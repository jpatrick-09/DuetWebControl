{"remainingRequest":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\src\\components\\dialogs\\FilamentDialog.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\src\\components\\dialogs\\FilamentDialog.vue","mtime":1592248188520},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\vuetify-loader\\lib\\loader.js","mtime":1574476662000},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQondXNlIHN0cmljdCcNCg0KaW1wb3J0IHsgbWFwU3RhdGUsIG1hcEdldHRlcnMsIG1hcEFjdGlvbnMgfSBmcm9tICd2dWV4Jw0KDQppbXBvcnQgeyBEaXNjb25uZWN0ZWRFcnJvciB9IGZyb20gJy4uLy4uL3V0aWxzL2Vycm9ycy5qcycNCg0KZXhwb3J0IGRlZmF1bHQgew0KCXByb3BzOiB7DQoJCXNob3duOiB7DQoJCQl0eXBlOiBCb29sZWFuLA0KCQkJcmVxdWlyZWQ6IHRydWUNCgkJfSwNCgkJdG9vbDogT2JqZWN0DQoJfSwNCgljb21wdXRlZDogew0KCQkuLi5tYXBTdGF0ZSgnbWFjaGluZS9tb2RlbCcsIHsNCgkJCWV4dHJ1ZGVyczogc3RhdGUgPT4gc3RhdGUubW92ZS5leHRydWRlcnMsDQoJCQlmaWxhbWVudHNEaXJlY3Rvcnk6IHN0YXRlID0+IHN0YXRlLmRpcmVjdG9yaWVzLmZpbGFtZW50cw0KCQl9KSwNCgkJLi4ubWFwR2V0dGVycygnbWFjaGluZS9tb2RlbCcsIFsnY3VycmVudFRvb2wnXSkNCgl9LA0KCWRhdGEoKSB7DQoJCXJldHVybiB7DQoJCQlmaWxhbWVudHM6IFtdLA0KCQkJbG9hZGluZzogZmFsc2UNCgkJfQ0KCX0sDQoJbWV0aG9kczogew0KCQkuLi5tYXBBY3Rpb25zKCdtYWNoaW5lJywgWydzZW5kQ29kZScsICdnZXRGaWxlTGlzdCddKSwNCgkJYXN5bmMgbG9hZEZpbGFtZW50cygpIHsNCgkJCWlmICh0aGlzLmxvYWRpbmcpIHsNCgkJCQlyZXR1cm47DQoJCQl9DQoNCgkJCXRoaXMubG9hZGluZyA9IHRydWUNCgkJCXRyeSB7DQoJCQkJY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmdldEZpbGVMaXN0KHRoaXMuZmlsYW1lbnRzRGlyZWN0b3J5KTsNCgkJCQl0aGlzLmZpbGFtZW50cyA9IHJlc3BvbnNlLmZpbHRlcihpdGVtID0+IGl0ZW0uaXNEaXJlY3RvcnkpLm1hcChpdGVtID0+IGl0ZW0ubmFtZSkuZmlsdGVyKGZ1bmN0aW9uKGZpbGFtZW50KSB7DQoJCQkJCS8vIEV4Y2x1ZGUgZmlsYW1lbnRzIHRoYXQgYXJlIGFscmVhZHkgbG9hZGVkIChSUkYgZG9lcyBub3QgYWxsb3cgbG9hZGluZyB0aGUgc2FtZSBmaWxhbWVudCBpbnRvIG11bHRpcGxlIHRvb2xzKQ0KCQkJCQlyZXR1cm4gIXRoaXMuZXh0cnVkZXJzLnNvbWUoZXh0cnVkZXIgPT4gZXh0cnVkZXIuZmlsYW1lbnQgPT09IGZpbGFtZW50KTsNCgkJCQl9LCB0aGlzKTsNCgkJCX0gY2F0Y2ggKGUpIHsNCgkJCQlpZiAoIShlIGluc3RhbmNlb2YgRGlzY29ubmVjdGVkRXJyb3IpKSB7DQoJCQkJCWNvbnNvbGUud2FybihlKTsNCgkJCQkJdGhpcy4kbG9nKCdlcnJvcicsIHRoaXMuJHQoJ2Vycm9yLmZpbGFtZW50c0xvYWRGYWlsZWQnKSwgZS5tZXNzYWdlKTsNCgkJCQl9DQoJCQkJdGhpcy5oaWRlKCk7DQoJCQl9DQoJCQl0aGlzLmxvYWRpbmcgPSBmYWxzZTsNCgkJfSwNCgkJZmlsYW1lbnRDbGljayhmaWxhbWVudCkgew0KCQkJdGhpcy5oaWRlKCk7DQoNCgkJCWxldCBjb2RlID0gJyc7DQoJCQlpZiAodGhpcy5jdXJyZW50VG9vbCAhPT0gdGhpcy50b29sKSB7DQoJCQkJLy8gU2VsZWN0IHRvb2wgZmlyc3QNCgkJCQljb2RlID0gYFQke3RoaXMudG9vbC5udW1iZXJ9XG5gOw0KCQkJfQ0KCQkJaWYgKHRoaXMudG9vbC5maWxhbWVudEV4dHJ1ZGVyID49IDAgJiYgdGhpcy50b29sLmZpbGFtZW50RXh0cnVkZXIgPCB0aGlzLmV4dHJ1ZGVycy5sZW5ndGggJiYNCgkJCQl0aGlzLmV4dHJ1ZGVyc1t0aGlzLnRvb2wuZmlsYW1lbnRFeHRydWRlcl0uZmlsYW1lbnQpIHsNCgkJCQkvLyBVbmxvYWQgY3VycmVudCBmaWxhbWVudA0KCQkJCWNvZGUgKz0gJ003MDJcbic7DQoJCQl9DQoJCQkvLyBSdW4gbG9hZCBzZXF1ZW5jZSBhbmQgY29uZmlndXJlIGN1cnJlbnQgdG9vbCBmb3IgaXQNCgkJCS8vIFRPRE8gTWFrZSBNNzAzIGNvbmZpZ3VyYWJsZQ0KCQkJY29kZSArPSBgTTcwMSBTIiR7ZmlsYW1lbnR9IlxuTTcwM2A7DQoJCQl0aGlzLnNlbmRDb2RlKGNvZGUpOw0KCQl9LA0KCQloaWRlKCkgew0KCQkJdGhpcy4kZW1pdCgndXBkYXRlOnNob3duJywgZmFsc2UpOw0KCQl9DQoJfSwNCgl3YXRjaDogew0KCQlzaG93bih0bykgew0KCQkJaWYgKHRvKSB7DQoJCQkJLy8gTG9hZCBmaWxhbWVudHMgd2hlbiB0aGlzIGRpYWxvZyBpcyBzaG93bg0KCQkJCXRoaXMubG9hZEZpbGFtZW50cygpOw0KCQkJfQ0KCQl9DQoJfQ0KfQ0K"},{"version":3,"sources":["FilamentDialog.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4BA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"FilamentDialog.vue","sourceRoot":"src/components/dialogs","sourcesContent":["<template>\r\n\t<v-dialog v-model=\"shown\" persistent width=\"360\" @keydown.escape=\"hide\">\r\n\t\t<v-card>\r\n\t\t\t<v-card-title class=\"headline\">\r\n\t\t\t\t{{ $t(tool ? (tool.filament ? 'dialog.filament.titleChange' : 'dialog.filament.titleLoad') : 'generic.noValue') }}\r\n\t\t\t</v-card-title>\r\n\r\n\t\t\t<v-card-text>\r\n\t\t\t\t{{ $t('dialog.filament.prompt') }}\r\n\r\n\t\t\t\t<v-progress-linear indeterminate v-if=\"loading\"></v-progress-linear>\r\n\t\t\t\t<v-list v-if=\"!loading\">\r\n\t\t\t\t\t<v-list-item v-for=\"filament in filaments\" :key=\"filament\" @click=\"filamentClick(filament)\">\r\n\t\t\t\t\t\t<v-icon class=\"mr-1\">mdi-radiobox-marked</v-icon> {{ filament }}\r\n\t\t\t\t\t</v-list-item>\r\n\t\t\t\t</v-list>\r\n\t\t\t</v-card-text>\r\n\r\n\t\t\t<v-card-actions>\r\n\t\t\t\t<v-spacer></v-spacer>\r\n\t\t\t\t<v-btn color=\"blue darken-1\" text @click=\"hide\">{{ $t('generic.cancel') }}</v-btn>\r\n\t\t\t\t<v-spacer></v-spacer>\r\n\t\t\t</v-card-actions>\r\n\t\t</v-card>\r\n\t</v-dialog>\r\n</template>\r\n\r\n<script>\r\n'use strict'\r\n\r\nimport { mapState, mapGetters, mapActions } from 'vuex'\r\n\r\nimport { DisconnectedError } from '../../utils/errors.js'\r\n\r\nexport default {\r\n\tprops: {\r\n\t\tshown: {\r\n\t\t\ttype: Boolean,\r\n\t\t\trequired: true\r\n\t\t},\r\n\t\ttool: Object\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapState('machine/model', {\r\n\t\t\textruders: state => state.move.extruders,\r\n\t\t\tfilamentsDirectory: state => state.directories.filaments\r\n\t\t}),\r\n\t\t...mapGetters('machine/model', ['currentTool'])\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tfilaments: [],\r\n\t\t\tloading: false\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\t...mapActions('machine', ['sendCode', 'getFileList']),\r\n\t\tasync loadFilaments() {\r\n\t\t\tif (this.loading) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.loading = true\r\n\t\t\ttry {\r\n\t\t\t\tconst response = await this.getFileList(this.filamentsDirectory);\r\n\t\t\t\tthis.filaments = response.filter(item => item.isDirectory).map(item => item.name).filter(function(filament) {\r\n\t\t\t\t\t// Exclude filaments that are already loaded (RRF does not allow loading the same filament into multiple tools)\r\n\t\t\t\t\treturn !this.extruders.some(extruder => extruder.filament === filament);\r\n\t\t\t\t}, this);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tif (!(e instanceof DisconnectedError)) {\r\n\t\t\t\t\tconsole.warn(e);\r\n\t\t\t\t\tthis.$log('error', this.$t('error.filamentsLoadFailed'), e.message);\r\n\t\t\t\t}\r\n\t\t\t\tthis.hide();\r\n\t\t\t}\r\n\t\t\tthis.loading = false;\r\n\t\t},\r\n\t\tfilamentClick(filament) {\r\n\t\t\tthis.hide();\r\n\r\n\t\t\tlet code = '';\r\n\t\t\tif (this.currentTool !== this.tool) {\r\n\t\t\t\t// Select tool first\r\n\t\t\t\tcode = `T${this.tool.number}\\n`;\r\n\t\t\t}\r\n\t\t\tif (this.tool.filamentExtruder >= 0 && this.tool.filamentExtruder < this.extruders.length &&\r\n\t\t\t\tthis.extruders[this.tool.filamentExtruder].filament) {\r\n\t\t\t\t// Unload current filament\r\n\t\t\t\tcode += 'M702\\n';\r\n\t\t\t}\r\n\t\t\t// Run load sequence and configure current tool for it\r\n\t\t\t// TODO Make M703 configurable\r\n\t\t\tcode += `M701 S\"${filament}\"\\nM703`;\r\n\t\t\tthis.sendCode(code);\r\n\t\t},\r\n\t\thide() {\r\n\t\t\tthis.$emit('update:shown', false);\r\n\t\t}\r\n\t},\r\n\twatch: {\r\n\t\tshown(to) {\r\n\t\t\tif (to) {\r\n\t\t\t\t// Load filaments when this dialog is shown\r\n\t\t\t\tthis.loadFilaments();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n"]}]}