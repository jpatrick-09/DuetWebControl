{"remainingRequest":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\src\\components\\buttons\\UploadBtn.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\src\\components\\buttons\\UploadBtn.vue","mtime":1592248188509},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\vuetify-loader\\lib\\loader.js","mtime":1574476662000},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQondXNlIHN0cmljdCcNCg0KaW1wb3J0IEpTWmlwIGZyb20gJ2pzemlwJw0KaW1wb3J0IHsgVkJ0biB9IGZyb20gJ3Z1ZXRpZnkvbGliJw0KDQppbXBvcnQgeyBtYXBTdGF0ZSwgbWFwR2V0dGVycywgbWFwQWN0aW9ucyB9IGZyb20gJ3Z1ZXgnDQoNCmltcG9ydCB7IE5ldHdvcmtJbnRlcmZhY2VUeXBlLCBTdGF0dXNUeXBlIH0gZnJvbSAnLi4vLi4vc3RvcmUvbWFjaGluZS9tb2RlbEVudW1zLmpzJw0KaW1wb3J0IFBhdGggZnJvbSAnLi4vLi4vdXRpbHMvcGF0aC5qcycNCmltcG9ydCB7IERpc2Nvbm5lY3RlZEVycm9yIH0gZnJvbSAnLi4vLi4vdXRpbHMvZXJyb3JzLmpzJw0KDQpjb25zdCB3ZWJFeHRlbnNpb25zID0gWycuaHRtJywgJy5odG1sJywgJy5pY28nLCAnLnhtbCcsICcuY3NzJywgJy5tYXAnLCAnLmpzJywgJy50dGYnLCAnLmVvdCcsICcuc3ZnJywgJy53b2ZmJywgJy53b2ZmMicsICcuanBlZycsICcuanBnJywgJy5wbmcnXQ0KDQpleHBvcnQgZGVmYXVsdCB7DQoJY29tcHV0ZWQ6IHsNCgkJLi4ubWFwU3RhdGUoWydpc0xvY2FsJ10pLA0KCQkuLi5tYXBTdGF0ZSgnbWFjaGluZS9tb2RlbCcsIFsnYm9hcmRzJywgJ2RpcmVjdG9yaWVzJywgJ25ldHdvcmsnLCAnc3RhdGUnXSksDQoJCS4uLm1hcEdldHRlcnMoWydpc0Nvbm5lY3RlZCcsICd1aUZyb3plbiddKSwNCgkJY2FwdGlvbigpIHsNCgkJCWlmICh0aGlzLmV4dHJhY3RpbmcpIHsNCgkJCQlyZXR1cm4gdGhpcy4kdCgnZ2VuZXJpYy5leHRyYWN0aW5nJyk7DQoJCQl9DQoJCQlpZiAodGhpcy51cGxvYWRpbmcpIHsNCgkJCQlyZXR1cm4gdGhpcy4kdCgnZ2VuZXJpYy51cGxvYWRpbmcnKTsNCgkJCX0NCgkJCXJldHVybiB0aGlzLiR0KGBidXR0b24udXBsb2FkWycke3RoaXMudGFyZ2V0fSddLmNhcHRpb25gKTsNCgkJfSwNCgkJY2FuVXBsb2FkKCkgew0KCQkJcmV0dXJuIHRoaXMuaXNDb25uZWN0ZWQgJiYgIXRoaXMudWlGcm96ZW47DQoJCX0sDQoJCWFjY2VwdCgpIHsNCgkJCXN3aXRjaCAodGhpcy50YXJnZXQpIHsNCgkJCQljYXNlICdnY29kZXMnOiByZXR1cm4gJy5nLC5nY29kZSwuZ2MsLmdjbywubmMsLm5nYywudGFwJzsNCgkJCQljYXNlICdzdGFydCc6IHJldHVybiAnLmcsLmdjb2RlLC5nYywuZ2NvLC5uYywubmdjLC50YXAnOw0KCQkJCWNhc2UgJ21hY3Jvcyc6IHJldHVybiAnKic7DQoJCQkJY2FzZSAnZmlsYW1lbnRzJzogcmV0dXJuICcuemlwJzsNCgkJCQljYXNlICdmaXJtd2FyZSc6IHJldHVybiAnLnppcCwuYmluJzsNCgkJCQljYXNlICdtZW51JzogcmV0dXJuICcqJzsNCgkJCQljYXNlICdzeXN0ZW0nOiByZXR1cm4gJy56aXAsLmJpbiwuanNvbiwuZywuY3N2JzsNCgkJCQljYXNlICd3ZWInOiByZXR1cm4gJy56aXAsLmNzdiwuanNvbiwuaHRtLC5odG1sLC5pY28sLnhtbCwuY3NzLC5tYXAsLmpzLC50dGYsLmVvdCwuc3ZnLC53b2ZmLC53b2ZmMiwuanBlZywuanBnLC5wbmcsLmd6JzsNCgkJCX0NCgkJCXJldHVybiB1bmRlZmluZWQ7DQoJCX0sDQoJCWRlc3RpbmF0aW9uRGlyZWN0b3J5KCkgew0KCQkJaWYgKHRoaXMuZGlyZWN0b3J5KSB7DQoJCQkJcmV0dXJuIHRoaXMuZGlyZWN0b3J5Ow0KCQkJfQ0KDQoJCQlzd2l0Y2ggKHRoaXMudGFyZ2V0KSB7DQoJCQkJY2FzZSAnZ2NvZGVzJzogcmV0dXJuIHRoaXMuZGlyZWN0b3JpZXMuZ0NvZGVzOw0KCQkJCWNhc2UgJ3N0YXJ0JzogcmV0dXJuIHRoaXMuZGlyZWN0b3JpZXMuZ0NvZGVzOw0KCQkJCWNhc2UgJ2Zpcm13YXJlJzogcmV0dXJuIHRoaXMuZGlyZWN0b3JpZXMuZmlybXdhcmU7DQoJCQkJY2FzZSAnbWFjcm9zJzogcmV0dXJuIHRoaXMuZGlyZWN0b3JpZXMubWFjcm9zOw0KCQkJCWNhc2UgJ2ZpbGFtZW50cyc6IHJldHVybiB0aGlzLmRpcmVjdG9yaWVzLmZpbGFtZW50czsNCgkJCQljYXNlICdtZW51JzogcmV0dXJuIHRoaXMuZGlyZWN0b3JpZXMubWVudTsNCgkJCQljYXNlICdzeXN0ZW0nOiByZXR1cm4gdGhpcy5kaXJlY3Rvcmllcy5zeXN0ZW07DQoJCQkJY2FzZSAnd2ViJzogcmV0dXJuIHRoaXMuZGlyZWN0b3JpZXMud2ViOw0KCQkJfQ0KCQkJcmV0dXJuIHVuZGVmaW5lZDsNCgkJfSwNCgkJaXNCdXN5KCkgew0KCQkJcmV0dXJuIHRoaXMuZXh0cmFjdGluZyB8fCB0aGlzLnVwbG9hZGluZzsNCgkJfQ0KCX0sDQoJZGF0YSgpIHsNCgkJcmV0dXJuIHsNCgkJCWlubmVyQ29sb3I6IHRoaXMuY29sb3IsDQoJCQlleHRyYWN0aW5nOiBmYWxzZSwNCgkJCXVwbG9hZGluZzogZmFsc2UsDQoNCgkJCWNvbmZpcm1VcGRhdGU6IGZhbHNlLA0KCQkJdXBkYXRlczogew0KCQkJCXdlYkludGVyZmFjZTogZmFsc2UsDQoJCQkJZmlybXdhcmVCb2FyZHM6IFtdLA0KCQkJCXdpZmlTZXJ2ZXI6IGZhbHNlLA0KCQkJCXdpZmlTZXJ2ZXJTcGlmZnM6IGZhbHNlLA0KDQoJCQkJY29kZVNlbnQ6IGZhbHNlDQoJCQl9DQoJCX0NCgl9LA0KCWV4dGVuZHM6IFZCdG4sDQoJcHJvcHM6IHsNCgkJZGlyZWN0b3J5OiBTdHJpbmcsDQoJCXRhcmdldDogew0KCQkJdHlwZTogU3RyaW5nLA0KCQkJcmVxdWlyZWQ6IHRydWUNCgkJfSwNCgkJdXBsb2FkUHJpbnQ6IEJvb2xlYW4NCgl9LA0KCW1ldGhvZHM6IHsNCgkJLi4ubWFwQWN0aW9ucygnbWFjaGluZScsIFsnc2VuZENvZGUnLCAndXBsb2FkJ10pLA0KCQljaG9vc2VGaWxlKCkgew0KCQkJaWYgKCF0aGlzLmlzQnVzeSkgew0KCQkJCXRoaXMuJHJlZnMuZmlsZUlucHV0LmNsaWNrKCk7DQoJCQl9DQoJCX0sDQoJCWFzeW5jIGZpbGVTZWxlY3RlZChlKSB7DQoJCQlhd2FpdCB0aGlzLmRvVXBsb2FkKGUudGFyZ2V0LmZpbGVzKTsNCgkJCWUudGFyZ2V0LnZhbHVlID0gJyc7DQoJCX0sDQoJCWlzV2ViRmlsZShmaWxlbmFtZSkgew0KCQkJaWYgKHdlYkV4dGVuc2lvbnMuc29tZShleHRlbnNpb24gPT4gZmlsZW5hbWUudG9Mb3dlckNhc2UoKS5lbmRzV2l0aChleHRlbnNpb24pKSkgew0KCQkJCXJldHVybiB0cnVlOw0KCQkJfQ0KDQoJCQljb25zdCBtYXRjaGVzID0gLyhcLlteLl0rKS5neiQvaS5leGVjKGZpbGVuYW1lKTsNCgkJCWlmIChtYXRjaGVzICYmIHdlYkV4dGVuc2lvbnMuaW5kZXhPZihtYXRjaGVzWzFdLnRvTG93ZXJDYXNlKCkpICE9PSAtMSkgew0KCQkJCXJldHVybiB0cnVlOw0KCQkJfQ0KCQkJcmV0dXJuIGZhbHNlOw0KCQl9LA0KCQlnZXRGaXJtd2FyZU5hbWUoZmlsZU5hbWUpIHsNCgkJCWxldCByZXN1bHQgPSBudWxsOw0KCQkJdGhpcy5ib2FyZHMuZm9yRWFjaCgoYm9hcmQsIGluZGV4KSA9PiB7DQoJCQkJaWYgKGJvYXJkICYmIGJvYXJkLmZpcm13YXJlRmlsZU5hbWUgJiYgKGJvYXJkLmNhbkFkZHJlc3MgfHwgaW5kZXggPT09IDApKSB7DQoJCQkJCWNvbnN0IHJlZ0V4ID0gbmV3IFJlZ0V4cChib2FyZC5maXJtd2FyZUZpbGVOYW1lLnJlcGxhY2UoL1wuYmluJC8sICcoLiopXFwuYmluJyksICdpJyk7DQoJCQkJCWlmIChyZWdFeC50ZXN0KGZpbGVOYW1lKSkgew0KCQkJCQkJcmVzdWx0ID0gYm9hcmQuZmlybXdhcmVGaWxlTmFtZTsNCgkJCQkJCXRoaXMudXBkYXRlcy5maXJtd2FyZUJvYXJkcy5wdXNoKGJvYXJkLmNhbkFkZHJlc3MgfHwgMCk7DQoJCQkJCX0NCgkJCQl9DQoJCQl9LCB0aGlzKTsNCgkJCXJldHVybiByZXN1bHQ7DQoJCX0sDQoJCWdldEJpbmFyeU5hbWUoa2V5LCBmaWxlTmFtZSkgew0KCQkJbGV0IHJlc3VsdCA9IG51bGw7DQoJCQl0aGlzLmJvYXJkcy5mb3JFYWNoKGJvYXJkID0+IHsNCgkJCQlpZiAoYm9hcmQgJiYgYm9hcmRba2V5XSkgew0KCQkJCQljb25zdCByZWdFeCA9IG5ldyBSZWdFeHAoYm9hcmRba2V5XS5yZXBsYWNlKC9cLmJpbiQvLCAnKC4qKVxcLmJpbicpLCAnaScpOw0KCQkJCQlpZiAocmVnRXgudGVzdChmaWxlTmFtZSkpIHsNCgkJCQkJCXJlc3VsdCA9IGJvYXJkW2tleV07DQoJCQkJCX0NCgkJCQl9DQoJCQl9KTsNCgkJCXJldHVybiByZXN1bHQ7DQoJCX0sDQoJCWFzeW5jIGRvVXBsb2FkKGZpbGVzLCB6aXBOYW1lLCBzdGFydFRpbWUpIHsNCgkJCWlmICghZmlsZXMubGVuZ3RoKSB7DQoJCQkJcmV0dXJuOw0KCQkJfQ0KDQoJCQlpZiAodGhpcy50YXJnZXQgPT09ICdzdGFydCcgJiYgZmlsZXMubGVuZ3RoICE9PSAxKSB7DQoJCQkJdGhpcy4kbWFrZU5vdGlmaWNhdGlvbignZXJyb3InLCB0aGlzLiR0KGBidXR0b24udXBsb2FkWycke3RoaXMudGFyZ2V0fSddLmNhcHRpb25gKSwgdGhpcy4kdCgnZXJyb3IudXBsb2FkU3RhcnRXcm9uZ0ZpbGVDb3VudCcpKTsNCgkJCQlyZXR1cm47DQoJCQl9DQoNCgkJCWlmICghemlwTmFtZSkgew0KCQkJCWlmIChmaWxlcy5sZW5ndGggPiAxICYmIGZpbGVzWzBdLm5hbWUudG9Mb3dlckNhc2UoKS5lbmRzV2l0aCgnLnppcCcpKSB7DQoJCQkJCXRoaXMuJG1ha2VOb3RpZmljYXRpb24oJ2Vycm9yJywgdGhpcy4kdChgYnV0dG9uLnVwbG9hZFsnJHt0aGlzLnRhcmdldH0nXS5jYXB0aW9uYCksIHRoaXMuJHQoJ2Vycm9yLnVwbG9hZE5vU2luZ2xlWklQJykpOw0KCQkJCQlyZXR1cm47DQoJCQkJfQ0KDQoJCQkJaWYgKGZpbGVzWzBdLm5hbWUudG9Mb3dlckNhc2UoKS5lbmRzV2l0aCgnLnppcCcpKSB7DQoJCQkJCWNvbnN0IHppcCA9IG5ldyBKU1ppcCgpLCB6aXBGaWxlcyA9IFtdLCB0YXJnZXQgPSB0aGlzLnRhcmdldDsNCgkJCQkJdGhpcy5leHRyYWN0aW5nID0gdHJ1ZTsNCgkJCQkJdHJ5IHsNCgkJCQkJCS8vIE9wZW4gdGhlIFpJUCBmaWxlIGFuZCByZWFkIGl0cyBjb250ZW50DQoJCQkJCQlhd2FpdCB6aXAubG9hZEFzeW5jKGZpbGVzWzBdLCB7IGNoZWNrQ1JDMzI6IHRydWUgfSk7DQoJCQkJCQl6aXAuZm9yRWFjaChmdW5jdGlvbihmaWxlKSB7DQoJCQkJCQkJaWYgKCFmaWxlLmVuZHNXaXRoKCcvJykgJiYgKGZpbGUuc3BsaXQoJy8nKS5sZW5ndGggPT09IDIgfHwgdGFyZ2V0ICE9PSAnZmlsYW1lbnRzJykpIHsNCgkJCQkJCQkJemlwRmlsZXMucHVzaChmaWxlKTsNCgkJCQkJCQl9DQoJCQkJCQl9KTsNCg0KCQkJCQkJLy8gQ291bGQgd2UgZ2V0IGFueXRoaW5nIHVzZWZ1bD8NCgkJCQkJCWlmICghemlwRmlsZXMubGVuZ3RoKSB7DQoJCQkJCQkJdGhpcy5leHRyYWN0aW5nID0gZmFsc2U7DQoJCQkJCQkJdGhpcy4kbWFrZU5vdGlmaWNhdGlvbignZXJyb3InLCB0aGlzLiR0KGBidXR0b24udXBsb2FkWycke3RoaXMudGFyZ2V0fSddLmNhcHRpb25gKSwgdGhpcy4kdCgnZXJyb3IudXBsb2FkTm9GaWxlcycpKTsNCgkJCQkJCQlyZXR1cm47DQoJCQkJCQl9DQoNCgkJCQkJCS8vIEV4dHJhY3QgZXZlcnl0aGluZyBhbmQgc3RhcnQgdGhlIHVwbG9hZA0KCQkJCQkJZm9yIChsZXQgaSA9IDA7IGkgPCB6aXBGaWxlcy5sZW5ndGg7IGkrKykgew0KCQkJCQkJCWNvbnN0IG5hbWUgPSB6aXBGaWxlc1tpXTsNCgkJCQkJCQl6aXBGaWxlc1tpXSA9IGF3YWl0IHppcC5maWxlKG5hbWUpLmFzeW5jKCdibG9iJyk7DQoJCQkJCQkJemlwRmlsZXNbaV0ubmFtZSA9IG5hbWU7DQoJCQkJCQl9DQoJCQkJCQl0aGlzLmRvVXBsb2FkKHppcEZpbGVzLCBmaWxlc1swXS5uYW1lLCBuZXcgRGF0ZSgpKTsNCgkJCQkJfSBjYXRjaCAoZSkgew0KCQkJCQkJY29uc29sZS53YXJuKGUpOw0KCQkJCQkJdGhpcy4kbWFrZU5vdGlmaWNhdGlvbignZXJyb3InLCB0aGlzLiR0KCdlcnJvci51cGxvYWREZWNvbXByZXNzaW9uRmFpbGVkJyksIGUubWVzc2FnZSk7DQoJCQkJCX0NCgkJCQkJdGhpcy5leHRyYWN0aW5nID0gZmFsc2U7DQoJCQkJCXJldHVybjsNCgkJCQl9DQoJCQl9DQoNCgkJCXRoaXMudXBkYXRlcy53ZWJJbnRlcmZhY2UgPSBmYWxzZTsNCgkJCXRoaXMudXBkYXRlcy5maXJtd2FyZUJvYXJkcyA9IFtdOw0KCQkJdGhpcy51cGRhdGVzLndpZmlTZXJ2ZXIgPSBmYWxzZTsNCgkJCXRoaXMudXBkYXRlcy53aWZpU2VydmVyU3BpZmZzID0gZmFsc2U7DQoNCgkJCWxldCBzdWNjZXNzID0gdHJ1ZTsNCgkJCXRoaXMudXBsb2FkaW5nID0gdHJ1ZTsNCgkJCWZvciAobGV0IGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyBpKyspIHsNCgkJCQljb25zdCBjb250ZW50ID0gZmlsZXNbaV07DQoNCgkJCQkvLyBBZGp1c3QgZmlsZW5hbWUgaWYgYW4gdXBkYXRlIGlzIGJlaW5nIHVwbG9hZGVkDQoJCQkJbGV0IGZpbGVuYW1lID0gUGF0aC5jb21iaW5lKHRoaXMuZGVzdGluYXRpb25EaXJlY3RvcnksIGNvbnRlbnQubmFtZSk7DQoJCQkJaWYgKHRoaXMudGFyZ2V0ID09PSAnc3lzdGVtJyB8fCB0aGlzLnRhcmdldCA9PT0gJ2Zpcm13YXJlJykgew0KCQkJCQlpZiAoUGF0aC5pc1NkUGF0aCgnLycgKyBjb250ZW50Lm5hbWUpKSB7DQoJCQkJCQlmaWxlbmFtZSA9IFBhdGguY29tYmluZSgnMDovJywgY29udGVudC5uYW1lKTsNCgkJCQkJfSBlbHNlIGlmICh0aGlzLmlzV2ViRmlsZShjb250ZW50Lm5hbWUpKSB7DQoJCQkJCQlmaWxlbmFtZSA9IFBhdGguY29tYmluZSh0aGlzLmRpcmVjdG9yaWVzLndlYiwgY29udGVudC5uYW1lKTsNCgkJCQkJCXRoaXMudXBkYXRlcy53ZWJJbnRlcmZhY2UgfD0gL2luZGV4Lmh0bWwoXC5neik/L2kudGVzdChjb250ZW50Lm5hbWUpOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJY29uc3QgZmlybXdhcmVGaWxlTmFtZSA9IHRoaXMuZ2V0RmlybXdhcmVOYW1lKGNvbnRlbnQubmFtZSk7DQoJCQkJCQljb25zdCBib290bG9hZGVyRmlsZU5hbWUgPSB0aGlzLmdldEJpbmFyeU5hbWUoJ2Jvb3Rsb2FkZXJGaWxlTmFtZScsIGNvbnRlbnQubmFtZSk7DQoJCQkJCQljb25zdCBpYXBGaWxlTmFtZVNCQyA9IHRoaXMuZ2V0QmluYXJ5TmFtZSgnaWFwRmlsZU5hbWVTQkMnLCBjb250ZW50Lm5hbWUpOw0KCQkJCQkJY29uc3QgaWFwRmlsZU5hbWVTRCA9IHRoaXMuZ2V0QmluYXJ5TmFtZSgnaWFwRmlsZU5hbWVTRCcsIGNvbnRlbnQubmFtZSk7DQoJCQkJCQlpZiAoZmlybXdhcmVGaWxlTmFtZSkgew0KCQkJCQkJCWZpbGVuYW1lID0gUGF0aC5jb21iaW5lKHRoaXMuZGlyZWN0b3JpZXMuZmlybXdhcmUsIGZpcm13YXJlRmlsZU5hbWUpOw0KCQkJCQkJfSBlbHNlIGlmIChib290bG9hZGVyRmlsZU5hbWUpIHsNCgkJCQkJCQlmaWxlbmFtZSA9IFBhdGguY29tYmluZSh0aGlzLmRpcmVjdG9yaWVzLmZpcm13YXJlLCBib290bG9hZGVyRmlsZU5hbWUpOw0KCQkJCQkJfSBlbHNlIGlmICh0aGlzLnN0YXRlLmRzZlZlcnNpb24gJiYgaWFwRmlsZU5hbWVTQkMpIHsNCgkJCQkJCQlmaWxlbmFtZSA9IFBhdGguY29tYmluZSh0aGlzLmRpcmVjdG9yaWVzLmZpcm13YXJlLCBpYXBGaWxlTmFtZVNCQyk7DQoJCQkJCQl9IGVsc2UgaWYgKGlhcEZpbGVOYW1lU0QpIHsNCgkJCQkJCQlmaWxlbmFtZSA9IFBhdGguY29tYmluZSh0aGlzLmRpcmVjdG9yaWVzLmZpcm13YXJlLCBpYXBGaWxlTmFtZVNEKTsNCgkJCQkJCX0gZWxzZSBpZiAoIXRoaXMuc3RhdGUuZHNmVmVyc2lvbiAmJiB0aGlzLm5ldHdvcmsuaW50ZXJmYWNlcy5zb21lKGlmYWNlID0+IGlmYWNlLnR5cGUgPT09IE5ldHdvcmtJbnRlcmZhY2VUeXBlLndpZmkpKSB7DQoJCQkJCQkJaWYgKCgvRHVldFdpRmlTb2NrZXRTZXJ2ZXIoLiopXC5iaW4vaS50ZXN0KGNvbnRlbnQubmFtZSkgfHwgL0R1ZXRXaUZpU2VydmVyKC4qKVwuYmluL2kudGVzdChjb250ZW50Lm5hbWUpKSkgew0KCQkJCQkJCQlmaWxlbmFtZSA9IFBhdGguY29tYmluZSh0aGlzLmRpcmVjdG9yaWVzLmZpcm13YXJlLCAnRHVldFdpRmlTZXJ2ZXIuYmluJyk7DQoJCQkJCQkJCXRoaXMudXBkYXRlcy53aWZpU2VydmVyID0gdHJ1ZTsNCgkJCQkJCQl9IGVsc2UgaWYgKC9EdWV0V2ViQ29udHJvbCguKilcLmJpbi9pLnRlc3QoY29udGVudC5uYW1lKSkgew0KCQkJCQkJCQlmaWxlbmFtZSA9IFBhdGguY29tYmluZSh0aGlzLmRpcmVjdG9yaWVzLmZpcm13YXJlLCAnRHVldFdlYkNvbnRyb2wuYmluJyk7DQoJCQkJCQkJCXRoaXMudXBkYXRlcy53aWZpU2VydmVyU3BpZmZzID0gdHJ1ZTsNCgkJCQkJCQl9DQoJCQkJCQl9IGVsc2UgaWYgKGNvbnRlbnQubmFtZS5lbmRzV2l0aCgnLmJpbicpKSB7DQoJCQkJCQkJLy8gRklYTUUgVGhpcyB3aWxsIGJlIG5vIGxvbmdlciBuZWVkZWQgd2hlbiBDQU4gYm9hcmQgZW51bWVyYXRpb24gaXMgc3VwcG9ydGVkDQoJCQkJCQkJZmlsZW5hbWUgPSBQYXRoLmNvbWJpbmUodGhpcy5kaXJlY3Rvcmllcy5maXJtd2FyZSwgY29udGVudC5uYW1lKTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0NCg0KCQkJCXRyeSB7DQoJCQkJCS8vIFN0YXJ0IHVwbG9hZGluZw0KCQkJCQlpZiAoZmlsZXMubGVuZ3RoID4gMSkgew0KCQkJCQkJYXdhaXQgdGhpcy51cGxvYWQoeyBmaWxlbmFtZSwgY29udGVudCwgc2hvd1N1Y2Nlc3M6ICF6aXBOYW1lLCBudW06IGkgKyAxLCBjb3VudDogZmlsZXMubGVuZ3RoIH0pOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJYXdhaXQgdGhpcy51cGxvYWQoeyBmaWxlbmFtZSwgY29udGVudCB9KTsNCgkJCQkJfQ0KDQoJCQkJCS8vIFJ1biBpdCAoaWYgcmVxdWlyZWQpDQoJCQkJCWlmICh0aGlzLnRhcmdldCA9PT0gJ3N0YXJ0Jykgew0KCQkJCQkJYXdhaXQgdGhpcy5zZW5kQ29kZShgTTMyICIke2ZpbGVuYW1lfSJgKTsNCgkJCQkJfQ0KCQkJCX0gY2F0Y2ggKGUpIHsNCgkJCQkJc3VjY2VzcyA9IGZhbHNlOw0KCQkJCQl0aGlzLiRlbWl0KCd1cGxvYWRGYWlsZWQnLCB7IGZpbGVuYW1lLCByZWFzb246IGUgfSk7DQoJCQkJCWJyZWFrOw0KCQkJCX0NCgkJCX0NCgkJCXRoaXMudXBsb2FkaW5nID0gZmFsc2U7DQoNCgkJCWlmIChzdWNjZXNzKSB7DQoJCQkJdGhpcy4kZW1pdCgndXBsb2FkQ29tcGxldGUnLCBmaWxlcyk7DQoNCgkJCQlpZiAoKHRoaXMudXBkYXRlcy5maXJtd2FyZUJvYXJkcy5sZW5ndGggPiAwKSB8fCB0aGlzLnVwZGF0ZXMud2lmaVNlcnZlciB8fCB0aGlzLnVwZGF0ZXMud2lmaVNlcnZlclNwaWZmcykgew0KCQkJCQkvLyBBc2sgdXNlciB0byBwZXJmb3JtIGFuIHVwZGF0ZQ0KCQkJCQl0aGlzLmNvbmZpcm1VcGRhdGUgPSB0cnVlOw0KCQkJCX0gZWxzZSBpZiAoIXRoaXMuaXNMb2NhbCAmJiB0aGlzLnVwZGF0ZXMud2ViSW50ZXJmYWNlKSB7DQoJCQkJCS8vIFJlbG9hZCB0aGUgd2ViIGludGVyZmFjZSBpbW1lZGlhdGVseSBpZiBpdCB3YXMgdGhlIG9ubHkgdXBkYXRlDQoJCQkJCWxvY2F0aW9uLnJlbG9hZCh0cnVlKTsNCgkJCQl9DQoNCgkJCQkvLyBGSVhNRSBGb3Igc29tZSByZWFzb24gdGhlICR0IGZ1bmN0aW9uIHRocm93cyBhbiBleGNlcHRpb24gd2hlbiB0aGlzIGJ1dHRvbiBpcyBmbG9hdGluZw0KCQkJCWlmICh6aXBOYW1lKSB7DQoJCQkJCWNvbnN0IHNlY29uZHNQYXNzZWQgPSBNYXRoLnJvdW5kKChuZXcgRGF0ZSgpIC0gc3RhcnRUaW1lKSAvIDEwMDApOw0KCQkJCQl0aGlzLiRtYWtlTm90aWZpY2F0aW9uKCdzdWNjZXNzJywgdGhpcy4kdCgnbm90aWZpY2F0aW9uLnVwbG9hZC5zdWNjZXNzJywgW3ppcE5hbWUsIHRoaXMuJGRpc3BsYXlUaW1lKHNlY29uZHNQYXNzZWQpXSkpOw0KCQkJCX0NCgkJCX0NCgkJfSwNCgkJYXN5bmMgc3RhcnRVcGRhdGUoKSB7DQoJCQkvLyBVcGRhdGUgZXhwYW5zaW9uIGJvYXJkcw0KCQkJZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnVwZGF0ZXMuZmlybXdhcmVCb2FyZHMubGVuZ3RoOyBpKyspIHsNCgkJCQljb25zdCBib2FyZFRvVXBkYXRlID0gdGhpcy51cGRhdGVzLmZpcm13YXJlQm9hcmRzW2ldOw0KCQkJCWlmIChib2FyZFRvVXBkYXRlID4gMCkgew0KCQkJCQl0cnkgew0KCQkJCQkJYXdhaXQgdGhpcy5zZW5kQ29kZShgTTk5NyBCJHtib2FyZFRvVXBkYXRlfWApOw0KCQkJCQkJZG8gew0KCQkJCQkJCS8vIFdhaXQgaW4gMi1zZWNvbmQgaW50ZXJ2YWxzIHVudGlsIHRoZSBzdGF0dXMgaXMgbm8gbG9uZ2VyICdVcGRhdGluZycNCgkJCQkJCQlhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMjAwMCkpOw0KDQoJCQkJCQkJLy8gU3RvcCBpZiB0aGUgY29ubmVjdGlvbiBoYXMgYmVlbiBpbnRlcnJ1cHRlZA0KCQkJCQkJCWlmICghdGhpcy5pc0Nvbm5lY3RlZCkgew0KCQkJCQkJCQlyZXR1cm47DQoJCQkJCQkJfQ0KCQkJCQkJfSB3aGlsZSAodGhpcy5zdGF0ZS5zdGF0dXMgPT09IFN0YXR1c1R5cGUudXBkYXRpbmcpOw0KDQoJCQkJCX0gY2F0Y2ggKGUpIHsNCgkJCQkJCWlmICghKGUgaW5zdGFuY2VvZiBEaXNjb25uZWN0ZWRFcnJvcikpIHsNCgkJCQkJCQljb25zb2xlLndhcm4oZSk7DQoJCQkJCQkJdGhpcy4kbG9nKCdlcnJvcicsIHRoaXMuJHQoJ2dlbmVyaWMuZXJyb3InKSwgZS5tZXNzYWdlKTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCg0KCQkJLy8gVXBkYXRlIG90aGVyIG1vZHVsZXMNCgkJCWxldCBtb2R1bGVzID0gW107DQoJCQlpZiAodGhpcy51cGRhdGVzLmZpcm13YXJlQm9hcmRzLmluZGV4T2YoMCkgPj0gMCkgew0KCQkJCW1vZHVsZXMucHVzaCgnMCcpOw0KCQkJfQ0KCQkJaWYgKHRoaXMudXBkYXRlcy53aWZpU2VydmVyKSB7DQoJCQkJbW9kdWxlcy5wdXNoKCcxJyk7DQoJCQl9DQoJCQlpZiAodGhpcy51cGRhdGVzLndpZmlTZXJ2ZXJTcGlmZnMpIHsNCgkJCQltb2R1bGVzLnB1c2goJzInKTsNCgkJCX0NCg0KCQkJdGhpcy51cGRhdGVzLmNvZGVTZW50ID0gdHJ1ZTsNCgkJCXRyeSB7DQoJCQkJYXdhaXQgdGhpcy5zZW5kQ29kZShgTTk5NyBTJHttb2R1bGVzLmpvaW4oJzonKX1gKTsNCgkJCX0gY2F0Y2ggKGUpIHsNCgkJCQlpZiAoIShlIGluc3RhbmNlb2YgRGlzY29ubmVjdGVkRXJyb3IpKSB7DQoJCQkJCWNvbnNvbGUud2FybihlKTsNCgkJCQkJdGhpcy4kbG9nKCdlcnJvcicsIHRoaXMuJHQoJ2dlbmVyaWMuZXJyb3InKSwgZS5tZXNzYWdlKTsNCgkJCQl9DQoJCQl9DQoJCX0sDQoJCWRyYWdPdmVyKGUpIHsNCgkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCWUuc3RvcFByb3BhZ2F0aW9uKCk7DQoJCQlpZiAoIXRoaXMuaXNCdXN5KSB7DQoJCQkJdGhpcy5pbm5lckNvbG9yID0gJ3N1Y2Nlc3MnOw0KCQkJfQ0KCQl9LA0KCQlkcmFnTGVhdmUoZSkgew0KCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsNCgkJCXRoaXMuaW5uZXJDb2xvciA9IHRoaXMuY29sb3I7DQoJCX0sDQoJCWFzeW5jIGRyYWdEcm9wKGUpIHsNCgkJCXRoaXMuaW5uZXJDb2xvciA9IHRoaXMuY29sb3I7DQoJCQlpZiAoIXRoaXMuaXNCdXN5ICYmIGUuZGF0YVRyYW5zZmVyLmZpbGVzLmxlbmd0aCkgew0KCQkJCWF3YWl0IHRoaXMuZG9VcGxvYWQoZS5kYXRhVHJhbnNmZXIuZmlsZXMpOw0KCQkJfQ0KCQl9DQoJfSwNCgl3YXRjaDogew0KCQlpc0Nvbm5lY3RlZCh0bykgew0KCQkJaWYgKHRvICYmICF0aGlzLmlzTG9jYWwgJiYgdGhpcy51cGRhdGVzLmNvZGVTZW50ICYmIHRoaXMudXBkYXRlcy53ZWJJbnRlcmZhY2UpIHsNCgkJCQkvLyBSZWxvYWQgdGhlIHdlYiBpbnRlcmZhY2Ugd2hlbiB0aGUgY29ubmVjdGlvbiBjb3VsZCBiZSBlc3RhYmxpc2hlZCBhZ2Fpbg0KCQkJCWxvY2F0aW9uLnJlbG9hZCh0cnVlKTsNCgkJCX0NCgkJfQ0KCX0NCn0NCg=="},{"version":3,"sources":["UploadBtn.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAmBA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"UploadBtn.vue","sourceRoot":"src/components/buttons","sourcesContent":["<template>\r\n\t<div>\r\n\t\t<v-btn v-bind=\"$props\" @click=\"chooseFile\" :disabled=\"$props.disabled || !canUpload\" :loading=\"isBusy\" :title=\"$t(`button.upload['${target}'].title`)\" :color=\"innerColor\" @dragover=\"dragOver\" @dragleave=\"dragLeave\" @drop.prevent.stop=\"dragDrop\">\r\n\t\t\t<template #loader>\r\n\t\t\t\t<v-progress-circular indeterminate :size=\"23\" :width=\"2\" class=\"mr-2\"></v-progress-circular>\r\n\t\t\t\t{{ caption }}\r\n\t\t\t</template>\r\n\r\n\t\t\t<slot>\r\n\t\t\t\t<v-icon class=\"mr-2\">mdi-cloud-upload</v-icon> {{ caption }}\r\n\t\t\t</slot>\r\n\t\t</v-btn>\r\n\r\n\t\t<input ref=\"fileInput\" type=\"file\" :accept=\"accept\" hidden @change=\"fileSelected\" multiple>\r\n\t\t<confirm-dialog :shown.sync=\"confirmUpdate\" :title=\"$t('dialog.update.title')\" :prompt=\"$t('dialog.update.prompt')\" @confirmed=\"startUpdate\"></confirm-dialog>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n'use strict'\r\n\r\nimport JSZip from 'jszip'\r\nimport { VBtn } from 'vuetify/lib'\r\n\r\nimport { mapState, mapGetters, mapActions } from 'vuex'\r\n\r\nimport { NetworkInterfaceType, StatusType } from '../../store/machine/modelEnums.js'\r\nimport Path from '../../utils/path.js'\r\nimport { DisconnectedError } from '../../utils/errors.js'\r\n\r\nconst webExtensions = ['.htm', '.html', '.ico', '.xml', '.css', '.map', '.js', '.ttf', '.eot', '.svg', '.woff', '.woff2', '.jpeg', '.jpg', '.png']\r\n\r\nexport default {\r\n\tcomputed: {\r\n\t\t...mapState(['isLocal']),\r\n\t\t...mapState('machine/model', ['boards', 'directories', 'network', 'state']),\r\n\t\t...mapGetters(['isConnected', 'uiFrozen']),\r\n\t\tcaption() {\r\n\t\t\tif (this.extracting) {\r\n\t\t\t\treturn this.$t('generic.extracting');\r\n\t\t\t}\r\n\t\t\tif (this.uploading) {\r\n\t\t\t\treturn this.$t('generic.uploading');\r\n\t\t\t}\r\n\t\t\treturn this.$t(`button.upload['${this.target}'].caption`);\r\n\t\t},\r\n\t\tcanUpload() {\r\n\t\t\treturn this.isConnected && !this.uiFrozen;\r\n\t\t},\r\n\t\taccept() {\r\n\t\t\tswitch (this.target) {\r\n\t\t\t\tcase 'gcodes': return '.g,.gcode,.gc,.gco,.nc,.ngc,.tap';\r\n\t\t\t\tcase 'start': return '.g,.gcode,.gc,.gco,.nc,.ngc,.tap';\r\n\t\t\t\tcase 'macros': return '*';\r\n\t\t\t\tcase 'filaments': return '.zip';\r\n\t\t\t\tcase 'firmware': return '.zip,.bin';\r\n\t\t\t\tcase 'menu': return '*';\r\n\t\t\t\tcase 'system': return '.zip,.bin,.json,.g,.csv';\r\n\t\t\t\tcase 'web': return '.zip,.csv,.json,.htm,.html,.ico,.xml,.css,.map,.js,.ttf,.eot,.svg,.woff,.woff2,.jpeg,.jpg,.png,.gz';\r\n\t\t\t}\r\n\t\t\treturn undefined;\r\n\t\t},\r\n\t\tdestinationDirectory() {\r\n\t\t\tif (this.directory) {\r\n\t\t\t\treturn this.directory;\r\n\t\t\t}\r\n\r\n\t\t\tswitch (this.target) {\r\n\t\t\t\tcase 'gcodes': return this.directories.gCodes;\r\n\t\t\t\tcase 'start': return this.directories.gCodes;\r\n\t\t\t\tcase 'firmware': return this.directories.firmware;\r\n\t\t\t\tcase 'macros': return this.directories.macros;\r\n\t\t\t\tcase 'filaments': return this.directories.filaments;\r\n\t\t\t\tcase 'menu': return this.directories.menu;\r\n\t\t\t\tcase 'system': return this.directories.system;\r\n\t\t\t\tcase 'web': return this.directories.web;\r\n\t\t\t}\r\n\t\t\treturn undefined;\r\n\t\t},\r\n\t\tisBusy() {\r\n\t\t\treturn this.extracting || this.uploading;\r\n\t\t}\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tinnerColor: this.color,\r\n\t\t\textracting: false,\r\n\t\t\tuploading: false,\r\n\r\n\t\t\tconfirmUpdate: false,\r\n\t\t\tupdates: {\r\n\t\t\t\twebInterface: false,\r\n\t\t\t\tfirmwareBoards: [],\r\n\t\t\t\twifiServer: false,\r\n\t\t\t\twifiServerSpiffs: false,\r\n\r\n\t\t\t\tcodeSent: false\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\textends: VBtn,\r\n\tprops: {\r\n\t\tdirectory: String,\r\n\t\ttarget: {\r\n\t\t\ttype: String,\r\n\t\t\trequired: true\r\n\t\t},\r\n\t\tuploadPrint: Boolean\r\n\t},\r\n\tmethods: {\r\n\t\t...mapActions('machine', ['sendCode', 'upload']),\r\n\t\tchooseFile() {\r\n\t\t\tif (!this.isBusy) {\r\n\t\t\t\tthis.$refs.fileInput.click();\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync fileSelected(e) {\r\n\t\t\tawait this.doUpload(e.target.files);\r\n\t\t\te.target.value = '';\r\n\t\t},\r\n\t\tisWebFile(filename) {\r\n\t\t\tif (webExtensions.some(extension => filename.toLowerCase().endsWith(extension))) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tconst matches = /(\\.[^.]+).gz$/i.exec(filename);\r\n\t\t\tif (matches && webExtensions.indexOf(matches[1].toLowerCase()) !== -1) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\tgetFirmwareName(fileName) {\r\n\t\t\tlet result = null;\r\n\t\t\tthis.boards.forEach((board, index) => {\r\n\t\t\t\tif (board && board.firmwareFileName && (board.canAddress || index === 0)) {\r\n\t\t\t\t\tconst regEx = new RegExp(board.firmwareFileName.replace(/\\.bin$/, '(.*)\\\\.bin'), 'i');\r\n\t\t\t\t\tif (regEx.test(fileName)) {\r\n\t\t\t\t\t\tresult = board.firmwareFileName;\r\n\t\t\t\t\t\tthis.updates.firmwareBoards.push(board.canAddress || 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\tgetBinaryName(key, fileName) {\r\n\t\t\tlet result = null;\r\n\t\t\tthis.boards.forEach(board => {\r\n\t\t\t\tif (board && board[key]) {\r\n\t\t\t\t\tconst regEx = new RegExp(board[key].replace(/\\.bin$/, '(.*)\\\\.bin'), 'i');\r\n\t\t\t\t\tif (regEx.test(fileName)) {\r\n\t\t\t\t\t\tresult = board[key];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\tasync doUpload(files, zipName, startTime) {\r\n\t\t\tif (!files.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.target === 'start' && files.length !== 1) {\r\n\t\t\t\tthis.$makeNotification('error', this.$t(`button.upload['${this.target}'].caption`), this.$t('error.uploadStartWrongFileCount'));\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (!zipName) {\r\n\t\t\t\tif (files.length > 1 && files[0].name.toLowerCase().endsWith('.zip')) {\r\n\t\t\t\t\tthis.$makeNotification('error', this.$t(`button.upload['${this.target}'].caption`), this.$t('error.uploadNoSingleZIP'));\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (files[0].name.toLowerCase().endsWith('.zip')) {\r\n\t\t\t\t\tconst zip = new JSZip(), zipFiles = [], target = this.target;\r\n\t\t\t\t\tthis.extracting = true;\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// Open the ZIP file and read its content\r\n\t\t\t\t\t\tawait zip.loadAsync(files[0], { checkCRC32: true });\r\n\t\t\t\t\t\tzip.forEach(function(file) {\r\n\t\t\t\t\t\t\tif (!file.endsWith('/') && (file.split('/').length === 2 || target !== 'filaments')) {\r\n\t\t\t\t\t\t\t\tzipFiles.push(file);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// Could we get anything useful?\r\n\t\t\t\t\t\tif (!zipFiles.length) {\r\n\t\t\t\t\t\t\tthis.extracting = false;\r\n\t\t\t\t\t\t\tthis.$makeNotification('error', this.$t(`button.upload['${this.target}'].caption`), this.$t('error.uploadNoFiles'));\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Extract everything and start the upload\r\n\t\t\t\t\t\tfor (let i = 0; i < zipFiles.length; i++) {\r\n\t\t\t\t\t\t\tconst name = zipFiles[i];\r\n\t\t\t\t\t\t\tzipFiles[i] = await zip.file(name).async('blob');\r\n\t\t\t\t\t\t\tzipFiles[i].name = name;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.doUpload(zipFiles, files[0].name, new Date());\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tconsole.warn(e);\r\n\t\t\t\t\t\tthis.$makeNotification('error', this.$t('error.uploadDecompressionFailed'), e.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.extracting = false;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.updates.webInterface = false;\r\n\t\t\tthis.updates.firmwareBoards = [];\r\n\t\t\tthis.updates.wifiServer = false;\r\n\t\t\tthis.updates.wifiServerSpiffs = false;\r\n\r\n\t\t\tlet success = true;\r\n\t\t\tthis.uploading = true;\r\n\t\t\tfor (let i = 0; i < files.length; i++) {\r\n\t\t\t\tconst content = files[i];\r\n\r\n\t\t\t\t// Adjust filename if an update is being uploaded\r\n\t\t\t\tlet filename = Path.combine(this.destinationDirectory, content.name);\r\n\t\t\t\tif (this.target === 'system' || this.target === 'firmware') {\r\n\t\t\t\t\tif (Path.isSdPath('/' + content.name)) {\r\n\t\t\t\t\t\tfilename = Path.combine('0:/', content.name);\r\n\t\t\t\t\t} else if (this.isWebFile(content.name)) {\r\n\t\t\t\t\t\tfilename = Path.combine(this.directories.web, content.name);\r\n\t\t\t\t\t\tthis.updates.webInterface |= /index.html(\\.gz)?/i.test(content.name);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst firmwareFileName = this.getFirmwareName(content.name);\r\n\t\t\t\t\t\tconst bootloaderFileName = this.getBinaryName('bootloaderFileName', content.name);\r\n\t\t\t\t\t\tconst iapFileNameSBC = this.getBinaryName('iapFileNameSBC', content.name);\r\n\t\t\t\t\t\tconst iapFileNameSD = this.getBinaryName('iapFileNameSD', content.name);\r\n\t\t\t\t\t\tif (firmwareFileName) {\r\n\t\t\t\t\t\t\tfilename = Path.combine(this.directories.firmware, firmwareFileName);\r\n\t\t\t\t\t\t} else if (bootloaderFileName) {\r\n\t\t\t\t\t\t\tfilename = Path.combine(this.directories.firmware, bootloaderFileName);\r\n\t\t\t\t\t\t} else if (this.state.dsfVersion && iapFileNameSBC) {\r\n\t\t\t\t\t\t\tfilename = Path.combine(this.directories.firmware, iapFileNameSBC);\r\n\t\t\t\t\t\t} else if (iapFileNameSD) {\r\n\t\t\t\t\t\t\tfilename = Path.combine(this.directories.firmware, iapFileNameSD);\r\n\t\t\t\t\t\t} else if (!this.state.dsfVersion && this.network.interfaces.some(iface => iface.type === NetworkInterfaceType.wifi)) {\r\n\t\t\t\t\t\t\tif ((/DuetWiFiSocketServer(.*)\\.bin/i.test(content.name) || /DuetWiFiServer(.*)\\.bin/i.test(content.name))) {\r\n\t\t\t\t\t\t\t\tfilename = Path.combine(this.directories.firmware, 'DuetWiFiServer.bin');\r\n\t\t\t\t\t\t\t\tthis.updates.wifiServer = true;\r\n\t\t\t\t\t\t\t} else if (/DuetWebControl(.*)\\.bin/i.test(content.name)) {\r\n\t\t\t\t\t\t\t\tfilename = Path.combine(this.directories.firmware, 'DuetWebControl.bin');\r\n\t\t\t\t\t\t\t\tthis.updates.wifiServerSpiffs = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (content.name.endsWith('.bin')) {\r\n\t\t\t\t\t\t\t// FIXME This will be no longer needed when CAN board enumeration is supported\r\n\t\t\t\t\t\t\tfilename = Path.combine(this.directories.firmware, content.name);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// Start uploading\r\n\t\t\t\t\tif (files.length > 1) {\r\n\t\t\t\t\t\tawait this.upload({ filename, content, showSuccess: !zipName, num: i + 1, count: files.length });\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tawait this.upload({ filename, content });\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Run it (if required)\r\n\t\t\t\t\tif (this.target === 'start') {\r\n\t\t\t\t\t\tawait this.sendCode(`M32 \"${filename}\"`);\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tsuccess = false;\r\n\t\t\t\t\tthis.$emit('uploadFailed', { filename, reason: e });\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.uploading = false;\r\n\r\n\t\t\tif (success) {\r\n\t\t\t\tthis.$emit('uploadComplete', files);\r\n\r\n\t\t\t\tif ((this.updates.firmwareBoards.length > 0) || this.updates.wifiServer || this.updates.wifiServerSpiffs) {\r\n\t\t\t\t\t// Ask user to perform an update\r\n\t\t\t\t\tthis.confirmUpdate = true;\r\n\t\t\t\t} else if (!this.isLocal && this.updates.webInterface) {\r\n\t\t\t\t\t// Reload the web interface immediately if it was the only update\r\n\t\t\t\t\tlocation.reload(true);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// FIXME For some reason the $t function throws an exception when this button is floating\r\n\t\t\t\tif (zipName) {\r\n\t\t\t\t\tconst secondsPassed = Math.round((new Date() - startTime) / 1000);\r\n\t\t\t\t\tthis.$makeNotification('success', this.$t('notification.upload.success', [zipName, this.$displayTime(secondsPassed)]));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync startUpdate() {\r\n\t\t\t// Update expansion boards\r\n\t\t\tfor (let i = 0; i < this.updates.firmwareBoards.length; i++) {\r\n\t\t\t\tconst boardToUpdate = this.updates.firmwareBoards[i];\r\n\t\t\t\tif (boardToUpdate > 0) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tawait this.sendCode(`M997 B${boardToUpdate}`);\r\n\t\t\t\t\t\tdo {\r\n\t\t\t\t\t\t\t// Wait in 2-second intervals until the status is no longer 'Updating'\r\n\t\t\t\t\t\t\tawait new Promise(resolve => setTimeout(resolve, 2000));\r\n\r\n\t\t\t\t\t\t\t// Stop if the connection has been interrupted\r\n\t\t\t\t\t\t\tif (!this.isConnected) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} while (this.state.status === StatusType.updating);\r\n\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tif (!(e instanceof DisconnectedError)) {\r\n\t\t\t\t\t\t\tconsole.warn(e);\r\n\t\t\t\t\t\t\tthis.$log('error', this.$t('generic.error'), e.message);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Update other modules\r\n\t\t\tlet modules = [];\r\n\t\t\tif (this.updates.firmwareBoards.indexOf(0) >= 0) {\r\n\t\t\t\tmodules.push('0');\r\n\t\t\t}\r\n\t\t\tif (this.updates.wifiServer) {\r\n\t\t\t\tmodules.push('1');\r\n\t\t\t}\r\n\t\t\tif (this.updates.wifiServerSpiffs) {\r\n\t\t\t\tmodules.push('2');\r\n\t\t\t}\r\n\r\n\t\t\tthis.updates.codeSent = true;\r\n\t\t\ttry {\r\n\t\t\t\tawait this.sendCode(`M997 S${modules.join(':')}`);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tif (!(e instanceof DisconnectedError)) {\r\n\t\t\t\t\tconsole.warn(e);\r\n\t\t\t\t\tthis.$log('error', this.$t('generic.error'), e.message);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tdragOver(e) {\r\n\t\t\te.preventDefault();\r\n\t\t\te.stopPropagation();\r\n\t\t\tif (!this.isBusy) {\r\n\t\t\t\tthis.innerColor = 'success';\r\n\t\t\t}\r\n\t\t},\r\n\t\tdragLeave(e) {\r\n\t\t\te.preventDefault();\r\n\t\t\te.stopPropagation();\r\n\t\t\tthis.innerColor = this.color;\r\n\t\t},\r\n\t\tasync dragDrop(e) {\r\n\t\t\tthis.innerColor = this.color;\r\n\t\t\tif (!this.isBusy && e.dataTransfer.files.length) {\r\n\t\t\t\tawait this.doUpload(e.dataTransfer.files);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\twatch: {\r\n\t\tisConnected(to) {\r\n\t\t\tif (to && !this.isLocal && this.updates.codeSent && this.updates.webInterface) {\r\n\t\t\t\t// Reload the web interface when the connection could be established again\r\n\t\t\t\tlocation.reload(true);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n"]}]}