{"remainingRequest":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\thread-loader\\dist\\cjs.js!C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\src\\store\\machine\\connector\\RestConnector.js","dependencies":[{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\src\\store\\machine\\connector\\RestConnector.js","mtime":1592248188701},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8gUkVTVGZ1bCBjb25uZWN0b3IgZm9yIERTRgondXNlIHN0cmljdCc7CgppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5jb25jYXQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mb3ItZWFjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnRyaW0iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiQzpcXFVzZXJzXFxqcGF0cmlja1xcRG9jdW1lbnRzXFxHaXRIdWJcXER1ZXRXZWJDb250cm9sX0ZvcmtcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIkM6XFxVc2Vyc1xcanBhdHJpY2tcXERvY3VtZW50c1xcR2l0SHViXFxEdWV0V2ViQ29udHJvbF9Gb3JrXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfYXNzZXJ0VGhpc0luaXRpYWxpemVkIGZyb20gIkM6XFxVc2Vyc1xcanBhdHJpY2tcXERvY3VtZW50c1xcR2l0SHViXFxEdWV0V2ViQ29udHJvbF9Gb3JrXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQiOwppbXBvcnQgX2dldFByb3RvdHlwZU9mIGZyb20gIkM6XFxVc2Vyc1xcanBhdHJpY2tcXERvY3VtZW50c1xcR2l0SHViXFxEdWV0V2ViQ29udHJvbF9Gb3JrXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9nZXRQcm90b3R5cGVPZiI7CmltcG9ydCBfZ2V0IGZyb20gIkM6XFxVc2Vyc1xcanBhdHJpY2tcXERvY3VtZW50c1xcR2l0SHViXFxEdWV0V2ViQ29udHJvbF9Gb3JrXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9nZXQiOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIkM6XFxVc2Vyc1xcanBhdHJpY2tcXERvY3VtZW50c1xcR2l0SHViXFxEdWV0V2ViQ29udHJvbF9Gb3JrXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7CmltcG9ydCBfaW5oZXJpdHMgZnJvbSAiQzpcXFVzZXJzXFxqcGF0cmlja1xcRG9jdW1lbnRzXFxHaXRIdWJcXER1ZXRXZWJDb250cm9sX0ZvcmtcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzIjsKaW1wb3J0IF9jcmVhdGVTdXBlciBmcm9tICJDOlxcVXNlcnNcXGpwYXRyaWNrXFxEb2N1bWVudHNcXEdpdEh1YlxcRHVldFdlYkNvbnRyb2xfRm9ya1xcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlU3VwZXIiOwppbXBvcnQgX2RlZmluZVByb3BlcnR5IGZyb20gIkM6XFxVc2Vyc1xcanBhdHJpY2tcXERvY3VtZW50c1xcR2l0SHViXFxEdWV0V2ViQ29udHJvbF9Gb3JrXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9kZWZpbmVQcm9wZXJ0eSI7CmltcG9ydCBCYXNlQ29ubmVjdG9yIGZyb20gJy4vQmFzZUNvbm5lY3Rvci5qcyc7CmltcG9ydCB7IFBhcnNlZEZpbGVJbmZvIH0gZnJvbSAnLi4vbW9kZWxJdGVtcy5qcyc7CmltcG9ydCB7IE5ldHdvcmtFcnJvciwgRGlzY29ubmVjdGVkRXJyb3IsIFRpbWVvdXRFcnJvciwgT3BlcmF0aW9uQ2FuY2VsbGVkRXJyb3IsIE9wZXJhdGlvbkZhaWxlZEVycm9yLCBEaXJlY3RvcnlOb3RGb3VuZEVycm9yLCBGaWxlTm90Rm91bmRFcnJvciwgTG9naW5FcnJvciwgSW52YWxpZFBhc3N3b3JkRXJyb3IgfSBmcm9tICcuLi8uLi8uLi91dGlscy9lcnJvcnMuanMnOwppbXBvcnQgeyBzdHJUb1RpbWUgfSBmcm9tICcuLi8uLi8uLi91dGlscy90aW1lLmpzJzsKCnZhciBSZXN0Q29ubmVjdG9yID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQmFzZUNvbm5lY3RvcikgewogIF9pbmhlcml0cyhSZXN0Q29ubmVjdG9yLCBfQmFzZUNvbm5lY3Rvcik7CgogIHZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIoUmVzdENvbm5lY3Rvcik7CgogIF9jcmVhdGVDbGFzcyhSZXN0Q29ubmVjdG9yLCBudWxsLCBbewogICAga2V5OiAiY29ubmVjdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2Nvbm5lY3QgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoaG9zdG5hbWUsIHVzZXJuYW1lLCBwYXNzd29yZCkgewogICAgICAgIHZhciBzb2NrZXRQcm90b2NvbCwgc29ja2V0LCBtb2RlbDsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBzb2NrZXRQcm90b2NvbCA9IGxvY2F0aW9uLnByb3RvY29sID09PSAnaHR0cHM6JyA/ICd3c3M6JyA6ICd3czonOwogICAgICAgICAgICAgICAgc29ja2V0ID0gbmV3IFdlYlNvY2tldCgiIi5jb25jYXQoc29ja2V0UHJvdG9jb2wsICIvLyIpLmNvbmNhdChob3N0bmFtZSwgIi9tYWNoaW5lIikpOwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICAgICAgICBzb2NrZXQub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICAvLyBTdWNjZXNzZnVsbHkgY29ubmVjdGVkLCB0aGUgZmlyc3QgbWVzc2FnZSBpcyB0aGUgZnVsbCBvYmplY3QgbW9kZWwKICAgICAgICAgICAgICAgICAgICB2YXIgbW9kZWwgPSBKU09OLnBhcnNlKGUuZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShtb2RlbCk7CiAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICBzb2NrZXQub25lcnJvciA9IHNvY2tldC5vbmNsb3NlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZS5jb2RlID09PSAxMDAxIHx8IGUuY29kZSA9PSAxMDExKSB7CiAgICAgICAgICAgICAgICAgICAgICAvLyBEQ1MgdW5hdmFpbGFibGUgb3IgaW5jb21wYXRpYmxlIERDUyB2ZXJzaW9uCiAgICAgICAgICAgICAgICAgICAgICByZWplY3QobmV3IExvZ2luRXJyb3IoZS5yZWFzb24pKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETyBhY2NvbW9kYXRlIEludmFsaWRQYXNzd29yZEVycm9yIGFuZCBOb0ZyZWVTZXNzaW9uRXJyb3IgaGVyZQogICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBOZXR3b3JrRXJyb3IoZS5yZWFzb24pKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgbW9kZWwgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgbmV3IFJlc3RDb25uZWN0b3IoaG9zdG5hbWUsIHBhc3N3b3JkLCBzb2NrZXQsIG1vZGVsKSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBjb25uZWN0KF94LCBfeDIsIF94MykgewogICAgICAgIHJldHVybiBfY29ubmVjdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gY29ubmVjdDsKICAgIH0oKQogIH1dKTsKCiAgZnVuY3Rpb24gUmVzdENvbm5lY3Rvcihob3N0bmFtZSwgcGFzc3dvcmQsIHNvY2tldCwgbW9kZWwpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUmVzdENvbm5lY3Rvcik7CgogICAgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCAncmVzdCcsIGhvc3RuYW1lKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJtb2RlbCIsIHt9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJmaWxlVHJhbnNmZXJzIiwgW10pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImxheWVycyIsIFtdKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJyZXF1ZXN0QmFzZSIsICcnKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJyZXF1ZXN0cyIsIFtdKTsKCiAgICBfdGhpcy5wYXNzd29yZCA9IHBhc3N3b3JkOwogICAgX3RoaXMucmVxdWVzdEJhc2UgPSAiIi5jb25jYXQobG9jYXRpb24ucHJvdG9jb2wsICIvLyIpLmNvbmNhdChob3N0bmFtZSwgIi8iKTsKICAgIF90aGlzLnNvY2tldCA9IHNvY2tldDsKICAgIF90aGlzLm1vZGVsID0gbW9kZWw7CgogICAgaWYgKG1vZGVsLmpvYiAmJiBtb2RlbC5qb2IubGF5ZXJzKSB7CiAgICAgIF90aGlzLmxheWVycyA9IG1vZGVsLmpvYi5sYXllcnM7CiAgICB9CgogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgX2NyZWF0ZUNsYXNzKFJlc3RDb25uZWN0b3IsIFt7CiAgICBrZXk6ICJyZXF1ZXN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZXF1ZXN0KG1ldGhvZCwgdXJsKSB7CiAgICAgIHZhciBwYXJhbXMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IG51bGw7CiAgICAgIHZhciByZXNwb25zZVR5cGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1szXSA6ICdqc29uJzsKICAgICAgdmFyIGJvZHkgPSBhcmd1bWVudHMubGVuZ3RoID4gNCAmJiBhcmd1bWVudHNbNF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1s0XSA6IG51bGw7CiAgICAgIHZhciBvblByb2dyZXNzID0gYXJndW1lbnRzLmxlbmd0aCA+IDUgJiYgYXJndW1lbnRzWzVdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbNV0gOiBudWxsOwogICAgICB2YXIgY2FuY2VsbGF0aW9uVG9rZW4gPSBhcmd1bWVudHMubGVuZ3RoID4gNiAmJiBhcmd1bWVudHNbNl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1s2XSA6IG51bGw7CiAgICAgIHZhciBmaWxlbmFtZSA9IGFyZ3VtZW50cy5sZW5ndGggPiA3ICYmIGFyZ3VtZW50c1s3XSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzddIDogJ24vYSc7CiAgICAgIHZhciBpbnRlcm5hbFVSTCA9IHRoaXMucmVxdWVzdEJhc2UgKyB1cmw7CgogICAgICBpZiAocGFyYW1zKSB7CiAgICAgICAgdmFyIGhhZFBhcmFtID0gZmFsc2U7CgogICAgICAgIGZvciAodmFyIGtleSBpbiBwYXJhbXMpIHsKICAgICAgICAgIGludGVybmFsVVJMICs9IChoYWRQYXJhbSA/ICcmJyA6ICc/JykgKyBrZXkgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQocGFyYW1zW2tleV0pOwogICAgICAgICAgaGFkUGFyYW0gPSB0cnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgICB4aHIub3BlbihtZXRob2QsIGludGVybmFsVVJMKTsKCiAgICAgIGlmIChyZXNwb25zZVR5cGUgPT09ICdqc29uJykgewogICAgICAgIHhoci5yZXNwb25zZVR5cGUgPSAndGV4dCc7CiAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgeGhyLnJlc3BvbnNlVHlwZSA9IHJlc3BvbnNlVHlwZTsKICAgICAgfQoKICAgICAgaWYgKG9uUHJvZ3Jlc3MpIHsKICAgICAgICB4aHIub25wcm9ncmVzcyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBpZiAoZS5sb2FkZWQgJiYgZS50b3RhbCkgewogICAgICAgICAgICBvblByb2dyZXNzKGUubG9hZGVkLCBlLnRvdGFsKTsKICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICB4aHIudXBsb2FkLm9ucHJvZ3Jlc3MgPSB4aHIub25wcm9ncmVzczsKICAgICAgfQoKICAgICAgeGhyLnRpbWVvdXQgPSAwOwoKICAgICAgaWYgKGNhbmNlbGxhdGlvblRva2VuKSB7CiAgICAgICAgY2FuY2VsbGF0aW9uVG9rZW4uY2FuY2VsID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHhoci5hYm9ydCgpOwogICAgICAgIH07CiAgICAgIH0KCiAgICAgIHRoaXMucmVxdWVzdHMucHVzaCh4aHIpOwogICAgICB2YXIgdGhhdCA9IHRoaXM7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHRoYXQucmVxdWVzdHMgPSB0aGF0LnJlcXVlc3RzLmZpbHRlcihmdW5jdGlvbiAocmVxdWVzdCkgewogICAgICAgICAgICByZXR1cm4gcmVxdWVzdCAhPT0geGhyOwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKHhoci5zdGF0dXMgPj0gMjAwICYmIHhoci5zdGF0dXMgPCAzMDApIHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlVHlwZSA9PT0gJ2pzb24nKSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICgheGhyLnJlc3BvbnNlVGV4dCkgewogICAgICAgICAgICAgICAgICByZXNvbHZlKG51bGwpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgcmVzb2x2ZShKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJlc29sdmUoeGhyLnJlc3BvbnNlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmICh4aHIuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgICAgcmVqZWN0KG5ldyBJbnZhbGlkUGFzc3dvcmRFcnJvcigpKTsKICAgICAgICAgIH0gZWxzZSBpZiAoeGhyLnN0YXR1cyA9PT0gNDA0KSB7CiAgICAgICAgICAgIHJlamVjdChuZXcgRmlsZU5vdEZvdW5kRXJyb3IoZmlsZW5hbWUpKTsKICAgICAgICAgIH0gZWxzZSBpZiAoeGhyLnN0YXR1cyA+PSA1MDApIHsKICAgICAgICAgICAgcmVqZWN0KG5ldyBPcGVyYXRpb25GYWlsZWRFcnJvcih4aHIucmVzcG9uc2VUZXh0IHx8IHhoci5zdGF0dXNUZXh0KSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHhoci5zdGF0dXMgIT09IDApIHsKICAgICAgICAgICAgcmVqZWN0KG5ldyBPcGVyYXRpb25GYWlsZWRFcnJvcigpKTsKICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICB4aHIub25hYm9ydCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHRoYXQucmVxdWVzdHMgPSB0aGF0LnJlcXVlc3RzLmZpbHRlcihmdW5jdGlvbiAocmVxdWVzdCkgewogICAgICAgICAgICByZXR1cm4gcmVxdWVzdCAhPT0geGhyOwogICAgICAgICAgfSk7CiAgICAgICAgICByZWplY3QodGhhdC5zb2NrZXQgPyBuZXcgT3BlcmF0aW9uQ2FuY2VsbGVkRXJyb3IoKSA6IG5ldyBEaXNjb25uZWN0ZWRFcnJvcigpKTsKICAgICAgICB9OwoKICAgICAgICB4aHIub25lcnJvciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHRoYXQucmVxdWVzdHMgPSB0aGF0LnJlcXVlc3RzLmZpbHRlcihmdW5jdGlvbiAocmVxdWVzdCkgewogICAgICAgICAgICByZXR1cm4gcmVxdWVzdCAhPT0geGhyOwogICAgICAgICAgfSk7CiAgICAgICAgICByZWplY3QobmV3IE5ldHdvcmtFcnJvcigpKTsKICAgICAgICB9OwoKICAgICAgICB4aHIub250aW1lb3V0ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmVqZWN0KG5ldyBUaW1lb3V0RXJyb3IoKSk7CiAgICAgICAgfTsKCiAgICAgICAgeGhyLnNlbmQoYm9keSk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImNhbmNlbFJlcXVlc3RzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjYW5jZWxSZXF1ZXN0cygpIHsKICAgICAgdGhpcy5yZXF1ZXN0cy5mb3JFYWNoKGZ1bmN0aW9uIChyZXF1ZXN0KSB7CiAgICAgICAgcmV0dXJuIHJlcXVlc3QuYWJvcnQoKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVjb25uZWN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcmVjb25uZWN0ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICB2YXIgdGhhdDsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgLy8gQ2FuY2VsIHBlbmRpbmcgcmVxdWVzdHMKICAgICAgICAgICAgICAgIHRoaXMuY2FuY2VsUmVxdWVzdHMoKTsgLy8gQXR0ZW1wdCB0byByZWNvbm5lY3QKCiAgICAgICAgICAgICAgICB0aGF0ID0gdGhpczsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNDsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgICAgICAgIHZhciBsYXN0RHNmVmVyc2lvbiA9IHRoYXQubW9kZWwuc3RhdGUuZHNmVmVyc2lvbjsKICAgICAgICAgICAgICAgICAgdmFyIHNvY2tldFByb3RvY29sID0gbG9jYXRpb24ucHJvdG9jb2wgPT09ICdodHRwczonID8gJ3dzczonIDogJ3dzOic7CiAgICAgICAgICAgICAgICAgIHZhciBzb2NrZXQgPSBuZXcgV2ViU29ja2V0KCIiLmNvbmNhdChzb2NrZXRQcm90b2NvbCwgIi8vIikuY29uY2F0KHRoYXQuaG9zdG5hbWUsICIvbWFjaGluZSIpKTsKCiAgICAgICAgICAgICAgICAgIHNvY2tldC5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgIC8vIFN1Y2Nlc3NmdWxseSBjb25uZWN0ZWQsIHRoZSBmaXJzdCBtZXNzYWdlIGlzIHRoZSBmdWxsIG9iamVjdCBtb2RlbAogICAgICAgICAgICAgICAgICAgIHRoYXQubW9kZWwgPSBKU09OLnBhcnNlKGUuZGF0YSk7CgogICAgICAgICAgICAgICAgICAgIGlmICh0aGF0Lm1vZGVsLmpvYiAmJiB0aGF0Lm1vZGVsLmpvYi5sYXllcnMpIHsKICAgICAgICAgICAgICAgICAgICAgIHRoYXQubGF5ZXJzID0gdGhhdC5tb2RlbC5qb2IubGF5ZXJzOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdGhhdC5zb2NrZXQgPSBzb2NrZXQ7IC8vIENoZWNrIGlmIERTRiBoYXMgYmVlbiB1cGRhdGVkCgogICAgICAgICAgICAgICAgICAgIGlmIChsYXN0RHNmVmVyc2lvbiAhPT0gdGhhdC5tb2RlbC5zdGF0ZS5kc2ZWZXJzaW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbi5yZWxvYWQodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICBzb2NrZXQub25lcnJvciA9IHNvY2tldC5vbmNsb3NlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZS5jb2RlID09PSAxMDAxIHx8IGUuY29kZSA9PSAxMDExKSB7CiAgICAgICAgICAgICAgICAgICAgICAvLyBEQ1MgdW5hdmFpbGFibGUgb3IgaW5jb21wYXRpYmxlIERDUyB2ZXJzaW9uCiAgICAgICAgICAgICAgICAgICAgICByZWplY3QobmV3IExvZ2luRXJyb3IoZS5yZWFzb24pKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETyBhY2NvbW9kYXRlIEludmFsaWRQYXNzd29yZEVycm9yIGFuZCBOb0ZyZWVTZXNzaW9uRXJyb3IgaGVyZQogICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBOZXR3b3JrRXJyb3IoZS5yZWFzb24pKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA2OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoYXQuc3RhcnRTb2NrZXQoKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gcmVjb25uZWN0KCkgewogICAgICAgIHJldHVybiBfcmVjb25uZWN0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiByZWNvbm5lY3Q7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJyZWdpc3RlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVnaXN0ZXIobW9kdWxlKSB7CiAgICAgIF9nZXQoX2dldFByb3RvdHlwZU9mKFJlc3RDb25uZWN0b3IucHJvdG90eXBlKSwgInJlZ2lzdGVyIiwgdGhpcykuY2FsbCh0aGlzLCBtb2R1bGUpOwoKICAgICAgdGhpcy5zdGFydFNvY2tldCgpOwogICAgfQogIH0sIHsKICAgIGtleTogInN0YXJ0U29ja2V0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfc3RhcnRTb2NrZXQgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KCkgewogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAvLyBEZWFsIHdpdGggZ2VuZXJpYyBtZXNzYWdlcwogICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwubWVzc2FnZXMgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm1lc3NhZ2VzLmZvckVhY2goIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIF9yZWYgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKG1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlzcGF0Y2goJ29uQ29kZUNvbXBsZXRlZCcsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbHk6IG1lc3NhZ2UuY29udGVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0sIF9jYWxsZWUzLCB0aGlzKTsKICAgICAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoX3g0KSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgIH0oKSwgdGhpcyk7CiAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLm1vZGVsLm1lc3NhZ2VzOwogICAgICAgICAgICAgICAgfSAvLyBTZW5kIFBJTkcgaW4gcHJlZGVmaW5lZCBpbnRlcnZhbHMgdG8gZGV0ZWN0IGRpc2Nvbm5lY3RzIGZyb20gdGhlIGNsaWVudCBzaWRlCgoKICAgICAgICAgICAgICAgIHRoaXMucGluZ1Rhc2sgPSBzZXRUaW1lb3V0KHRoaXMuZG9QaW5nLmJpbmQodGhpcyksIHRoaXMuc2V0dGluZ3MucGluZ0ludGVydmFsKTsgLy8gU2V0IHVwIHNvY2tldCBldmVudHMKCiAgICAgICAgICAgICAgICB0aGlzLnNvY2tldC5vbm1lc3NhZ2UgPSB0aGlzLm9uTWVzc2FnZS5iaW5kKHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5zb2NrZXQub25lcnJvciA9IHRoaXMub25DbG9zZS5iaW5kKHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5zb2NrZXQub25jbG9zZSA9IHRoaXMub25DbG9zZS5iaW5kKHRoaXMpOyAvLyBVcGRhdGUgbW9kZWwgYW5kIGFja25vd2xlZGdlIHJlY2VpdmFsCgogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlzcGF0Y2goJ3VwZGF0ZScsIHRoaXMubW9kZWwpOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICB0aGlzLnNvY2tldC5zZW5kKCdPS1xuJyk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHN0YXJ0U29ja2V0KCkgewogICAgICAgIHJldHVybiBfc3RhcnRTb2NrZXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHN0YXJ0U29ja2V0OwogICAgfSgpCiAgfSwgewogICAga2V5OiAiZG9QaW5nIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkb1BpbmcoKSB7CiAgICAgIC8vIEFsdGhvdWdoIHRoZSBXZWJTb2NrZXQgc3RhbmRhcmQgaXMgc3VwcG9zZWQgdG8gcHJvdmlkZSBQSU5HIGZyYW1lcywKICAgICAgLy8gdGhlcmUgaXMgbm8gd2F5IHRvIHNlbmQgdGhlbSBzaW5jZSBhIFdlYlNvY2tldCBpbnN0YW5jZSBkb2VzIG5vdCBwcm92aWRlIGEgbWV0aG9kIGZvciB0aGF0LgogICAgICAvLyBIZW5jZSB3ZSByZWx5IG9uIG91ciBvd24gb3B0aW9uYWwgUElORy1QT05HIGltcGxlbWVudGF0aW9uCiAgICAgIHRoaXMuc29ja2V0LnNlbmQoJ1BJTkdcbicpOwogICAgICB0aGlzLnBpbmdUYXNrID0gdW5kZWZpbmVkOwogICAgfQogIH0sIHsKICAgIGtleTogIm9uTWVzc2FnZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX29uTWVzc2FnZSA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTYoZSkgewogICAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgICB2YXIgZGF0YTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTYkKF9jb250ZXh0NikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDYucHJldiA9IF9jb250ZXh0Ni5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgaWYgKCEodGhpcy5zb2NrZXQgPT0gbnVsbCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIC8vIFVzZSBQSU5HL1BPTkcgbWVzc2FnZXMgdG8gZGV0ZWN0IGNvbm5lY3Rpb24gaW50ZXJydXB0cwogICAgICAgICAgICAgICAgaWYgKHRoaXMucGluZ1Rhc2spIHsKICAgICAgICAgICAgICAgICAgLy8gV2UndmUganVzdCByZWNlaXZlZCBzb21ldGhpbmcsIHJlc2V0IHRoZSBwaW5nIHRhc2sKICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucGluZ1Rhc2spOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMucGluZ1Rhc2sgPSBzZXRUaW1lb3V0KHRoaXMuZG9QaW5nLmJpbmQodGhpcyksIHRoaXMuc2V0dGluZ3MucGluZ0ludGVydmFsKTsgLy8gSXQncyBqdXN0IGEgUE9ORyByZXBseSwgaWdub3JlIHRoaXMKCiAgICAgICAgICAgICAgICBpZiAoIShlLmRhdGEgPT09ICdQT05HXG4nKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgLy8gUHJvY2VzcyBtb2RlbCB1cGRhdGVzCiAgICAgICAgICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShlLmRhdGEpOyAvLyBEZWFsIHdpdGggZ2VuZXJpYyBtZXNzYWdlcwoKICAgICAgICAgICAgICAgIGlmIChkYXRhLm1lc3NhZ2VzKSB7CiAgICAgICAgICAgICAgICAgIGRhdGEubWVzc2FnZXMuZm9yRWFjaCggLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgX3JlZjIgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU1KG1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciByZXBseTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNSQoX2NvbnRleHQ1KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDUucHJldiA9IF9jb250ZXh0NS5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS50MCA9IG1lc3NhZ2UudHlwZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSBfY29udGV4dDUudDAgPT09IDEgPyAzIDogX2NvbnRleHQ1LnQwID09PSAyID8gNSA6IDc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbHkgPSAiV2FybmluZzogIi5jb25jYXQobWVzc2FnZS5jb250ZW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoImJyZWFrIiwgOSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBseSA9ICJFcnJvcjogIi5jb25jYXQobWVzc2FnZS5jb250ZW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoImJyZWFrIiwgOSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBseSA9IG1lc3NhZ2UuY29udGVudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoImJyZWFrIiwgOSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kaXNwYXRjaCgnb25Db2RlQ29tcGxldGVkJywgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBseTogcmVwbHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfSwgX2NhbGxlZTUsIHRoaXMpOwogICAgICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfeDYpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVmMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgIH0oKSwgdGhpcyk7CiAgICAgICAgICAgICAgICAgIGRlbGV0ZSBkYXRhLm1lc3NhZ2VzOwogICAgICAgICAgICAgICAgfSAvLyBEZWFsIHdpdGggbGF5ZXJzCgoKICAgICAgICAgICAgICAgIGlmIChkYXRhLmpvYiAmJiBkYXRhLmpvYi5sYXllcnMgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICBpZiAoZGF0YS5qb2IubGF5ZXJzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMubGF5ZXJzID0gW107CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2IubGF5ZXJzLmZvckVhY2goZnVuY3Rpb24gKGxheWVyKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMyLmxheWVycy5wdXNoKGxheWVyKTsKICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgZGF0YS5qb2IubGF5ZXJzID0gdGhpcy5sYXllcnM7CiAgICAgICAgICAgICAgICB9IC8vIFVwZGF0ZSBtb2RlbCBhbmQgYWNrbm93bGVkZ2UgcmVjZWlwdAoKCiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDExOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlzcGF0Y2goJ3VwZGF0ZScsIGRhdGEpOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgdGhpcy5zb2NrZXQuc2VuZCgnT0tcbicpOwoKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU2LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gb25NZXNzYWdlKF94NSkgewogICAgICAgIHJldHVybiBfb25NZXNzYWdlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBvbk1lc3NhZ2U7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJvbkNsb3NlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvbkNsb3NlKGUpIHsKICAgICAgdGhpcy5jYW5jZWxSZXF1ZXN0cygpOwoKICAgICAgaWYgKHRoaXMucGluZ1Rhc2spIHsKICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5waW5nVGFzayk7CiAgICAgICAgdGhpcy5waW5nVGFzayA9IHVuZGVmaW5lZDsKICAgICAgfQoKICAgICAgdGhpcy5kaXNwYXRjaCgnb25Db25uZWN0aW9uRXJyb3InLCBuZXcgTmV0d29ya0Vycm9yKGUucmVhc29uKSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZGlzY29ubmVjdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2Rpc2Nvbm5lY3QgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU3KCkgewogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNyQoX2NvbnRleHQ3KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ny5wcmV2ID0gX2NvbnRleHQ3Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5zb2NrZXQpIHsKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucGluZ1Rhc2spIHsKICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5waW5nVGFzayk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5waW5nVGFzayA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdGhpcy5zb2NrZXQuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgdGhpcy5zb2NrZXQgPSBudWxsOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTcsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBkaXNjb25uZWN0KCkgewogICAgICAgIHJldHVybiBfZGlzY29ubmVjdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZGlzY29ubmVjdDsKICAgIH0oKQogIH0sIHsKICAgIGtleTogInVucmVnaXN0ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVucmVnaXN0ZXIoKSB7CiAgICAgIHRoaXMuY2FuY2VsUmVxdWVzdHMoKTsKCiAgICAgIF9nZXQoX2dldFByb3RvdHlwZU9mKFJlc3RDb25uZWN0b3IucHJvdG90eXBlKSwgInVucmVnaXN0ZXIiLCB0aGlzKS5jYWxsKHRoaXMpOwogICAgfQogIH0sIHsKICAgIGtleTogInNlbmRDb2RlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfc2VuZENvZGUgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU4KGNvZGUpIHsKICAgICAgICB2YXIgcmVwbHksIHJlc3BvbnNlOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlOCQoX2NvbnRleHQ4KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OC5wcmV2ID0gX2NvbnRleHQ4Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDgucHJldiA9IDA7CiAgICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KCdQT1NUJywgJ21hY2hpbmUvY29kZScsIG51bGwsICd0ZXh0JywgY29kZSk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQ4LnNlbnQ7CiAgICAgICAgICAgICAgICByZXBseSA9IHJlc3BvbnNlLnRyaW0oKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgX2NvbnRleHQ4LnByZXYgPSA3OwogICAgICAgICAgICAgICAgX2NvbnRleHQ4LnQwID0gX2NvbnRleHQ4WyJjYXRjaCJdKDApOwogICAgICAgICAgICAgICAgcmVwbHkgPSAnRXJyb3I6ICcgKyBfY29udGV4dDgudDAubWVzc2FnZTsKCiAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2goJ29uQ29kZUNvbXBsZXRlZCcsIHsKICAgICAgICAgICAgICAgICAgY29kZTogY29kZSwKICAgICAgICAgICAgICAgICAgcmVwbHk6IHJlcGx5CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iLCByZXBseSk7CgogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTgsIHRoaXMsIFtbMCwgN11dKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gc2VuZENvZGUoX3g3KSB7CiAgICAgICAgcmV0dXJuIF9zZW5kQ29kZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gc2VuZENvZGU7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJ1cGxvYWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF91cGxvYWQgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU5KF9yZWYzKSB7CiAgICAgICAgdmFyIGZpbGVuYW1lLCBjb250ZW50LCBfcmVmMyRjYW5jZWxsYXRpb25Ub2ssIGNhbmNlbGxhdGlvblRva2VuLCBvblByb2dyZXNzLCBwYXlsb2FkOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTkkKF9jb250ZXh0OSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDkucHJldiA9IF9jb250ZXh0OS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgZmlsZW5hbWUgPSBfcmVmMy5maWxlbmFtZSwgY29udGVudCA9IF9yZWYzLmNvbnRlbnQsIF9yZWYzJGNhbmNlbGxhdGlvblRvayA9IF9yZWYzLmNhbmNlbGxhdGlvblRva2VuLCBjYW5jZWxsYXRpb25Ub2tlbiA9IF9yZWYzJGNhbmNlbGxhdGlvblRvayA9PT0gdm9pZCAwID8gbnVsbCA6IF9yZWYzJGNhbmNlbGxhdGlvblRvaywgb25Qcm9ncmVzcyA9IF9yZWYzLm9uUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAvLyBQZXJmb3JtIGFjdHVhbCB1cGxvYWQgaW4gdGhlIGJhY2tncm91bmQKICAgICAgICAgICAgICAgIHBheWxvYWQgPSBjb250ZW50IGluc3RhbmNlb2YgQmxvYiA/IGNvbnRlbnQgOiBuZXcgQmxvYihbY29udGVudF0pOwogICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdCgnUFVUJywgJ21hY2hpbmUvZmlsZS8nICsgZW5jb2RlVVJJQ29tcG9uZW50KGZpbGVuYW1lKSwgbnVsbCwgJycsIHBheWxvYWQsIG9uUHJvZ3Jlc3MsIGNhbmNlbGxhdGlvblRva2VuLCBmaWxlbmFtZSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgIC8vIFVwbG9hZCBzdWNjZXNzZnVsCiAgICAgICAgICAgICAgICB0aGlzLmRpc3BhdGNoKCdvbkZpbGVVcGxvYWRlZCcsIHsKICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6IGZpbGVuYW1lLAogICAgICAgICAgICAgICAgICBjb250ZW50OiBjb250ZW50CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU5LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gdXBsb2FkKF94OCkgewogICAgICAgIHJldHVybiBfdXBsb2FkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiB1cGxvYWQ7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJkZWxldGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9kZWxldGUyID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTAoZmlsZW5hbWUpIHsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEwJChfY29udGV4dDEwKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTAucHJldiA9IF9jb250ZXh0MTAubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KCdERUxFVEUnLCAnbWFjaGluZS9maWxlLycgKyBlbmNvZGVVUklDb21wb25lbnQoZmlsZW5hbWUpLCBudWxsLCAnanNvbicsIG51bGwsIG51bGwsIG51bGwsIGZpbGVuYW1lKTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gNDsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRpc3BhdGNoKCdvbkZpbGVPckRpcmVjdG9yeURlbGV0ZWQnLCBmaWxlbmFtZSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTEwLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gX2RlbGV0ZShfeDkpIHsKICAgICAgICByZXR1cm4gX2RlbGV0ZTIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIF9kZWxldGU7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJtb3ZlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfbW92ZSA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTExKF9yZWY0KSB7CiAgICAgICAgdmFyIGZyb20sIHRvLCBfcmVmNCRmb3JjZSwgZm9yY2UsIF9yZWY0JHNpbGVudCwgc2lsZW50LCBmb3JtRGF0YTsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMSQoX2NvbnRleHQxMSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDExLnByZXYgPSBfY29udGV4dDExLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBmcm9tID0gX3JlZjQuZnJvbSwgdG8gPSBfcmVmNC50bywgX3JlZjQkZm9yY2UgPSBfcmVmNC5mb3JjZSwgZm9yY2UgPSBfcmVmNCRmb3JjZSA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcmVmNCRmb3JjZSwgX3JlZjQkc2lsZW50ID0gX3JlZjQuc2lsZW50LCBzaWxlbnQgPSBfcmVmNCRzaWxlbnQgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZjQkc2lsZW50OwogICAgICAgICAgICAgICAgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgICAgICAgICAgIGZvcm1EYXRhLnNldCgnZnJvbScsIGZyb20pOwogICAgICAgICAgICAgICAgZm9ybURhdGEuc2V0KCd0bycsIHRvKTsKICAgICAgICAgICAgICAgIGZvcm1EYXRhLnNldCgnZm9yY2UnLCBCb29sZWFuKGZvcmNlKSk7CiAgICAgICAgICAgICAgICBfY29udGV4dDExLnByZXYgPSA1OwogICAgICAgICAgICAgICAgX2NvbnRleHQxMS5uZXh0ID0gODsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QoJ1BPU1QnLCAnbWFjaGluZS9maWxlL21vdmUnLCBudWxsLCAnJywgZm9ybURhdGEsIG51bGwsIG51bGwsIGZyb20pOwoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICBfY29udGV4dDExLm5leHQgPSAxMDsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRpc3BhdGNoKCdvbkZpbGVPckRpcmVjdG9yeU1vdmVkJywgewogICAgICAgICAgICAgICAgICBmcm9tOiBmcm9tLAogICAgICAgICAgICAgICAgICB0bzogdG8sCiAgICAgICAgICAgICAgICAgIGZvcmNlOiBmb3JjZQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICBfY29udGV4dDExLm5leHQgPSAxNjsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgX2NvbnRleHQxMS5wcmV2ID0gMTI7CiAgICAgICAgICAgICAgICBfY29udGV4dDExLnQwID0gX2NvbnRleHQxMVsiY2F0Y2giXSg1KTsKCiAgICAgICAgICAgICAgICBpZiAoc2lsZW50KSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTEubmV4dCA9IDE2OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aHJvdyBfY29udGV4dDExLnQwOwoKICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTEsIHRoaXMsIFtbNSwgMTJdXSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIG1vdmUoX3gxMCkgewogICAgICAgIHJldHVybiBfbW92ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gbW92ZTsKICAgIH0oKQogIH0sIHsKICAgIGtleTogIm1ha2VEaXJlY3RvcnkiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9tYWtlRGlyZWN0b3J5ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTIoZGlyZWN0b3J5KSB7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMiQoX2NvbnRleHQxMikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDEyLnByZXYgPSBfY29udGV4dDEyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDEyLm5leHQgPSAyOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdCgnUFVUJywgJ21hY2hpbmUvZGlyZWN0b3J5LycgKyBlbmNvZGVVUklDb21wb25lbnQoZGlyZWN0b3J5KSk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIF9jb250ZXh0MTIubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kaXNwYXRjaCgnb25EaXJlY3RvcnlDcmVhdGVkJywgZGlyZWN0b3J5KTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTIsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBtYWtlRGlyZWN0b3J5KF94MTEpIHsKICAgICAgICByZXR1cm4gX21ha2VEaXJlY3RvcnkuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG1ha2VEaXJlY3Rvcnk7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJkb3dubG9hZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2Rvd25sb2FkID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTMocGF5bG9hZCkgewogICAgICAgIHZhciBmaWxlbmFtZSwgdHlwZSwgb25Qcm9ncmVzcywgY2FuY2VsbGF0aW9uVG9rZW4sIHJlc3BvbnNlOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTMkKF9jb250ZXh0MTMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMy5wcmV2ID0gX2NvbnRleHQxMy5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgZmlsZW5hbWUgPSBwYXlsb2FkIGluc3RhbmNlb2YgT2JqZWN0ID8gcGF5bG9hZC5maWxlbmFtZSA6IHBheWxvYWQ7CiAgICAgICAgICAgICAgICB0eXBlID0gcGF5bG9hZCBpbnN0YW5jZW9mIE9iamVjdCAmJiBwYXlsb2FkLnR5cGUgIT09IHVuZGVmaW5lZCA/IHBheWxvYWQudHlwZSA6ICdqc29uJzsKICAgICAgICAgICAgICAgIG9uUHJvZ3Jlc3MgPSBwYXlsb2FkIGluc3RhbmNlb2YgT2JqZWN0ID8gcGF5bG9hZC5vblByb2dyZXNzIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgY2FuY2VsbGF0aW9uVG9rZW4gPSBwYXlsb2FkIGluc3RhbmNlb2YgT2JqZWN0ICYmIHBheWxvYWQuY2FuY2VsbGF0aW9uVG9rZW4gPyBwYXlsb2FkLmNhbmNlbGxhdGlvblRva2VuIDogbnVsbDsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTMubmV4dCA9IDY7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KCdHRVQnLCAnbWFjaGluZS9maWxlLycgKyBlbmNvZGVVUklDb21wb25lbnQoZmlsZW5hbWUpLCBudWxsLCB0eXBlLCBudWxsLCBvblByb2dyZXNzLCBjYW5jZWxsYXRpb25Ub2tlbiwgZmlsZW5hbWUpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0MTMuc2VudDsKICAgICAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2goJ29uRmlsZURvd25sb2FkZWQnLCB7CiAgICAgICAgICAgICAgICAgIGZpbGVuYW1lOiBmaWxlbmFtZSwKICAgICAgICAgICAgICAgICAgY29udGVudDogcmVzcG9uc2UKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTMuYWJydXB0KCJyZXR1cm4iLCByZXNwb25zZSk7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTEzLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZG93bmxvYWQoX3gxMikgewogICAgICAgIHJldHVybiBfZG93bmxvYWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGRvd25sb2FkOwogICAgfSgpCiAgfSwgewogICAga2V5OiAiZ2V0RmlsZUxpc3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRGaWxlTGlzdCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE0KGRpcmVjdG9yeSkgewogICAgICAgIHZhciByZXNwb25zZTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTE0JChfY29udGV4dDE0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTQucHJldiA9IF9jb250ZXh0MTQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0MTQucHJldiA9IDA7CiAgICAgICAgICAgICAgICBfY29udGV4dDE0Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdCgnR0VUJywgJ21hY2hpbmUvZGlyZWN0b3J5LycgKyBlbmNvZGVVUklDb21wb25lbnQoZGlyZWN0b3J5KSk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQxNC5zZW50OwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTQuYWJydXB0KCJyZXR1cm4iLCByZXNwb25zZS5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBpc0RpcmVjdG9yeTogaXRlbS50eXBlID09PSAnZCcsCiAgICAgICAgICAgICAgICAgICAgbmFtZTogaXRlbS5uYW1lLAogICAgICAgICAgICAgICAgICAgIHNpemU6IGl0ZW0udHlwZSA9PT0gJ2QnID8gbnVsbCA6IGl0ZW0uc2l6ZSwKICAgICAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHN0clRvVGltZShpdGVtLmRhdGUpCiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIF9jb250ZXh0MTQucHJldiA9IDc7CiAgICAgICAgICAgICAgICBfY29udGV4dDE0LnQwID0gX2NvbnRleHQxNFsiY2F0Y2giXSgwKTsKCiAgICAgICAgICAgICAgICBpZiAoIShfY29udGV4dDE0LnQwIGluc3RhbmNlb2YgRmlsZU5vdEZvdW5kRXJyb3IpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTQubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRGlyZWN0b3J5Tm90Rm91bmRFcnJvcihkaXJlY3RvcnkpOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgdGhyb3cgX2NvbnRleHQxNC50MDsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTE0LCB0aGlzLCBbWzAsIDddXSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGdldEZpbGVMaXN0KF94MTMpIHsKICAgICAgICByZXR1cm4gX2dldEZpbGVMaXN0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXRGaWxlTGlzdDsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImdldEZpbGVJbmZvIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZ2V0RmlsZUluZm8gPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNShmaWxlbmFtZSkgewogICAgICAgIHZhciByZXNwb25zZTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTE1JChfY29udGV4dDE1KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTUucHJldiA9IF9jb250ZXh0MTUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0MTUubmV4dCA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KCdHRVQnLCAnbWFjaGluZS9maWxlaW5mby8nICsgZW5jb2RlVVJJQ29tcG9uZW50KGZpbGVuYW1lKSwgbnVsbCwgJ2pzb24nLCBudWxsLCBudWxsLCBudWxsLCBmaWxlbmFtZSk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQxNS5zZW50OwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTUuYWJydXB0KCJyZXR1cm4iLCBuZXcgUGFyc2VkRmlsZUluZm8ocmVzcG9uc2UpKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTUsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXRGaWxlSW5mbyhfeDE0KSB7CiAgICAgICAgcmV0dXJuIF9nZXRGaWxlSW5mby5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZ2V0RmlsZUluZm87CiAgICB9KCkKICB9XSk7CgogIHJldHVybiBSZXN0Q29ubmVjdG9yOwp9KEJhc2VDb25uZWN0b3IpOwoKZXhwb3J0IHsgUmVzdENvbm5lY3RvciBhcyBkZWZhdWx0IH07"},{"version":3,"sources":["C:/Users/jpatrick/Documents/GitHub/DuetWebControl_Fork/src/store/machine/connector/RestConnector.js"],"names":["BaseConnector","ParsedFileInfo","NetworkError","DisconnectedError","TimeoutError","OperationCancelledError","OperationFailedError","DirectoryNotFoundError","FileNotFoundError","LoginError","InvalidPasswordError","strToTime","RestConnector","hostname","username","password","socketProtocol","location","protocol","socket","WebSocket","Promise","resolve","reject","onmessage","e","model","JSON","parse","data","onerror","onclose","code","reason","requestBase","job","layers","method","url","params","responseType","body","onProgress","cancellationToken","filename","internalURL","hadParam","key","encodeURIComponent","xhr","XMLHttpRequest","open","setRequestHeader","onprogress","loaded","total","upload","timeout","cancel","abort","requests","push","that","onload","filter","request","status","responseText","response","statusText","onabort","ontimeout","send","forEach","cancelRequests","lastDsfVersion","state","dsfVersion","reload","startSocket","module","messages","undefined","message","dispatch","reply","content","pingTask","setTimeout","doPing","bind","settings","pingInterval","onMessage","onClose","clearTimeout","type","length","layer","close","trim","payload","Blob","from","to","force","silent","formData","FormData","set","Boolean","directory","Object","map","item","isDirectory","name","size","lastModified","date"],"mappings":"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","sourcesContent":["// RESTful connector for DSF\r\n'use strict'\r\n\r\nimport BaseConnector from './BaseConnector.js'\r\nimport { ParsedFileInfo } from '../modelItems.js'\r\n\r\nimport {\r\n\tNetworkError, DisconnectedError, TimeoutError, OperationCancelledError, OperationFailedError,\r\n\tDirectoryNotFoundError, FileNotFoundError,\r\n\tLoginError, InvalidPasswordError\r\n} from '../../../utils/errors.js'\r\n\r\nimport { strToTime } from '../../../utils/time.js'\r\n\r\nexport default class RestConnector extends BaseConnector {\r\n\tstatic async connect(hostname, username, password) {\r\n\t\tconst socketProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';\r\n\t\tconst socket = new WebSocket(`${socketProtocol}//${hostname}/machine`);\r\n\t\tconst model = await new Promise(function(resolve, reject) {\r\n\t\t\tsocket.onmessage = function(e) {\r\n\t\t\t\t// Successfully connected, the first message is the full object model\r\n\t\t\t\tconst model = JSON.parse(e.data);\r\n\t\t\t\tresolve(model);\r\n\t\t\t};\r\n\t\t\tsocket.onerror = socket.onclose = function(e) {\r\n\t\t\t\tif (e.code === 1001 || e.code == 1011) {\r\n\t\t\t\t\t// DCS unavailable or incompatible DCS version\r\n\t\t\t\t\treject(new LoginError(e.reason));\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// TODO accomodate InvalidPasswordError and NoFreeSessionError here\r\n\t\t\t\t\treject(new NetworkError(e.reason));\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn new RestConnector(hostname, password, socket, model);\r\n\t}\r\n\r\n\tmodel = {}\r\n\tfileTransfers = []\r\n\tlayers = []\r\n\r\n\tconstructor(hostname, password, socket, model) {\r\n\t\tsuper('rest', hostname);\r\n\t\tthis.password = password;\r\n\t\tthis.requestBase = `${location.protocol}//${hostname}/`;\r\n\t\tthis.socket = socket;\r\n\t\tthis.model = model;\r\n\t\tif (model.job && model.job.layers) {\r\n\t\t\tthis.layers = model.job.layers;\r\n\t\t}\r\n\t}\r\n\r\n\trequestBase = ''\r\n\trequests = []\r\n\r\n\trequest(method, url, params = null, responseType = 'json', body = null, onProgress = null, cancellationToken = null, filename = 'n/a') {\r\n\t\tlet internalURL = this.requestBase + url;\r\n\t\tif (params) {\r\n\t\t\tlet hadParam = false;\r\n\t\t\tfor (let key in params) {\r\n\t\t\t\tinternalURL += (hadParam ? '&' : '?') + key + '=' + encodeURIComponent(params[key]);\r\n\t\t\t\thadParam = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst xhr = new XMLHttpRequest();\r\n\t\txhr.open(method, internalURL);\r\n\t\tif (responseType === 'json') {\r\n\t\t\txhr.responseType = 'text';\r\n\t\t\txhr.setRequestHeader('Content-Type', 'application/json');\r\n\t\t} else {\r\n\t\t\txhr.responseType = responseType;\r\n\t\t}\r\n\t\tif (onProgress) {\r\n\t\t\txhr.onprogress = function(e) {\r\n\t\t\t\tif (e.loaded && e.total) {\r\n\t\t\t\t\tonProgress(e.loaded, e.total);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\txhr.upload.onprogress = xhr.onprogress;\r\n\t\t}\r\n\t\txhr.timeout = 0;\r\n\t\tif (cancellationToken) {\r\n\t\t\tcancellationToken.cancel = () => xhr.abort();\r\n\t\t}\r\n\t\tthis.requests.push(xhr);\r\n\r\n\t\tconst that = this;\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\txhr.onload = function() {\r\n\t\t\t\tthat.requests = that.requests.filter(request => request !== xhr);\r\n\t\t\t\tif (xhr.status >= 200 && xhr.status < 300) {\r\n\t\t\t\t\tif (responseType === 'json') {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tif (!xhr.responseText) {\r\n\t\t\t\t\t\t\t\tresolve(null);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tresolve(JSON.parse(xhr.responseText));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\treject(e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresolve(xhr.response);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (xhr.status === 401) {\r\n\t\t\t\t\treject(new InvalidPasswordError());\r\n\t\t\t\t} else if (xhr.status === 404) {\r\n\t\t\t\t\treject(new FileNotFoundError(filename));\r\n\t\t\t\t} else if (xhr.status >= 500) {\r\n\t\t\t\t\treject(new OperationFailedError(xhr.responseText || xhr.statusText));\r\n\t\t\t\t} else if (xhr.status !== 0) {\r\n\t\t\t\t\treject(new OperationFailedError());\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\txhr.onabort = function() {\r\n\t\t\t\tthat.requests = that.requests.filter(request => request !== xhr);\r\n\t\t\t\treject(that.socket ? new OperationCancelledError() : new DisconnectedError());\r\n\t\t\t}\r\n\t\t\txhr.onerror = function() {\r\n\t\t\t\tthat.requests = that.requests.filter(request => request !== xhr);\r\n\t\t\t\treject(new NetworkError());\r\n\t\t\t};\r\n\t\t\txhr.ontimeout = function () {\r\n\t\t\t\treject(new TimeoutError());\r\n\t\t\t};\r\n\t\t\txhr.send(body);\r\n\t\t});\r\n\t}\r\n\r\n\tcancelRequests() {\r\n\t\tthis.requests.forEach(request => request.abort());\r\n\t}\r\n\r\n\tasync reconnect() {\r\n\t\t// Cancel pending requests\r\n\t\tthis.cancelRequests();\r\n\r\n\t\t// Attempt to reconnect\r\n\t\tconst that = this;\r\n\t\tawait new Promise(function(resolve, reject) {\r\n\t\t\tconst lastDsfVersion = that.model.state.dsfVersion;\r\n\t\t\tconst socketProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';\r\n\t\t\tconst socket = new WebSocket(`${socketProtocol}//${that.hostname}/machine`);\r\n\t\t\tsocket.onmessage = function(e) {\r\n\t\t\t\t// Successfully connected, the first message is the full object model\r\n\t\t\t\tthat.model = JSON.parse(e.data);\r\n\t\t\t\tif (that.model.job && that.model.job.layers) {\r\n\t\t\t\t\tthat.layers = that.model.job.layers;\r\n\t\t\t\t}\r\n\t\t\t\tthat.socket = socket;\r\n\r\n\t\t\t\t// Check if DSF has been updated\r\n\t\t\t\tif (lastDsfVersion !== that.model.state.dsfVersion) {\r\n\t\t\t\t\tlocation.reload(true);\r\n\t\t\t\t}\r\n\t\t\t\tresolve();\r\n\t\t\t}\r\n\t\t\tsocket.onerror = socket.onclose = function(e) {\r\n\t\t\t\tif (e.code === 1001 || e.code == 1011) {\r\n\t\t\t\t\t// DCS unavailable or incompatible DCS version\r\n\t\t\t\t\treject(new LoginError(e.reason));\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// TODO accomodate InvalidPasswordError and NoFreeSessionError here\r\n\t\t\t\t\treject(new NetworkError(e.reason));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Apply new socket and machine model\r\n\t\tawait that.startSocket();\r\n\t}\r\n\r\n\tregister(module) {\r\n\t\tsuper.register(module);\r\n\t\tthis.startSocket();\r\n\t}\r\n\r\n\tasync startSocket() {\r\n\t\t// Deal with generic messages\r\n\t\tif (this.model.messages !== undefined) {\r\n\t\t\tthis.model.messages.forEach(async function(message) {\r\n\t\t\t\tawait this.dispatch('onCodeCompleted', { code: undefined, reply: message.content });\r\n\t\t\t}, this);\r\n\t\t\tdelete this.model.messages;\r\n\t\t}\r\n\r\n\t\t// Send PING in predefined intervals to detect disconnects from the client side\r\n\t\tthis.pingTask = setTimeout(this.doPing.bind(this), this.settings.pingInterval);\r\n\r\n\t\t// Set up socket events\r\n\t\tthis.socket.onmessage = this.onMessage.bind(this);\r\n\t\tthis.socket.onerror = this.onClose.bind(this);\r\n\t\tthis.socket.onclose = this.onClose.bind(this);\r\n\r\n\t\t// Update model and acknowledge receival\r\n\t\tawait this.dispatch('update', this.model);\r\n\t\tthis.socket.send('OK\\n');\r\n\t}\r\n\r\n\tdoPing() {\r\n\t\t// Although the WebSocket standard is supposed to provide PING frames,\r\n\t\t// there is no way to send them since a WebSocket instance does not provide a method for that.\r\n\t\t// Hence we rely on our own optional PING-PONG implementation\r\n\t\tthis.socket.send('PING\\n');\r\n\t\tthis.pingTask = undefined;\r\n\t}\r\n\r\n\tasync onMessage(e) {\r\n\t\t// Don't do anything if the connection has been terminated...\r\n\t\tif (this.socket == null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Use PING/PONG messages to detect connection interrupts\r\n\t\tif (this.pingTask) {\r\n\t\t\t// We've just received something, reset the ping task\r\n\t\t\tclearTimeout(this.pingTask);\r\n\t\t}\r\n\t\tthis.pingTask = setTimeout(this.doPing.bind(this), this.settings.pingInterval);\r\n\r\n\t\t// It's just a PONG reply, ignore this\r\n\t\tif (e.data === 'PONG\\n') {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Process model updates\r\n\t\tconst data = JSON.parse(e.data);\r\n\r\n\t\t// Deal with generic messages\r\n\t\tif (data.messages) {\r\n\t\t\tdata.messages.forEach(async function(message) {\r\n\t\t\t\tlet reply;\r\n\t\t\t\tswitch (message.type) {\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\treply  = `Warning: ${message.content}`;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\treply  = `Error: ${message.content}`;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treply = message.content;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// TODO Pass supplied date/time from the messages here\r\n\t\t\t\tawait this.dispatch('onCodeCompleted', { code: undefined, reply });\r\n\t\t\t}, this);\r\n\t\t\tdelete data.messages;\r\n\t\t}\r\n\r\n\t\t// Deal with layers\r\n\t\tif (data.job && data.job.layers !== undefined) {\r\n\t\t\tif (data.job.layers.length === 0) {\r\n\t\t\t\tthis.layers = [];\r\n\t\t\t} else {\r\n\t\t\t\tdata.job.layers.forEach(layer => this.layers.push(layer), this);\r\n\t\t\t}\r\n\t\t\tdata.job.layers = this.layers;\r\n\t\t}\r\n\r\n\t\t// Update model and acknowledge receipt\r\n\t\tawait this.dispatch('update', data);\r\n\t\tthis.socket.send('OK\\n');\r\n\t}\r\n\r\n\tonClose(e) {\r\n\t\tthis.cancelRequests();\r\n\t\tif (this.pingTask) {\r\n\t\t\tclearTimeout(this.pingTask);\r\n\t\t\tthis.pingTask = undefined;\r\n\t\t}\r\n\t\tthis.dispatch('onConnectionError', new NetworkError(e.reason));\r\n\t}\r\n\r\n\tasync disconnect() {\r\n\t\tif (this.socket) {\r\n\t\t\tif (this.pingTask) {\r\n\t\t\t\tclearTimeout(this.pingTask);\r\n\t\t\t\tthis.pingTask = undefined;\r\n\t\t\t}\r\n\r\n\t\t\tthis.socket.close();\r\n\t\t\tthis.socket = null;\r\n\t\t}\r\n\t}\r\n\r\n\tunregister() {\r\n\t\tthis.cancelRequests();\r\n\t\tsuper.unregister();\r\n\t}\r\n\r\n\tasync sendCode(code) {\r\n\t\tlet reply;\r\n\t\ttry {\r\n\t\t\tconst response = await this.request('POST', 'machine/code', null, 'text', code);\r\n\t\t\treply = response.trim();\r\n\t\t} catch (e) {\r\n\t\t\treply = 'Error: ' + e.message;\r\n\t\t}\r\n\r\n\t\tthis.dispatch('onCodeCompleted', { code, reply });\r\n\t\treturn reply;\r\n\t}\r\n\r\n\tasync upload({ filename, content, cancellationToken = null, onProgress }) {\r\n\t\t// Perform actual upload in the background\r\n\t\tconst payload = (content instanceof(Blob)) ? content : new Blob([content]);\r\n\t\tawait this.request('PUT', 'machine/file/' + encodeURIComponent(filename), null, '', payload, onProgress, cancellationToken, filename);\r\n\r\n\t\t// Upload successful\r\n\t\tthis.dispatch('onFileUploaded', { filename, content });\r\n\t}\r\n\r\n\tasync delete(filename) {\r\n\t\tawait this.request('DELETE', 'machine/file/' + encodeURIComponent(filename), null, 'json', null, null, null, filename);\r\n\t\tawait this.dispatch('onFileOrDirectoryDeleted', filename);\r\n\t}\r\n\r\n\tasync move({ from, to, force = false, silent = false }) {\r\n\t\tconst formData = new FormData();\r\n\t\tformData.set('from', from);\r\n\t\tformData.set('to', to);\r\n\t\tformData.set('force', Boolean(force));\r\n\t\t\r\n\t\ttry {\r\n\t\t\tawait this.request('POST', 'machine/file/move', null, '', formData, null, null, from);\r\n\t\t\tawait this.dispatch('onFileOrDirectoryMoved', { from, to, force });\r\n\t\t} catch (e) {\r\n\t\t\tif (!silent) {\r\n\t\t\t\tthrow e;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tasync makeDirectory(directory) {\r\n\t\tawait this.request('PUT', 'machine/directory/' + encodeURIComponent(directory));\r\n\t\tawait this.dispatch('onDirectoryCreated', directory);\r\n\t}\r\n\r\n\tasync download(payload) {\r\n\t\tconst filename = (payload instanceof Object) ? payload.filename : payload;\r\n\t\tconst type = (payload instanceof Object && payload.type !== undefined) ? payload.type : 'json';\r\n\t\tconst onProgress = (payload instanceof Object) ? payload.onProgress : undefined;\r\n\t\tconst cancellationToken = (payload instanceof Object && payload.cancellationToken) ? payload.cancellationToken : null;\r\n\r\n\t\tconst response = await this.request('GET', 'machine/file/' + encodeURIComponent(filename), null, type, null, onProgress, cancellationToken, filename);\r\n\r\n\t\tthis.dispatch('onFileDownloaded', { filename, content: response });\r\n\t\treturn response;\r\n\t}\r\n\r\n\tasync getFileList(directory) {\r\n\t\ttry {\r\n\t\t\tconst response = await this.request('GET', 'machine/directory/' + encodeURIComponent(directory));\r\n\t\t\treturn response.map(item => ({\r\n\t\t\t\tisDirectory: item.type === 'd',\r\n\t\t\t\tname: item.name,\r\n\t\t\t\tsize: (item.type === 'd') ? null : item.size,\r\n\t\t\t\tlastModified: strToTime(item.date)\r\n\t\t\t}));\r\n\t\t} catch (e) {\r\n\t\t\tif (e instanceof FileNotFoundError) {\r\n\t\t\t\tthrow new DirectoryNotFoundError(directory);\r\n\t\t\t}\r\n\t\t\tthrow e;\r\n\t\t}\r\n\t}\r\n\r\n\tasync getFileInfo(filename) {\r\n\t\tconst response = await this.request('GET', 'machine/fileinfo/' + encodeURIComponent(filename), null, 'json', null, null, null, filename);\r\n\t\treturn new ParsedFileInfo(response);\r\n\t}\r\n}\r\n"]}]}