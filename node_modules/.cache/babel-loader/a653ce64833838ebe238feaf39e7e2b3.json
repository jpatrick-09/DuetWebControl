{"remainingRequest":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\thread-loader\\dist\\cjs.js!C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\src\\store\\machine\\connector\\PollConnector.js","dependencies":[{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\src\\store\\machine\\connector\\PollConnector.js","mtime":1592248188689},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8gUG9sbGluZyBjb25uZWN0b3IgZm9yIFJlcFJhcEZpcm13YXJlCid1c2Ugc3RyaWN0JzsKCmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbHRlciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZvci1lYWNoIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmtleXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnRyaW0iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvciI7CmltcG9ydCBfdHlwZW9mIGZyb20gIkM6XFxVc2Vyc1xcanBhdHJpY2tcXERvY3VtZW50c1xcR2l0SHViXFxEdWV0V2ViQ29udHJvbF9Gb3JrXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS90eXBlb2YiOwppbXBvcnQgX3RvQ29uc3VtYWJsZUFycmF5IGZyb20gIkM6XFxVc2Vyc1xcanBhdHJpY2tcXERvY3VtZW50c1xcR2l0SHViXFxEdWV0V2ViQ29udHJvbF9Gb3JrXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS90b0NvbnN1bWFibGVBcnJheSI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lIjsKaW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkM6XFxVc2Vyc1xcanBhdHJpY2tcXERvY3VtZW50c1xcR2l0SHViXFxEdWV0V2ViQ29udHJvbF9Gb3JrXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJDOlxcVXNlcnNcXGpwYXRyaWNrXFxEb2N1bWVudHNcXEdpdEh1YlxcRHVldFdlYkNvbnRyb2xfRm9ya1xcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2Fzc2VydFRoaXNJbml0aWFsaXplZCBmcm9tICJDOlxcVXNlcnNcXGpwYXRyaWNrXFxEb2N1bWVudHNcXEdpdEh1YlxcRHVldFdlYkNvbnRyb2xfRm9ya1xcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vYXNzZXJ0VGhpc0luaXRpYWxpemVkIjsKaW1wb3J0IF9nZXRQcm90b3R5cGVPZiBmcm9tICJDOlxcVXNlcnNcXGpwYXRyaWNrXFxEb2N1bWVudHNcXEdpdEh1YlxcRHVldFdlYkNvbnRyb2xfRm9ya1xcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vZ2V0UHJvdG90eXBlT2YiOwppbXBvcnQgX2dldCBmcm9tICJDOlxcVXNlcnNcXGpwYXRyaWNrXFxEb2N1bWVudHNcXEdpdEh1YlxcRHVldFdlYkNvbnRyb2xfRm9ya1xcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vZ2V0IjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICJDOlxcVXNlcnNcXGpwYXRyaWNrXFxEb2N1bWVudHNcXEdpdEh1YlxcRHVldFdlYkNvbnRyb2xfRm9ya1xcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX2luaGVyaXRzIGZyb20gIkM6XFxVc2Vyc1xcanBhdHJpY2tcXERvY3VtZW50c1xcR2l0SHViXFxEdWV0V2ViQ29udHJvbF9Gb3JrXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9pbmhlcml0cyI7CmltcG9ydCBfY3JlYXRlU3VwZXIgZnJvbSAiQzpcXFVzZXJzXFxqcGF0cmlja1xcRG9jdW1lbnRzXFxHaXRIdWJcXER1ZXRXZWJDb250cm9sX0ZvcmtcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZVN1cGVyIjsKaW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJDOlxcVXNlcnNcXGpwYXRyaWNrXFxEb2N1bWVudHNcXEdpdEh1YlxcRHVldFdlYkNvbnRyb2xfRm9ya1xcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vZGVmaW5lUHJvcGVydHkiOwppbXBvcnQgY3JjMzIgZnJvbSAndHVyYm8tY3JjMzIvY3JjMzInOwppbXBvcnQgQmFzZUNvbm5lY3RvciwgeyBkZWZhdWx0UmVxdWVzdFRpbWVvdXQgfSBmcm9tICcuL0Jhc2VDb25uZWN0b3IuanMnOwppbXBvcnQgeyBnZXRCb2FyZERlZmluaXRpb24gfSBmcm9tICcuLi9ib2FyZHMuanMnOwppbXBvcnQgeyBEZWZhdWx0TWFjaGluZU1vZGVsIH0gZnJvbSAnLi4vbW9kZWwuanMnOwppbXBvcnQgeyBIZWF0ZXJTdGF0ZSwgU3RhdHVzVHlwZSwgaXNQYXVzZWQsIGlzUHJpbnRpbmcgfSBmcm9tICcuLi9tb2RlbEVudW1zLmpzJzsKaW1wb3J0IHsgQmVlcFJlcXVlc3QsIE1lc3NhZ2VCb3gsIFBhcnNlZEZpbGVJbmZvIH0gZnJvbSAnLi4vbW9kZWxJdGVtcy5qcyc7CmltcG9ydCB7IE5ldHdvcmtFcnJvciwgRGlzY29ubmVjdGVkRXJyb3IsIFRpbWVvdXRFcnJvciwgT3BlcmF0aW9uQ2FuY2VsbGVkRXJyb3IsIE9wZXJhdGlvbkZhaWxlZEVycm9yLCBEaXJlY3RvcnlOb3RGb3VuZEVycm9yLCBGaWxlTm90Rm91bmRFcnJvciwgRHJpdmVVbm1vdW50ZWRFcnJvciwgTG9naW5FcnJvciwgSW52YWxpZFBhc3N3b3JkRXJyb3IsIE5vRnJlZVNlc3Npb25FcnJvciwgQ29kZVJlc3BvbnNlRXJyb3IsIENvZGVCdWZmZXJFcnJvciB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL2Vycm9ycy5qcyc7CmltcG9ydCB7IGFycmF5U2l6ZXNEaWZmZXIsIHF1aWNrUGF0Y2ggfSBmcm9tICcuLi8uLi8uLi91dGlscy9wYXRjaC5qcyc7CmltcG9ydCB7IGJpdG1hcFRvQXJyYXkgfSBmcm9tICcuLi8uLi8uLi91dGlscy9udW1iZXJzLmpzJzsKaW1wb3J0IHsgc3RyVG9UaW1lLCB0aW1lVG9TdHIgfSBmcm9tICcuLi8uLi8uLi91dGlscy90aW1lLmpzJzsKCnZhciBQb2xsQ29ubmVjdG9yID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQmFzZUNvbm5lY3RvcikgewogIF9pbmhlcml0cyhQb2xsQ29ubmVjdG9yLCBfQmFzZUNvbm5lY3Rvcik7CgogIHZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIoUG9sbENvbm5lY3Rvcik7CgogIF9jcmVhdGVDbGFzcyhQb2xsQ29ubmVjdG9yLCBbewogICAga2V5OiAicmVxdWVzdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVxdWVzdChtZXRob2QsIHVybCkgewogICAgICB2YXIgcGFyYW1zID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiBudWxsOwogICAgICB2YXIgcmVzcG9uc2VUeXBlID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbM10gOiAnanNvbic7CiAgICAgIHZhciBib2R5ID0gYXJndW1lbnRzLmxlbmd0aCA+IDQgJiYgYXJndW1lbnRzWzRdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbNF0gOiBudWxsOwogICAgICB2YXIgb25Qcm9ncmVzcyA9IGFyZ3VtZW50cy5sZW5ndGggPiA1ICYmIGFyZ3VtZW50c1s1XSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzVdIDogbnVsbDsKICAgICAgdmFyIHRpbWVvdXQgPSBhcmd1bWVudHMubGVuZ3RoID4gNiAmJiBhcmd1bWVudHNbNl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1s2XSA6IHRoaXMucmVxdWVzdFRpbWVvdXQ7CiAgICAgIHZhciBjYW5jZWxsYXRpb25Ub2tlbiA9IGFyZ3VtZW50cy5sZW5ndGggPiA3ICYmIGFyZ3VtZW50c1s3XSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzddIDogbnVsbDsKICAgICAgdmFyIGZpbGVuYW1lID0gYXJndW1lbnRzLmxlbmd0aCA+IDggJiYgYXJndW1lbnRzWzhdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbOF0gOiAnbi9hJzsKICAgICAgdmFyIHJldHJ5ID0gYXJndW1lbnRzLmxlbmd0aCA+IDkgJiYgYXJndW1lbnRzWzldICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbOV0gOiAwOwogICAgICB2YXIgaW50ZXJuYWxVUkwgPSB0aGlzLnJlcXVlc3RCYXNlICsgdXJsOwoKICAgICAgaWYgKHBhcmFtcykgewogICAgICAgIHZhciBoYWRQYXJhbSA9IGZhbHNlOwoKICAgICAgICBmb3IgKHZhciBrZXkgaW4gcGFyYW1zKSB7CiAgICAgICAgICBpbnRlcm5hbFVSTCArPSAoaGFkUGFyYW0gPyAnJicgOiAnPycpICsga2V5ICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHBhcmFtc1trZXldKTsKICAgICAgICAgIGhhZFBhcmFtID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgeGhyLm9wZW4obWV0aG9kLCBpbnRlcm5hbFVSTCk7CgogICAgICBpZiAocmVzcG9uc2VUeXBlID09PSAnanNvbicpIHsKICAgICAgICB4aHIucmVzcG9uc2VUeXBlID0gJ3RleHQnOwogICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpOwogICAgICB9IGVsc2UgewogICAgICAgIHhoci5yZXNwb25zZVR5cGUgPSByZXNwb25zZVR5cGU7CiAgICAgIH0KCiAgICAgIGlmIChvblByb2dyZXNzKSB7CiAgICAgICAgeGhyLm9ucHJvZ3Jlc3MgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgaWYgKGUubG9hZGVkICYmIGUudG90YWwpIHsKICAgICAgICAgICAgb25Qcm9ncmVzcyhlLmxvYWRlZCwgZS50b3RhbCk7CiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgeGhyLnVwbG9hZC5vbnByb2dyZXNzID0geGhyLm9ucHJvZ3Jlc3M7CiAgICAgIH0KCiAgICAgIHhoci50aW1lb3V0ID0gdGltZW91dDsKCiAgICAgIGlmIChjYW5jZWxsYXRpb25Ub2tlbikgewogICAgICAgIGNhbmNlbGxhdGlvblRva2VuLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiB4aHIuYWJvcnQoKTsKICAgICAgICB9OwogICAgICB9CgogICAgICB0aGlzLnJlcXVlc3RzLnB1c2goeGhyKTsKICAgICAgdmFyIG1heFJldHJpZXMgPSB0aGlzLnNldHRpbmdzLmFqYXhSZXRyaWVzLAogICAgICAgICAgdGhhdCA9IHRoaXM7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHRoYXQucmVxdWVzdHMgPSB0aGF0LnJlcXVlc3RzLmZpbHRlcihmdW5jdGlvbiAocmVxdWVzdCkgewogICAgICAgICAgICByZXR1cm4gcmVxdWVzdCAhPT0geGhyOwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKHhoci5zdGF0dXMgPj0gMjAwICYmIHhoci5zdGF0dXMgPCAzMDApIHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlVHlwZSA9PT0gJ2pzb24nKSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICgheGhyLnJlc3BvbnNlVGV4dCkgewogICAgICAgICAgICAgICAgICByZXNvbHZlKG51bGwpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgcmVzb2x2ZShKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJlc29sdmUoeGhyLnJlc3BvbnNlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmICh4aHIuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgICAgLy8gVXNlciBtaWdodCBoYXZlIGNsb3NlZCBhbm90aGVyIHRhYiBvciB0aGUgZmlybXdhcmUgcmVzdGFydGVkLCB3aGljaCBjYW4gY2F1c2UKICAgICAgICAgICAgLy8gdGhlIGN1cnJlbnQgc2Vzc2lvbiB0byBiZSB0ZXJtaW5hdGVkLiBUcnkgdG8gc2VuZCBhbm90aGVyIHJyX2Nvbm5lY3QgcmVxdWVzdAogICAgICAgICAgICAvLyB3aXRoIHRoZSBsYXN0LWtub3duIHBhc3N3b3JkIGFuZCByZXRyeSB0aGUgcGVuZGluZyByZXF1ZXN0IGlmIHRoYXQgc3VjY2VlZHMKICAgICAgICAgICAgQmFzZUNvbm5lY3Rvci5yZXF1ZXN0KCdHRVQnLCAiIi5jb25jYXQobG9jYXRpb24ucHJvdG9jb2wsICIvLyIpLmNvbmNhdCh0aGF0Lmhvc3RuYW1lLCAiL3JyX2Nvbm5lY3QiKSwgewogICAgICAgICAgICAgIHBhc3N3b3JkOiB0aGF0LnBhc3N3b3JkLAogICAgICAgICAgICAgIHRpbWU6IHRpbWVUb1N0cihuZXcgRGF0ZSgpKQogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICBpZiAocmVzdWx0IGluc3RhbmNlb2YgT2JqZWN0ICYmIHJlc3VsdC5lcnIgPT09IDApIHsKICAgICAgICAgICAgICAgIHRoYXQucmVxdWVzdChtZXRob2QsIHVybCwgcGFyYW1zLCByZXNwb25zZVR5cGUsIGJvZHksIG9uUHJvZ3Jlc3MsIHRpbWVvdXQsIGNhbmNlbGxhdGlvblRva2VuLCBmaWxlbmFtZSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKHJlc3VsdCk7CiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdChlcnJvcik7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBJbnZhbGlkUGFzc3dvcmRFcnJvcigpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgICAgIHJldHVybiByZWplY3QoZXJyb3IpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoeGhyLnN0YXR1cyA9PT0gNDA0KSB7CiAgICAgICAgICAgIHJlamVjdChuZXcgRmlsZU5vdEZvdW5kRXJyb3IoZmlsZW5hbWUpKTsKICAgICAgICAgIH0gZWxzZSBpZiAoeGhyLnN0YXR1cyA9PT0gNTAzKSB7CiAgICAgICAgICAgIGlmIChyZXRyeSA8IG1heFJldHJpZXMpIHsKICAgICAgICAgICAgICAvLyBSUkYgbWF5IGhhdmUgcnVuIG91dCBvZiBvdXRwdXQgYnVmZmVycy4gV2UgdXN1YWxseSBnZXQgaGVyZSB3aGVuIGEgY29kZSByZXBseSBpcyBibG9ja2luZwogICAgICAgICAgICAgIGlmIChyZXRyeSA9PT0gMCkgewogICAgICAgICAgICAgICAgdGhhdC5sYXN0U2VxKys7CiAgICAgICAgICAgICAgICB0aGF0LmdldEdDb2RlUmVwbHkodGhhdC5sYXN0U2VxKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgLy8gUmV0cnkgdGhlIG9yaWdpbmFsIHJlcXVlc3Qgd2hlbiB0aGUgY29kZSByZXBseSBoYXMgYmVlbiByZWNlaXZlZAogICAgICAgICAgICAgICAgICB0aGF0LnJlcXVlc3QobWV0aG9kLCB1cmwsIHBhcmFtcywgcmVzcG9uc2VUeXBlLCBib2R5LCBvblByb2dyZXNzLCB0aW1lb3V0LCBjYW5jZWxsYXRpb25Ub2tlbiwgZmlsZW5hbWUsIHJldHJ5ICsgMSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUocmVzdWx0KTsKICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdChlcnJvcik7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiByZWplY3QoZXJyb3IpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIFJldHJ5IHRoZSBvcmlnaW5hbCByZXF1ZXN0IGFmdGVyIGEgd2hpbGUKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICB0aGF0LnJlcXVlc3QobWV0aG9kLCB1cmwsIHBhcmFtcywgcmVzcG9uc2VUeXBlLCBib2R5LCBvblByb2dyZXNzLCB0aW1lb3V0LCBjYW5jZWxsYXRpb25Ub2tlbiwgZmlsZW5hbWUsIHJldHJ5ICsgMSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUocmVzdWx0KTsKICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdChlcnJvcik7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMjAwMCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJlamVjdChuZXcgT3BlcmF0aW9uRmFpbGVkRXJyb3IoeGhyLnJlc3BvbnNlVGV4dCB8fCB4aHIuc3RhdHVzVGV4dCkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKHhoci5zdGF0dXMgPj0gNTAwKSB7CiAgICAgICAgICAgIHJlamVjdChuZXcgT3BlcmF0aW9uRmFpbGVkRXJyb3IoeGhyLnJlc3BvbnNlVGV4dCB8fCB4aHIuc3RhdHVzVGV4dCkpOwogICAgICAgICAgfSBlbHNlIGlmICh4aHIuc3RhdHVzICE9PSAwKSB7CiAgICAgICAgICAgIHJlamVjdChuZXcgT3BlcmF0aW9uRmFpbGVkRXJyb3IoKSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgeGhyLm9uYWJvcnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0aGF0LnJlcXVlc3RzID0gdGhhdC5yZXF1ZXN0cy5maWx0ZXIoZnVuY3Rpb24gKHJlcXVlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3QgIT09IHhocjsKICAgICAgICAgIH0pOwogICAgICAgICAgcmVqZWN0KHRoYXQudXBkYXRlTG9vcFRpbWVyID8gbmV3IE9wZXJhdGlvbkNhbmNlbGxlZEVycm9yKCkgOiBuZXcgRGlzY29ubmVjdGVkRXJyb3IoKSk7CiAgICAgICAgfTsKCiAgICAgICAgeGhyLm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0aGF0LnJlcXVlc3RzID0gdGhhdC5yZXF1ZXN0cy5maWx0ZXIoZnVuY3Rpb24gKHJlcXVlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3QgIT09IHhocjsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChyZXRyeSA8IG1heFJldHJpZXMpIHsKICAgICAgICAgICAgLy8gVW5yZWxpYWJsZSBjb25uZWN0aW9uLCByZXRyeSBpZiBwb3NzaWJsZQogICAgICAgICAgICB0aGF0LnJlcXVlc3QobWV0aG9kLCB1cmwsIHBhcmFtcywgcmVzcG9uc2VUeXBlLCBib2R5LCBvblByb2dyZXNzLCB0aW1lb3V0LCBjYW5jZWxsYXRpb25Ub2tlbiwgZmlsZW5hbWUsIHJldHJ5ICsgMSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUocmVzdWx0KTsKICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdChlcnJvcik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVqZWN0KG5ldyBOZXR3b3JrRXJyb3IoKSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgeGhyLm9udGltZW91dCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHRoYXQucmVxdWVzdHMgPSB0aGF0LnJlcXVlc3RzLmZpbHRlcihmdW5jdGlvbiAocmVxdWVzdCkgewogICAgICAgICAgICByZXR1cm4gcmVxdWVzdCAhPT0geGhyOwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKHJldHJ5IDwgbWF4UmV0cmllcykgewogICAgICAgICAgICAvLyBSZXF1ZXN0IGhhcyB0aW1lZCBvdXQsIHJldHJ5IGlmIHBvc3NpYmxlCiAgICAgICAgICAgIHRoYXQucmVxdWVzdChtZXRob2QsIHVybCwgcGFyYW1zLCByZXNwb25zZVR5cGUsIGJvZHksIG9uUHJvZ3Jlc3MsIHRpbWVvdXQsIGNhbmNlbGxhdGlvblRva2VuLCBmaWxlbmFtZSwgcmV0cnkgKyAxKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShyZXN1bHQpOwogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgICAgICByZXR1cm4gcmVqZWN0KGVycm9yKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZWplY3QobmV3IFRpbWVvdXRFcnJvcigpKTsKICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICB4aHIuc2VuZChib2R5KTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY2FuY2VsUmVxdWVzdHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNhbmNlbFJlcXVlc3RzKCkgewogICAgICB0aGlzLnBlbmRpbmdDb2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChjb2RlKSB7CiAgICAgICAgcmV0dXJuIGNvZGUucmVqZWN0KG5ldyBEaXNjb25uZWN0ZWRFcnJvcigpKTsKICAgICAgfSk7CiAgICAgIHRoaXMucGVuZGluZ0NvZGVzID0gW107CiAgICAgIHRoaXMucmVxdWVzdHMuZm9yRWFjaChmdW5jdGlvbiAocmVxdWVzdCkgewogICAgICAgIHJldHVybiByZXF1ZXN0LmFib3J0KCk7CiAgICAgIH0pOwogICAgICB0aGlzLnJlcXVlc3RzID0gW107CiAgICB9CiAgfV0sIFt7CiAgICBrZXk6ICJjb25uZWN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfY29ubmVjdCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShob3N0bmFtZSwgdXNlcm5hbWUsIHBhc3N3b3JkKSB7CiAgICAgICAgdmFyIHJlc3BvbnNlOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgcmV0dXJuIEJhc2VDb25uZWN0b3IucmVxdWVzdCgnR0VUJywgIiIuY29uY2F0KGxvY2F0aW9uLnByb3RvY29sLCAiLy8iKS5jb25jYXQoaG9zdG5hbWUsICIvcnJfY29ubmVjdCIpLCB7CiAgICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZCwKICAgICAgICAgICAgICAgICAgdGltZTogdGltZVRvU3RyKG5ldyBEYXRlKCkpCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgICAgX2NvbnRleHQudDAgPSByZXNwb25zZS5lcnI7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gX2NvbnRleHQudDAgPT09IDAgPyA2IDogX2NvbnRleHQudDAgPT09IDEgPyA4IDogX2NvbnRleHQudDAgPT09IDIgPyA5IDogMTA7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgaWYgKCF3aW5kb3cuZm9yY2VMZWdhY3lDb25uZWN0ICYmIHJlc3BvbnNlLmFwaUxldmVsID4gMCkgewogICAgICAgICAgICAgICAgICAvLyBEb24ndCBoaWRlIHRoZSBjb25uZWN0aW9uIGRpYWxvZyB3aGlsZSB0aGUgZnVsbCBtb2RlbCBpcyBiZWluZyBsb2FkZWQuLi4KICAgICAgICAgICAgICAgICAgQmFzZUNvbm5lY3Rvci5zZXRDb25uZWN0aW5nUHJvZ3Jlc3MoMCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgbmV3IFBvbGxDb25uZWN0b3IoaG9zdG5hbWUsIHBhc3N3b3JkLCByZXNwb25zZSkpOwoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFBhc3N3b3JkRXJyb3IoKTsKCiAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vRnJlZVNlc3Npb25FcnJvcigpOwoKICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IExvZ2luRXJyb3IoIlVua25vd24gZXJyIHZhbHVlOiAiLmNvbmNhdChyZXNwb25zZS5lcnIpKTsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBjb25uZWN0KF94LCBfeDIsIF94MykgewogICAgICAgIHJldHVybiBfY29ubmVjdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gY29ubmVjdDsKICAgIH0oKQogIH1dKTsKCiAgZnVuY3Rpb24gUG9sbENvbm5lY3Rvcihob3N0bmFtZSwgcGFzc3dvcmQsIHJlc3BvbnNlRGF0YSkgewogICAgdmFyIF90aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBQb2xsQ29ubmVjdG9yKTsKCiAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsICdwb2xsJywgaG9zdG5hbWUpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInNlc3Npb25UaW1lb3V0IiwgODAwMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAianVzdENvbm5lY3RlZCIsIHRydWUpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm5hbWUiLCBudWxsKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJwYXNzd29yZCIsIG51bGwpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImJvYXJkVHlwZSIsIG51bGwpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImFwaUxldmVsIiwgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicmVxdWVzdEJhc2UiLCAnJyk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicmVxdWVzdFRpbWVvdXQiLCBkZWZhdWx0UmVxdWVzdFRpbWVvdXQpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInJlcXVlc3RzIiwgW10pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInVwZGF0ZUxvb3BUaW1lciIsIG51bGwpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInVwZGF0ZUxvb3BDb3VudGVyIiwgMSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAibGFzdFN0YXR1c1Jlc3BvbnNlIiwge30pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImxhc3RTZXEiLCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJwZW5kaW5nQ29kZXMiLCBbXSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAibGF5ZXJzIiwgW10pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImN1cnJlbnRGaWxlSW5mbyIsIG5ldyBQYXJzZWRGaWxlSW5mbygpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJwcmludFN0YXRzIiwge30pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInByb2JlVHlwZSIsIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm51bUV4dHJ1ZGVycyIsIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImxhc3RTZXFzIiwge30pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImxhc3RTdGF0dXMiLCBudWxsKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJsYXN0VXB0aW1lIiwgMCk7CgogICAgX3RoaXMucGFzc3dvcmQgPSBwYXNzd29yZDsKICAgIF90aGlzLmJvYXJkVHlwZSA9IHJlc3BvbnNlRGF0YS5ib2FyZFR5cGU7CiAgICBfdGhpcy5yZXF1ZXN0QmFzZSA9ICIiLmNvbmNhdChsb2NhdGlvbi5wcm90b2NvbCwgIi8vIikuY29uY2F0KGhvc3RuYW1lLCAiLyIpOwogICAgX3RoaXMuc2Vzc2lvblRpbWVvdXQgPSByZXNwb25zZURhdGEuc2Vzc2lvblRpbWVvdXQ7CiAgICBfdGhpcy5hcGlMZXZlbCA9IHJlc3BvbnNlRGF0YS5hcGlMZXZlbCB8fCAwOwogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgX2NyZWF0ZUNsYXNzKFBvbGxDb25uZWN0b3IsIFt7CiAgICBrZXk6ICJyZWdpc3RlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVnaXN0ZXIobW9kdWxlKSB7CiAgICAgIF9nZXQoX2dldFByb3RvdHlwZU9mKFBvbGxDb25uZWN0b3IucHJvdG90eXBlKSwgInJlZ2lzdGVyIiwgdGhpcykuY2FsbCh0aGlzLCBtb2R1bGUpOwoKICAgICAgdGhpcy5yZXF1ZXN0VGltZW91dCA9IHRoaXMuc2Vzc2lvblRpbWVvdXQgLyAodGhpcy5zZXR0aW5ncy5hamF4UmV0cmllcyArIDEpOyAvLyBJZGVhbGx5IHdlIHNob3VsZCBiZSB1c2luZyBhIFNlcnZpY2VXb3JrZXIgaGVyZSB3aGljaCB3b3VsZCBhbGxvdyB1cyB0byBzZW5kIHB1c2gKICAgICAgLy8gbm90aWZpY2F0aW9ucyBldmVuIHdoaWxlIERXQzIgaXMgcnVubmluZyBpbiB0aGUgYmFja2dyb3VuZC4gSG93ZXZlciwgd2UgY2Fubm90IGRvCiAgICAgIC8vIHRoaXMgYmVjYXVzZSBTZXJ2aWNlV29ya2VycyByZXF1aXJlIHNlY3VyZWQgSFRUUCBjb25uZWN0aW9ucywgd2hpY2ggYXJlIG5vIG9wdGlvbgogICAgICAvLyBmb3Igc3RhbmRhcmQgZW5kLXVzZXJzLiBUaGF0IGlzIGFsc28gdGhlIHJlYXNvbiB3aHkgdGhleSBhcmUgZGlzYWJsZWQgaW4gdGhlIGJ1aWxkCiAgICAgIC8vIHNjcmlwdCwgd2hpY2ggYnkgZGVmYXVsdCBpcyB1c2VkIGZvciBpbXByb3ZlZCBjYWNoaW5nCgogICAgICB0aGlzLnNjaGVkdWxlVXBkYXRlKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVjb25uZWN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcmVjb25uZWN0ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICB2YXIgcmVzcG9uc2U7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIC8vIENhbmNlbCBwZW5kaW5nIHJlcXVlc3RzIGFuZCByZXNldCB0aGUgbGFzdCAnc2VxJyBmaWVsZAogICAgICAgICAgICAgICAgLy8gc28gdGhhdCB0aGUgbGFzdCBHLWNvZGUgcmVwbHkgaXMgcXVlcmllZCBhZ2FpbgogICAgICAgICAgICAgICAgdGhpcy5jYW5jZWxSZXF1ZXN0cygpOwogICAgICAgICAgICAgICAgdGhpcy5sYXN0U3RhdHVzUmVzcG9uc2UgPSB7fTsKICAgICAgICAgICAgICAgIHRoaXMubGFzdFNlcSA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLmxhc3RTZXFzID0ge307CiAgICAgICAgICAgICAgICB0aGlzLmxhc3RVcHRpbWUgPSAwOyAvLyBBdHRlbXB0IHRvIHJlY29ubmVjdAoKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIHJldHVybiBCYXNlQ29ubmVjdG9yLnJlcXVlc3QoJ0dFVCcsICIiLmNvbmNhdChsb2NhdGlvbi5wcm90b2NvbCwgIi8vIikuY29uY2F0KHRoaXMuaG9zdG5hbWUsICIvcnJfY29ubmVjdCIpLCB7CiAgICAgICAgICAgICAgICAgIHBhc3N3b3JkOiB0aGlzLnBhc3N3b3JkLAogICAgICAgICAgICAgICAgICB0aW1lOiB0aW1lVG9TdHIobmV3IERhdGUoKSkKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgX2NvbnRleHQyLnQwID0gcmVzcG9uc2UuZXJyOwogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSBfY29udGV4dDIudDAgPT09IDAgPyAxMSA6IF9jb250ZXh0Mi50MCA9PT0gMSA/IDE4IDogX2NvbnRleHQyLnQwID09PSAyID8gMTkgOiAyMDsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgdGhpcy5qdXN0Q29ubmVjdGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuYm9hcmRUeXBlID0gcmVzcG9uc2UuYm9hcmRUeXBlOwogICAgICAgICAgICAgICAgdGhpcy5zZXNzaW9uVGltZW91dCA9IHJlc3BvbnNlLnNlc3Npb25UaW1lb3V0OwogICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0VGltZW91dCA9IHJlc3BvbnNlLnNlc3Npb25UaW1lb3V0IC8gKHRoaXMuc2V0dGluZ3MuYWpheFJldHJpZXMgKyAxKTsKICAgICAgICAgICAgICAgIHRoaXMuYXBpTGV2ZWwgPSByZXNwb25zZS5hcGlMZXZlbCB8fCAwOwogICAgICAgICAgICAgICAgdGhpcy5zY2hlZHVsZVVwZGF0ZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoImJyZWFrIiwgMjEpOwoKICAgICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRQYXNzd29yZEVycm9yKCk7CgogICAgICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm9GcmVlU2Vzc2lvbkVycm9yKCk7CgogICAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTG9naW5FcnJvcigiVW5rbm93biBlcnIgdmFsdWU6ICIuY29uY2F0KHJlc3BvbnNlLmVycikpOwoKICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gcmVjb25uZWN0KCkgewogICAgICAgIHJldHVybiBfcmVjb25uZWN0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiByZWNvbm5lY3Q7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJkaXNjb25uZWN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZGlzY29ubmVjdCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoKSB7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QoJ0dFVCcsICdycl9kaXNjb25uZWN0Jyk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMywgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGRpc2Nvbm5lY3QoKSB7CiAgICAgICAgcmV0dXJuIF9kaXNjb25uZWN0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBkaXNjb25uZWN0OwogICAgfSgpCiAgfSwgewogICAga2V5OiAidW5yZWdpc3RlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdW5yZWdpc3RlcigpIHsKICAgICAgdGhpcy5jYW5jZWxSZXF1ZXN0cygpOwoKICAgICAgaWYgKHRoaXMudXBkYXRlTG9vcFRpbWVyKSB7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudXBkYXRlTG9vcFRpbWVyKTsKICAgICAgICB0aGlzLnVwZGF0ZUxvb3BUaW1lciA9IG51bGw7CiAgICAgIH0KCiAgICAgIF9nZXQoX2dldFByb3RvdHlwZU9mKFBvbGxDb25uZWN0b3IucHJvdG90eXBlKSwgInVucmVnaXN0ZXIiLCB0aGlzKS5jYWxsKHRoaXMpOwogICAgfQogIH0sIHsKICAgIGtleTogInVwZGF0ZUxvb3BTdGF0dXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF91cGRhdGVMb29wU3RhdHVzID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNCgpIHsKICAgICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgICAgdmFyIHJlcXVlc3RFeHRlbmRlZFN0YXR1cywKICAgICAgICAgICAgd2FzUHJpbnRpbmcsCiAgICAgICAgICAgIHdhc1NpbXVsYXRpbmcsCiAgICAgICAgICAgIHdhc1BhdXNlZCwKICAgICAgICAgICAgc3RhdHVzVHlwZSwKICAgICAgICAgICAgcmVzcG9uc2UsCiAgICAgICAgICAgIGlzUHJpbnRpbmcsCiAgICAgICAgICAgIG5ld0RhdGEsCiAgICAgICAgICAgIGZhblJQTXMsCiAgICAgICAgICAgIGF4aXNOYW1lcywKICAgICAgICAgICAgYm9hcmREZWZpbml0aW9uLAogICAgICAgICAgICBpLAogICAgICAgICAgICBhZGRMYXllcnMsCiAgICAgICAgICAgIGxheWVySnVzdENoYW5nZWQsCiAgICAgICAgICAgIGF2Z0R1cmF0aW9uLAogICAgICAgICAgICBsYXllciwKICAgICAgICAgICAgYmVlcEZyZXF1ZW5jeSwKICAgICAgICAgICAgYmVlcER1cmF0aW9uLAogICAgICAgICAgICBkaXNwbGF5TWVzc2FnZSwKICAgICAgICAgICAgbWVzc2FnZUJveCwKICAgICAgICAgICAgX2ksCiAgICAgICAgICAgIGhlYXRlciwKICAgICAgICAgICAgX2FyZ3M0ID0gYXJndW1lbnRzOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgcmVxdWVzdEV4dGVuZGVkU3RhdHVzID0gX2FyZ3M0Lmxlbmd0aCA+IDAgJiYgX2FyZ3M0WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczRbMF0gOiBmYWxzZTsKICAgICAgICAgICAgICAgIHJlcXVlc3RFeHRlbmRlZFN0YXR1cyB8PSB0aGlzLmp1c3RDb25uZWN0ZWQgfHwgdGhpcy51cGRhdGVMb29wQ291bnRlciAlIHRoaXMuc2V0dGluZ3MuZXh0ZW5kZWRVcGRhdGVFdmVyeSA9PT0gMCB8fCB0aGlzLnZlcmJvc2UgJiYgdGhpcy51cGRhdGVMb29wQ291bnRlciAlIDIgPT09IDA7IC8vIERlY2lkZSB3aGljaCB0eXBlIG9mIHN0YXR1cyB1cGRhdGUgdG8gcG9sbCBhbmQgcmVxdWVzdCBpdAoKICAgICAgICAgICAgICAgIHdhc1ByaW50aW5nID0gWydEJywgJ1MnLCAnUicsICdQJywgJ00nXS5pbmRleE9mKHRoaXMubGFzdFN0YXR1c1Jlc3BvbnNlLnN0YXR1cykgIT09IC0xOwogICAgICAgICAgICAgICAgd2FzU2ltdWxhdGluZyA9IHRoaXMubGFzdFN0YXR1c1Jlc3BvbnNlLnN0YXR1cyA9PT0gJ00nLCB3YXNQYXVzZWQgPSB0aGlzLmxhc3RTdGF0dXNSZXNwb25zZS5zdGF0dXMgPT09ICdQJzsKICAgICAgICAgICAgICAgIHN0YXR1c1R5cGUgPSByZXF1ZXN0RXh0ZW5kZWRTdGF0dXMgPyAyIDogd2FzUHJpbnRpbmcgPyAzIDogMTsKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QoJ0dFVCcsICdycl9zdGF0dXMnLCB7CiAgICAgICAgICAgICAgICAgIHR5cGU6IHN0YXR1c1R5cGUKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0NC5zZW50OwogICAgICAgICAgICAgICAgaXNQcmludGluZyA9IFsnRCcsICdTJywgJ1InLCAnUCcsICdNJ10uaW5kZXhPZihyZXNwb25zZS5zdGF0dXMpICE9PSAtMTsKICAgICAgICAgICAgICAgIG5ld0RhdGEgPSB7fTsgLy8gQ2hlY2sgaWYgYW4gZXh0ZW5kZWQgc3RhdHVzIHJlc3BvbnNlIG5lZWRzIHRvIGJlIHBvbGxlZCBpbiBjYXNlIG1hY2hpbmUgcGFyYW1ldGVycyBoYXZlIGNoYW5nZWQKCiAgICAgICAgICAgICAgICBpZiAoISghcmVxdWVzdEV4dGVuZGVkU3RhdHVzICYmIGFycmF5U2l6ZXNEaWZmZXIocmVzcG9uc2UsIHRoaXMubGFzdFN0YXR1c1Jlc3BvbnNlKSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxNDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnVwZGF0ZUxvb3BTdGF0dXModHJ1ZSk7CgogICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICBpZiAoIWlzUHJpbnRpbmcpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAyNTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCEodGhpcy5qdXN0Q29ubmVjdGVkIHx8ICF3YXNQcmludGluZykpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAyMzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxODsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEZpbGVJbmZvKCk7CgogICAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRGaWxlSW5mbyA9IF9jb250ZXh0NC5zZW50OwogICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuY3VycmVudEZpbGVJbmZvLnByaW50RHVyYXRpb247CiAgICAgICAgICAgICAgICBxdWlja1BhdGNoKG5ld0RhdGEsIHsKICAgICAgICAgICAgICAgICAgam9iOiB7CiAgICAgICAgICAgICAgICAgICAgZmlsZTogdGhpcy5jdXJyZW50RmlsZUluZm8sCiAgICAgICAgICAgICAgICAgICAgbGF5ZXJzOiBbXQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHRoaXMubGF5ZXJzID0gW107CiAgICAgICAgICAgICAgICB0aGlzLnByaW50U3RhdHMgPSB7CiAgICAgICAgICAgICAgICAgIGxheWVySGVpZ2h0OiB0aGlzLmN1cnJlbnRGaWxlSW5mby5sYXllckhlaWdodAogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgY2FzZSAyMzoKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMjY7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyNToKICAgICAgICAgICAgICAgIGlmICh3YXNQcmludGluZykgewogICAgICAgICAgICAgICAgICBxdWlja1BhdGNoKG5ld0RhdGEsIHsKICAgICAgICAgICAgICAgICAgICBqb2I6IHsKICAgICAgICAgICAgICAgICAgICAgIGxhc3RGaWxlTmFtZTogdGhpcy5jdXJyZW50RmlsZUluZm8uZmlsZU5hbWUsCiAgICAgICAgICAgICAgICAgICAgICBsYXN0RmlsZUNhbmNlbGxlZDogd2FzUGF1c2VkLAogICAgICAgICAgICAgICAgICAgICAgbGFzdEZpbGVTaW11bGF0ZWQ6IHdhc1NpbXVsYXRpbmcKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjYXNlIDI2OgogICAgICAgICAgICAgICAgLy8gU3RhbmRhcmQgU3RhdHVzIFJlc3BvbnNlCiAgICAgICAgICAgICAgICBmYW5SUE1zID0gcmVzcG9uc2Uuc2Vuc29ycy5mYW5SUE0gaW5zdGFuY2VvZiBBcnJheSA/IHJlc3BvbnNlLnNlbnNvcnMuZmFuUlBNIDogW3Jlc3BvbnNlLnNlbnNvcnMuZmFuUlBNXTsKICAgICAgICAgICAgICAgIHF1aWNrUGF0Y2gobmV3RGF0YSwgewogICAgICAgICAgICAgICAgICBmYW5zOiByZXNwb25zZS5wYXJhbXMuZmFuUGVyY2VudC5tYXAoZnVuY3Rpb24gKGZhblBlcmNlbnQsIGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgIHJwbTogaW5kZXggPCBmYW5SUE1zLmxlbmd0aCA/IGZhblJQTXNbaW5kZXhdIDogLTEsCiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZmFuUGVyY2VudCAvIDEwMAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICBoZWF0OiB7CiAgICAgICAgICAgICAgICAgICAgaGVhdGVyczogcmVzcG9uc2UudGVtcHMuc3RhdGUubWFwKGZ1bmN0aW9uIChzdGF0ZSwgc2Vuc29yKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZTogX3RoaXMyLmNvbnZlcnRIZWF0ZXJTdGF0ZShzdGF0ZSksCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbnNvcjogc2Vuc29yCiAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIG1vdmU6IHsKICAgICAgICAgICAgICAgICAgICBheGVzOiByZXNwb25zZS5jb29yZHMueHl6Lm1hcChmdW5jdGlvbiAocG9zaXRpb24sIGRyaXZlKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBkcml2ZXM6IFtkcml2ZV0sCiAgICAgICAgICAgICAgICAgICAgICAgIGhvbWVkOiBCb29sZWFuKHJlc3BvbnNlLmNvb3Jkcy5heGVzSG9tZWRbZHJpdmVdKSwKICAgICAgICAgICAgICAgICAgICAgICAgbWFjaGluZVBvc2l0aW9uOiBwb3NpdGlvbiA9PT0gOTk5OSA/IG51bGwgOiBwb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgdXNlclBvc2l0aW9uOiBwb3NpdGlvbiA9PT0gOTk5OSA/IG51bGwgOiBwb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICBjdXJyZW50TW92ZTogewogICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdGVkU3BlZWQ6IHJlc3BvbnNlLnNwZWVkcyAhPT0gdW5kZWZpbmVkID8gcmVzcG9uc2Uuc3BlZWRzLnJlcXVlc3RlZCA6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB0b3BTcGVlZDogcmVzcG9uc2Uuc3BlZWRzICE9PSB1bmRlZmluZWQgPyByZXNwb25zZS5zcGVlZHMudG9wIDogbnVsbAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgZXh0cnVkZXJzOiByZXNwb25zZS5jb29yZHMuZXh0ci5tYXAoZnVuY3Rpb24gKHBvc2l0aW9uLCBleHRydWRlcikgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgZHJpdmVzOiBbcmVzcG9uc2UuY29vcmRzLnh5ei5sZW5ndGggKyBleHRydWRlcl0sCiAgICAgICAgICAgICAgICAgICAgICAgIGZhY3RvcjogcmVzcG9uc2UucGFyYW1zLmV4dHJGYWN0b3JzW2V4dHJ1ZGVyXSAvIDEwMCwKICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgIHNwZWVkRmFjdG9yOiByZXNwb25zZS5wYXJhbXMuc3BlZWRGYWN0b3IgLyAxMDAsCiAgICAgICAgICAgICAgICAgICAgd29ya3NwYWNlTnVtYmVyOiByZXNwb25zZS53cGwgIT09IHVuZGVmaW5lZCA/IHJlc3BvbnNlLndwbCA6IDEKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgc2Nhbm5lcjogcmVzcG9uc2Uuc2Nhbm5lciA/IHsKICAgICAgICAgICAgICAgICAgICBwcm9ncmVzczogcmVzcG9uc2Uuc2Nhbm5lci5wcm9ncmVzcywKICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLnNjYW5uZXIuc3RhdHVzCiAgICAgICAgICAgICAgICAgIH0gOiB7fSwKICAgICAgICAgICAgICAgICAgc2Vuc29yczogewogICAgICAgICAgICAgICAgICAgIGFuYWxvZzogcmVzcG9uc2UudGVtcHMuY3VycmVudC5tYXAoZnVuY3Rpb24gKGxhc3RSZWFkaW5nLCBudW1iZXIpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RSZWFkaW5nOiBsYXN0UmVhZGluZywKICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyOiBudW1iZXIKICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgfSkuY29uY2F0KHJlc3BvbnNlLnRlbXBzLmV4dHJhLm1hcChmdW5jdGlvbiAoZXh0cmEpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RSZWFkaW5nOiBleHRyYS50ZW1wID09PSA5OTk5ID8gbnVsbCA6IGV4dHJhLnRlbXAsCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGV4dHJhLm5hbWUKICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgfSkpLAogICAgICAgICAgICAgICAgICAgIHByb2JlczogdGhpcy5wcm9iZVR5cGUgIT09IDAgPyBbewogICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFtyZXNwb25zZS5zZW5zb3JzLnByb2JlVmFsdWVdLmNvbmNhdChyZXNwb25zZS5zZW5zb3JzLnByb2JlU2Vjb25kYXJ5ID8gcmVzcG9uc2Uuc2Vuc29ycy5wcm9iZVNlY29uZGFyeSA6IFtdKQogICAgICAgICAgICAgICAgICAgIH1dIDogW10KICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgc3RhdGU6IHsKICAgICAgICAgICAgICAgICAgICBhdHhQb3dlcjogcmVzcG9uc2UucGFyYW1zLmF0eFBvd2VyID09PSAtMSA/IG51bGwgOiBCb29sZWFuKHJlc3BvbnNlLnBhcmFtcy5hdHhQb3dlciksCiAgICAgICAgICAgICAgICAgICAgY3VycmVudFRvb2w6IHJlc3BvbnNlLmN1cnJlbnRUb29sLAogICAgICAgICAgICAgICAgICAgIHN0YXR1czogdGhpcy5jb252ZXJ0U3RhdHVzTGV0dGVyKHJlc3BvbnNlLnN0YXR1cykKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgdG9vbHM6IHJlc3BvbnNlLnRlbXBzLnRvb2xzLmFjdGl2ZS5tYXAoZnVuY3Rpb24gKGFjdGl2ZSwgaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiBhY3RpdmUsCiAgICAgICAgICAgICAgICAgICAgICBzdGFuZGJ5OiByZXNwb25zZS50ZW1wcy50b29scy5zdGFuZGJ5W2luZGV4XQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAobmV3RGF0YS5tb3ZlLmF4ZXMubGVuZ3RoID49IDMpIHsKICAgICAgICAgICAgICAgICAgbmV3RGF0YS5tb3ZlLmF4ZXNbMl0uYmFieXN0ZXAgPSByZXNwb25zZS5wYXJhbXMuYmFieXN0ZXAgIT09IHVuZGVmaW5lZCA/IHJlc3BvbnNlLnBhcmFtcy5iYWJ5c3RlcCA6IDA7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmNvb3Jkcy5tYWNoaW5lKSB7CiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmNvb3Jkcy5tYWNoaW5lLmZvckVhY2goZnVuY3Rpb24gKG1hY2hpbmVQb3NpdGlvbiwgYXhpcykgewogICAgICAgICAgICAgICAgICAgIG5ld0RhdGEubW92ZS5heGVzW2F4aXNdLm1hY2hpbmVQb3NpdGlvbiA9IG1hY2hpbmVQb3NpdGlvbiA9PT0gOTk5OSA/IG51bGwgOiBtYWNoaW5lUG9zaXRpb247CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS50ZW1wcy5iZWQgJiYgcmVzcG9uc2UudGVtcHMuYmVkLmhlYXRlciA+PSAwICYmIHJlc3BvbnNlLnRlbXBzLmJlZC5oZWF0ZXIgPCBuZXdEYXRhLnNlbnNvcnMuYW5hbG9nLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICBuZXdEYXRhLmhlYXQuaGVhdGVyc1tyZXNwb25zZS50ZW1wcy5iZWQuaGVhdGVyXS5hY3RpdmUgPSByZXNwb25zZS50ZW1wcy5iZWQuYWN0aXZlOwogICAgICAgICAgICAgICAgICBuZXdEYXRhLmhlYXQuaGVhdGVyc1tyZXNwb25zZS50ZW1wcy5iZWQuaGVhdGVyXS5zdGFuZGJ5ID0gcmVzcG9uc2UudGVtcHMuYmVkLnN0YW5kYnk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnRlbXBzLmNoYW1iZXIgJiYgcmVzcG9uc2UudGVtcHMuY2hhbWJlci5oZWF0ZXIgPj0gMCAmJiByZXNwb25zZS50ZW1wcy5jaGFtYmVyLmhlYXRlciA8IG5ld0RhdGEuc2Vuc29ycy5hbmFsb2cubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgIG5ld0RhdGEuaGVhdC5oZWF0ZXJzW3Jlc3BvbnNlLnRlbXBzLmNoYW1iZXIuaGVhdGVyXS5hY3RpdmUgPSByZXNwb25zZS50ZW1wcy5jaGFtYmVyLmFjdGl2ZTsKICAgICAgICAgICAgICAgICAgbmV3RGF0YS5oZWF0LmhlYXRlcnNbcmVzcG9uc2UudGVtcHMuY2hhbWJlci5oZWF0ZXJdLnN0YW5kYnkgPSByZXNwb25zZS50ZW1wcy5jaGFtYmVyLnN0YW5kYnk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnRlbXBzLmNhYmluZXQgJiYgcmVzcG9uc2UudGVtcHMuY2FiaW5ldC5oZWF0ZXIgPj0gMCAmJiByZXNwb25zZS50ZW1wcy5jYWJpbmV0LmhlYXRlciA8IG5ld0RhdGEuc2Vuc29ycy5hbmFsb2cubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgIG5ld0RhdGEuaGVhdC5oZWF0ZXJzW3Jlc3BvbnNlLnRlbXBzLmNhYmluZXQuaGVhdGVyXS5hY3RpdmUgPSByZXNwb25zZS50ZW1wcy5jYWJpbmV0LmFjdGl2ZTsKICAgICAgICAgICAgICAgICAgbmV3RGF0YS5oZWF0LmhlYXRlcnNbcmVzcG9uc2UudGVtcHMuY2FiaW5ldC5oZWF0ZXJdLnN0YW5kYnkgPSByZXNwb25zZS50ZW1wcy5jYWJpbmV0LnN0YW5kYnk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5udW1FeHRydWRlcnMgPSByZXNwb25zZS5jb29yZHMuZXh0ci5sZW5ndGg7CgogICAgICAgICAgICAgICAgaWYgKHN0YXR1c1R5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgLy8gRXh0ZW5kZWQgU3RhdHVzIFJlc3BvbnNlCiAgICAgICAgICAgICAgICAgIGF4aXNOYW1lcyA9IHJlc3BvbnNlLmF4aXNOYW1lcyAhPT0gdW5kZWZpbmVkID8gcmVzcG9uc2UuYXhpc05hbWVzLnNwbGl0KCcnKSA6IFsnWCcsICdZJywgJ1onLCAnVScsICdWJywgJ1cnLCAnQScsICdCJywgJ0MnXTsKICAgICAgICAgICAgICAgICAgYm9hcmREZWZpbml0aW9uID0gZ2V0Qm9hcmREZWZpbml0aW9uKHRoaXMuYm9hcmRUeXBlKTsKICAgICAgICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wcm9iZVR5cGUgPSByZXNwb25zZS5wcm9iZSA/IHJlc3BvbnNlLnByb2JlLnR5cGUgOiAwOwogICAgICAgICAgICAgICAgICBxdWlja1BhdGNoKG5ld0RhdGEsIHsKICAgICAgICAgICAgICAgICAgICBib2FyZHM6IFt7CiAgICAgICAgICAgICAgICAgICAgICBmaXJtd2FyZUZpbGVOYW1lOiBib2FyZERlZmluaXRpb24uZmlybXdhcmVGaWxlTmFtZSwKICAgICAgICAgICAgICAgICAgICAgIGZpcm13YXJlTmFtZTogcmVzcG9uc2UuZmlybXdhcmVOYW1lLAogICAgICAgICAgICAgICAgICAgICAgaWFwRmlsZU5hbWVTRDogYm9hcmREZWZpbml0aW9uLmlhcEZpbGVOYW1lU0QsCiAgICAgICAgICAgICAgICAgICAgICBtYXhIZWF0ZXJzOiBib2FyZERlZmluaXRpb24ubWF4SGVhdGVycywKICAgICAgICAgICAgICAgICAgICAgIG1heE1vdG9yczogYm9hcmREZWZpbml0aW9uLm1heE1vdG9ycywKICAgICAgICAgICAgICAgICAgICAgIG1jdVRlbXA6IHJlc3BvbnNlLm1jdXRlbXAgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1pbjogcmVzcG9uc2UubWN1dGVtcC5taW4sCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQ6IHJlc3BvbnNlLm1jdXRlbXAuY3VyLAogICAgICAgICAgICAgICAgICAgICAgICBtYXg6IHJlc3BvbnNlLm1jdXRlbXAubWF4CiAgICAgICAgICAgICAgICAgICAgICB9IDoge30sCiAgICAgICAgICAgICAgICAgICAgICBzaG9ydE5hbWU6IHRoaXMuYm9hcmRUeXBlLAogICAgICAgICAgICAgICAgICAgICAgc3VwcG9ydHMxMjg2NDogYm9hcmREZWZpbml0aW9uLnN1cHBvcnRzMTI4NjQsCiAgICAgICAgICAgICAgICAgICAgICB2MTI6IHJlc3BvbnNlLnYxMiA/IHsKICAgICAgICAgICAgICAgICAgICAgICAgbWluOiByZXNwb25zZS52MTIubWluLAogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50OiByZXNwb25zZS52MTIuY3VyLAogICAgICAgICAgICAgICAgICAgICAgICBtYXg6IHJlc3BvbnNlLnYxMi5tYXgKICAgICAgICAgICAgICAgICAgICAgIH0gOiB7fSwKICAgICAgICAgICAgICAgICAgICAgIHZJbjogcmVzcG9uc2UudmluID8gewogICAgICAgICAgICAgICAgICAgICAgICBtaW46IHJlc3BvbnNlLnZpbi5taW4sCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQ6IHJlc3BvbnNlLnZpbi5jdXIsCiAgICAgICAgICAgICAgICAgICAgICAgIG1heDogcmVzcG9uc2UudmluLm1heAogICAgICAgICAgICAgICAgICAgICAgfSA6IHt9CiAgICAgICAgICAgICAgICAgICAgfV0sCiAgICAgICAgICAgICAgICAgICAgZmFuczogbmV3RGF0YS5mYW5zLm1hcChmdW5jdGlvbiAoZmFuRGF0YSwgaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICFyZXNwb25zZS5wYXJhbXMuZmFuTmFtZXMgPyBudWxsIDogcmVzcG9uc2UucGFyYW1zLmZhbk5hbWVzW2luZGV4XSwKICAgICAgICAgICAgICAgICAgICAgICAgdGhlcm1vc3RhdGljOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhdGVyczogKHJlc3BvbnNlLmNvbnRyb2xsYWJsZUZhbnMgJiAxIDw8IGluZGV4KSAhPT0gMCA/IFtdIDogWy0xXQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgIGhlYXQ6IHsKICAgICAgICAgICAgICAgICAgICAgIGJlZEhlYXRlcnM6IHJlc3BvbnNlLnRlbXBzLmJlZCA/IFtyZXNwb25zZS50ZW1wcy5iZWQuaGVhdGVyXSA6IFtdLAogICAgICAgICAgICAgICAgICAgICAgY2hhbWJlckhlYXRlcnM6IChyZXNwb25zZS50ZW1wcy5jaGFtYmVyID8gW3Jlc3BvbnNlLnRlbXBzLmNoYW1iZXIuaGVhdGVyXSA6IFtdKS5jb25jYXQocmVzcG9uc2UudGVtcHMuY2FiaW5ldCA/IFtyZXNwb25zZS50ZW1wcy5jYWJpbmV0LmhlYXRlcl0gOiBbXSksCiAgICAgICAgICAgICAgICAgICAgICBjb2xkRXh0cnVkZVRlbXBlcmF0dXJlOiByZXNwb25zZS5jb2xkRXh0cnVkZVRlbXAsCiAgICAgICAgICAgICAgICAgICAgICBjb2xkUmV0cmFjdFRlbXBlcmF0dXJlOiByZXNwb25zZS5jb2xkUmV0cmFjdFRlbXAKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG1vdmU6IHsKICAgICAgICAgICAgICAgICAgICAgIGF4ZXM6IHJlc3BvbnNlLmNvb3Jkcy54eXoubWFwKGZ1bmN0aW9uIChwb3NpdGlvbiwgaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBsZXR0ZXI6IGF4aXNOYW1lc1tpbmRleF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogcmVzcG9uc2UuYXhlcyAhPT0gdW5kZWZpbmVkID8gaW5kZXggPCByZXNwb25zZS5heGVzIDogdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICBjb21wZW5zYXRpb246IHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogcmVzcG9uc2UuY29tcGVuc2F0aW9uCiAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAga2luZW1hdGljczogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiByZXNwb25zZS5nZW9tZXRyeQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgbmV0d29yazogewogICAgICAgICAgICAgICAgICAgICAgbmFtZTogcmVzcG9uc2UubmFtZQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2Vuc29yczogewogICAgICAgICAgICAgICAgICAgICAgZW5kc3RvcHM6IF90b0NvbnN1bWFibGVBcnJheShBcnJheShyZXNwb25zZS5jb29yZHMueHl6Lmxlbmd0aCArIHJlc3BvbnNlLmNvb3Jkcy5leHRyLmxlbmd0aCkpLm1hcChmdW5jdGlvbiAoZHVtbXksIGRyaXZlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcmVkOiBCb29sZWFuKHJlc3BvbnNlLmVuZHN0b3BzICYgMSA8PCBkcml2ZSkKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgcHJvYmVzOiByZXNwb25zZS5wcm9iZSAmJiByZXNwb25zZS5wcm9iZS50eXBlICE9PSAwID8gW3sKICAgICAgICAgICAgICAgICAgICAgICAgdGhyZXNob2xkOiByZXNwb25zZS5wcm9iZS50aHJlc2hvbGQsCiAgICAgICAgICAgICAgICAgICAgICAgIHRyaWdnZXJIZWlnaHQ6IHJlc3BvbnNlLnByb2JlLmhlaWdodCwKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogcmVzcG9uc2UucHJvYmUudHlwZQogICAgICAgICAgICAgICAgICAgICAgfV0gOiBbXQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc3RhdGU6IHsKICAgICAgICAgICAgICAgICAgICAgIG1hY2hpbmVNb2RlOiByZXNwb25zZS5tb2RlID8gcmVzcG9uc2UubW9kZSA6IG51bGwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHRvb2xzOiByZXNwb25zZS50b29scyAhPT0gdW5kZWZpbmVkID8gcmVzcG9uc2UudG9vbHMubWFwKGZ1bmN0aW9uICh0b29sKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6IHRvb2wubnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB0b29sLm5hbWUgPyB0b29sLm5hbWUgOiAnJywKICAgICAgICAgICAgICAgICAgICAgICAgaGVhdGVyczogdG9vbC5oZWF0ZXJzLAogICAgICAgICAgICAgICAgICAgICAgICBleHRydWRlcnM6IHRvb2wuZHJpdmVzLAogICAgICAgICAgICAgICAgICAgICAgICBheGVzOiB0b29sLmF4aXNNYXAsCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbnM6IGJpdG1hcFRvQXJyYXkodG9vbC5mYW5zKSwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsYW1lbnRFeHRydWRlcjogdG9vbC5kcml2ZXMubGVuZ3RoID4gMCA/IHRvb2wuZHJpdmVzWzBdIDogLTEsCiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldHM6IHRvb2wub2Zmc2V0cwogICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB9KSA6IFtdCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBuZXdEYXRhLmhlYXQuaGVhdGVycy5mb3JFYWNoKGZ1bmN0aW9uIChoZWF0ZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGVhdGVyLm1heCA9IHJlc3BvbnNlLnRlbXBMaW1pdDsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLnRvb2xzLmZvckVhY2goZnVuY3Rpb24gKHRvb2wpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodG9vbC5kcml2ZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIGRyaXZlID0gdG9vbC5kcml2ZXNbMF07CgogICAgICAgICAgICAgICAgICAgICAgaWYgKGRyaXZlID49IDAgJiYgZHJpdmUgPCBuZXdEYXRhLm1vdmUuZXh0cnVkZXJzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICBuZXdEYXRhLm1vdmUuZXh0cnVkZXJzWzBdLmZpbGFtZW50ID0gdG9vbC5maWxhbWVudDsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnRlbXBzLm5hbWVzICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICByZXNwb25zZS50ZW1wcy5uYW1lcy5mb3JFYWNoKGZ1bmN0aW9uIChuYW1lLCBpbmRleCkgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ld0RhdGEuc2Vuc29ycy5hbmFsb2dbaW5kZXhdLm5hbWUgPSBuYW1lOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBuZXdEYXRhLnZvbHVtZXMgPSBbXTsKCiAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCByZXNwb25zZS52b2x1bWVzOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBuZXdEYXRhLnZvbHVtZXMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICBtb3VudGVkOiAocmVzcG9uc2UubW91bnRlZFZvbHVtZXMgJiAxIDw8IGkpICE9PSAwCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLnRvb2xzLmZvckVhY2goZnVuY3Rpb24gKHRvb2wpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodG9vbC5kcml2ZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIGV4dHJ1ZGVyID0gdG9vbC5kcml2ZXNbMF07CgogICAgICAgICAgICAgICAgICAgICAgaWYgKGV4dHJ1ZGVyID49IDAgJiYgZXh0cnVkZXIgPCBuZXdEYXRhLm1vdmUuZXh0cnVkZXJzLmxlbmd0aCAmJiBuZXdEYXRhLm1vdmUuZXh0cnVkZXJzW2V4dHJ1ZGVyXSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBuZXdEYXRhLm1vdmUuZXh0cnVkZXJzW2V4dHJ1ZGVyXS5maWxhbWVudCA9IHRvb2wuZmlsYW1lbnQ7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzVHlwZSA9PT0gMykgewogICAgICAgICAgICAgICAgICBpZiAoIW5ld0RhdGEuam9iKSB7CiAgICAgICAgICAgICAgICAgICAgbmV3RGF0YS5qb2IgPSB7fTsKICAgICAgICAgICAgICAgICAgfSAvLyBQcmludCBTdGF0dXMgUmVzcG9uc2UKCgogICAgICAgICAgICAgICAgICBxdWlja1BhdGNoKG5ld0RhdGEuam9iLCB7CiAgICAgICAgICAgICAgICAgICAgZmlsZToge30sCiAgICAgICAgICAgICAgICAgICAgZmlsZVBvc2l0aW9uOiByZXNwb25zZS5maWxlUG9zaXRpb24KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmV4dHJSYXcuZm9yRWFjaChmdW5jdGlvbiAocmF3UG9zaXRpb24sIGV4dHJ1ZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ld0RhdGEubW92ZS5leHRydWRlcnNbZXh0cnVkZXJdLnJhd1Bvc2l0aW9uID0gcmF3UG9zaXRpb247CiAgICAgICAgICAgICAgICAgIH0pOyAvLyBVcGRhdGUgc29tZSBzdGF0cyBvbmx5IGlmIHRoZSBwcmludCBpcyBzdGlsbCBsaXZlCgogICAgICAgICAgICAgICAgICBpZiAoaXNQcmludGluZykgewogICAgICAgICAgICAgICAgICAgIHF1aWNrUGF0Y2gobmV3RGF0YS5qb2IsIHsKICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiByZXNwb25zZS5wcmludER1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgbGF5ZXI6IHJlc3BvbnNlLmN1cnJlbnRMYXllciwKICAgICAgICAgICAgICAgICAgICAgIGxheWVyVGltZTogcmVzcG9uc2UuY3VycmVudExheWVyVGltZSwKICAgICAgICAgICAgICAgICAgICAgIHdhcm1VcER1cmF0aW9uOiByZXNwb25zZS53YXJtVXBEdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgIHRpbWVzTGVmdDogewogICAgICAgICAgICAgICAgICAgICAgICBmaWxlOiByZXNwb25zZS50aW1lc0xlZnQuZmlsZSwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsYW1lbnQ6IHJlc3BvbnNlLnRpbWVzTGVmdC5maWxhbWVudCwKICAgICAgICAgICAgICAgICAgICAgICAgbGF5ZXI6IHJlc3BvbnNlLnRpbWVzTGVmdC5sYXllcgogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHF1aWNrUGF0Y2gobmV3RGF0YS5qb2IsIHsKICAgICAgICAgICAgICAgICAgICAgIGxheWVyVGltZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIHRpbWVzTGVmdDogewogICAgICAgICAgICAgICAgICAgICAgICBmaWxlOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBmaWxhbWVudDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgbGF5ZXI6IG51bGwKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSAvLyBTZWUgaWYgd2UgbmVlZCB0byByZWNvcmQgbW9yZSBsYXllciBzdGF0cwoKCiAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5jdXJyZW50TGF5ZXIgPiB0aGlzLmxheWVycy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBhZGRMYXllcnMgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmxheWVycy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgIC8vIElzIHRoZSBmaXJzdCBsYXllciBjb21wbGV0ZT8KICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5jdXJyZW50TGF5ZXIgPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubGF5ZXJzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiByZXNwb25zZS5maXJzdExheWVyRHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLmN1cnJlbnRGaWxlSW5mby5maXJzdExheWVySGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGFtZW50OiByZXNwb25zZS5jdXJyZW50TGF5ZXIgPT09IDIgPyByZXNwb25zZS5leHRyUmF3LmZpbHRlcihmdW5jdGlvbiAoYW1vdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYW1vdW50ID4gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICB9KSA6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZnJhY3Rpb25QcmludGVkOiByZXNwb25zZS5jdXJyZW50TGF5ZXIgPT09IDIgPyByZXNwb25zZS5mcmFjdGlvblByaW50ZWQgLyAxMDAgOiBudWxsCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBuZXdEYXRhLmpvYi5sYXllcnMgPSB0aGlzLmxheWVyczsgLy8gS2VlcCB0cmFjayBvZiB0aGUgcGFzdCBsYXllcgoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmN1cnJlbnRMYXllciA9PT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHJpbnRTdGF0cy5kdXJhdGlvbiA9IHJlc3BvbnNlLndhcm1VcER1cmF0aW9uICsgcmVzcG9uc2UuZmlyc3RMYXllckR1cmF0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHJpbnRTdGF0cy5leHRyUmF3ID0gcmVzcG9uc2UuZXh0clJhdzsKICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByaW50U3RhdHMuZnJhY3Rpb25QcmludGVkID0gcmVzcG9uc2UuZnJhY3Rpb25QcmludGVkOwogICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHJpbnRTdGF0cy5tZWFzdXJlZExheWVySGVpZ2h0ID0gcmVzcG9uc2UuY29vcmRzLnh5elsyXSAtIHRoaXMuY3VycmVudEZpbGVJbmZvLmZpcnN0TGF5ZXJIZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmludFN0YXRzLnpQb3NpdGlvbiA9IHJlc3BvbnNlLmNvb3Jkcy54eXpbMl07CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuY3VycmVudExheWVyID4gdGhpcy5sYXllcnMubGVuZ3RoICsgMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGFkZExheWVycyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmN1cnJlbnRMYXllciA+IHRoaXMubGF5ZXJzLmxlbmd0aCArIDEpIHsKICAgICAgICAgICAgICAgICAgICAgIC8vIEFub3RoZXIgbGF5ZXIgaXMgY29tcGxldGUsIGFkZCBpdAogICAgICAgICAgICAgICAgICAgICAgYWRkTGF5ZXJzID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChhZGRMYXllcnMpIHsKICAgICAgICAgICAgICAgICAgICAgIGxheWVySnVzdENoYW5nZWQgPSByZXNwb25zZS5zdGF0dXMgPT09ICdNJyB8fCByZXNwb25zZS5jdXJyZW50TGF5ZXIgLSB0aGlzLmxheWVycy5sZW5ndGggPT09IDI7CgogICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucHJpbnRTdGF0cy5kdXJhdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBHb3QgaW5mbyBhYm91dCB0aGUgcGFzdCBsYXllciwgYWRkIHdoYXQgd2Uga25vdwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxheWVycy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogcmVzcG9uc2UucHJpbnREdXJhdGlvbiAtIHRoaXMucHJpbnRTdGF0cy5kdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHRoaXMucHJpbnRTdGF0cy5tZWFzdXJlZExheWVySGVpZ2h0ID8gdGhpcy5wcmludFN0YXRzLm1lYXN1cmVkTGF5ZXJIZWlnaHQgOiB0aGlzLnByaW50U3RhdHMubGF5ZXJIZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsYW1lbnQ6IHJlc3BvbnNlLmV4dHJSYXcubWFwKGZ1bmN0aW9uIChhbW91bnQsIGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYW1vdW50IC0gX3RoaXMyLnByaW50U3RhdHMuZXh0clJhd1tpbmRleF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmlsdGVyKGZ1bmN0aW9uIChkdW1teSwgaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5leHRyUmF3W2luZGV4XSA+IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgZnJhY3Rpb25QcmludGVkOiAocmVzcG9uc2UuZnJhY3Rpb25QcmludGVkIC0gdGhpcy5wcmludFN0YXRzLmZyYWN0aW9uUHJpbnRlZCkgLyAxMDAKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBJbnRlcnBvbGF0ZSBkYXRhLi4uCiAgICAgICAgICAgICAgICAgICAgICAgIGF2Z0R1cmF0aW9uID0gKHJlc3BvbnNlLnByaW50RHVyYXRpb24gLSByZXNwb25zZS53YXJtVXBEdXJhdGlvbiAtIHJlc3BvbnNlLmZpcnN0TGF5ZXJEdXJhdGlvbiAtIHJlc3BvbnNlLmN1cnJlbnRMYXllclRpbWUpIC8gKHJlc3BvbnNlLmN1cnJlbnRMYXllciAtIDIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsYXllciA9IHRoaXMubGF5ZXJzLmxlbmd0aDsgbGF5ZXIgKyAxIDwgcmVzcG9uc2UuY3VycmVudExheWVyOyBsYXllcisrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXllcnMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogYXZnRHVyYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmludFN0YXRzLnpQb3NpdGlvbiA9IHJlc3BvbnNlLmNvb3Jkcy54eXpbMl07CiAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgbmV3RGF0YS5qb2IubGF5ZXJzID0gdGhpcy5sYXllcnM7IC8vIEtlZXAgdHJhY2sgb2YgdGhlIHBhc3QgbGF5ZXIgaWYgdGhlIGxheWVyIGNoYW5nZSBqdXN0IGhhcHBlbmVkCgogICAgICAgICAgICAgICAgICAgICAgaWYgKGxheWVySnVzdENoYW5nZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmludFN0YXRzLmR1cmF0aW9uID0gcmVzcG9uc2UucHJpbnREdXJhdGlvbjsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmludFN0YXRzLmV4dHJSYXcgPSByZXNwb25zZS5leHRyUmF3OwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByaW50U3RhdHMuZnJhY3Rpb25QcmludGVkID0gcmVzcG9uc2UuZnJhY3Rpb25QcmludGVkOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByaW50U3RhdHMubWVhc3VyZWRMYXllckhlaWdodCA9IHJlc3BvbnNlLmNvb3Jkcy54eXpbMl0gLSB0aGlzLnByaW50U3RhdHMuelBvc2l0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByaW50U3RhdHMuelBvc2l0aW9uID0gcmVzcG9uc2UuY29vcmRzLnh5elsyXTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gLy8gT3V0cHV0IFV0aWxpdGllcwoKCiAgICAgICAgICAgICAgICBiZWVwRnJlcXVlbmN5ID0gMCwgYmVlcER1cmF0aW9uID0gMCwgZGlzcGxheU1lc3NhZ2UgPSAnJywgbWVzc2FnZUJveCA9IG51bGw7CgogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm91dHB1dCkgewogICAgICAgICAgICAgICAgICAvLyBCZWVwCiAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5vdXRwdXQuYmVlcEZyZXF1ZW5jeSAhPT0gdW5kZWZpbmVkICYmIHJlc3BvbnNlLm91dHB1dC5iZWVwRHVyYXRpb24gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIGJlZXBGcmVxdWVuY3kgPSByZXNwb25zZS5vdXRwdXQuYmVlcEZyZXF1ZW5jeTsKICAgICAgICAgICAgICAgICAgICBiZWVwRHVyYXRpb24gPSByZXNwb25zZS5vdXRwdXQuYmVlcER1cmF0aW9uOwogICAgICAgICAgICAgICAgICB9IC8vIFBlcnNpc3RlbnQgTWVzc2FnZQoKCiAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5vdXRwdXQubWVzc2FnZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgZGlzcGxheU1lc3NhZ2UgPSByZXNwb25zZS5vdXRwdXQubWVzc2FnZTsKICAgICAgICAgICAgICAgICAgfSAvLyBNZXNzYWdlIEJveAoKCiAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5vdXRwdXQubXNnQm94KSB7CiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZUJveCA9IG5ldyBNZXNzYWdlQm94KHsKICAgICAgICAgICAgICAgICAgICAgIG1vZGU6IHJlc3BvbnNlLm91dHB1dC5tc2dCb3gubW9kZSwKICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5vdXRwdXQubXNnQm94LnRpdGxlLAogICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogcmVzcG9uc2Uub3V0cHV0Lm1zZ0JveC5tc2csCiAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0OiByZXNwb25zZS5vdXRwdXQubXNnQm94LnRpbWVvdXQsCiAgICAgICAgICAgICAgICAgICAgICBheGlzQ29udHJvbHM6IHJlc3BvbnNlLm91dHB1dC5tc2dCb3guY29udHJvbHMKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHF1aWNrUGF0Y2gobmV3RGF0YSwgewogICAgICAgICAgICAgICAgICBzdGF0ZTogewogICAgICAgICAgICAgICAgICAgIGJlZXA6IGJlZXBGcmVxdWVuY3kgPiAwICYmIGJlZXBEdXJhdGlvbiA+IDAgPyBuZXcgQmVlcFJlcXVlc3QoewogICAgICAgICAgICAgICAgICAgICAgZnJlcXVlbmN5OiBiZWVwRnJlcXVlbmN5LAogICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IGJlZXBEdXJhdGlvbgogICAgICAgICAgICAgICAgICAgIH0pIDogbnVsbCwKICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TWVzc2FnZTogZGlzcGxheU1lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZUJveDogbWVzc2FnZUJveAogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsgLy8gU3BpbmRsZXMKCiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3BpbmRsZXMpIHsKICAgICAgICAgICAgICAgICAgcXVpY2tQYXRjaChuZXdEYXRhLCB7CiAgICAgICAgICAgICAgICAgICAgc3BpbmRsZXM6IHJlc3BvbnNlLnNwaW5kbGVzLm1hcChmdW5jdGlvbiAoc3BpbmRsZSkgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiBzcGluZGxlLmFjdGl2ZSwKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudDogc3BpbmRsZS5jdXJyZW50LAogICAgICAgICAgICAgICAgICAgICAgICB0b29sOiBzcGluZGxlLnRvb2wKICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IC8vIFJlbW92ZSBpbnZhbGlkIGhlYXRlcnMKCgogICAgICAgICAgICAgICAgZm9yIChfaSA9IDA7IF9pIDwgbmV3RGF0YS5oZWF0LmhlYXRlcnMubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICAgICAgICAgIGhlYXRlciA9IG5ld0RhdGEuaGVhdC5oZWF0ZXJzW19pXTsKCiAgICAgICAgICAgICAgICAgIGlmIChoZWF0ZXIgJiYgaGVhdGVyLnN0YXRlID09PSBIZWF0ZXJTdGF0ZS5vZmYpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaGVhdGVyLnNlbnNvciA8IDAgfHwgaGVhdGVyLnNlbnNvciA+PSBuZXdEYXRhLnNlbnNvcnMuYW5hbG9nLmxlbmd0aCB8fCBuZXdEYXRhLnNlbnNvcnMuYW5hbG9nW2hlYXRlci5zZW5zb3JdLmxhc3RSZWFkaW5nID09PSAyMDAwKSB7CiAgICAgICAgICAgICAgICAgICAgICBuZXdEYXRhLmhlYXQuaGVhdGVyc1tfaV0gPSBudWxsOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSAvLyBVcGRhdGUgdGhlIGRhdGEgbW9kZWwKCgogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA0MjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRpc3BhdGNoKCd1cGRhdGUnLCBuZXdEYXRhKTsKCiAgICAgICAgICAgICAgY2FzZSA0MjoKICAgICAgICAgICAgICAgIGlmICghKHJlc3BvbnNlLnNlcSAhPT0gdGhpcy5sYXN0U2VxKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDQ2OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDQ1OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0R0NvZGVSZXBseShyZXNwb25zZS5zZXEpOwoKICAgICAgICAgICAgICBjYXNlIDQ1OgogICAgICAgICAgICAgICAgdGhpcy5sYXN0U2VxID0gcmVzcG9uc2Uuc2VxOwoKICAgICAgICAgICAgICBjYXNlIDQ2OgogICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGZpcm13YXJlIHJlYm9vdGVkCiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuanVzdENvbm5lY3RlZCAmJiByZXNwb25zZS50aW1lIDwgdGhpcy5sYXN0U3RhdHVzUmVzcG9uc2UudGltZSkgewogICAgICAgICAgICAgICAgICB0aGlzLnBlbmRpbmdDb2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChjb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvZGUucmVqZWN0KG5ldyBPcGVyYXRpb25DYW5jZWxsZWRFcnJvcigpKTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIHRoaXMucGVuZGluZ0NvZGVzID0gW107CiAgICAgICAgICAgICAgICB9IC8vIFNvbWV0aW1lcyB3ZSBuZWVkIHRvIHVwZGF0ZSB0aGUgY29uZmlnIGFzIHdlbGwKCgogICAgICAgICAgICAgICAgaWYgKCEocmVxdWVzdEV4dGVuZGVkU3RhdHVzIHx8IHRoaXMuanVzdENvbm5lY3RlZCB8fCB0aGlzLnZlcmJvc2UgJiYgdGhpcy51cGRhdGVMb29wQ291bnRlciAlIDIgPT09IDApKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNTA7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNTA7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRDb25maWdSZXNwb25zZSgpOwoKICAgICAgICAgICAgICBjYXNlIDUwOgogICAgICAgICAgICAgICAgLy8gU3RhdHVzIHVwZGF0ZSBjb21wbGV0ZQogICAgICAgICAgICAgICAgdGhpcy5sYXN0U3RhdHVzUmVzcG9uc2UgPSByZXNwb25zZTsKICAgICAgICAgICAgICAgIHRoaXMuanVzdENvbm5lY3RlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVMb29wQ291bnRlcisrOyAvLyBTY2hlZHVsZSB0aGUgbmV4dCBzdGF0dXMgdXBkYXRlCgogICAgICAgICAgICAgICAgdGhpcy5zY2hlZHVsZVVwZGF0ZSgpOwoKICAgICAgICAgICAgICBjYXNlIDU0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU0LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gdXBkYXRlTG9vcFN0YXR1cygpIHsKICAgICAgICByZXR1cm4gX3VwZGF0ZUxvb3BTdGF0dXMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHVwZGF0ZUxvb3BTdGF0dXM7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJjb252ZXJ0SGVhdGVyU3RhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbnZlcnRIZWF0ZXJTdGF0ZShzdGF0ZSkgewogICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKEhlYXRlclN0YXRlKTsKCiAgICAgIGlmIChzdGF0ZSA+PSAwICYmIHN0YXRlIDwga2V5cy5sZW5ndGgpIHsKICAgICAgICByZXR1cm4ga2V5c1tzdGF0ZV07CiAgICAgIH0KCiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0sIHsKICAgIGtleTogImNvbnZlcnRTdGF0dXNMZXR0ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbnZlcnRTdGF0dXNMZXR0ZXIobGV0dGVyKSB7CiAgICAgIHN3aXRjaCAobGV0dGVyKSB7CiAgICAgICAgY2FzZSAnRic6CiAgICAgICAgICByZXR1cm4gJ3VwZGF0aW5nJzsKCiAgICAgICAgY2FzZSAnTyc6CiAgICAgICAgICByZXR1cm4gJ29mZic7CgogICAgICAgIGNhc2UgJ0gnOgogICAgICAgICAgcmV0dXJuICdoYWx0ZWQnOwoKICAgICAgICBjYXNlICdEJzoKICAgICAgICAgIHJldHVybiAncGF1c2luZyc7CgogICAgICAgIGNhc2UgJ1MnOgogICAgICAgICAgcmV0dXJuICdwYXVzZWQnOwoKICAgICAgICBjYXNlICdSJzoKICAgICAgICAgIHJldHVybiAncmVzdW1pbmcnOwoKICAgICAgICBjYXNlICdQJzoKICAgICAgICAgIHJldHVybiAncHJvY2Vzc2luZyc7CgogICAgICAgIGNhc2UgJ00nOgogICAgICAgICAgcmV0dXJuICdzaW11bGF0aW5nJzsKCiAgICAgICAgY2FzZSAnQic6CiAgICAgICAgICByZXR1cm4gJ2J1c3knOwoKICAgICAgICBjYXNlICdUJzoKICAgICAgICAgIHJldHVybiAnY2hhbmdpbmdUb29sJzsKCiAgICAgICAgY2FzZSAnSSc6CiAgICAgICAgICByZXR1cm4gJ2lkbGUnOwogICAgICB9CgogICAgICByZXR1cm4gJ3Vua25vd24nOwogICAgfSAvLyBDYWxsIHRoaXMgb25seSBmcm9tIHVwZGF0ZUxvb3BTdGF0dXMoKQoKICB9LCB7CiAgICBrZXk6ICJnZXRDb25maWdSZXNwb25zZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2dldENvbmZpZ1Jlc3BvbnNlID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNSgpIHsKICAgICAgICB2YXIgcmVzcG9uc2UsIGNvbmZpZ0RhdGE7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QoJ0dFVCcsICdycl9jb25maWcnKTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBfY29udGV4dDUuc2VudDsKICAgICAgICAgICAgICAgIGNvbmZpZ0RhdGEgPSB7CiAgICAgICAgICAgICAgICAgIGJvYXJkczogW3sKICAgICAgICAgICAgICAgICAgICBuYW1lOiByZXNwb25zZS5maXJtd2FyZUVsZWN0cm9uaWNzLAogICAgICAgICAgICAgICAgICAgIGZpcm13YXJlRGF0ZTogcmVzcG9uc2UuZmlybXdhcmVEYXRlLAogICAgICAgICAgICAgICAgICAgIGZpcm13YXJlTmFtZTogcmVzcG9uc2UuZmlybXdhcmVOYW1lLAogICAgICAgICAgICAgICAgICAgIGZpcm13YXJlVmVyc2lvbjogcmVzcG9uc2UuZmlybXdhcmVWZXJzaW9uCiAgICAgICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgICAgICBkaXJlY3RvcmllczogcmVzcG9uc2Uuc3lzZGlyICE9PSB1bmRlZmluZWQgPyB7CiAgICAgICAgICAgICAgICAgICAgc3lzdGVtOiByZXNwb25zZS5zeXNkaXIKICAgICAgICAgICAgICAgICAgfSA6IHt9LAogICAgICAgICAgICAgICAgICBtb3ZlOiB7CiAgICAgICAgICAgICAgICAgICAgYXhlczogcmVzcG9uc2UuYXhpc01pbnMubWFwKGZ1bmN0aW9uIChtaW4sIGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBhY2NlbGVyYXRpb246IHJlc3BvbnNlLmFjY2VsZXJhdGlvbnNbaW5kZXhdLAogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50OiByZXNwb25zZS5jdXJyZW50c1tpbmRleF0sCiAgICAgICAgICAgICAgICAgICAgICAgIGplcms6IHJlc3BvbnNlLm1pbkZlZWRyYXRlc1tpbmRleF0sCiAgICAgICAgICAgICAgICAgICAgICAgIG1pbjogbWluLAogICAgICAgICAgICAgICAgICAgICAgICBtYXg6IHJlc3BvbnNlLmF4aXNNYXhlc1tpbmRleF0sCiAgICAgICAgICAgICAgICAgICAgICAgIHNwZWVkOiByZXNwb25zZS5tYXhGZWVkcmF0ZXNbaW5kZXhdCiAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgIGV4dHJ1ZGVyczogX3RvQ29uc3VtYWJsZUFycmF5KEFycmF5KHRoaXMubnVtRXh0cnVkZXJzKSkubWFwKGZ1bmN0aW9uIChkdW1teSwgaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFjY2VsZXJhdGlvbjogcmVzcG9uc2UuYWNjZWxlcmF0aW9uc1tyZXNwb25zZS5heGlzTWlucy5sZW5ndGggKyBpbmRleF0sCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQ6IHJlc3BvbnNlLmN1cnJlbnRzW3Jlc3BvbnNlLmF4aXNNaW5zLmxlbmd0aCArIGluZGV4XSwKICAgICAgICAgICAgICAgICAgICAgICAgamVyazogcmVzcG9uc2UubWluRmVlZHJhdGVzW3Jlc3BvbnNlLmF4aXNNaW5zLmxlbmd0aCArIGluZGV4XSwKICAgICAgICAgICAgICAgICAgICAgICAgc3BlZWQ6IHJlc3BvbnNlLm1heEZlZWRyYXRlc1tyZXNwb25zZS5heGlzTWlucy5sZW5ndGggKyBpbmRleF0KICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgaWRsZTogewogICAgICAgICAgICAgICAgICAgICAgZmFjdG9yOiByZXNwb25zZS5pZGxlQ3VycmVudEZhY3RvciwKICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ6IHJlc3BvbnNlLmlkbGVUaW1lb3V0CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBuZXR3b3JrOiB7CiAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlczogW3sKICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHJlc3BvbnNlLmR3c1ZlcnNpb24gIT09IHVuZGVmaW5lZCA/ICd3aWZpJyA6ICdsYW4nLAogICAgICAgICAgICAgICAgICAgICAgZmlybXdhcmVWZXJzaW9uOiByZXNwb25zZS5kd3NWZXJzaW9uCiAgICAgICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gNjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRpc3BhdGNoKCd1cGRhdGUnLCBjb25maWdEYXRhKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU1LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZ2V0Q29uZmlnUmVzcG9uc2UoKSB7CiAgICAgICAgcmV0dXJuIF9nZXRDb25maWdSZXNwb25zZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZ2V0Q29uZmlnUmVzcG9uc2U7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJ1cGRhdGVMb29wTW9kZWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF91cGRhdGVMb29wTW9kZWwgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU2KCkgewogICAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgICB2YXIgam9iS2V5LCBleHRydWRlcnMsIHN0YXR1cywgelBvc2l0aW9uLCBrZXlJbmRleCwgbnVtS2V5cywga2V5LCBrZXlSZXNwb25zZSwgcmVzcG9uc2UsIHNlcXMsIF9rZXksIF9rZXlSZXNwb25zZSwgbGF5ZXJzQ2hhbmdlZCwgZXh0clJhdywgZnJhY3Rpb25QcmludGVkLCBhZGRMYXllcnMsIGF2Z0R1cmF0aW9uLCBsYXllcjsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU2JChfY29udGV4dDYpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGpvYktleSA9IG51bGwsIGV4dHJ1ZGVycyA9IFtdLCBzdGF0dXMgPSBudWxsLCB6UG9zaXRpb24gPSBudWxsOwoKICAgICAgICAgICAgICAgIGlmICghdGhpcy5qdXN0Q29ubmVjdGVkKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMzM7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuanVzdENvbm5lY3RlZCA9IGZhbHNlOyAvLyBRdWVyeSB0aGUgc2VxcyBmaWVsZCBhbmQgdGhlIEctY29kZSByZXBseQoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QoJ0dFVCcsICdycl9tb2RlbCcsIHsKICAgICAgICAgICAgICAgICAga2V5OiAnc2VxcycKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICB0aGlzLmxhc3RTZXFzID0gX2NvbnRleHQ2LnNlbnQucmVzdWx0OwoKICAgICAgICAgICAgICAgIGlmICghKHRoaXMubGFzdFNlcXMgPT0gbnVsbCB8fCB0aGlzLmxhc3RTZXFzLnJlcGx5ID09PSB1bmRlZmluZWQpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignSW5jb21wYXRpYmxlIHJyX21vZGVsIHZlcnNpb24gZGV0ZWN0ZWQsIGZhbGxpbmcgYmFjayB0byBzdGF0dXMgcmVzcG9uc2VzJyk7CiAgICAgICAgICAgICAgICB3aW5kb3cuZm9yY2VMZWdhY3lDb25uZWN0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIEJhc2VDb25uZWN0b3Iuc2V0Q29ubmVjdGluZ1Byb2dyZXNzKC0xKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgIGlmICghKHRoaXMubGFzdFNlcXMucmVwbHkgPiAwKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDE0OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDE0OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0R0NvZGVSZXBseSh0aGlzLmxhc3RTZXFzLnJlcGx5KTsKCiAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5wcmV2ID0gMTQ7CiAgICAgICAgICAgICAgICBrZXlJbmRleCA9IDEsIG51bUtleXMgPSBPYmplY3Qua2V5cyhEZWZhdWx0TWFjaGluZU1vZGVsKS5sZW5ndGg7CiAgICAgICAgICAgICAgICBfY29udGV4dDYudDAgPSByZWdlbmVyYXRvclJ1bnRpbWUua2V5cyhEZWZhdWx0TWFjaGluZU1vZGVsKTsKCiAgICAgICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgICAgIGlmICgoX2NvbnRleHQ2LnQxID0gX2NvbnRleHQ2LnQwKCkpLmRvbmUpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAyODsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAga2V5ID0gX2NvbnRleHQ2LnQxLnZhbHVlOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAyMTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QoJ0dFVCcsICdycl9tb2RlbCcsIHsKICAgICAgICAgICAgICAgICAga2V5OiBrZXksCiAgICAgICAgICAgICAgICAgIGZsYWdzOiAnZDk5dm4nCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgICAgIGtleVJlc3BvbnNlID0gX2NvbnRleHQ2LnNlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDI0OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlzcGF0Y2goJ3VwZGF0ZScsIF9kZWZpbmVQcm9wZXJ0eSh7fSwga2V5LCBrZXlSZXNwb25zZS5yZXN1bHQpKTsKCiAgICAgICAgICAgICAgY2FzZSAyNDoKICAgICAgICAgICAgICAgIEJhc2VDb25uZWN0b3Iuc2V0Q29ubmVjdGluZ1Byb2dyZXNzKGtleUluZGV4KysgLyBudW1LZXlzICogMTAwKTsKCiAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAnam9iJykgewogICAgICAgICAgICAgICAgICBqb2JLZXkgPSBrZXlSZXNwb25zZS5yZXN1bHQ7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGtleSA9PT0gJ21vdmUnKSB7CiAgICAgICAgICAgICAgICAgIGV4dHJ1ZGVycyA9IGtleVJlc3BvbnNlLnJlc3VsdC5leHRydWRlcnM7CiAgICAgICAgICAgICAgICAgIHpQb3NpdGlvbiA9IGtleVJlc3BvbnNlLnJlc3VsdC5heGVzLmxlbmd0aCA+IDIgPyBrZXlSZXNwb25zZS5yZXN1bHQuYXhlc1syXS51c2VyUG9zaXRpb24gOiBudWxsOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICdzdGF0ZScpIHsKICAgICAgICAgICAgICAgICAgc3RhdHVzID0ga2V5UmVzcG9uc2UucmVzdWx0LnN0YXR1czsKICAgICAgICAgICAgICAgICAgdGhpcy5sYXN0VXB0aW1lID0ga2V5UmVzcG9uc2UucmVzdWx0LnVwVGltZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDE3OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjg6CiAgICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDI4OwogICAgICAgICAgICAgICAgQmFzZUNvbm5lY3Rvci5zZXRDb25uZWN0aW5nUHJvZ3Jlc3MoLTEpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5maW5pc2goMjgpOwoKICAgICAgICAgICAgICBjYXNlIDMxOgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA2NzsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDMzOgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAzNTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QoJ0dFVCcsICdycl9tb2RlbCcsIHsKICAgICAgICAgICAgICAgICAgZmxhZ3M6ICdkOTlmbicKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDM1OgogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBfY29udGV4dDYuc2VudDsKICAgICAgICAgICAgICAgIHNlcXMgPSByZXNwb25zZS5yZXN1bHQuc2VxczsKICAgICAgICAgICAgICAgIGV4dHJ1ZGVycyA9IHJlc3BvbnNlLnJlc3VsdC5tb3ZlLmV4dHJ1ZGVyczsKICAgICAgICAgICAgICAgIGRlbGV0ZSByZXNwb25zZS5yZXN1bHQuc2VxczsKICAgICAgICAgICAgICAgIHN0YXR1cyA9IHJlc3BvbnNlLnJlc3VsdC5zdGF0ZS5zdGF0dXM7CiAgICAgICAgICAgICAgICB6UG9zaXRpb24gPSByZXNwb25zZS5yZXN1bHQubW92ZS5heGVzLmxlbmd0aCA+IDIgPyByZXNwb25zZS5yZXN1bHQubW92ZS5heGVzWzJdLnVzZXJQb3NpdGlvbiA6IG51bGw7IC8vIEFwcGx5IG5ldyB2YWx1ZXMKCiAgICAgICAgICAgICAgICBpZiAoIWlzUHJpbnRpbmcoc3RhdHVzKSAmJiBpc1ByaW50aW5nKHRoaXMubGFzdFN0YXR1cykpIHsKICAgICAgICAgICAgICAgICAgcmVzcG9uc2UucmVzdWx0LmpvYi5sYXN0RmlsZUNhbmNlbGxlZCA9IGlzUGF1c2VkKHRoaXMubGFzdFN0YXR1cyk7CiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLnJlc3VsdC5qb2IubGFzdEZpbGVTaW11bGF0ZWQgPSB0aGlzLmxhc3RTdGF0dXMgPT09IFN0YXR1c1R5cGUuc2ltdWxhdGluZzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDQ0OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlzcGF0Y2goJ3VwZGF0ZScsIHJlc3BvbnNlLnJlc3VsdCk7CgogICAgICAgICAgICAgIGNhc2UgNDQ6CiAgICAgICAgICAgICAgICBfY29udGV4dDYudDIgPSByZWdlbmVyYXRvclJ1bnRpbWUua2V5cyhEZWZhdWx0TWFjaGluZU1vZGVsKTsKCiAgICAgICAgICAgICAgY2FzZSA0NToKICAgICAgICAgICAgICAgIGlmICgoX2NvbnRleHQ2LnQzID0gX2NvbnRleHQ2LnQyKCkpLmRvbmUpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA1NjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2tleSA9IF9jb250ZXh0Ni50My52YWx1ZTsKCiAgICAgICAgICAgICAgICBpZiAoISh0aGlzLmxhc3RTZXFzW19rZXldICE9PSBzZXFzW19rZXldKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDU0OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDUwOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdCgnR0VUJywgJ3JyX21vZGVsJywgewogICAgICAgICAgICAgICAgICBrZXk6IF9rZXksCiAgICAgICAgICAgICAgICAgIGZsYWdzOiAnZDk5dm4nCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSA1MDoKICAgICAgICAgICAgICAgIF9rZXlSZXNwb25zZSA9IF9jb250ZXh0Ni5zZW50OwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA1MzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRpc3BhdGNoKCd1cGRhdGUnLCBfZGVmaW5lUHJvcGVydHkoe30sIF9rZXksIF9rZXlSZXNwb25zZS5yZXN1bHQpKTsKCiAgICAgICAgICAgICAgY2FzZSA1MzoKICAgICAgICAgICAgICAgIGlmIChfa2V5ID09PSAnam9iJykgewogICAgICAgICAgICAgICAgICBqb2JLZXkgPSBfa2V5UmVzcG9uc2UucmVzdWx0OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjYXNlIDU0OgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA0NTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDU2OgogICAgICAgICAgICAgICAgaWYgKCEocmVzcG9uc2UucmVzdWx0LnN0YXRlLnVwVGltZSA8IHRoaXMubGFzdFVwdGltZSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA2MjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5qdXN0Q29ubmVjdGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMucGVuZGluZ0NvZGVzLmZvckVhY2goZnVuY3Rpb24gKGNvZGUpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvZGUucmVqZWN0KG5ldyBPcGVyYXRpb25DYW5jZWxsZWRFcnJvcigpKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nQ29kZXMgPSBbXTsgLy8gU2VuZCB0aGUgcnJfY29ubmVjdCByZXF1ZXN0IGFuZCBkYXRldGltZSBhZ2FpbiBhZnRlciBhIGZpcm13YXJlIHJlc2V0CgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA2MjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QoJ0dFVCcsICdycl9jb25uZWN0JywgewogICAgICAgICAgICAgICAgICBwYXNzd29yZDogdGhpcy5wYXNzd29yZCwKICAgICAgICAgICAgICAgICAgdGltZTogdGltZVRvU3RyKG5ldyBEYXRlKCkpCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSA2MjoKICAgICAgICAgICAgICAgIHRoaXMubGFzdFVwdGltZSA9IHJlc3BvbnNlLnJlc3VsdC5zdGF0ZS51cFRpbWU7IC8vIEZpbmFsbHkgY2hlY2sgaWYgdGhlcmUgaXMgYSBuZXcgRy1jb2RlIHJlcGx5IGF2YWlsYWJsZQoKICAgICAgICAgICAgICAgIGlmICghKHRoaXMubGFzdFNlcXMucmVwbHkgIT09IHNlcXMucmVwbHkpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNjY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNjY7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRHQ29kZVJlcGx5KHNlcXMucmVwbHkpOwoKICAgICAgICAgICAgICBjYXNlIDY2OgogICAgICAgICAgICAgICAgdGhpcy5sYXN0U2VxcyA9IHNlcXM7CgogICAgICAgICAgICAgIGNhc2UgNjc6CiAgICAgICAgICAgICAgICBpZiAoIShqb2JLZXkgJiYgaXNQcmludGluZyhzdGF0dXMpKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDc4OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBsYXllcnNDaGFuZ2VkID0gZmFsc2U7CgogICAgICAgICAgICAgICAgaWYgKCFpc1ByaW50aW5nKHRoaXMubGFzdFN0YXR1cykpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5sYXllcnMgPSBbXTsKICAgICAgICAgICAgICAgICAgbGF5ZXJzQ2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZXh0clJhdyA9IGV4dHJ1ZGVycy5tYXAoZnVuY3Rpb24gKGV4dHJ1ZGVyKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBleHRydWRlci5yYXdQb3NpdGlvbjsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZnJhY3Rpb25QcmludGVkID0gam9iS2V5LnNpemUgPiAwID8gam9iS2V5LmZpbGVQb3NpdGlvbiAvIGpvYktleS5maWxlLnNpemUgOiAwOwogICAgICAgICAgICAgICAgYWRkTGF5ZXJzID0gZmFsc2U7CgogICAgICAgICAgICAgICAgaWYgKHRoaXMubGF5ZXJzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAvLyBJcyB0aGUgZmlyc3QgbGF5ZXIgY29tcGxldGU/CiAgICAgICAgICAgICAgICAgIGlmIChqb2JLZXkubGF5ZXIgPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXllcnMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogam9iS2V5LmZpcnN0TGF5ZXJEdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogam9iS2V5LmZpbGUuZmlyc3RMYXllckhlaWdodCwKICAgICAgICAgICAgICAgICAgICAgIGZpbGFtZW50OiBqb2JLZXkubGF5ZXIgPT09IDIgPyBleHRyUmF3IDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIGZyYWN0aW9uUHJpbnRlZDogam9iS2V5LmxheWVyID09PSAyID8gZnJhY3Rpb25QcmludGVkIDogbnVsbAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGxheWVyc0NoYW5nZWQgPSB0cnVlOyAvLyBLZWVwIHRyYWNrIG9mIHRoZSBwYXN0IGxheWVyCgogICAgICAgICAgICAgICAgICAgIGlmIChqb2JLZXkubGF5ZXIgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHJpbnRTdGF0cy5kdXJhdGlvbiA9IGpvYktleS53YXJtVXBEdXJhdGlvbiArIGpvYktleS5maXJzdExheWVyRHVyYXRpb247CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByaW50U3RhdHMuZXh0clJhdyA9IGV4dHJSYXc7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByaW50U3RhdHMuZnJhY3Rpb25QcmludGVkID0gZnJhY3Rpb25QcmludGVkOwogICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmludFN0YXRzLm1lYXN1cmVkTGF5ZXJIZWlnaHQgPSB6UG9zaXRpb24gLSBqb2JLZXkuZmlsZS5maXJzdExheWVySGVpZ2h0OwogICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmludFN0YXRzLnpQb3NpdGlvbiA9IHpQb3NpdGlvbjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGpvYktleS5sYXllciA+IHRoaXMubGF5ZXJzLmxlbmd0aCArIDEpIHsKICAgICAgICAgICAgICAgICAgICAgIGFkZExheWVycyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGpvYktleS5sYXllciA+IHRoaXMubGF5ZXJzLmxlbmd0aCArIDEpIHsKICAgICAgICAgICAgICAgICAgLy8gQW5vdGhlciBsYXllciBpcyBjb21wbGV0ZSwgYWRkIGl0CiAgICAgICAgICAgICAgICAgIGFkZExheWVycyA9IHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGFkZExheWVycykgewogICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmludFN0YXRzLmR1cmF0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gR290IGluZm8gYWJvdXQgdGhlIHBhc3QgbGF5ZXIsIGFkZCB3aGF0IHdlIGtub3cKICAgICAgICAgICAgICAgICAgICB0aGlzLmxheWVycy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBqb2JLZXkuZHVyYXRpb24gLSB0aGlzLnByaW50U3RhdHMuZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHRoaXMucHJpbnRTdGF0cy5tZWFzdXJlZExheWVySGVpZ2h0ID8gdGhpcy5wcmludFN0YXRzLm1lYXN1cmVkTGF5ZXJIZWlnaHQgOiB0aGlzLnByaW50U3RhdHMubGF5ZXJIZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgICBmaWxhbWVudDogZXh0clJhdy5tYXAoZnVuY3Rpb24gKGFtb3VudCwgaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFtb3VudCAtIF90aGlzMy5wcmludFN0YXRzLmV4dHJSYXdbaW5kZXhdOwogICAgICAgICAgICAgICAgICAgICAgfSkuZmlsdGVyKGZ1bmN0aW9uIChkdW1teSwgaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV4dHJSYXdbaW5kZXhdID4gMDsKICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgZnJhY3Rpb25QcmludGVkOiBmcmFjdGlvblByaW50ZWQgLSB0aGlzLnByaW50U3RhdHMuZnJhY3Rpb25QcmludGVkCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgbGF5ZXJzQ2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gSW50ZXJwb2xhdGUgZGF0YS4uLgogICAgICAgICAgICAgICAgICAgIGF2Z0R1cmF0aW9uID0gKGpvYktleS5kdXJhdGlvbiAtIGpvYktleS53YXJtVXBEdXJhdGlvbiAtIGpvYktleS5maXJzdExheWVyRHVyYXRpb24gLSBqb2JLZXkubGF5ZXJUaW1lKSAvIChqb2JLZXkubGF5ZXIgLSAyKTsKCiAgICAgICAgICAgICAgICAgICAgZm9yIChsYXllciA9IHRoaXMubGF5ZXJzLmxlbmd0aDsgbGF5ZXIgKyAxIDwgam9iS2V5LmxheWVyOyBsYXllcisrKSB7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxheWVycy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IGF2Z0R1cmF0aW9uCiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgIGxheWVyc0NoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSAvLyBLZWVwIHRyYWNrIG9mIHRoZSBwYXN0IGxheWVyIGlmIG5ldyBsYXllcnMgaGF2ZSBiZWVuIGFkZGVkCgoKICAgICAgICAgICAgICAgICAgaWYgKGxheWVyc0NoYW5nZWQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnByaW50U3RhdHMuZHVyYXRpb24gPSBqb2JLZXkuZHVyYXRpb247CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmludFN0YXRzLmV4dHJSYXcgPSBleHRyUmF3OwogICAgICAgICAgICAgICAgICAgIHRoaXMucHJpbnRTdGF0cy5mcmFjdGlvblByaW50ZWQgPSBmcmFjdGlvblByaW50ZWQ7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmludFN0YXRzLm1lYXN1cmVkTGF5ZXJIZWlnaHQgPSB6UG9zaXRpb24gLSB0aGlzLnByaW50U3RhdHMuelBvc2l0aW9uOwogICAgICAgICAgICAgICAgICAgIHRoaXMucHJpbnRTdGF0cy56UG9zaXRpb24gPSB6UG9zaXRpb247CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoIWxheWVyc0NoYW5nZWQpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA3ODsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA3ODsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRpc3BhdGNoKCd1cGRhdGUnLCB7CiAgICAgICAgICAgICAgICAgIGpvYjogewogICAgICAgICAgICAgICAgICAgIGxheWVyczogdGhpcy5sYXllcnMKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgNzg6CiAgICAgICAgICAgICAgICAvLyBTY2hlZHVsZSB0aGUgbmV4dCBzdGF0dXMgdXBkYXRlCiAgICAgICAgICAgICAgICB0aGlzLmxhc3RTdGF0dXMgPSBzdGF0dXM7CiAgICAgICAgICAgICAgICB0aGlzLnNjaGVkdWxlVXBkYXRlKCk7CgogICAgICAgICAgICAgIGNhc2UgODA6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTYsIHRoaXMsIFtbMTQsLCAyOCwgMzFdXSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHVwZGF0ZUxvb3BNb2RlbCgpIHsKICAgICAgICByZXR1cm4gX3VwZGF0ZUxvb3BNb2RlbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gdXBkYXRlTG9vcE1vZGVsOwogICAgfSgpCiAgfSwgewogICAga2V5OiAiZG9VcGRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9kb1VwZGF0ZSA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTcoKSB7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU3JChfY29udGV4dDcpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ3LnByZXYgPSBfY29udGV4dDcubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlTG9vcFRpbWVyID0gbnVsbDsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5wcmV2ID0gMTsKCiAgICAgICAgICAgICAgICBpZiAoISghd2luZG93LmZvcmNlTGVnYWN5Q29ubmVjdCAmJiB0aGlzLmFwaUxldmVsID49IDEpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gNzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQ3Lm5leHQgPSA1OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudXBkYXRlTG9vcE1vZGVsKCk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gOTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy51cGRhdGVMb29wU3RhdHVzKCk7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5wcmV2ID0gMTE7CiAgICAgICAgICAgICAgICBfY29udGV4dDcudDAgPSBfY29udGV4dDdbImNhdGNoIl0oMSk7CiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oX2NvbnRleHQ3LnQwKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kaXNwYXRjaCgnb25Db25uZWN0aW9uRXJyb3InLCBfY29udGV4dDcudDApOwoKICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU3LCB0aGlzLCBbWzEsIDExXV0pOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBkb1VwZGF0ZSgpIHsKICAgICAgICByZXR1cm4gX2RvVXBkYXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBkb1VwZGF0ZTsKICAgIH0oKQogIH0sIHsKICAgIGtleTogInNjaGVkdWxlVXBkYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzY2hlZHVsZVVwZGF0ZSgpIHsKICAgICAgaWYgKCF0aGlzLnVwZGF0ZUxvb3BUaW1lcikgewogICAgICAgIHRoaXMudXBkYXRlTG9vcFRpbWVyID0gc2V0VGltZW91dCh0aGlzLmRvVXBkYXRlLmJpbmQodGhpcyksIHRoaXMuc2V0dGluZ3MudXBkYXRlSW50ZXJ2YWwpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAic2VuZENvZGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9zZW5kQ29kZSA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTgoY29kZSkgewogICAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgICB2YXIgcmVzcG9uc2UsIGluQnJhY2VzLCBpLCBfcmV0OwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTgkKF9jb250ZXh0OCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDgucHJldiA9IF9jb250ZXh0OC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdCgnR0VUJywgJ3JyX2djb2RlJywgewogICAgICAgICAgICAgICAgICBnY29kZTogY29kZQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQ4LnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlIGluc3RhbmNlb2YgT2JqZWN0KSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJSZWNlaXZlZCBiYWQgcmVzcG9uc2UgZm9yIHJyX2djb2RlOiAiLmNvbmNhdChKU09OLnN0cmluZ2lmeShyZXNwb25zZSkpKTsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBDb2RlUmVzcG9uc2VFcnJvcigpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICBpZiAoIShyZXNwb25zZS5idWZmID09PSAwKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDg7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBDb2RlQnVmZmVyRXJyb3IoKTsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgaW5CcmFjZXMgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGkgPSAwOwoKICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgaWYgKCEoaSA8IGNvZGUubGVuZ3RoKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDI4OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoIWluQnJhY2VzKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGluQnJhY2VzID0gY29kZVtpXSAhPT0gJyknOwogICAgICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSAyNTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgICAgaWYgKCEoY29kZVtpXSA9PT0gJygnKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDE5OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpbkJyYWNlcyA9IHRydWU7CiAgICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDI1OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICAgICAgICBpZiAoIShjb2RlW2ldID09PSAnOycpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gMjE7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iLCAnJyk7CgogICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgICBpZiAoIShjb2RlW2ldICE9PSAnICcgJiYgY29kZVtpXSAhPT0gJ1x0JyAmJiBjb2RlW2ldICE9PSAnXHInICYmIGNvZGUgIT09ICdcbicpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gMjU7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9yZXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHZhciBwZW5kaW5nQ29kZXMgPSBfdGhpczQucGVuZGluZ0NvZGVzLAogICAgICAgICAgICAgICAgICAgICAgc2VxID0gX3RoaXM0Lmxhc3RTZXE7CiAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgdjogbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBlbmRpbmdDb2Rlcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VxOiBzZXEsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHJlc29sdmUsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdDogcmVqZWN0CiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfSgpOwoKICAgICAgICAgICAgICAgIGlmICghKF90eXBlb2YoX3JldCkgPT09ICJvYmplY3QiKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDI1OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LmFicnVwdCgicmV0dXJuIiwgX3JldC52KTsKCiAgICAgICAgICAgICAgY2FzZSAyNToKICAgICAgICAgICAgICAgIGkrKzsKICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlOCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHNlbmRDb2RlKF94NCkgewogICAgICAgIHJldHVybiBfc2VuZENvZGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHNlbmRDb2RlOwogICAgfSgpCiAgfSwgewogICAga2V5OiAiZ2V0R0NvZGVSZXBseSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2dldEdDb2RlUmVwbHkgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU5KHNlcSkgewogICAgICAgIHZhciByZXNwb25zZSwgcmVwbHk7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU5JChfY29udGV4dDkpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ5LnByZXYgPSBfY29udGV4dDkubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QoJ0dFVCcsICdycl9yZXBseScsIHRoaXMucmVxdWVzdFRpbWVvdXQsICd0ZXh0Jyk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQ5LnNlbnQ7CiAgICAgICAgICAgICAgICByZXBseSA9IHJlc3BvbnNlLnRyaW0oKTsgLy8gVE9ETz8gQ2hlY2sgZm9yIHNwZWNpYWwgSlNPTiByZXNwb25zZXMgZ2VuZXJhdGVkIGJ5IE0xMTksIHNlZSBEV0MxCiAgICAgICAgICAgICAgICAvLyBQcm9iYWJseSBtYWtlcyBzZW5zZSBvbmx5IGFzIHNvb24gYXMgdGhlIHNldHRpbmdzIHVwZGF0ZSBub3RpZmljYXRpb25zIGFyZSB3b3JraW5nIGFnYWluCgogICAgICAgICAgICAgICAgaWYgKCF0aGlzLnBlbmRpbmdDb2Rlcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgLy8gSnVzdCBsb2cgdGhpcyByZXNwb25zZQogICAgICAgICAgICAgICAgICB0aGlzLmRpc3BhdGNoKCdvbkNvZGVDb21wbGV0ZWQnLCB7CiAgICAgICAgICAgICAgICAgICAgY29kZTogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgIHJlcGx5OiByZXBseQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIC8vIFJlc29sdmUgcGVuZGluZyBjb2RlIHByb21pc2VzCiAgICAgICAgICAgICAgICAgIHRoaXMucGVuZGluZ0NvZGVzLmZvckVhY2goZnVuY3Rpb24gKGNvZGUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoY29kZS5zZXEgPCBzZXEpIHsKICAgICAgICAgICAgICAgICAgICAgIGNvZGUucmVzb2x2ZShyZXBseSk7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BhdGNoKCdvbkNvZGVDb21wbGV0ZWQnLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGNvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGx5OiByZXBseQogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9LCB0aGlzKTsKICAgICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nQ29kZXMgPSB0aGlzLnBlbmRpbmdDb2Rlcy5maWx0ZXIoZnVuY3Rpb24gKGNvZGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29kZS5zZXEgPj0gc2VxOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU5LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZ2V0R0NvZGVSZXBseShfeDUpIHsKICAgICAgICByZXR1cm4gX2dldEdDb2RlUmVwbHkuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGdldEdDb2RlUmVwbHk7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJ1cGxvYWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF91cGxvYWQgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMChfcmVmKSB7CiAgICAgICAgdmFyIGZpbGVuYW1lLCBjb250ZW50LCBfcmVmJGNhbmNlbGxhdGlvblRva2UsIGNhbmNlbGxhdGlvblRva2VuLCBvblByb2dyZXNzLCBwYXlsb2FkLCBwYXJhbXMsIGNoZWNrc3VtLCByZXNwb25zZTsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMCQoX2NvbnRleHQxMCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDEwLnByZXYgPSBfY29udGV4dDEwLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBmaWxlbmFtZSA9IF9yZWYuZmlsZW5hbWUsIGNvbnRlbnQgPSBfcmVmLmNvbnRlbnQsIF9yZWYkY2FuY2VsbGF0aW9uVG9rZSA9IF9yZWYuY2FuY2VsbGF0aW9uVG9rZW4sIGNhbmNlbGxhdGlvblRva2VuID0gX3JlZiRjYW5jZWxsYXRpb25Ub2tlID09PSB2b2lkIDAgPyBudWxsIDogX3JlZiRjYW5jZWxsYXRpb25Ub2tlLCBvblByb2dyZXNzID0gX3JlZi5vblByb2dyZXNzOwogICAgICAgICAgICAgICAgLy8gQ3JlYXRlIHVwbG9hZCBvcHRpb25zCiAgICAgICAgICAgICAgICBwYXlsb2FkID0gY29udGVudCBpbnN0YW5jZW9mIEJsb2IgPyBjb250ZW50IDogbmV3IEJsb2IoW2NvbnRlbnRdKTsKICAgICAgICAgICAgICAgIHBhcmFtcyA9IHsKICAgICAgICAgICAgICAgICAgbmFtZTogZmlsZW5hbWUsCiAgICAgICAgICAgICAgICAgIHRpbWU6IHRpbWVUb1N0cihjb250ZW50Lmxhc3RNb2RpZmllZCA/IG5ldyBEYXRlKGNvbnRlbnQubGFzdE1vZGlmaWVkKSA6IG5ldyBEYXRlKCkpCiAgICAgICAgICAgICAgICB9OyAvLyBDaGVjayBpZiB0aGUgQ1JDMzIgY2hlY2tzdW0gaXMgcmVxdWlyZWQKCiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuc2V0dGluZ3MuY3JjVXBsb2FkcykgewogICAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSA4OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSA2OwogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgICAgICAgICAgIHZhciBmaWxlUmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKCiAgICAgICAgICAgICAgICAgIGZpbGVSZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gY3JjMzIoZS50YXJnZXQucmVzdWx0KTsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7CiAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICBmaWxlUmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKHBheWxvYWQpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIGNoZWNrc3VtID0gX2NvbnRleHQxMC5zZW50OwogICAgICAgICAgICAgICAgcGFyYW1zLmNyYzMyID0gY2hlY2tzdW0udG9TdHJpbmcoMTYpOwoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSAxMDsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QoJ1BPU1QnLCAncnJfdXBsb2FkJywgcGFyYW1zLCAnanNvbicsIHBheWxvYWQsIG9uUHJvZ3Jlc3MsIDAsIGNhbmNlbGxhdGlvblRva2VuLCBmaWxlbmFtZSk7CgogICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0MTAuc2VudDsKCiAgICAgICAgICAgICAgICBpZiAoIShyZXNwb25zZS5lcnIgIT09IDApKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDEzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgT3BlcmF0aW9uRmFpbGVkRXJyb3IoImVyciAiLmNvbmNhdChyZXNwb25zZS5lcnIpKTsKCiAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgIC8vIFVwbG9hZCBzdWNjZXNzZnVsCiAgICAgICAgICAgICAgICB0aGlzLmRpc3BhdGNoKCdvbkZpbGVVcGxvYWRlZCcsIHsKICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6IGZpbGVuYW1lLAogICAgICAgICAgICAgICAgICBjb250ZW50OiBjb250ZW50CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTEwLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gdXBsb2FkKF94NikgewogICAgICAgIHJldHVybiBfdXBsb2FkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiB1cGxvYWQ7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJkZWxldGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9kZWxldGUyID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTEoZmlsZW5hbWUpIHsKICAgICAgICB2YXIgcmVzcG9uc2U7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMSQoX2NvbnRleHQxMSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDExLnByZXYgPSBfY29udGV4dDExLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDExLm5leHQgPSAyOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdCgnR0VUJywgJ3JyX2RlbGV0ZScsIHsKICAgICAgICAgICAgICAgICAgbmFtZTogZmlsZW5hbWUKICAgICAgICAgICAgICAgIH0sICdqc29uJywgbnVsbCwgbnVsbCwgdGhpcy5yZXF1ZXN0VGltZW91dCwgbnVsbCwgZmlsZW5hbWUpOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0MTEuc2VudDsKCiAgICAgICAgICAgICAgICBpZiAoIShyZXNwb25zZS5lcnIgIT09IDApKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTEubmV4dCA9IDU7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBPcGVyYXRpb25GYWlsZWRFcnJvcigiZXJyICIuY29uY2F0KHJlc3BvbnNlLmVycikpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICBfY29udGV4dDExLm5leHQgPSA3OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlzcGF0Y2goJ29uRmlsZU9yRGlyZWN0b3J5RGVsZXRlZCcsIGZpbGVuYW1lKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTEsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBfZGVsZXRlKF94NykgewogICAgICAgIHJldHVybiBfZGVsZXRlMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gX2RlbGV0ZTsKICAgIH0oKQogIH0sIHsKICAgIGtleTogIm1vdmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9tb3ZlID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTIoX3JlZjIpIHsKICAgICAgICB2YXIgZnJvbSwgdG8sIF9yZWYyJGZvcmNlLCBmb3JjZSwgX3JlZjIkc2lsZW50LCBzaWxlbnQsIHJlc3BvbnNlOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEyJChfY29udGV4dDEyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTIucHJldiA9IF9jb250ZXh0MTIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGZyb20gPSBfcmVmMi5mcm9tLCB0byA9IF9yZWYyLnRvLCBfcmVmMiRmb3JjZSA9IF9yZWYyLmZvcmNlLCBmb3JjZSA9IF9yZWYyJGZvcmNlID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWYyJGZvcmNlLCBfcmVmMiRzaWxlbnQgPSBfcmVmMi5zaWxlbnQsIHNpbGVudCA9IF9yZWYyJHNpbGVudCA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcmVmMiRzaWxlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDEyLm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdCgnR0VUJywgJ3JyX21vdmUnLCB7CiAgICAgICAgICAgICAgICAgIG9sZDogZnJvbSwKICAgICAgICAgICAgICAgICAgbmV3OiB0bywKICAgICAgICAgICAgICAgICAgZGVsZXRlZXhpc3Rpbmc6IGZvcmNlID8gJ3llcycgOiAnbm8nCiAgICAgICAgICAgICAgICB9LCAnanNvbicsIG51bGwsIG51bGwsIHRoaXMucmVxdWVzdFRpbWVvdXQsIG51bGwsIGZyb20pOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0MTIuc2VudDsKCiAgICAgICAgICAgICAgICBpZiAoc2lsZW50KSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTIubmV4dCA9IDk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICghKHJlc3BvbnNlLmVyciAhPT0gMCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMi5uZXh0ID0gNzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE9wZXJhdGlvbkZhaWxlZEVycm9yKCJlcnIgIi5jb25jYXQocmVzcG9uc2UuZXJyKSk7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIF9jb250ZXh0MTIubmV4dCA9IDk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kaXNwYXRjaCgnb25GaWxlT3JEaXJlY3RvcnlNb3ZlZCcsIHsKICAgICAgICAgICAgICAgICAgZnJvbTogZnJvbSwKICAgICAgICAgICAgICAgICAgdG86IHRvLAogICAgICAgICAgICAgICAgICBmb3JjZTogZm9yY2UKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMiwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIG1vdmUoX3g4KSB7CiAgICAgICAgcmV0dXJuIF9tb3ZlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBtb3ZlOwogICAgfSgpCiAgfSwgewogICAga2V5OiAibWFrZURpcmVjdG9yeSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX21ha2VEaXJlY3RvcnkgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMyhkaXJlY3RvcnkpIHsKICAgICAgICB2YXIgcmVzcG9uc2U7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMyQoX2NvbnRleHQxMykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDEzLnByZXYgPSBfY29udGV4dDEzLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDEzLm5leHQgPSAyOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdCgnR0VUJywgJ3JyX21rZGlyJywgewogICAgICAgICAgICAgICAgICBkaXI6IGRpcmVjdG9yeQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQxMy5zZW50OwoKICAgICAgICAgICAgICAgIGlmICghKHJlc3BvbnNlLmVyciAhPT0gMCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMy5uZXh0ID0gNTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE9wZXJhdGlvbkZhaWxlZEVycm9yKCJlcnIgIi5jb25jYXQocmVzcG9uc2UuZXJyKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIF9jb250ZXh0MTMubmV4dCA9IDc7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kaXNwYXRjaCgnb25EaXJlY3RvcnlDcmVhdGVkJywgZGlyZWN0b3J5KTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMy5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTMsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBtYWtlRGlyZWN0b3J5KF94OSkgewogICAgICAgIHJldHVybiBfbWFrZURpcmVjdG9yeS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gbWFrZURpcmVjdG9yeTsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImRvd25sb2FkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZG93bmxvYWQgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNChwYXlsb2FkKSB7CiAgICAgICAgdmFyIGZpbGVuYW1lLCB0eXBlLCBvblByb2dyZXNzLCBjYW5jZWxsYXRpb25Ub2tlbiwgcmVzcG9uc2U7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNCQoX2NvbnRleHQxNCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDE0LnByZXYgPSBfY29udGV4dDE0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBmaWxlbmFtZSA9IHBheWxvYWQgaW5zdGFuY2VvZiBPYmplY3QgPyBwYXlsb2FkLmZpbGVuYW1lIDogcGF5bG9hZDsKICAgICAgICAgICAgICAgIHR5cGUgPSBwYXlsb2FkIGluc3RhbmNlb2YgT2JqZWN0ICYmIHBheWxvYWQudHlwZSAhPT0gdW5kZWZpbmVkID8gcGF5bG9hZC50eXBlIDogJ2pzb24nOwogICAgICAgICAgICAgICAgb25Qcm9ncmVzcyA9IHBheWxvYWQgaW5zdGFuY2VvZiBPYmplY3QgPyBwYXlsb2FkLm9uUHJvZ3Jlc3MgOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBjYW5jZWxsYXRpb25Ub2tlbiA9IHBheWxvYWQgaW5zdGFuY2VvZiBPYmplY3QgJiYgcGF5bG9hZC5jYW5jZWxsYXRpb25Ub2tlbiA/IHBheWxvYWQuY2FuY2VsbGF0aW9uVG9rZW4gOiBudWxsOwogICAgICAgICAgICAgICAgX2NvbnRleHQxNC5uZXh0ID0gNjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QoJ0dFVCcsICdycl9kb3dubG9hZCcsIHsKICAgICAgICAgICAgICAgICAgbmFtZTogZmlsZW5hbWUKICAgICAgICAgICAgICAgIH0sIHR5cGUsIG51bGwsIG9uUHJvZ3Jlc3MsIDAsIGNhbmNlbGxhdGlvblRva2VuLCBmaWxlbmFtZSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQxNC5zZW50OwogICAgICAgICAgICAgICAgdGhpcy5kaXNwYXRjaCgnb25GaWxlRG93bmxvYWRlZCcsIHsKICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6IGZpbGVuYW1lLAogICAgICAgICAgICAgICAgICBjb250ZW50OiByZXNwb25zZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNC5hYnJ1cHQoInJldHVybiIsIHJlc3BvbnNlKTsKCiAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTQsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBkb3dubG9hZChfeDEwKSB7CiAgICAgICAgcmV0dXJuIF9kb3dubG9hZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZG93bmxvYWQ7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJnZXRGaWxlTGlzdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2dldEZpbGVMaXN0ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTUoZGlyZWN0b3J5KSB7CiAgICAgICAgdmFyIGZpbGVMaXN0LCBuZXh0LCByZXNwb25zZTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTE1JChfY29udGV4dDE1KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTUucHJldiA9IF9jb250ZXh0MTUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGZpbGVMaXN0ID0gW10sIG5leHQgPSAwOwoKICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICBfY29udGV4dDE1Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdCgnR0VUJywgJ3JyX2ZpbGVsaXN0JywgewogICAgICAgICAgICAgICAgICBkaXI6IGRpcmVjdG9yeSwKICAgICAgICAgICAgICAgICAgZmlyc3Q6IG5leHQKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0MTUuc2VudDsKCiAgICAgICAgICAgICAgICBpZiAoIShyZXNwb25zZS5lcnIgPT09IDEpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTUubmV4dCA9IDg7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBEcml2ZVVubW91bnRlZEVycm9yKCk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgIGlmICghKHJlc3BvbnNlLmVyciA9PT0gMikpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQxNS5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBEaXJlY3RvcnlOb3RGb3VuZEVycm9yKGRpcmVjdG9yeSk7CgogICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICBmaWxlTGlzdCA9IGZpbGVMaXN0LmNvbmNhdChyZXNwb25zZS5maWxlcyk7CiAgICAgICAgICAgICAgICBuZXh0ID0gcmVzcG9uc2UubmV4dDsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIGlmIChuZXh0ICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTUubmV4dCA9IDE7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTUuYWJydXB0KCJyZXR1cm4iLCBmaWxlTGlzdC5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBpc0RpcmVjdG9yeTogaXRlbS50eXBlID09PSAnZCcsCiAgICAgICAgICAgICAgICAgICAgbmFtZTogaXRlbS5uYW1lLAogICAgICAgICAgICAgICAgICAgIHNpemU6IGl0ZW0udHlwZSA9PT0gJ2QnID8gbnVsbCA6IGl0ZW0uc2l6ZSwKICAgICAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHN0clRvVGltZShpdGVtLmRhdGUpCiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE1LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxNSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGdldEZpbGVMaXN0KF94MTEpIHsKICAgICAgICByZXR1cm4gX2dldEZpbGVMaXN0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXRGaWxlTGlzdDsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImdldEZpbGVJbmZvIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZ2V0RmlsZUluZm8gPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNihmaWxlbmFtZSkgewogICAgICAgIHZhciByZXNwb25zZTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTE2JChfY29udGV4dDE2KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTYucHJldiA9IF9jb250ZXh0MTYubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0MTYubmV4dCA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KCdHRVQnLCAncnJfZmlsZWluZm8nLCBmaWxlbmFtZSA/IHsKICAgICAgICAgICAgICAgICAgbmFtZTogZmlsZW5hbWUKICAgICAgICAgICAgICAgIH0gOiB7fSwgJ2pzb24nLCBudWxsLCBudWxsLCB0aGlzLnNlc3Npb25UaW1lb3V0LCBudWxsLCBmaWxlbmFtZSk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQxNi5zZW50OwoKICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuZXJyKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTYubmV4dCA9IDU7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBPcGVyYXRpb25GYWlsZWRFcnJvcigiZXJyICIuY29uY2F0KHJlc3BvbnNlLmVycikpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICBkZWxldGUgcmVzcG9uc2UuZXJyOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTYuYWJydXB0KCJyZXR1cm4iLCBuZXcgUGFyc2VkRmlsZUluZm8ocmVzcG9uc2UpKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTYsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXRGaWxlSW5mbyhfeDEyKSB7CiAgICAgICAgcmV0dXJuIF9nZXRGaWxlSW5mby5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZ2V0RmlsZUluZm87CiAgICB9KCkKICB9XSk7CgogIHJldHVybiBQb2xsQ29ubmVjdG9yOwp9KEJhc2VDb25uZWN0b3IpOwoKZXhwb3J0IHsgUG9sbENvbm5lY3RvciBhcyBkZWZhdWx0IH07"},{"version":3,"sources":["C:/Users/jpatrick/Documents/GitHub/DuetWebControl_Fork/src/store/machine/connector/PollConnector.js"],"names":["crc32","BaseConnector","defaultRequestTimeout","getBoardDefinition","DefaultMachineModel","HeaterState","StatusType","isPaused","isPrinting","BeepRequest","MessageBox","ParsedFileInfo","NetworkError","DisconnectedError","TimeoutError","OperationCancelledError","OperationFailedError","DirectoryNotFoundError","FileNotFoundError","DriveUnmountedError","LoginError","InvalidPasswordError","NoFreeSessionError","CodeResponseError","CodeBufferError","arraySizesDiffer","quickPatch","bitmapToArray","strToTime","timeToStr","PollConnector","method","url","params","responseType","body","onProgress","timeout","requestTimeout","cancellationToken","filename","retry","internalURL","requestBase","hadParam","key","encodeURIComponent","xhr","XMLHttpRequest","open","setRequestHeader","onprogress","e","loaded","total","upload","cancel","abort","requests","push","maxRetries","settings","ajaxRetries","that","Promise","resolve","reject","onload","filter","request","status","responseText","JSON","parse","response","location","protocol","hostname","password","time","Date","then","result","Object","err","catch","error","lastSeq","getGCodeReply","setTimeout","statusText","onabort","updateLoopTimer","onerror","ontimeout","send","pendingCodes","forEach","code","username","window","forceLegacyConnect","apiLevel","setConnectingProgress","responseData","boardType","sessionTimeout","module","scheduleUpdate","cancelRequests","lastStatusResponse","lastSeqs","lastUptime","justConnected","clearTimeout","requestExtendedStatus","updateLoopCounter","extendedUpdateEvery","verbose","wasPrinting","indexOf","wasSimulating","wasPaused","statusType","type","newData","updateLoopStatus","getFileInfo","currentFileInfo","printDuration","job","file","layers","printStats","layerHeight","lastFileName","fileName","lastFileCancelled","lastFileSimulated","fanRPMs","sensors","fanRPM","Array","fans","fanPercent","map","index","rpm","length","value","heat","heaters","temps","state","sensor","convertHeaterState","move","axes","coords","xyz","position","drive","drives","homed","Boolean","axesHomed","machinePosition","userPosition","currentMove","requestedSpeed","speeds","undefined","requested","topSpeed","top","extruders","extr","extruder","factor","extrFactors","speedFactor","workspaceNumber","wpl","scanner","progress","analog","current","lastReading","number","concat","extra","temp","name","probes","probeType","probeValue","probeSecondary","atxPower","currentTool","convertStatusLetter","tools","active","standby","babystep","machine","axis","bed","heater","chamber","cabinet","numExtruders","axisNames","split","boardDefinition","probe","boards","firmwareFileName","firmwareName","iapFileNameSD","maxHeaters","maxMotors","mcuTemp","mcutemp","min","cur","max","shortName","supports12864","v12","vIn","vin","fanData","fanNames","thermostatic","controllableFans","bedHeaters","chamberHeaters","coldExtrudeTemperature","coldExtrudeTemp","coldRetractTemperature","coldRetractTemp","letter","visible","compensation","kinematics","geometry","network","endstops","dummy","triggered","threshold","triggerHeight","height","machineMode","mode","tool","axisMap","filamentExtruder","offsets","tempLimit","filament","names","volumes","i","mounted","mountedVolumes","filePosition","extrRaw","rawPosition","duration","layer","currentLayer","layerTime","currentLayerTime","warmUpDuration","timesLeft","addLayers","firstLayerDuration","firstLayerHeight","amount","fractionPrinted","measuredLayerHeight","zPosition","layerJustChanged","avgDuration","beepFrequency","beepDuration","displayMessage","messageBox","output","message","msgBox","title","msg","axisControls","controls","beep","frequency","spindles","spindle","off","dispatch","seq","getConfigResponse","keys","configData","firmwareElectronics","firmwareDate","firmwareVersion","directories","sysdir","system","axisMins","acceleration","accelerations","currents","jerk","minFeedrates","axisMaxes","speed","maxFeedrates","idle","idleCurrentFactor","idleTimeout","interfaces","dwsVersion","jobKey","reply","console","warn","keyIndex","numKeys","flags","keyResponse","upTime","seqs","lastStatus","simulating","layersChanged","size","updateLoopModel","doUpdate","bind","updateInterval","gcode","stringify","buff","inBraces","trim","content","payload","Blob","lastModified","crcUploads","fileReader","FileReader","target","readAsArrayBuffer","checksum","toString","from","to","force","silent","old","new","deleteexisting","directory","dir","fileList","next","first","files","item","isDirectory","date"],"mappings":"AAAA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,OAAOA,KAAP,MAAkB,mBAAlB;AAEA,OAAOC,aAAP,IAAwBC,qBAAxB,QAAqD,oBAArD;AACA,SAASC,kBAAT,QAAmC,cAAnC;AACA,SAASC,mBAAT,QAAoC,aAApC;AACA,SAASC,WAAT,EAAsBC,UAAtB,EAAkCC,QAAlC,EAA4CC,UAA5C,QAA8D,kBAA9D;AACA,SAASC,WAAT,EAAsBC,UAAtB,EAAkCC,cAAlC,QAAwD,kBAAxD;AAEA,SACCC,YADD,EACeC,iBADf,EACkCC,YADlC,EACgDC,uBADhD,EACyEC,oBADzE,EAECC,sBAFD,EAEyBC,iBAFzB,EAE4CC,mBAF5C,EAGCC,UAHD,EAGaC,oBAHb,EAGmCC,kBAHnC,EAICC,iBAJD,EAIoBC,eAJpB,QAKO,0BALP;AAMA,SAASC,gBAAT,EAA2BC,UAA3B,QAA6C,yBAA7C;AACA,SAASC,aAAT,QAA8B,2BAA9B;AACA,SAASC,SAAT,EAAoBC,SAApB,QAAqC,wBAArC;;IAEqBC,a;;;;;;;4BA+BZC,M,EAAQC,G,EAAiK;AAAA,UAA5JC,MAA4J,uEAAnJ,IAAmJ;AAAA,UAA7IC,YAA6I,uEAA9H,MAA8H;AAAA,UAAtHC,IAAsH,uEAA/G,IAA+G;AAAA,UAAzGC,UAAyG,uEAA5F,IAA4F;AAAA,UAAtFC,OAAsF,uEAA5E,KAAKC,cAAuE;AAAA,UAAvDC,iBAAuD,uEAAnC,IAAmC;AAAA,UAA7BC,QAA6B,uEAAlB,KAAkB;AAAA,UAAXC,KAAW,uEAAH,CAAG;AAChL,UAAIC,WAAW,GAAG,KAAKC,WAAL,GAAmBX,GAArC;;AACA,UAAIC,MAAJ,EAAY;AACX,YAAIW,QAAQ,GAAG,KAAf;;AACA,aAAK,IAAIC,GAAT,IAAgBZ,MAAhB,EAAwB;AACvBS,UAAAA,WAAW,IAAI,CAACE,QAAQ,GAAG,GAAH,GAAS,GAAlB,IAAyBC,GAAzB,GAA+B,GAA/B,GAAqCC,kBAAkB,CAACb,MAAM,CAACY,GAAD,CAAP,CAAtE;AACAD,UAAAA,QAAQ,GAAG,IAAX;AACA;AACD;;AAED,UAAMG,GAAG,GAAG,IAAIC,cAAJ,EAAZ;AACAD,MAAAA,GAAG,CAACE,IAAJ,CAASlB,MAAT,EAAiBW,WAAjB;;AACA,UAAIR,YAAY,KAAK,MAArB,EAA6B;AAC5Ba,QAAAA,GAAG,CAACb,YAAJ,GAAmB,MAAnB;AACAa,QAAAA,GAAG,CAACG,gBAAJ,CAAqB,cAArB,EAAqC,kBAArC;AACA,OAHD,MAGO;AACNH,QAAAA,GAAG,CAACb,YAAJ,GAAmBA,YAAnB;AACA;;AACD,UAAIE,UAAJ,EAAgB;AACfW,QAAAA,GAAG,CAACI,UAAJ,GAAiB,UAASC,CAAT,EAAY;AAC5B,cAAIA,CAAC,CAACC,MAAF,IAAYD,CAAC,CAACE,KAAlB,EAAyB;AACxBlB,YAAAA,UAAU,CAACgB,CAAC,CAACC,MAAH,EAAWD,CAAC,CAACE,KAAb,CAAV;AACA;AACD,SAJD;;AAKAP,QAAAA,GAAG,CAACQ,MAAJ,CAAWJ,UAAX,GAAwBJ,GAAG,CAACI,UAA5B;AACA;;AACDJ,MAAAA,GAAG,CAACV,OAAJ,GAAcA,OAAd;;AACA,UAAIE,iBAAJ,EAAuB;AACtBA,QAAAA,iBAAiB,CAACiB,MAAlB,GAA2B;AAAA,iBAAMT,GAAG,CAACU,KAAJ,EAAN;AAAA,SAA3B;AACA;;AACD,WAAKC,QAAL,CAAcC,IAAd,CAAmBZ,GAAnB;AAEA,UAAMa,UAAU,GAAG,KAAKC,QAAL,CAAcC,WAAjC;AAAA,UAA8CC,IAAI,GAAG,IAArD;AACA,aAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACvCnB,QAAAA,GAAG,CAACoB,MAAJ,GAAa,YAAW;AACvBJ,UAAAA,IAAI,CAACL,QAAL,GAAgBK,IAAI,CAACL,QAAL,CAAcU,MAAd,CAAqB,UAAAC,OAAO;AAAA,mBAAIA,OAAO,KAAKtB,GAAhB;AAAA,WAA5B,CAAhB;;AACA,cAAIA,GAAG,CAACuB,MAAJ,IAAc,GAAd,IAAqBvB,GAAG,CAACuB,MAAJ,GAAa,GAAtC,EAA2C;AAC1C,gBAAIpC,YAAY,KAAK,MAArB,EAA6B;AAC5B,kBAAI;AACH,oBAAI,CAACa,GAAG,CAACwB,YAAT,EAAuB;AACtBN,kBAAAA,OAAO,CAAC,IAAD,CAAP;AACA,iBAFD,MAEO;AACNA,kBAAAA,OAAO,CAACO,IAAI,CAACC,KAAL,CAAW1B,GAAG,CAACwB,YAAf,CAAD,CAAP;AACA;AACD,eAND,CAME,OAAOnB,CAAP,EAAU;AACXc,gBAAAA,MAAM,CAACd,CAAD,CAAN;AACA;AACD,aAVD,MAUO;AACNa,cAAAA,OAAO,CAAClB,GAAG,CAAC2B,QAAL,CAAP;AACA;AACD,WAdD,MAcO,IAAI3B,GAAG,CAACuB,MAAJ,KAAe,GAAnB,EAAwB;AAC9B;AACA;AACA;AACArE,YAAAA,aAAa,CAACoE,OAAd,CAAsB,KAAtB,YAAgCM,QAAQ,CAACC,QAAzC,eAAsDb,IAAI,CAACc,QAA3D,kBAAkF;AAChFC,cAAAA,QAAQ,EAAEf,IAAI,CAACe,QADiE;AAEhFC,cAAAA,IAAI,EAAElD,SAAS,CAAC,IAAImD,IAAJ,EAAD;AAFiE,aAAlF,EAIEC,IAJF,CAIO,UAASC,MAAT,EAAiB;AACtB,kBAAIA,MAAM,YAAYC,MAAlB,IAA4BD,MAAM,CAACE,GAAP,KAAe,CAA/C,EAAkD;AACjDrB,gBAAAA,IAAI,CAACM,OAAL,CAAatC,MAAb,EAAqBC,GAArB,EAA0BC,MAA1B,EAAkCC,YAAlC,EAAgDC,IAAhD,EAAsDC,UAAtD,EAAkEC,OAAlE,EAA2EE,iBAA3E,EAA8FC,QAA9F,EACEyC,IADF,CACO,UAAAC,MAAM;AAAA,yBAAIjB,OAAO,CAACiB,MAAD,CAAX;AAAA,iBADb,EAEEG,KAFF,CAEQ,UAAAC,KAAK;AAAA,yBAAIpB,MAAM,CAACoB,KAAD,CAAV;AAAA,iBAFb;AAGA,eAJD,MAIO;AACNpB,gBAAAA,MAAM,CAAC,IAAI7C,oBAAJ,EAAD,CAAN;AACA;AACD,aAZF,EAaEgE,KAbF,CAaQ,UAAAC,KAAK;AAAA,qBAAIpB,MAAM,CAACoB,KAAD,CAAV;AAAA,aAbb;AAcA,WAlBM,MAkBA,IAAIvC,GAAG,CAACuB,MAAJ,KAAe,GAAnB,EAAwB;AAC9BJ,YAAAA,MAAM,CAAC,IAAIhD,iBAAJ,CAAsBsB,QAAtB,CAAD,CAAN;AACA,WAFM,MAEA,IAAIO,GAAG,CAACuB,MAAJ,KAAe,GAAnB,EAAwB;AAC9B,gBAAI7B,KAAK,GAAGmB,UAAZ,EAAwB;AACvB;AACA,kBAAInB,KAAK,KAAK,CAAd,EAAiB;AAChBsB,gBAAAA,IAAI,CAACwB,OAAL;AACAxB,gBAAAA,IAAI,CAACyB,aAAL,CAAmBzB,IAAI,CAACwB,OAAxB,EACEN,IADF,CACO,YAAW;AAChB;AACAlB,kBAAAA,IAAI,CAACM,OAAL,CAAatC,MAAb,EAAqBC,GAArB,EAA0BC,MAA1B,EAAkCC,YAAlC,EAAgDC,IAAhD,EAAsDC,UAAtD,EAAkEC,OAAlE,EAA2EE,iBAA3E,EAA8FC,QAA9F,EAAwGC,KAAK,GAAG,CAAhH,EACEwC,IADF,CACO,UAAAC,MAAM;AAAA,2BAAIjB,OAAO,CAACiB,MAAD,CAAX;AAAA,mBADb,EAEEG,KAFF,CAEQ,UAAAC,KAAK;AAAA,2BAAIpB,MAAM,CAACoB,KAAD,CAAV;AAAA,mBAFb;AAGA,iBANF,EAOED,KAPF,CAOQ,UAAAC,KAAK;AAAA,yBAAIpB,MAAM,CAACoB,KAAD,CAAV;AAAA,iBAPb;AAQA,eAVD,MAUO;AACN;AACAG,gBAAAA,UAAU,CAAC,YAAW;AACrB1B,kBAAAA,IAAI,CAACM,OAAL,CAAatC,MAAb,EAAqBC,GAArB,EAA0BC,MAA1B,EAAkCC,YAAlC,EAAgDC,IAAhD,EAAsDC,UAAtD,EAAkEC,OAAlE,EAA2EE,iBAA3E,EAA8FC,QAA9F,EAAwGC,KAAK,GAAG,CAAhH,EACEwC,IADF,CACO,UAAAC,MAAM;AAAA,2BAAIjB,OAAO,CAACiB,MAAD,CAAX;AAAA,mBADb,EAEEG,KAFF,CAEQ,UAAAC,KAAK;AAAA,2BAAIpB,MAAM,CAACoB,KAAD,CAAV;AAAA,mBAFb;AAGA,iBAJS,EAIP,IAJO,CAAV;AAKA;AACD,aApBD,MAoBO;AACNpB,cAAAA,MAAM,CAAC,IAAIlD,oBAAJ,CAAyB+B,GAAG,CAACwB,YAAJ,IAAoBxB,GAAG,CAAC2C,UAAjD,CAAD,CAAN;AACA;AACD,WAxBM,MAwBA,IAAI3C,GAAG,CAACuB,MAAJ,IAAc,GAAlB,EAAuB;AAC7BJ,YAAAA,MAAM,CAAC,IAAIlD,oBAAJ,CAAyB+B,GAAG,CAACwB,YAAJ,IAAoBxB,GAAG,CAAC2C,UAAjD,CAAD,CAAN;AACA,WAFM,MAEA,IAAI3C,GAAG,CAACuB,MAAJ,KAAe,CAAnB,EAAsB;AAC5BJ,YAAAA,MAAM,CAAC,IAAIlD,oBAAJ,EAAD,CAAN;AACA;AACD,SAjED;;AAkEA+B,QAAAA,GAAG,CAAC4C,OAAJ,GAAc,YAAW;AACxB5B,UAAAA,IAAI,CAACL,QAAL,GAAgBK,IAAI,CAACL,QAAL,CAAcU,MAAd,CAAqB,UAAAC,OAAO;AAAA,mBAAIA,OAAO,KAAKtB,GAAhB;AAAA,WAA5B,CAAhB;AACAmB,UAAAA,MAAM,CAACH,IAAI,CAAC6B,eAAL,GAAuB,IAAI7E,uBAAJ,EAAvB,GAAuD,IAAIF,iBAAJ,EAAxD,CAAN;AACA,SAHD;;AAIAkC,QAAAA,GAAG,CAAC8C,OAAJ,GAAc,YAAW;AACxB9B,UAAAA,IAAI,CAACL,QAAL,GAAgBK,IAAI,CAACL,QAAL,CAAcU,MAAd,CAAqB,UAAAC,OAAO;AAAA,mBAAIA,OAAO,KAAKtB,GAAhB;AAAA,WAA5B,CAAhB;;AACA,cAAIN,KAAK,GAAGmB,UAAZ,EAAwB;AACvB;AACAG,YAAAA,IAAI,CAACM,OAAL,CAAatC,MAAb,EAAqBC,GAArB,EAA0BC,MAA1B,EAAkCC,YAAlC,EAAgDC,IAAhD,EAAsDC,UAAtD,EAAkEC,OAAlE,EAA2EE,iBAA3E,EAA8FC,QAA9F,EAAwGC,KAAK,GAAG,CAAhH,EACEwC,IADF,CACO,UAAAC,MAAM;AAAA,qBAAIjB,OAAO,CAACiB,MAAD,CAAX;AAAA,aADb,EAEEG,KAFF,CAEQ,UAAAC,KAAK;AAAA,qBAAIpB,MAAM,CAACoB,KAAD,CAAV;AAAA,aAFb;AAGA,WALD,MAKO;AACNpB,YAAAA,MAAM,CAAC,IAAItD,YAAJ,EAAD,CAAN;AACA;AACD,SAVD;;AAWAmC,QAAAA,GAAG,CAAC+C,SAAJ,GAAgB,YAAY;AAC3B/B,UAAAA,IAAI,CAACL,QAAL,GAAgBK,IAAI,CAACL,QAAL,CAAcU,MAAd,CAAqB,UAAAC,OAAO;AAAA,mBAAIA,OAAO,KAAKtB,GAAhB;AAAA,WAA5B,CAAhB;;AACA,cAAIN,KAAK,GAAGmB,UAAZ,EAAwB;AACvB;AACAG,YAAAA,IAAI,CAACM,OAAL,CAAatC,MAAb,EAAqBC,GAArB,EAA0BC,MAA1B,EAAkCC,YAAlC,EAAgDC,IAAhD,EAAsDC,UAAtD,EAAkEC,OAAlE,EAA2EE,iBAA3E,EAA8FC,QAA9F,EAAwGC,KAAK,GAAG,CAAhH,EACEwC,IADF,CACO,UAAAC,MAAM;AAAA,qBAAIjB,OAAO,CAACiB,MAAD,CAAX;AAAA,aADb,EAEEG,KAFF,CAEQ,UAAAC,KAAK;AAAA,qBAAIpB,MAAM,CAACoB,KAAD,CAAV;AAAA,aAFb;AAGA,WALD,MAKO;AACNpB,YAAAA,MAAM,CAAC,IAAIpD,YAAJ,EAAD,CAAN;AACA;AACD,SAVD;;AAWAiC,QAAAA,GAAG,CAACgD,IAAJ,CAAS5D,IAAT;AACA,OA9FM,CAAP;AA+FA;;;qCAEgB;AAChB,WAAK6D,YAAL,CAAkBC,OAAlB,CAA0B,UAAAC,IAAI;AAAA,eAAIA,IAAI,CAAChC,MAAL,CAAY,IAAIrD,iBAAJ,EAAZ,CAAJ;AAAA,OAA9B;AACA,WAAKmF,YAAL,GAAoB,EAApB;AACA,WAAKtC,QAAL,CAAcuC,OAAd,CAAsB,UAAA5B,OAAO;AAAA,eAAIA,OAAO,CAACZ,KAAR,EAAJ;AAAA,OAA7B;AACA,WAAKC,QAAL,GAAgB,EAAhB;AACA;;;;8FArKoBmB,Q,EAAUsB,Q,EAAUrB,Q;;;;;;;uBACjB7E,aAAa,CAACoE,OAAd,CAAsB,KAAtB,YAAgCM,QAAQ,CAACC,QAAzC,eAAsDC,QAAtD,kBAA6E;AACnGC,kBAAAA,QAAQ,EAARA,QADmG;AAEnGC,kBAAAA,IAAI,EAAElD,SAAS,CAAC,IAAImD,IAAJ,EAAD;AAFoF,iBAA7E,C;;;AAAjBN,gBAAAA,Q;8BAKEA,QAAQ,CAACU,G;gDACX,C,uBAMA,C,uBACA,C;;;;AANJ,oBAAI,CAACgB,MAAM,CAACC,kBAAR,IAA8B3B,QAAQ,CAAC4B,QAAT,GAAoB,CAAtD,EAAyD;AACxD;AACArG,kBAAAA,aAAa,CAACsG,qBAAd,CAAoC,CAApC;AACA;;iDACM,IAAIzE,aAAJ,CAAkB+C,QAAlB,EAA4BC,QAA5B,EAAsCJ,QAAtC,C;;;sBACM,IAAIrD,oBAAJ,E;;;sBACA,IAAIC,kBAAJ,E;;;sBACC,IAAIF,UAAJ,8BAAqCsD,QAAQ,CAACU,GAA9C,E;;;;;;;;;;;;;;;;;;AAwJjB,yBAAYP,QAAZ,EAAsBC,QAAtB,EAAgC0B,YAAhC,EAA8C;AAAA;;AAAA;;AAC7C,8BAAM,MAAN,EAAc3B,QAAd;;AAD6C,qEApJ7B,IAoJ6B;;AAAA,oEAnJ9B,IAmJ8B;;AAAA,2DAlJvC,IAkJuC;;AAAA,+DAjJnC,IAiJmC;;AAAA,gEAhJlC,IAgJkC;;AAAA,+DA/InC,CA+ImC;;AAAA,kEA7IhC,EA6IgC;;AAAA,qEA5I7B3E,qBA4I6B;;AAAA,+DA3InC,EA2ImC;;AAAA,sEAsE5B,IAtE4B;;AAAA,wEAuE1B,CAvE0B;;AAAA,yEAwEzB,EAxEyB;;AAAA,8DAyEpC,CAzEoC;;AAAA,mEA2E/B,EA3E+B;;AAAA,6DA4ErC,EA5EqC;;AAAA,sEA6E5B,IAAIS,cAAJ,EA7E4B;;AAAA,iEA8EjC,EA9EiC;;AAAA,gEA+ElC,CA/EkC;;AAAA,mEAgF/B,CAhF+B;;AAAA,+DAwkBnC,EAxkBmC;;AAAA,iEAykBjC,IAzkBiC;;AAAA,iEA0kBjC,CA1kBiC;;AAE7C,UAAKmE,QAAL,GAAgBA,QAAhB;AACA,UAAK2B,SAAL,GAAiBD,YAAY,CAACC,SAA9B;AACA,UAAK9D,WAAL,aAAsBgC,QAAQ,CAACC,QAA/B,eAA4CC,QAA5C;AACA,UAAK6B,cAAL,GAAsBF,YAAY,CAACE,cAAnC;AACA,UAAKJ,QAAL,GAAgBE,YAAY,CAACF,QAAb,IAAyB,CAAzC;AAN6C;AAO7C;;;;6BAEQK,M,EAAQ;AAChB,kFAAeA,MAAf;;AACA,WAAKrE,cAAL,GAAsB,KAAKoE,cAAL,IAAuB,KAAK7C,QAAL,CAAcC,WAAd,GAA4B,CAAnD,CAAtB,CAFgB,CAIhB;AACA;AACA;AACA;AACA;;AACA,WAAK8C,cAAL;AACA;;;;;;;;;;AAGA;AACA;AACA,qBAAKC,cAAL;AACA,qBAAKC,kBAAL,GAA0B,EAA1B;AACA,qBAAKvB,OAAL,GAAe,CAAf;AACA,qBAAKwB,QAAL,GAAgB,EAAhB;AACA,qBAAKC,UAAL,GAAkB,CAAlB,C,CAEA;;;uBACuB/G,aAAa,CAACoE,OAAd,CAAsB,KAAtB,YAAgCM,QAAQ,CAACC,QAAzC,eAAsD,KAAKC,QAA3D,kBAAkF;AACxGC,kBAAAA,QAAQ,EAAE,KAAKA,QADyF;AAExGC,kBAAAA,IAAI,EAAElD,SAAS,CAAC,IAAImD,IAAJ,EAAD;AAFyF,iBAAlF,C;;;AAAjBN,gBAAAA,Q;+BAKEA,QAAQ,CAACU,G;kDACX,C,yBAQA,C,yBAGA,C;;;;AAVJ,qBAAK6B,aAAL,GAAqB,IAArB;AACA,qBAAKR,SAAL,GAAiB/B,QAAQ,CAAC+B,SAA1B;AACA,qBAAKC,cAAL,GAAsBhC,QAAQ,CAACgC,cAA/B;AACA,qBAAKpE,cAAL,GAAsBoC,QAAQ,CAACgC,cAAT,IAA2B,KAAK7C,QAAL,CAAcC,WAAd,GAA4B,CAAvD,CAAtB;AACA,qBAAKwC,QAAL,GAAgB5B,QAAQ,CAAC4B,QAAT,IAAqB,CAArC;AACA,qBAAKM,cAAL;;;;sBAIM,IAAIvF,oBAAJ,E;;;sBAGA,IAAIC,kBAAJ,E;;;sBAGA,IAAIF,UAAJ,8BAAqCsD,QAAQ,CAACU,GAA9C,E;;;;;;;;;;;;;;;;;;;;;;;;;uBAKF,KAAKf,OAAL,CAAa,KAAb,EAAoB,eAApB,C;;;;;;;;;;;;;;;;;;iCAGM;AACZ,WAAKwC,cAAL;;AACA,UAAI,KAAKjB,eAAT,EAA0B;AACzBsB,QAAAA,YAAY,CAAC,KAAKtB,eAAN,CAAZ;AACA,aAAKA,eAAL,GAAuB,IAAvB;AACA;;AACD;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAcsBuB,gBAAAA,qB,8DAAwB,K;AAC9CA,gBAAAA,qBAAqB,IAAI,KAAKF,aAAL,IACvB,KAAKG,iBAAL,GAAyB,KAAKvD,QAAL,CAAcwD,mBAAxC,KAAiE,CADzC,IAEvB,KAAKC,OAAL,IAAiB,KAAKF,iBAAL,GAAyB,CAA1B,KAAiC,CAFnD,C,CAIA;;AACMG,gBAAAA,W,GAAc,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,GAAhB,EAAqB,GAArB,EAA0BC,OAA1B,CAAkC,KAAKV,kBAAL,CAAwBxC,MAA1D,MAAsE,CAAC,C;AACrFmD,gBAAAA,a,GAAgB,KAAKX,kBAAL,CAAwBxC,MAAxB,KAAmC,G,EAAKoD,S,GAAY,KAAKZ,kBAAL,CAAwBxC,MAAxB,KAAmC,G;AACvGqD,gBAAAA,U,GAAaR,qBAAqB,GAAG,CAAH,GAAQI,WAAW,GAAG,CAAH,GAAO,C;;uBAC3C,KAAKlD,OAAL,CAAa,KAAb,EAAoB,WAApB,EAAiC;AAAEuD,kBAAAA,IAAI,EAAED;AAAR,iBAAjC,C;;;AAAjBjD,gBAAAA,Q;AACAlE,gBAAAA,U,GAAa,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,GAAhB,EAAqB,GAArB,EAA0BgH,OAA1B,CAAkC9C,QAAQ,CAACJ,MAA3C,MAAuD,CAAC,C;AACrEuD,gBAAAA,O,GAAU,E,EAEhB;;sBACI,CAACV,qBAAD,IAA0B1F,gBAAgB,CAACiD,QAAD,EAAW,KAAKoC,kBAAhB,C;;;;;;uBACvC,KAAKgB,gBAAL,CAAsB,IAAtB,C;;;;;;qBAKHtH,U;;;;;sBACC,KAAKyG,aAAL,IAAsB,CAACM,W;;;;;;uBACG,KAAKQ,WAAL,E;;;AAA7B,qBAAKC,e;AACL,uBAAO,KAAKA,eAAL,CAAqBC,aAA5B;AAEAvG,gBAAAA,UAAU,CAACmG,OAAD,EAAU;AACnBK,kBAAAA,GAAG,EAAE;AACJC,oBAAAA,IAAI,EAAE,KAAKH,eADP;AAEJI,oBAAAA,MAAM,EAAE;AAFJ;AADc,iBAAV,CAAV;AAOA,qBAAKA,MAAL,GAAc,EAAd;AACA,qBAAKC,UAAL,GAAkB;AACjBC,kBAAAA,WAAW,EAAE,KAAKN,eAAL,CAAqBM;AADjB,iBAAlB;;;;;;;AAIK,oBAAIf,WAAJ,EAAiB;AACvB7F,kBAAAA,UAAU,CAACmG,OAAD,EAAU;AACnBK,oBAAAA,GAAG,EAAE;AACJK,sBAAAA,YAAY,EAAE,KAAKP,eAAL,CAAqBQ,QAD/B;AAEJC,sBAAAA,iBAAiB,EAAEf,SAFf;AAGJgB,sBAAAA,iBAAiB,EAAEjB;AAHf;AADc,mBAAV,CAAV;AAOA;;;AAED;AACMkB,gBAAAA,O,GAAWjE,QAAQ,CAACkE,OAAT,CAAiBC,MAAjB,YAAmCC,KAApC,GAA6CpE,QAAQ,CAACkE,OAAT,CAAiBC,MAA9D,GAAuE,CAACnE,QAAQ,CAACkE,OAAT,CAAiBC,MAAlB,C;AACvFnH,gBAAAA,UAAU,CAACmG,OAAD,EAAU;AACnBkB,kBAAAA,IAAI,EAAErE,QAAQ,CAACzC,MAAT,CAAgB+G,UAAhB,CAA2BC,GAA3B,CAA+B,UAACD,UAAD,EAAaE,KAAb;AAAA,2BAAwB;AAC5DC,sBAAAA,GAAG,EAAGD,KAAK,GAAGP,OAAO,CAACS,MAAjB,GAA2BT,OAAO,CAACO,KAAD,CAAlC,GAA4C,CAAC,CADU;AAE5DG,sBAAAA,KAAK,EAAEL,UAAU,GAAG;AAFwC,qBAAxB;AAAA,mBAA/B,CADa;AAKnBM,kBAAAA,IAAI,EAAE;AACLC,oBAAAA,OAAO,EAAE7E,QAAQ,CAAC8E,KAAT,CAAeC,KAAf,CAAqBR,GAArB,CAAyB,UAACQ,KAAD,EAAQC,MAAR;AAAA,6BAAoB;AAAED,wBAAAA,KAAK,EAAE,MAAI,CAACE,kBAAL,CAAwBF,KAAxB,CAAT;AAAyCC,wBAAAA,MAAM,EAANA;AAAzC,uBAApB;AAAA,qBAAzB,EAAiG,IAAjG;AADJ,mBALa;AAQnBE,kBAAAA,IAAI,EAAE;AACLC,oBAAAA,IAAI,EAAEnF,QAAQ,CAACoF,MAAT,CAAgBC,GAAhB,CAAoBd,GAApB,CAAwB,UAACe,QAAD,EAAWC,KAAX;AAAA,6BAAsB;AACnDC,wBAAAA,MAAM,EAAE,CAACD,KAAD,CAD2C;AAEnDE,wBAAAA,KAAK,EAAEC,OAAO,CAAC1F,QAAQ,CAACoF,MAAT,CAAgBO,SAAhB,CAA0BJ,KAA1B,CAAD,CAFqC;AAGnDK,wBAAAA,eAAe,EAAGN,QAAQ,KAAK,IAAd,GAAsB,IAAtB,GAA6BA,QAHK;AAInDO,wBAAAA,YAAY,EAAGP,QAAQ,KAAK,IAAd,GAAsB,IAAtB,GAA6BA;AAJQ,uBAAtB;AAAA,qBAAxB,CADD;AAOLQ,oBAAAA,WAAW,EAAE;AACZC,sBAAAA,cAAc,EAAG/F,QAAQ,CAACgG,MAAT,KAAoBC,SAArB,GAAkCjG,QAAQ,CAACgG,MAAT,CAAgBE,SAAlD,GAA8D,IADlE;AAEZC,sBAAAA,QAAQ,EAAGnG,QAAQ,CAACgG,MAAT,KAAoBC,SAArB,GAAkCjG,QAAQ,CAACgG,MAAT,CAAgBI,GAAlD,GAAwD;AAFtD,qBAPR;AAWLC,oBAAAA,SAAS,EAAErG,QAAQ,CAACoF,MAAT,CAAgBkB,IAAhB,CAAqB/B,GAArB,CAAyB,UAACe,QAAD,EAAWiB,QAAX;AAAA,6BAAyB;AAC5Df,wBAAAA,MAAM,EAAE,CAACxF,QAAQ,CAACoF,MAAT,CAAgBC,GAAhB,CAAoBX,MAApB,GAA6B6B,QAA9B,CADoD;AAE5DC,wBAAAA,MAAM,EAAExG,QAAQ,CAACzC,MAAT,CAAgBkJ,WAAhB,CAA4BF,QAA5B,IAAwC,GAFY;AAG5DjB,wBAAAA,QAAQ,EAAEA;AAHkD,uBAAzB;AAAA,qBAAzB,CAXN;AAgBLoB,oBAAAA,WAAW,EAAE1G,QAAQ,CAACzC,MAAT,CAAgBmJ,WAAhB,GAA8B,GAhBtC;AAiBLC,oBAAAA,eAAe,EAAG3G,QAAQ,CAAC4G,GAAT,KAAiBX,SAAlB,GAA+BjG,QAAQ,CAAC4G,GAAxC,GAA8C;AAjB1D,mBARa;AA2BnBC,kBAAAA,OAAO,EAAG7G,QAAQ,CAAC6G,OAAV,GAAqB;AAC7BC,oBAAAA,QAAQ,EAAE9G,QAAQ,CAAC6G,OAAT,CAAiBC,QADE;AAE7BlH,oBAAAA,MAAM,EAAEI,QAAQ,CAAC6G,OAAT,CAAiBjH;AAFI,mBAArB,GAGL,EA9Be;AA+BnBsE,kBAAAA,OAAO,EAAE;AACR6C,oBAAAA,MAAM,EAAE/G,QAAQ,CAAC8E,KAAT,CAAekC,OAAf,CAAuBzC,GAAvB,CAA2B,UAAC0C,WAAD,EAAcC,MAAd;AAAA,6BAA0B;AAAED,wBAAAA,WAAW,EAAXA,WAAF;AAAeC,wBAAAA,MAAM,EAANA;AAAf,uBAA1B;AAAA,qBAA3B,EACLC,MADK,CACEnH,QAAQ,CAAC8E,KAAT,CAAesC,KAAf,CAAqB7C,GAArB,CAAyB,UAAA6C,KAAK;AAAA,6BAAK;AAC1CH,wBAAAA,WAAW,EAAGG,KAAK,CAACC,IAAN,KAAe,IAAhB,GAAwB,IAAxB,GAA+BD,KAAK,CAACC,IADR;AAE1CC,wBAAAA,IAAI,EAAEF,KAAK,CAACE;AAF8B,uBAAL;AAAA,qBAA9B,CADF,CADA;AAMRC,oBAAAA,MAAM,EAAG,KAAKC,SAAL,KAAmB,CAApB,GAAyB,CAChC;AACC7C,sBAAAA,KAAK,EAAE,CAAC3E,QAAQ,CAACkE,OAAT,CAAiBuD,UAAlB,EAA8BN,MAA9B,CAAqCnH,QAAQ,CAACkE,OAAT,CAAiBwD,cAAjB,GAAkC1H,QAAQ,CAACkE,OAAT,CAAiBwD,cAAnD,GAAoE,EAAzG;AADR,qBADgC,CAAzB,GAIJ;AAVI,mBA/BU;AA2CnB3C,kBAAAA,KAAK,EAAE;AACN4C,oBAAAA,QAAQ,EAAG3H,QAAQ,CAACzC,MAAT,CAAgBoK,QAAhB,KAA6B,CAAC,CAA/B,GAAoC,IAApC,GAA2CjC,OAAO,CAAC1F,QAAQ,CAACzC,MAAT,CAAgBoK,QAAjB,CADtD;AAENC,oBAAAA,WAAW,EAAE5H,QAAQ,CAAC4H,WAFhB;AAGNhI,oBAAAA,MAAM,EAAE,KAAKiI,mBAAL,CAAyB7H,QAAQ,CAACJ,MAAlC;AAHF,mBA3CY;AAgDnBkI,kBAAAA,KAAK,EAAE9H,QAAQ,CAAC8E,KAAT,CAAegD,KAAf,CAAqBC,MAArB,CAA4BxD,GAA5B,CAAgC,UAACwD,MAAD,EAASvD,KAAT;AAAA,2BAAoB;AAC1DuD,sBAAAA,MAAM,EAANA,MAD0D;AAE1DC,sBAAAA,OAAO,EAAEhI,QAAQ,CAAC8E,KAAT,CAAegD,KAAf,CAAqBE,OAArB,CAA6BxD,KAA7B;AAFiD,qBAApB;AAAA,mBAAhC;AAhDY,iBAAV,CAAV;;AAqDA,oBAAIrB,OAAO,CAAC+B,IAAR,CAAaC,IAAb,CAAkBT,MAAlB,IAA4B,CAAhC,EAAmC;AAClCvB,kBAAAA,OAAO,CAAC+B,IAAR,CAAaC,IAAb,CAAkB,CAAlB,EAAqB8C,QAArB,GAAiCjI,QAAQ,CAACzC,MAAT,CAAgB0K,QAAhB,KAA6BhC,SAA9B,GAA2CjG,QAAQ,CAACzC,MAAT,CAAgB0K,QAA3D,GAAsE,CAAtG;AACA;;AACD,oBAAIjI,QAAQ,CAACoF,MAAT,CAAgB8C,OAApB,EAA6B;AAC5BlI,kBAAAA,QAAQ,CAACoF,MAAT,CAAgB8C,OAAhB,CAAwB3G,OAAxB,CAAgC,UAASqE,eAAT,EAA0BuC,IAA1B,EAAgC;AAC/DhF,oBAAAA,OAAO,CAAC+B,IAAR,CAAaC,IAAb,CAAkBgD,IAAlB,EAAwBvC,eAAxB,GAA2CA,eAAe,KAAK,IAArB,GAA6B,IAA7B,GAAoCA,eAA9E;AACA,mBAFD;AAGA;;AACD,oBAAI5F,QAAQ,CAAC8E,KAAT,CAAesD,GAAf,IAAsBpI,QAAQ,CAAC8E,KAAT,CAAesD,GAAf,CAAmBC,MAAnB,IAA6B,CAAnD,IAAwDrI,QAAQ,CAAC8E,KAAT,CAAesD,GAAf,CAAmBC,MAAnB,GAA4BlF,OAAO,CAACe,OAAR,CAAgB6C,MAAhB,CAAuBrC,MAA/G,EAAuH;AACtHvB,kBAAAA,OAAO,CAACyB,IAAR,CAAaC,OAAb,CAAqB7E,QAAQ,CAAC8E,KAAT,CAAesD,GAAf,CAAmBC,MAAxC,EAAgDN,MAAhD,GAAyD/H,QAAQ,CAAC8E,KAAT,CAAesD,GAAf,CAAmBL,MAA5E;AACA5E,kBAAAA,OAAO,CAACyB,IAAR,CAAaC,OAAb,CAAqB7E,QAAQ,CAAC8E,KAAT,CAAesD,GAAf,CAAmBC,MAAxC,EAAgDL,OAAhD,GAA0DhI,QAAQ,CAAC8E,KAAT,CAAesD,GAAf,CAAmBJ,OAA7E;AACA;;AACD,oBAAIhI,QAAQ,CAAC8E,KAAT,CAAewD,OAAf,IAA0BtI,QAAQ,CAAC8E,KAAT,CAAewD,OAAf,CAAuBD,MAAvB,IAAiC,CAA3D,IAAgErI,QAAQ,CAAC8E,KAAT,CAAewD,OAAf,CAAuBD,MAAvB,GAAgClF,OAAO,CAACe,OAAR,CAAgB6C,MAAhB,CAAuBrC,MAA3H,EAAmI;AAClIvB,kBAAAA,OAAO,CAACyB,IAAR,CAAaC,OAAb,CAAqB7E,QAAQ,CAAC8E,KAAT,CAAewD,OAAf,CAAuBD,MAA5C,EAAoDN,MAApD,GAA6D/H,QAAQ,CAAC8E,KAAT,CAAewD,OAAf,CAAuBP,MAApF;AACA5E,kBAAAA,OAAO,CAACyB,IAAR,CAAaC,OAAb,CAAqB7E,QAAQ,CAAC8E,KAAT,CAAewD,OAAf,CAAuBD,MAA5C,EAAoDL,OAApD,GAA8DhI,QAAQ,CAAC8E,KAAT,CAAewD,OAAf,CAAuBN,OAArF;AACA;;AACD,oBAAIhI,QAAQ,CAAC8E,KAAT,CAAeyD,OAAf,IAA0BvI,QAAQ,CAAC8E,KAAT,CAAeyD,OAAf,CAAuBF,MAAvB,IAAiC,CAA3D,IAAgErI,QAAQ,CAAC8E,KAAT,CAAeyD,OAAf,CAAuBF,MAAvB,GAAgClF,OAAO,CAACe,OAAR,CAAgB6C,MAAhB,CAAuBrC,MAA3H,EAAmI;AAClIvB,kBAAAA,OAAO,CAACyB,IAAR,CAAaC,OAAb,CAAqB7E,QAAQ,CAAC8E,KAAT,CAAeyD,OAAf,CAAuBF,MAA5C,EAAoDN,MAApD,GAA6D/H,QAAQ,CAAC8E,KAAT,CAAeyD,OAAf,CAAuBR,MAApF;AACA5E,kBAAAA,OAAO,CAACyB,IAAR,CAAaC,OAAb,CAAqB7E,QAAQ,CAAC8E,KAAT,CAAeyD,OAAf,CAAuBF,MAA5C,EAAoDL,OAApD,GAA8DhI,QAAQ,CAAC8E,KAAT,CAAeyD,OAAf,CAAuBP,OAArF;AACA;;AACD,qBAAKQ,YAAL,GAAoBxI,QAAQ,CAACoF,MAAT,CAAgBkB,IAAhB,CAAqB5B,MAAzC;;AAEA,oBAAIzB,UAAU,KAAK,CAAnB,EAAsB;AACrB;AACMwF,kBAAAA,SAFe,GAEFzI,QAAQ,CAACyI,SAAT,KAAuBxC,SAAxB,GAAqCjG,QAAQ,CAACyI,SAAT,CAAmBC,KAAnB,CAAyB,EAAzB,CAArC,GAAoE,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,GAAhB,EAAqB,GAArB,EAA0B,GAA1B,EAA+B,GAA/B,EAAoC,GAApC,EAAyC,GAAzC,CAFjE;AAGfC,kBAAAA,eAHe,GAGGlN,kBAAkB,CAAC,KAAKsG,SAAN,CAHrB;AAIrB,uBAAKuF,IAAL,GAAYA,IAAZ;AACA,uBAAKE,SAAL,GAAiBxH,QAAQ,CAAC4I,KAAT,GAAiB5I,QAAQ,CAAC4I,KAAT,CAAe1F,IAAhC,GAAuC,CAAxD;AAEAlG,kBAAAA,UAAU,CAACmG,OAAD,EAAU;AACnB0F,oBAAAA,MAAM,EAAE,CACP;AACCC,sBAAAA,gBAAgB,EAAEH,eAAe,CAACG,gBADnC;AAECC,sBAAAA,YAAY,EAAE/I,QAAQ,CAAC+I,YAFxB;AAGCC,sBAAAA,aAAa,EAAEL,eAAe,CAACK,aAHhC;AAICC,sBAAAA,UAAU,EAAEN,eAAe,CAACM,UAJ7B;AAKCC,sBAAAA,SAAS,EAAEP,eAAe,CAACO,SAL5B;AAMCC,sBAAAA,OAAO,EAAEnJ,QAAQ,CAACoJ,OAAT,GAAmB;AAC3BC,wBAAAA,GAAG,EAAErJ,QAAQ,CAACoJ,OAAT,CAAiBC,GADK;AAE3BrC,wBAAAA,OAAO,EAAEhH,QAAQ,CAACoJ,OAAT,CAAiBE,GAFC;AAG3BC,wBAAAA,GAAG,EAAEvJ,QAAQ,CAACoJ,OAAT,CAAiBG;AAHK,uBAAnB,GAIL,EAVL;AAWCC,sBAAAA,SAAS,EAAE,KAAKzH,SAXjB;AAYC0H,sBAAAA,aAAa,EAAEd,eAAe,CAACc,aAZhC;AAaCC,sBAAAA,GAAG,EAAE1J,QAAQ,CAAC0J,GAAT,GAAe;AACnBL,wBAAAA,GAAG,EAAErJ,QAAQ,CAAC0J,GAAT,CAAaL,GADC;AAEnBrC,wBAAAA,OAAO,EAAEhH,QAAQ,CAAC0J,GAAT,CAAaJ,GAFH;AAGnBC,wBAAAA,GAAG,EAAEvJ,QAAQ,CAAC0J,GAAT,CAAaH;AAHC,uBAAf,GAID,EAjBL;AAkBCI,sBAAAA,GAAG,EAAE3J,QAAQ,CAAC4J,GAAT,GAAe;AACnBP,wBAAAA,GAAG,EAAErJ,QAAQ,CAAC4J,GAAT,CAAaP,GADC;AAEnBrC,wBAAAA,OAAO,EAAEhH,QAAQ,CAAC4J,GAAT,CAAaN,GAFH;AAGnBC,wBAAAA,GAAG,EAAEvJ,QAAQ,CAAC4J,GAAT,CAAaL;AAHC,uBAAf,GAID;AAtBL,qBADO,CADW;AA2BnBlF,oBAAAA,IAAI,EAAElB,OAAO,CAACkB,IAAR,CAAaE,GAAb,CAAiB,UAACsF,OAAD,EAAUrF,KAAV;AAAA,6BAAqB;AAC3C8C,wBAAAA,IAAI,EAAE,CAACtH,QAAQ,CAACzC,MAAT,CAAgBuM,QAAjB,GAA4B,IAA5B,GAAmC9J,QAAQ,CAACzC,MAAT,CAAgBuM,QAAhB,CAAyBtF,KAAzB,CADE;AAE3CuF,wBAAAA,YAAY,EAAE;AACblF,0BAAAA,OAAO,EAAG,CAAC7E,QAAQ,CAACgK,gBAAT,GAA6B,KAAKxF,KAAnC,MAA+C,CAAhD,GAAqD,EAArD,GAA0D,CAAC,CAAC,CAAF;AADtD;AAF6B,uBAArB;AAAA,qBAAjB,CA3Ba;AAiCnBI,oBAAAA,IAAI,EAAE;AACLqF,sBAAAA,UAAU,EAAEjK,QAAQ,CAAC8E,KAAT,CAAesD,GAAf,GAAqB,CAACpI,QAAQ,CAAC8E,KAAT,CAAesD,GAAf,CAAmBC,MAApB,CAArB,GAAmD,EAD1D;AAEL6B,sBAAAA,cAAc,EAAE,CAAClK,QAAQ,CAAC8E,KAAT,CAAewD,OAAf,GAAyB,CAACtI,QAAQ,CAAC8E,KAAT,CAAewD,OAAf,CAAuBD,MAAxB,CAAzB,GAA2D,EAA5D,EACXlB,MADW,CACJnH,QAAQ,CAAC8E,KAAT,CAAeyD,OAAf,GAAyB,CAACvI,QAAQ,CAAC8E,KAAT,CAAeyD,OAAf,CAAuBF,MAAxB,CAAzB,GAA2D,EADvD,CAFX;AAIL8B,sBAAAA,sBAAsB,EAAEnK,QAAQ,CAACoK,eAJ5B;AAKLC,sBAAAA,sBAAsB,EAAErK,QAAQ,CAACsK;AAL5B,qBAjCa;AAwCnBpF,oBAAAA,IAAI,EAAE;AACLC,sBAAAA,IAAI,EAAEnF,QAAQ,CAACoF,MAAT,CAAgBC,GAAhB,CAAoBd,GAApB,CAAwB,UAACe,QAAD,EAAWd,KAAX;AAAA,+BAAsB;AACnD+F,0BAAAA,MAAM,EAAE9B,SAAS,CAACjE,KAAD,CADkC;AAEnDgG,0BAAAA,OAAO,EAAGxK,QAAQ,CAACmF,IAAT,KAAkBc,SAAnB,GAAiCzB,KAAK,GAAGxE,QAAQ,CAACmF,IAAlD,GAA0D;AAFhB,yBAAtB;AAAA,uBAAxB,CADD;AAKLsF,sBAAAA,YAAY,EAAE;AACbvH,wBAAAA,IAAI,EAAElD,QAAQ,CAACyK;AADF,uBALT;AAQLC,sBAAAA,UAAU,EAAE;AACXpD,wBAAAA,IAAI,EAAEtH,QAAQ,CAAC2K;AADJ;AARP,qBAxCa;AAoDnBC,oBAAAA,OAAO,EAAE;AACRtD,sBAAAA,IAAI,EAAEtH,QAAQ,CAACsH;AADP,qBApDU;AAuDnBpD,oBAAAA,OAAO,EAAE;AACR2G,sBAAAA,QAAQ,EAAE,mBAAIzG,KAAK,CAACpE,QAAQ,CAACoF,MAAT,CAAgBC,GAAhB,CAAoBX,MAApB,GAA6B1E,QAAQ,CAACoF,MAAT,CAAgBkB,IAAhB,CAAqB5B,MAAnD,CAAT,EAAqEH,GAArE,CAAyE,UAACuG,KAAD,EAAQvF,KAAR;AAAA,+BAAmB;AACrGwF,0BAAAA,SAAS,EAAErF,OAAO,CAAC1F,QAAQ,CAAC6K,QAAT,GAAqB,KAAKtF,KAA3B;AADmF,yBAAnB;AAAA,uBAAzE,CADF;AAIRgC,sBAAAA,MAAM,EAAGvH,QAAQ,CAAC4I,KAAT,IAAkB5I,QAAQ,CAAC4I,KAAT,CAAe1F,IAAf,KAAwB,CAA3C,GAAgD,CACvD;AACC8H,wBAAAA,SAAS,EAAEhL,QAAQ,CAAC4I,KAAT,CAAeoC,SAD3B;AAECC,wBAAAA,aAAa,EAAEjL,QAAQ,CAAC4I,KAAT,CAAesC,MAF/B;AAGChI,wBAAAA,IAAI,EAAElD,QAAQ,CAAC4I,KAAT,CAAe1F;AAHtB,uBADuD,CAAhD,GAMJ;AAVI,qBAvDU;AAmEnB6B,oBAAAA,KAAK,EAAE;AACNoG,sBAAAA,WAAW,EAAEnL,QAAQ,CAACoL,IAAT,GAAgBpL,QAAQ,CAACoL,IAAzB,GAAgC;AADvC,qBAnEY;AAsEnBtD,oBAAAA,KAAK,EAAG9H,QAAQ,CAAC8H,KAAT,KAAmB7B,SAApB,GAAiCjG,QAAQ,CAAC8H,KAAT,CAAevD,GAAf,CAAmB,UAAA8G,IAAI;AAAA,6BAAK;AACnEnE,wBAAAA,MAAM,EAAEmE,IAAI,CAACnE,MADsD;AAEnEI,wBAAAA,IAAI,EAAE+D,IAAI,CAAC/D,IAAL,GAAY+D,IAAI,CAAC/D,IAAjB,GAAwB,EAFqC;AAGnEzC,wBAAAA,OAAO,EAAEwG,IAAI,CAACxG,OAHqD;AAInEwB,wBAAAA,SAAS,EAAEgF,IAAI,CAAC7F,MAJmD;AAKnEL,wBAAAA,IAAI,EAAEkG,IAAI,CAACC,OALwD;AAMnEjH,wBAAAA,IAAI,EAAEpH,aAAa,CAACoO,IAAI,CAAChH,IAAN,CANgD;AAOnEkH,wBAAAA,gBAAgB,EAAGF,IAAI,CAAC7F,MAAL,CAAYd,MAAZ,GAAqB,CAAtB,GAA2B2G,IAAI,CAAC7F,MAAL,CAAY,CAAZ,CAA3B,GAA4C,CAAC,CAPI;AAQnEgG,wBAAAA,OAAO,EAAEH,IAAI,CAACG;AARqD,uBAAL;AAAA,qBAAvB,CAAjC,GASD;AA/Ea,mBAAV,CAAV;AAkFArI,kBAAAA,OAAO,CAACyB,IAAR,CAAaC,OAAb,CAAqBtD,OAArB,CAA6B,UAAA8G,MAAM;AAAA,2BAAIA,MAAM,CAACkB,GAAP,GAAavJ,QAAQ,CAACyL,SAA1B;AAAA,mBAAnC;AAEAzL,kBAAAA,QAAQ,CAAC8H,KAAT,CAAevG,OAAf,CAAuB,UAAA8J,IAAI,EAAI;AAC9B,wBAAIA,IAAI,CAAC7F,MAAL,CAAYd,MAAZ,GAAqB,CAAzB,EAA4B;AAC3B,0BAAMa,KAAK,GAAG8F,IAAI,CAAC7F,MAAL,CAAY,CAAZ,CAAd;;AACA,0BAAID,KAAK,IAAI,CAAT,IAAcA,KAAK,GAAGpC,OAAO,CAAC+B,IAAR,CAAamB,SAAb,CAAuB3B,MAAjD,EAAyD;AACxDvB,wBAAAA,OAAO,CAAC+B,IAAR,CAAamB,SAAb,CAAuB,CAAvB,EAA0BqF,QAA1B,GAAqCL,IAAI,CAACK,QAA1C;AACA;AACD;AACD,mBAPD;;AASA,sBAAI1L,QAAQ,CAAC8E,KAAT,CAAe6G,KAAf,KAAyB1F,SAA7B,EAAwC;AACvCjG,oBAAAA,QAAQ,CAAC8E,KAAT,CAAe6G,KAAf,CAAqBpK,OAArB,CAA6B,UAAC+F,IAAD,EAAO9C,KAAP;AAAA,6BAAiBrB,OAAO,CAACe,OAAR,CAAgB6C,MAAhB,CAAuBvC,KAAvB,EAA8B8C,IAA9B,GAAqCA,IAAtD;AAAA,qBAA7B;AACA;;AAEDnE,kBAAAA,OAAO,CAACyI,OAAR,GAAkB,EAAlB;;AACA,uBAASC,CAAT,GAAa,CAAb,EAAgBA,CAAC,GAAG7L,QAAQ,CAAC4L,OAA7B,EAAsCC,CAAC,EAAvC,EAA2C;AAC1C1I,oBAAAA,OAAO,CAACyI,OAAR,CAAgB3M,IAAhB,CAAqB;AACpB6M,sBAAAA,OAAO,EAAE,CAAC9L,QAAQ,CAAC+L,cAAT,GAA2B,KAAKF,CAAjC,MAAyC;AAD9B,qBAArB;AAGA;;AAED7L,kBAAAA,QAAQ,CAAC8H,KAAT,CAAevG,OAAf,CAAuB,UAAA8J,IAAI,EAAI;AAC9B,wBAAIA,IAAI,CAAC7F,MAAL,CAAYd,MAAZ,GAAqB,CAAzB,EAA4B;AAC3B,0BAAM6B,QAAQ,GAAG8E,IAAI,CAAC7F,MAAL,CAAY,CAAZ,CAAjB;;AACA,0BAAIe,QAAQ,IAAI,CAAZ,IAAiBA,QAAQ,GAAGpD,OAAO,CAAC+B,IAAR,CAAamB,SAAb,CAAuB3B,MAAnD,IAA6DvB,OAAO,CAAC+B,IAAR,CAAamB,SAAb,CAAuBE,QAAvB,MAAqC,IAAtG,EAA4G;AAC3GpD,wBAAAA,OAAO,CAAC+B,IAAR,CAAamB,SAAb,CAAuBE,QAAvB,EAAiCmF,QAAjC,GAA4CL,IAAI,CAACK,QAAjD;AACA;AACD;AACD,mBAPD;AAQA,iBAvHD,MAuHO,IAAIzI,UAAU,KAAK,CAAnB,EAAsB;AAC5B,sBAAI,CAACE,OAAO,CAACK,GAAb,EAAkB;AACjBL,oBAAAA,OAAO,CAACK,GAAR,GAAc,EAAd;AACA,mBAH2B,CAK5B;;;AACAxG,kBAAAA,UAAU,CAACmG,OAAO,CAACK,GAAT,EAAc;AACvBC,oBAAAA,IAAI,EAAE,EADiB;AAEvBuI,oBAAAA,YAAY,EAAEhM,QAAQ,CAACgM;AAFA,mBAAd,CAAV;AAIAhM,kBAAAA,QAAQ,CAACiM,OAAT,CAAiB1K,OAAjB,CAAyB,UAAC2K,WAAD,EAAc3F,QAAd;AAAA,2BAA2BpD,OAAO,CAAC+B,IAAR,CAAamB,SAAb,CAAuBE,QAAvB,EAAiC2F,WAAjC,GAA+CA,WAA1E;AAAA,mBAAzB,EAV4B,CAY5B;;AACA,sBAAIpQ,UAAJ,EAAgB;AACfkB,oBAAAA,UAAU,CAACmG,OAAO,CAACK,GAAT,EAAc;AACvB2I,sBAAAA,QAAQ,EAAEnM,QAAQ,CAACuD,aADI;AAEvB6I,sBAAAA,KAAK,EAAEpM,QAAQ,CAACqM,YAFO;AAGvBC,sBAAAA,SAAS,EAAEtM,QAAQ,CAACuM,gBAHG;AAIvBC,sBAAAA,cAAc,EAAExM,QAAQ,CAACwM,cAJF;AAKvBC,sBAAAA,SAAS,EAAE;AACVhJ,wBAAAA,IAAI,EAAEzD,QAAQ,CAACyM,SAAT,CAAmBhJ,IADf;AAEViI,wBAAAA,QAAQ,EAAE1L,QAAQ,CAACyM,SAAT,CAAmBf,QAFnB;AAGVU,wBAAAA,KAAK,EAAEpM,QAAQ,CAACyM,SAAT,CAAmBL;AAHhB;AALY,qBAAd,CAAV;AAWA,mBAZD,MAYO;AACNpP,oBAAAA,UAAU,CAACmG,OAAO,CAACK,GAAT,EAAc;AACvB8I,sBAAAA,SAAS,EAAE,IADY;AAEvBG,sBAAAA,SAAS,EAAE;AACVhJ,wBAAAA,IAAI,EAAE,IADI;AAEViI,wBAAAA,QAAQ,EAAE,IAFA;AAGVU,wBAAAA,KAAK,EAAE;AAHG;AAFY,qBAAd,CAAV;AAQA,mBAlC2B,CAoC5B;;;AACA,sBAAIpM,QAAQ,CAACqM,YAAT,GAAwB,KAAK3I,MAAL,CAAYgB,MAAxC,EAAgD;AAC3CgI,oBAAAA,SAD2C,GAC/B,KAD+B;;AAE/C,wBAAI,CAAC,KAAKhJ,MAAL,CAAYgB,MAAjB,EAAyB;AACxB;AACA,0BAAI1E,QAAQ,CAACqM,YAAT,GAAwB,CAA5B,EAA+B;AAC9B,6BAAK3I,MAAL,CAAYzE,IAAZ,CAAiB;AAChBkN,0BAAAA,QAAQ,EAAEnM,QAAQ,CAAC2M,kBADH;AAEhBzB,0BAAAA,MAAM,EAAE,KAAK5H,eAAL,CAAqBsJ,gBAFb;AAGhBlB,0BAAAA,QAAQ,EAAG1L,QAAQ,CAACqM,YAAT,KAA0B,CAA3B,GAAgCrM,QAAQ,CAACiM,OAAT,CAAiBvM,MAAjB,CAAwB,UAAAmN,MAAM;AAAA,mCAAIA,MAAM,GAAG,CAAb;AAAA,2BAA9B,CAAhC,GAAgF,IAH1E;AAIhBC,0BAAAA,eAAe,EAAG9M,QAAQ,CAACqM,YAAT,KAA0B,CAA3B,GAAgCrM,QAAQ,CAAC8M,eAAT,GAA2B,GAA3D,GAAiE;AAJlE,yBAAjB;AAMA3J,wBAAAA,OAAO,CAACK,GAAR,CAAYE,MAAZ,GAAqB,KAAKA,MAA1B,CAP8B,CAS9B;;AACA,4BAAI1D,QAAQ,CAACqM,YAAT,KAA0B,CAA9B,EAAiC;AAChC,+BAAK1I,UAAL,CAAgBwI,QAAhB,GAA2BnM,QAAQ,CAACwM,cAAT,GAA0BxM,QAAQ,CAAC2M,kBAA9D;AACA,+BAAKhJ,UAAL,CAAgBsI,OAAhB,GAA0BjM,QAAQ,CAACiM,OAAnC;AACA,+BAAKtI,UAAL,CAAgBmJ,eAAhB,GAAkC9M,QAAQ,CAAC8M,eAA3C;AACA,+BAAKnJ,UAAL,CAAgBoJ,mBAAhB,GAAsC/M,QAAQ,CAACoF,MAAT,CAAgBC,GAAhB,CAAoB,CAApB,IAAyB,KAAK/B,eAAL,CAAqBsJ,gBAApF;AACA,+BAAKjJ,UAAL,CAAgBqJ,SAAhB,GAA4BhN,QAAQ,CAACoF,MAAT,CAAgBC,GAAhB,CAAoB,CAApB,CAA5B;AACA,yBAND,MAMO,IAAIrF,QAAQ,CAACqM,YAAT,GAAwB,KAAK3I,MAAL,CAAYgB,MAAZ,GAAqB,CAAjD,EAAoD;AAC1DgI,0BAAAA,SAAS,GAAG,IAAZ;AACA;AACD;AACD,qBAtBD,MAsBO,IAAI1M,QAAQ,CAACqM,YAAT,GAAwB,KAAK3I,MAAL,CAAYgB,MAAZ,GAAqB,CAAjD,EAAoD;AAC1D;AACAgI,sBAAAA,SAAS,GAAG,IAAZ;AACA;;AAED,wBAAIA,SAAJ,EAAe;AACRO,sBAAAA,gBADQ,GACYjN,QAAQ,CAACJ,MAAT,KAAoB,GAArB,IAA+BI,QAAQ,CAACqM,YAAT,GAAwB,KAAK3I,MAAL,CAAYgB,MAArC,KAAiD,CAD1F;;AAEd,0BAAI,KAAKf,UAAL,CAAgBwI,QAApB,EAA8B;AAC7B;AACA,6BAAKzI,MAAL,CAAYzE,IAAZ,CAAiB;AAChBkN,0BAAAA,QAAQ,EAAEnM,QAAQ,CAACuD,aAAT,GAAyB,KAAKI,UAAL,CAAgBwI,QADnC;AAEhBjB,0BAAAA,MAAM,EAAE,KAAKvH,UAAL,CAAgBoJ,mBAAhB,GAAsC,KAAKpJ,UAAL,CAAgBoJ,mBAAtD,GAA4E,KAAKpJ,UAAL,CAAgBC,WAFpF;AAGhB8H,0BAAAA,QAAQ,EAAE1L,QAAQ,CAACiM,OAAT,CAAiB1H,GAAjB,CAAqB,UAACsI,MAAD,EAASrI,KAAT;AAAA,mCAAmBqI,MAAM,GAAG,MAAI,CAAClJ,UAAL,CAAgBsI,OAAhB,CAAwBzH,KAAxB,CAA5B;AAAA,2BAArB,EAAiF9E,MAAjF,CAAwF,UAACoL,KAAD,EAAQtG,KAAR;AAAA,mCAAkBxE,QAAQ,CAACiM,OAAT,CAAiBzH,KAAjB,IAA0B,CAA5C;AAAA,2BAAxF,CAHM;AAIhBsI,0BAAAA,eAAe,EAAE,CAAC9M,QAAQ,CAAC8M,eAAT,GAA2B,KAAKnJ,UAAL,CAAgBmJ,eAA5C,IAA+D;AAJhE,yBAAjB;AAMA,uBARD,MAQO;AACN;AACMI,wBAAAA,WAFA,GAEc,CAAClN,QAAQ,CAACuD,aAAT,GAAyBvD,QAAQ,CAACwM,cAAlC,GAAmDxM,QAAQ,CAAC2M,kBAA5D,GAAiF3M,QAAQ,CAACuM,gBAA3F,KAAgHvM,QAAQ,CAACqM,YAAT,GAAwB,CAAxI,CAFd;;AAGN,6BAASD,KAAT,GAAiB,KAAK1I,MAAL,CAAYgB,MAA7B,EAAqC0H,KAAK,GAAG,CAAR,GAAYpM,QAAQ,CAACqM,YAA1D,EAAwED,KAAK,EAA7E,EAAiF;AAChF,+BAAK1I,MAAL,CAAYzE,IAAZ,CAAiB;AAAEkN,4BAAAA,QAAQ,EAAEe;AAAZ,2BAAjB;AACA;;AACD,6BAAKvJ,UAAL,CAAgBqJ,SAAhB,GAA4BhN,QAAQ,CAACoF,MAAT,CAAgBC,GAAhB,CAAoB,CAApB,CAA5B;AACA;;AACDlC,sBAAAA,OAAO,CAACK,GAAR,CAAYE,MAAZ,GAAqB,KAAKA,MAA1B,CAlBc,CAoBd;;AACA,0BAAIuJ,gBAAJ,EAAsB;AACrB,6BAAKtJ,UAAL,CAAgBwI,QAAhB,GAA2BnM,QAAQ,CAACuD,aAApC;AACA,6BAAKI,UAAL,CAAgBsI,OAAhB,GAA0BjM,QAAQ,CAACiM,OAAnC;AACA,6BAAKtI,UAAL,CAAgBmJ,eAAhB,GAAkC9M,QAAQ,CAAC8M,eAA3C;AACA,6BAAKnJ,UAAL,CAAgBoJ,mBAAhB,GAAsC/M,QAAQ,CAACoF,MAAT,CAAgBC,GAAhB,CAAoB,CAApB,IAAyB,KAAK1B,UAAL,CAAgBqJ,SAA/E;AACA,6BAAKrJ,UAAL,CAAgBqJ,SAAhB,GAA4BhN,QAAQ,CAACoF,MAAT,CAAgBC,GAAhB,CAAoB,CAApB,CAA5B;AACA;AACD;AACD;AACD,iB,CAED;;;AACI8H,gBAAAA,a,GAAgB,C,EAAGC,Y,GAAe,C,EAAGC,c,GAAiB,E,EAAIC,U,GAAa,I;;AAC3E,oBAAItN,QAAQ,CAACuN,MAAb,EAAqB;AACpB;AACA,sBAAIvN,QAAQ,CAACuN,MAAT,CAAgBJ,aAAhB,KAAkClH,SAAlC,IAA+CjG,QAAQ,CAACuN,MAAT,CAAgBH,YAAhB,KAAiCnH,SAApF,EAA+F;AAC9FkH,oBAAAA,aAAa,GAAGnN,QAAQ,CAACuN,MAAT,CAAgBJ,aAAhC;AACAC,oBAAAA,YAAY,GAAGpN,QAAQ,CAACuN,MAAT,CAAgBH,YAA/B;AACA,mBALmB,CAOpB;;;AACA,sBAAIpN,QAAQ,CAACuN,MAAT,CAAgBC,OAAhB,KAA4BvH,SAAhC,EAA2C;AAC1CoH,oBAAAA,cAAc,GAAGrN,QAAQ,CAACuN,MAAT,CAAgBC,OAAjC;AACA,mBAVmB,CAYpB;;;AACA,sBAAIxN,QAAQ,CAACuN,MAAT,CAAgBE,MAApB,EAA4B;AAC3BH,oBAAAA,UAAU,GAAG,IAAItR,UAAJ,CAAe;AAC3BoP,sBAAAA,IAAI,EAAEpL,QAAQ,CAACuN,MAAT,CAAgBE,MAAhB,CAAuBrC,IADF;AAE3BsC,sBAAAA,KAAK,EAAE1N,QAAQ,CAACuN,MAAT,CAAgBE,MAAhB,CAAuBC,KAFH;AAG3BF,sBAAAA,OAAO,EAAExN,QAAQ,CAACuN,MAAT,CAAgBE,MAAhB,CAAuBE,GAHL;AAI3BhQ,sBAAAA,OAAO,EAAEqC,QAAQ,CAACuN,MAAT,CAAgBE,MAAhB,CAAuB9P,OAJL;AAK3BiQ,sBAAAA,YAAY,EAAE5N,QAAQ,CAACuN,MAAT,CAAgBE,MAAhB,CAAuBI;AALV,qBAAf,CAAb;AAOA;AACD;;AAED7Q,gBAAAA,UAAU,CAACmG,OAAD,EAAU;AACnB4B,kBAAAA,KAAK,EAAE;AACN+I,oBAAAA,IAAI,EAAGX,aAAa,GAAG,CAAhB,IAAqBC,YAAY,GAAG,CAArC,GAA0C,IAAIrR,WAAJ,CAAgB;AAC/DgS,sBAAAA,SAAS,EAAEZ,aADoD;AAE/DhB,sBAAAA,QAAQ,EAAEiB;AAFqD,qBAAhB,CAA1C,GAGD,IAJC;AAKNC,oBAAAA,cAAc,EAAdA,cALM;AAMNC,oBAAAA,UAAU,EAAVA;AANM;AADY,iBAAV,CAAV,C,CAWA;;AACA,oBAAItN,QAAQ,CAACgO,QAAb,EAAuB;AACtBhR,kBAAAA,UAAU,CAACmG,OAAD,EAAU;AACnB6K,oBAAAA,QAAQ,EAAEhO,QAAQ,CAACgO,QAAT,CAAkBzJ,GAAlB,CAAsB,UAAA0J,OAAO;AAAA,6BAAK;AAC3ClG,wBAAAA,MAAM,EAAEkG,OAAO,CAAClG,MAD2B;AAE3Cf,wBAAAA,OAAO,EAAEiH,OAAO,CAACjH,OAF0B;AAG3CqE,wBAAAA,IAAI,EAAE4C,OAAO,CAAC5C;AAH6B,uBAAL;AAAA,qBAA7B;AADS,mBAAV,CAAV;AAOA,iB,CAED;;;AACA,qBAASQ,EAAT,GAAa,CAAb,EAAgBA,EAAC,GAAG1I,OAAO,CAACyB,IAAR,CAAaC,OAAb,CAAqBH,MAAzC,EAAiDmH,EAAC,EAAlD,EAAsD;AAC/CxD,kBAAAA,MAD+C,GACtClF,OAAO,CAACyB,IAAR,CAAaC,OAAb,CAAqBgH,EAArB,CADsC;;AAErD,sBAAIxD,MAAM,IAAIA,MAAM,CAACtD,KAAP,KAAiBpJ,WAAW,CAACuS,GAA3C,EAAgD;AAC/C,wBAAI7F,MAAM,CAACrD,MAAP,GAAgB,CAAhB,IAAqBqD,MAAM,CAACrD,MAAP,IAAiB7B,OAAO,CAACe,OAAR,CAAgB6C,MAAhB,CAAuBrC,MAA7D,IACHvB,OAAO,CAACe,OAAR,CAAgB6C,MAAhB,CAAuBsB,MAAM,CAACrD,MAA9B,EAAsCiC,WAAtC,KAAsD,IADvD,EAC6D;AAC5D9D,sBAAAA,OAAO,CAACyB,IAAR,CAAaC,OAAb,CAAqBgH,EAArB,IAA0B,IAA1B;AACA;AACD;AACD,iB,CAED;;;;uBACM,KAAKsC,QAAL,CAAc,QAAd,EAAwBhL,OAAxB,C;;;sBAGFnD,QAAQ,CAACoO,GAAT,KAAiB,KAAKvN,O;;;;;;uBACnB,KAAKC,aAAL,CAAmBd,QAAQ,CAACoO,GAA5B,C;;;AACN,qBAAKvN,OAAL,GAAeb,QAAQ,CAACoO,GAAxB;;;AAGD;AACA,oBAAI,CAAC,KAAK7L,aAAN,IAAuBvC,QAAQ,CAACK,IAAT,GAAgB,KAAK+B,kBAAL,CAAwB/B,IAAnE,EAAyE;AACxE,uBAAKiB,YAAL,CAAkBC,OAAlB,CAA0B,UAAAC,IAAI;AAAA,2BAAIA,IAAI,CAAChC,MAAL,CAAY,IAAInD,uBAAJ,EAAZ,CAAJ;AAAA,mBAA9B;AACA,uBAAKiF,YAAL,GAAoB,EAApB;AACA,iB,CAED;;;sBACImB,qBAAqB,IAAI,KAAKF,aAA9B,IAAgD,KAAKK,OAAL,IAAgB,KAAKF,iBAAL,GAAyB,CAAzB,KAA+B,C;;;;;;uBAC5F,KAAK2L,iBAAL,E;;;AAGP;AACA,qBAAKjM,kBAAL,GAA0BpC,QAA1B;AACA,qBAAKuC,aAAL,GAAqB,KAArB;AACA,qBAAKG,iBAAL,G,CAEA;;AACA,qBAAKR,cAAL;;;;;;;;;;;;;;;;;;uCAGkB6C,K,EAAO;AACzB,UAAMuJ,IAAI,GAAG7N,MAAM,CAAC6N,IAAP,CAAY3S,WAAZ,CAAb;;AACA,UAAIoJ,KAAK,IAAI,CAAT,IAAcA,KAAK,GAAGuJ,IAAI,CAAC5J,MAA/B,EAAuC;AACtC,eAAO4J,IAAI,CAACvJ,KAAD,CAAX;AACA;;AACD,aAAO,IAAP;AACA;;;wCAEmBwF,M,EAAQ;AAC3B,cAAQA,MAAR;AACC,aAAK,GAAL;AAAU,iBAAO,UAAP;;AACV,aAAK,GAAL;AAAU,iBAAO,KAAP;;AACV,aAAK,GAAL;AAAU,iBAAO,QAAP;;AACV,aAAK,GAAL;AAAU,iBAAO,SAAP;;AACV,aAAK,GAAL;AAAU,iBAAO,QAAP;;AACV,aAAK,GAAL;AAAU,iBAAO,UAAP;;AACV,aAAK,GAAL;AAAU,iBAAO,YAAP;;AACV,aAAK,GAAL;AAAU,iBAAO,YAAP;;AACV,aAAK,GAAL;AAAU,iBAAO,MAAP;;AACV,aAAK,GAAL;AAAU,iBAAO,cAAP;;AACV,aAAK,GAAL;AAAU,iBAAO,MAAP;AAXX;;AAaA,aAAO,SAAP;AACA,K,CAED;;;;;;;;;;;;uBAEwB,KAAK5K,OAAL,CAAa,KAAb,EAAoB,WAApB,C;;;AAAjBK,gBAAAA,Q;AACAuO,gBAAAA,U,GAAa;AAClB1F,kBAAAA,MAAM,EAAE,CACP;AACCvB,oBAAAA,IAAI,EAAEtH,QAAQ,CAACwO,mBADhB;AAECC,oBAAAA,YAAY,EAAEzO,QAAQ,CAACyO,YAFxB;AAGC1F,oBAAAA,YAAY,EAAE/I,QAAQ,CAAC+I,YAHxB;AAIC2F,oBAAAA,eAAe,EAAE1O,QAAQ,CAAC0O;AAJ3B,mBADO,CADU;AASlBC,kBAAAA,WAAW,EAAG3O,QAAQ,CAAC4O,MAAT,KAAoB3I,SAArB,GAAkC;AAC9C4I,oBAAAA,MAAM,EAAE7O,QAAQ,CAAC4O;AAD6B,mBAAlC,GAET,EAXc;AAYlB1J,kBAAAA,IAAI,EAAE;AACLC,oBAAAA,IAAI,EAAEnF,QAAQ,CAAC8O,QAAT,CAAkBvK,GAAlB,CAAsB,UAAC8E,GAAD,EAAM7E,KAAN;AAAA,6BAAiB;AAC5CuK,wBAAAA,YAAY,EAAE/O,QAAQ,CAACgP,aAAT,CAAuBxK,KAAvB,CAD8B;AAE5CwC,wBAAAA,OAAO,EAAEhH,QAAQ,CAACiP,QAAT,CAAkBzK,KAAlB,CAFmC;AAG5C0K,wBAAAA,IAAI,EAAElP,QAAQ,CAACmP,YAAT,CAAsB3K,KAAtB,CAHsC;AAI5C6E,wBAAAA,GAAG,EAAHA,GAJ4C;AAK5CE,wBAAAA,GAAG,EAAEvJ,QAAQ,CAACoP,SAAT,CAAmB5K,KAAnB,CALuC;AAM5C6K,wBAAAA,KAAK,EAAErP,QAAQ,CAACsP,YAAT,CAAsB9K,KAAtB;AANqC,uBAAjB;AAAA,qBAAtB,CADD;AASL6B,oBAAAA,SAAS,EAAE,mBAAIjC,KAAK,CAAC,KAAKoE,YAAN,CAAT,EAA8BjE,GAA9B,CAAkC,UAACuG,KAAD,EAAQtG,KAAR;AAAA,6BAAmB;AAC/DuK,wBAAAA,YAAY,EAAE/O,QAAQ,CAACgP,aAAT,CAAuBhP,QAAQ,CAAC8O,QAAT,CAAkBpK,MAAlB,GAA2BF,KAAlD,CADiD;AAE/DwC,wBAAAA,OAAO,EAAEhH,QAAQ,CAACiP,QAAT,CAAkBjP,QAAQ,CAAC8O,QAAT,CAAkBpK,MAAlB,GAA2BF,KAA7C,CAFsD;AAG/D0K,wBAAAA,IAAI,EAAElP,QAAQ,CAACmP,YAAT,CAAsBnP,QAAQ,CAAC8O,QAAT,CAAkBpK,MAAlB,GAA2BF,KAAjD,CAHyD;AAI/D6K,wBAAAA,KAAK,EAAErP,QAAQ,CAACsP,YAAT,CAAsBtP,QAAQ,CAAC8O,QAAT,CAAkBpK,MAAlB,GAA2BF,KAAjD;AAJwD,uBAAnB;AAAA,qBAAlC,CATN;AAeL+K,oBAAAA,IAAI,EAAE;AACL/I,sBAAAA,MAAM,EAAExG,QAAQ,CAACwP,iBADZ;AAEL7R,sBAAAA,OAAO,EAAEqC,QAAQ,CAACyP;AAFb;AAfD,mBAZY;AAgClB7E,kBAAAA,OAAO,EAAE;AACR8E,oBAAAA,UAAU,EAAE,CACX;AACCxM,sBAAAA,IAAI,EAAGlD,QAAQ,CAAC2P,UAAT,KAAwB1J,SAAzB,GAAsC,MAAtC,GAA+C,KADtD;AAECyI,sBAAAA,eAAe,EAAE1O,QAAQ,CAAC2P;AAF3B,qBADW;AADJ;AAhCS,iB;;uBA0Cb,KAAKxB,QAAL,CAAc,QAAd,EAAwBI,UAAxB,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOFqB,gBAAAA,M,GAAS,I,EAAMvJ,S,GAAY,E,EAAIzG,M,GAAS,I,EAAMoN,S,GAAY,I;;qBAC1D,KAAKzK,a;;;;;AACR,qBAAKA,aAAL,GAAqB,KAArB,C,CAEA;;;uBACuB,KAAK5C,OAAL,CAAa,KAAb,EAAoB,UAApB,EAAgC;AAAExB,kBAAAA,GAAG,EAAE;AAAP,iBAAhC,C;;;AAAvB,qBAAKkE,Q,kBAAoE7B,M;;sBACrE,KAAK6B,QAAL,IAAiB,IAAjB,IAAyB,KAAKA,QAAL,CAAcwN,KAAd,KAAwB5J,S;;;;;AACpD6J,gBAAAA,OAAO,CAACC,IAAR,CAAa,0EAAb;AACArO,gBAAAA,MAAM,CAACC,kBAAP,GAA4B,IAA5B;AACApG,gBAAAA,aAAa,CAACsG,qBAAd,CAAoC,CAAC,CAArC;;;;sBAGG,KAAKQ,QAAL,CAAcwN,KAAd,GAAsB,C;;;;;;uBACnB,KAAK/O,aAAL,CAAmB,KAAKuB,QAAL,CAAcwN,KAAjC,C;;;;AAKFG,gBAAAA,Q,GAAW,C,EAAGC,O,GAAUxP,MAAM,CAAC6N,IAAP,CAAY5S,mBAAZ,EAAiCgJ,M;uDAC7ChJ,mB;;;;;;;;AAAPyC,gBAAAA,G;;uBACkB,KAAKwB,OAAL,CAAa,KAAb,EAAoB,UAApB,EAAgC;AAAExB,kBAAAA,GAAG,EAAHA,GAAF;AAAO+R,kBAAAA,KAAK,EAAE;AAAd,iBAAhC,C;;;AAApBC,gBAAAA,W;;uBACA,KAAKhC,QAAL,CAAc,QAAd,sBAA2BhQ,GAA3B,EAAiCgS,WAAW,CAAC3P,MAA7C,E;;;AACNjF,gBAAAA,aAAa,CAACsG,qBAAd,CAAqCmO,QAAQ,KAAKC,OAAd,GAAyB,GAA7D;;AAEA,oBAAI9R,GAAG,KAAK,KAAZ,EAAmB;AAClByR,kBAAAA,MAAM,GAAGO,WAAW,CAAC3P,MAArB;AACA,iBAFD,MAEO,IAAIrC,GAAG,KAAK,MAAZ,EAAoB;AAC1BkI,kBAAAA,SAAS,GAAG8J,WAAW,CAAC3P,MAAZ,CAAmB6F,SAA/B;AACA2G,kBAAAA,SAAS,GAAImD,WAAW,CAAC3P,MAAZ,CAAmB2E,IAAnB,CAAwBT,MAAxB,GAAiC,CAAlC,GAAuCyL,WAAW,CAAC3P,MAAZ,CAAmB2E,IAAnB,CAAwB,CAAxB,EAA2BU,YAAlE,GAAiF,IAA7F;AACA,iBAHM,MAGA,IAAI1H,GAAG,KAAK,OAAZ,EAAqB;AAC3ByB,kBAAAA,MAAM,GAAGuQ,WAAW,CAAC3P,MAAZ,CAAmBZ,MAA5B;AACA,uBAAK0C,UAAL,GAAkB6N,WAAW,CAAC3P,MAAZ,CAAmB4P,MAArC;AACA;;;;;;;AAGF7U,gBAAAA,aAAa,CAACsG,qBAAd,CAAoC,CAAC,CAArC;;;;;;;;;uBAIsB,KAAKlC,OAAL,CAAa,KAAb,EAAoB,UAApB,EAAgC;AAAEuQ,kBAAAA,KAAK,EAAE;AAAT,iBAAhC,C;;;AAAjBlQ,gBAAAA,Q;AAAsEqQ,gBAAAA,I,GAAOrQ,QAAQ,CAACQ,MAAT,CAAgB6P,I;AACnGhK,gBAAAA,SAAS,GAAGrG,QAAQ,CAACQ,MAAT,CAAgB0E,IAAhB,CAAqBmB,SAAjC;AACA,uBAAOrG,QAAQ,CAACQ,MAAT,CAAgB6P,IAAvB;AACAzQ,gBAAAA,MAAM,GAAGI,QAAQ,CAACQ,MAAT,CAAgBuE,KAAhB,CAAsBnF,MAA/B;AACAoN,gBAAAA,SAAS,GAAIhN,QAAQ,CAACQ,MAAT,CAAgB0E,IAAhB,CAAqBC,IAArB,CAA0BT,MAA1B,GAAmC,CAApC,GAAyC1E,QAAQ,CAACQ,MAAT,CAAgB0E,IAAhB,CAAqBC,IAArB,CAA0B,CAA1B,EAA6BU,YAAtE,GAAqF,IAAjG,C,CAEA;;AACA,oBAAI,CAAC/J,UAAU,CAAC8D,MAAD,CAAX,IAAuB9D,UAAU,CAAC,KAAKwU,UAAN,CAArC,EAAwD;AACvDtQ,kBAAAA,QAAQ,CAACQ,MAAT,CAAgBgD,GAAhB,CAAoBO,iBAApB,GAAwClI,QAAQ,CAAC,KAAKyU,UAAN,CAAhD;AACAtQ,kBAAAA,QAAQ,CAACQ,MAAT,CAAgBgD,GAAhB,CAAoBQ,iBAApB,GAAyC,KAAKsM,UAAL,KAAoB1U,UAAU,CAAC2U,UAAxE;AACA;;;uBACK,KAAKpC,QAAL,CAAc,QAAd,EAAwBnO,QAAQ,CAACQ,MAAjC,C;;;uDAGU9E,mB;;;;;;;;AAAPyC,gBAAAA,I;;sBACJ,KAAKkE,QAAL,CAAclE,IAAd,MAAuBkS,IAAI,CAAClS,IAAD,C;;;;;;uBACJ,KAAKwB,OAAL,CAAa,KAAb,EAAoB,UAApB,EAAgC;AAAExB,kBAAAA,GAAG,EAAHA,IAAF;AAAO+R,kBAAAA,KAAK,EAAE;AAAd,iBAAhC,C;;;AAApBC,gBAAAA,Y;;uBACA,KAAKhC,QAAL,CAAc,QAAd,sBAA2BhQ,IAA3B,EAAiCgS,YAAW,CAAC3P,MAA7C,E;;;AAEN,oBAAIrC,IAAG,KAAK,KAAZ,EAAmB;AAClByR,kBAAAA,MAAM,GAAGO,YAAW,CAAC3P,MAArB;AACA;;;;;;;sBAKCR,QAAQ,CAACQ,MAAT,CAAgBuE,KAAhB,CAAsBqL,MAAtB,GAA+B,KAAK9N,U;;;;;AACvC,qBAAKC,aAAL,GAAqB,IAArB;AACA,qBAAKjB,YAAL,CAAkBC,OAAlB,CAA0B,UAAAC,IAAI;AAAA,yBAAIA,IAAI,CAAChC,MAAL,CAAY,IAAInD,uBAAJ,EAAZ,CAAJ;AAAA,iBAA9B;AACA,qBAAKiF,YAAL,GAAoB,EAApB,C,CAEA;;;uBACM,KAAK3B,OAAL,CAAa,KAAb,EAAoB,YAApB,EAAkC;AACvCS,kBAAAA,QAAQ,EAAE,KAAKA,QADwB;AAEvCC,kBAAAA,IAAI,EAAElD,SAAS,CAAC,IAAImD,IAAJ,EAAD;AAFwB,iBAAlC,C;;;AAKP,qBAAKgC,UAAL,GAAkBtC,QAAQ,CAACQ,MAAT,CAAgBuE,KAAhB,CAAsBqL,MAAxC,C,CAEA;;sBACI,KAAK/N,QAAL,CAAcwN,KAAd,KAAwBQ,IAAI,CAACR,K;;;;;;uBAC1B,KAAK/O,aAAL,CAAmBuP,IAAI,CAACR,KAAxB,C;;;AAEP,qBAAKxN,QAAL,GAAgBgO,IAAhB;;;sBAIGT,MAAM,IAAI9T,UAAU,CAAC8D,MAAD,C;;;;;AACnB4Q,gBAAAA,a,GAAgB,K;;AACpB,oBAAI,CAAC1U,UAAU,CAAC,KAAKwU,UAAN,CAAf,EAAkC;AACjC,uBAAK5M,MAAL,GAAc,EAAd;AACA8M,kBAAAA,aAAa,GAAG,IAAhB;AACA;;AAEKvE,gBAAAA,O,GAAU5F,SAAS,CAAC9B,GAAV,CAAc,UAAAgC,QAAQ;AAAA,yBAAIA,QAAQ,CAAC2F,WAAb;AAAA,iBAAtB,C;AACVY,gBAAAA,e,GAAmB8C,MAAM,CAACa,IAAP,GAAc,CAAf,GAAqBb,MAAM,CAAC5D,YAAP,GAAsB4D,MAAM,CAACnM,IAAP,CAAYgN,IAAvD,GAA+D,C;AACnF/D,gBAAAA,S,GAAY,K;;AAChB,oBAAI,KAAKhJ,MAAL,CAAYgB,MAAZ,KAAuB,CAA3B,EAA8B;AAC7B;AACA,sBAAIkL,MAAM,CAACxD,KAAP,GAAe,CAAnB,EAAsB;AACrB,yBAAK1I,MAAL,CAAYzE,IAAZ,CAAiB;AAChBkN,sBAAAA,QAAQ,EAAEyD,MAAM,CAACjD,kBADD;AAEhBzB,sBAAAA,MAAM,EAAE0E,MAAM,CAACnM,IAAP,CAAYmJ,gBAFJ;AAGhBlB,sBAAAA,QAAQ,EAAGkE,MAAM,CAACxD,KAAP,KAAiB,CAAlB,GAAuBH,OAAvB,GAAiC,IAH3B;AAIhBa,sBAAAA,eAAe,EAAG8C,MAAM,CAACxD,KAAP,KAAiB,CAAlB,GAAuBU,eAAvB,GAAyC;AAJ1C,qBAAjB;AAMA0D,oBAAAA,aAAa,GAAG,IAAhB,CAPqB,CASrB;;AACA,wBAAIZ,MAAM,CAACxD,KAAP,KAAiB,CAArB,EAAwB;AACvB,2BAAKzI,UAAL,CAAgBwI,QAAhB,GAA2ByD,MAAM,CAACpD,cAAP,GAAwBoD,MAAM,CAACjD,kBAA1D;AACA,2BAAKhJ,UAAL,CAAgBsI,OAAhB,GAA0BA,OAA1B;AACA,2BAAKtI,UAAL,CAAgBmJ,eAAhB,GAAkCA,eAAlC;AACA,2BAAKnJ,UAAL,CAAgBoJ,mBAAhB,GAAsCC,SAAS,GAAG4C,MAAM,CAACnM,IAAP,CAAYmJ,gBAA9D;AACA,2BAAKjJ,UAAL,CAAgBqJ,SAAhB,GAA4BA,SAA5B;AACA,qBAND,MAMO,IAAI4C,MAAM,CAACxD,KAAP,GAAe,KAAK1I,MAAL,CAAYgB,MAAZ,GAAqB,CAAxC,EAA2C;AACjDgI,sBAAAA,SAAS,GAAG,IAAZ;AACA;AACD;AACD,iBAtBD,MAsBO,IAAIkD,MAAM,CAACxD,KAAP,GAAe,KAAK1I,MAAL,CAAYgB,MAAZ,GAAqB,CAAxC,EAA2C;AACjD;AACAgI,kBAAAA,SAAS,GAAG,IAAZ;AACA;;AAED,oBAAIA,SAAJ,EAAe;AACd,sBAAI,KAAK/I,UAAL,CAAgBwI,QAApB,EAA8B;AAC7B;AACA,yBAAKzI,MAAL,CAAYzE,IAAZ,CAAiB;AAChBkN,sBAAAA,QAAQ,EAAEyD,MAAM,CAACzD,QAAP,GAAkB,KAAKxI,UAAL,CAAgBwI,QAD5B;AAEhBjB,sBAAAA,MAAM,EAAE,KAAKvH,UAAL,CAAgBoJ,mBAAhB,GAAsC,KAAKpJ,UAAL,CAAgBoJ,mBAAtD,GAA4E,KAAKpJ,UAAL,CAAgBC,WAFpF;AAGhB8H,sBAAAA,QAAQ,EAAEO,OAAO,CAChB1H,GADS,CACL,UAACsI,MAAD,EAASrI,KAAT;AAAA,+BAAmBqI,MAAM,GAAG,MAAI,CAAClJ,UAAL,CAAgBsI,OAAhB,CAAwBzH,KAAxB,CAA5B;AAAA,uBADK,EAET9E,MAFS,CAEF,UAACoL,KAAD,EAAQtG,KAAR;AAAA,+BAAkByH,OAAO,CAACzH,KAAD,CAAP,GAAiB,CAAnC;AAAA,uBAFE,CAHM;AAMhBsI,sBAAAA,eAAe,EAAEA,eAAe,GAAG,KAAKnJ,UAAL,CAAgBmJ;AANnC,qBAAjB;AAQA0D,oBAAAA,aAAa,GAAG,IAAhB;AACA,mBAXD,MAWO;AACN;AACMtD,oBAAAA,WAFA,GAEc,CAAC0C,MAAM,CAACzD,QAAP,GAAkByD,MAAM,CAACpD,cAAzB,GAA0CoD,MAAM,CAACjD,kBAAjD,GAAsEiD,MAAM,CAACtD,SAA9E,KAA4FsD,MAAM,CAACxD,KAAP,GAAe,CAA3G,CAFd;;AAGN,yBAASA,KAAT,GAAiB,KAAK1I,MAAL,CAAYgB,MAA7B,EAAqC0H,KAAK,GAAG,CAAR,GAAYwD,MAAM,CAACxD,KAAxD,EAA+DA,KAAK,EAApE,EAAwE;AACvE,2BAAK1I,MAAL,CAAYzE,IAAZ,CAAiB;AAAEkN,wBAAAA,QAAQ,EAAEe;AAAZ,uBAAjB;AACAsD,sBAAAA,aAAa,GAAG,IAAhB;AACA;AACD,mBAnBa,CAqBd;;;AACA,sBAAIA,aAAJ,EAAmB;AAClB,yBAAK7M,UAAL,CAAgBwI,QAAhB,GAA2ByD,MAAM,CAACzD,QAAlC;AACA,yBAAKxI,UAAL,CAAgBsI,OAAhB,GAA0BA,OAA1B;AACA,yBAAKtI,UAAL,CAAgBmJ,eAAhB,GAAkCA,eAAlC;AACA,yBAAKnJ,UAAL,CAAgBoJ,mBAAhB,GAAsCC,SAAS,GAAG,KAAKrJ,UAAL,CAAgBqJ,SAAlE;AACA,yBAAKrJ,UAAL,CAAgBqJ,SAAhB,GAA4BA,SAA5B;AACA;AACD;;qBAEGwD,a;;;;;;uBACG,KAAKrC,QAAL,CAAc,QAAd,EAAwB;AAC7B3K,kBAAAA,GAAG,EAAE;AACJE,oBAAAA,MAAM,EAAE,KAAKA;AADT;AADwB,iBAAxB,C;;;AAQR;AACA,qBAAK4M,UAAL,GAAkB1Q,MAAlB;AACA,qBAAKsC,cAAL;;;;;;;;;;;;;;;;;;;;;;;;AAIA,qBAAKhB,eAAL,GAAuB,IAAvB;;;sBAEK,CAACQ,MAAM,CAACC,kBAAR,IAA8B,KAAKC,QAAL,IAAiB,C;;;;;;uBAE5C,KAAK8O,eAAL,E;;;;;;;;uBAGA,KAAKtN,gBAAL,E;;;;;;;;;AAGP0M,gBAAAA,OAAO,CAACC,IAAR;;uBACM,KAAK5B,QAAL,CAAc,mBAAd,e;;;;;;;;;;;;;;;;;;qCAIS;AAChB,UAAI,CAAC,KAAKjN,eAAV,EAA2B;AAC1B,aAAKA,eAAL,GAAuBH,UAAU,CAAC,KAAK4P,QAAL,CAAcC,IAAd,CAAmB,IAAnB,CAAD,EAA2B,KAAKzR,QAAL,CAAc0R,cAAzC,CAAjC;AACA;AACD;;;;gGAEcrP,I;;;;;;;;;;uBACS,KAAK7B,OAAL,CAAa,KAAb,EAAoB,UAApB,EAAgC;AAAEmR,kBAAAA,KAAK,EAAEtP;AAAT,iBAAhC,C;;;AAAjBxB,gBAAAA,Q;;oBACAA,QAAQ,YAAYS,M;;;;;AACzBqP,gBAAAA,OAAO,CAACC,IAAR,+CAAoDjQ,IAAI,CAACiR,SAAL,CAAe/Q,QAAf,CAApD;sBACM,IAAInD,iBAAJ,E;;;sBAEHmD,QAAQ,CAACgR,IAAT,KAAkB,C;;;;;sBACf,IAAIlU,eAAJ,E;;;AAGHmU,gBAAAA,Q,GAAW,K;AACNpF,gBAAAA,C,GAAI,C;;;sBAAGA,CAAC,GAAGrK,IAAI,CAACkD,M;;;;;qBACpBuM,Q;;;;;AACHA,gBAAAA,QAAQ,GAAIzP,IAAI,CAACqK,CAAD,CAAJ,KAAY,GAAxB;;;;;sBACUrK,IAAI,CAACqK,CAAD,CAAJ,KAAY,G;;;;;AACtBoF,gBAAAA,QAAQ,GAAG,IAAX;;;;;sBAEIzP,IAAI,CAACqK,CAAD,CAAJ,KAAY,G;;;;;kDACR,E;;;sBAGJrK,IAAI,CAACqK,CAAD,CAAJ,KAAY,GAAZ,IAAmBrK,IAAI,CAACqK,CAAD,CAAJ,KAAY,IAA/B,IAAuCrK,IAAI,CAACqK,CAAD,CAAJ,KAAY,IAAnD,IAA2DrK,IAAI,KAAK,I;;;;;;AACvE,sBAAMF,YAAY,GAAG,MAAI,CAACA,YAA1B;AAAA,sBAAwC8M,GAAG,GAAG,MAAI,CAACvN,OAAnD;AACA;AAAA,uBAAO,IAAIvB,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV;AAAA,6BAAqB8B,YAAY,CAACrC,IAAb,CAAkB;AAAEmP,wBAAAA,GAAG,EAAHA,GAAF;AAAO7O,wBAAAA,OAAO,EAAPA,OAAP;AAAgBC,wBAAAA,MAAM,EAANA;AAAhB,uBAAlB,CAArB;AAAA,qBAAZ;AAAP;;;;;;;;;;;AAZ8BqM,gBAAAA,CAAC,E;;;;;;;;;;;;;;;;;;;;;qGAkBfuC,G;;;;;;;uBACI,KAAKzO,OAAL,CAAa,KAAb,EAAoB,UAApB,EAAgC,KAAK/B,cAArC,EAAqD,MAArD,C;;;AAAjBoC,gBAAAA,Q;AACA6P,gBAAAA,K,GAAQ7P,QAAQ,CAACkR,IAAT,E,EAEd;AACA;;AAEA,oBAAI,CAAC,KAAK5P,YAAL,CAAkBoD,MAAvB,EAA+B;AAC9B;AACA,uBAAKyJ,QAAL,CAAc,iBAAd,EAAiC;AAAE3M,oBAAAA,IAAI,EAAEyE,SAAR;AAAmB4J,oBAAAA,KAAK,EAALA;AAAnB,mBAAjC;AACA,iBAHD,MAGO;AACN;AACA,uBAAKvO,YAAL,CAAkBC,OAAlB,CAA0B,UAASC,IAAT,EAAe;AACxC,wBAAIA,IAAI,CAAC4M,GAAL,GAAWA,GAAf,EAAoB;AACnB5M,sBAAAA,IAAI,CAACjC,OAAL,CAAasQ,KAAb;AACA,2BAAK1B,QAAL,CAAc,iBAAd,EAAiC;AAAE3M,wBAAAA,IAAI,EAAJA,IAAF;AAAQqO,wBAAAA,KAAK,EAALA;AAAR,uBAAjC;AACA;AACD,mBALD,EAKG,IALH;AAMA,uBAAKvO,YAAL,GAAoB,KAAKA,YAAL,CAAkB5B,MAAlB,CAAyB,UAAA8B,IAAI;AAAA,2BAAIA,IAAI,CAAC4M,GAAL,IAAYA,GAAhB;AAAA,mBAA7B,CAApB;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;AAGatQ,gBAAAA,Q,QAAAA,Q,EAAUqT,O,QAAAA,O,+BAAStT,iB,EAAAA,iB,sCAAoB,I,0BAAMH,U,QAAAA,U;AAC3D;AACM0T,gBAAAA,O,GAAWD,OAAO,YAAYE,IAApB,GAA6BF,OAA7B,GAAuC,IAAIE,IAAJ,CAAS,CAACF,OAAD,CAAT,C;AACjD5T,gBAAAA,M,GAAS;AACd+J,kBAAAA,IAAI,EAAExJ,QADQ;AAEduC,kBAAAA,IAAI,EAAElD,SAAS,CAACgU,OAAO,CAACG,YAAR,GAAuB,IAAIhR,IAAJ,CAAS6Q,OAAO,CAACG,YAAjB,CAAvB,GAAwD,IAAIhR,IAAJ,EAAzD;AAFD,iB,EAKf;;qBACI,KAAKnB,QAAL,CAAcoS,U;;;;;;uBACM,IAAIjS,OAAJ,CAAY,UAASC,OAAT,EAAkB;AACpD,sBAAMiS,UAAU,GAAG,IAAIC,UAAJ,EAAnB;;AACAD,kBAAAA,UAAU,CAAC/R,MAAX,GAAoB,UAASf,CAAT,EAAW;AAC9B,wBAAM8B,MAAM,GAAGlF,KAAK,CAACoD,CAAC,CAACgT,MAAF,CAASlR,MAAV,CAApB;AACAjB,oBAAAA,OAAO,CAACiB,MAAD,CAAP;AACA,mBAHD;;AAIAgR,kBAAAA,UAAU,CAACG,iBAAX,CAA6BP,OAA7B;AACA,iBAPsB,C;;;AAAjBQ,gBAAAA,Q;AASNrU,gBAAAA,MAAM,CAACjC,KAAP,GAAesW,QAAQ,CAACC,QAAT,CAAkB,EAAlB,CAAf;;;;uBAIsB,KAAKlS,OAAL,CAAa,MAAb,EAAqB,WAArB,EAAkCpC,MAAlC,EAA0C,MAA1C,EAAkD6T,OAAlD,EAA2D1T,UAA3D,EAAuE,CAAvE,EAA0EG,iBAA1E,EAA6FC,QAA7F,C;;;AAAjBkC,gBAAAA,Q;;sBACFA,QAAQ,CAACU,GAAT,KAAiB,C;;;;;sBACd,IAAIpE,oBAAJ,eAAgC0D,QAAQ,CAACU,GAAzC,E;;;AAGP;AACA,qBAAKyN,QAAL,CAAc,gBAAd,EAAgC;AAAErQ,kBAAAA,QAAQ,EAARA,QAAF;AAAYqT,kBAAAA,OAAO,EAAPA;AAAZ,iBAAhC;;;;;;;;;;;;;;;;;;;gGAGYrT,Q;;;;;;;uBACW,KAAK6B,OAAL,CAAa,KAAb,EAAoB,WAApB,EAAiC;AAAE2H,kBAAAA,IAAI,EAAExJ;AAAR,iBAAjC,EAAqD,MAArD,EAA6D,IAA7D,EAAmE,IAAnE,EAAyE,KAAKF,cAA9E,EAA8F,IAA9F,EAAoGE,QAApG,C;;;AAAjBkC,gBAAAA,Q;;sBACFA,QAAQ,CAACU,GAAT,KAAiB,C;;;;;sBACd,IAAIpE,oBAAJ,eAAgC0D,QAAQ,CAACU,GAAzC,E;;;;uBAGD,KAAKyN,QAAL,CAAc,0BAAd,EAA0CrQ,QAA1C,C;;;;;;;;;;;;;;;;;;;;;;;;;;AAGMgU,gBAAAA,I,SAAAA,I,EAAMC,E,SAAAA,E,sBAAIC,K,EAAAA,K,4BAAQ,K,qCAAOC,M,EAAAA,M,6BAAS,K;;uBACvB,KAAKtS,OAAL,CAAa,KAAb,EAAoB,SAApB,EAA+B;AACrDuS,kBAAAA,GAAG,EAAEJ,IADgD;AAErDK,kBAAAA,GAAG,EAAEJ,EAFgD;AAGrDK,kBAAAA,cAAc,EAAEJ,KAAK,GAAG,KAAH,GAAW;AAHqB,iBAA/B,EAIpB,MAJoB,EAIZ,IAJY,EAIN,IAJM,EAIA,KAAKpU,cAJL,EAIqB,IAJrB,EAI2BkU,IAJ3B,C;;;AAAjB9R,gBAAAA,Q;;oBAMDiS,M;;;;;sBACAjS,QAAQ,CAACU,GAAT,KAAiB,C;;;;;sBACd,IAAIpE,oBAAJ,eAAgC0D,QAAQ,CAACU,GAAzC,E;;;;uBAGD,KAAKyN,QAAL,CAAc,wBAAd,EAAwC;AAAE2D,kBAAAA,IAAI,EAAJA,IAAF;AAAQC,kBAAAA,EAAE,EAAFA,EAAR;AAAYC,kBAAAA,KAAK,EAALA;AAAZ,iBAAxC,C;;;;;;;;;;;;;;;;;;;sGAIYK,S;;;;;;;uBACI,KAAK1S,OAAL,CAAa,KAAb,EAAoB,UAApB,EAAgC;AAAE2S,kBAAAA,GAAG,EAAED;AAAP,iBAAhC,C;;;AAAjBrS,gBAAAA,Q;;sBACFA,QAAQ,CAACU,GAAT,KAAiB,C;;;;;sBACd,IAAIpE,oBAAJ,eAAgC0D,QAAQ,CAACU,GAAzC,E;;;;uBAGD,KAAKyN,QAAL,CAAc,oBAAd,EAAoCkE,SAApC,C;;;;;;;;;;;;;;;;;;;iGAGQjB,O;;;;;;AACRtT,gBAAAA,Q,GAAYsT,OAAO,YAAY3Q,MAApB,GAA8B2Q,OAAO,CAACtT,QAAtC,GAAiDsT,O;AAC5DlO,gBAAAA,I,GAAQkO,OAAO,YAAY3Q,MAAnB,IAA6B2Q,OAAO,CAAClO,IAAR,KAAiB+C,SAA/C,GAA4DmL,OAAO,CAAClO,IAApE,GAA2E,M;AAClFxF,gBAAAA,U,GAAc0T,OAAO,YAAY3Q,MAApB,GAA8B2Q,OAAO,CAAC1T,UAAtC,GAAmDuI,S;AAChEpI,gBAAAA,iB,GAAqBuT,OAAO,YAAY3Q,MAAnB,IAA6B2Q,OAAO,CAACvT,iBAAtC,GAA2DuT,OAAO,CAACvT,iBAAnE,GAAuF,I;;uBAE1F,KAAK8B,OAAL,CAAa,KAAb,EAAoB,aAApB,EAAmC;AAAE2H,kBAAAA,IAAI,EAAExJ;AAAR,iBAAnC,EAAuDoF,IAAvD,EAA6D,IAA7D,EAAmExF,UAAnE,EAA+E,CAA/E,EAAkFG,iBAAlF,EAAqGC,QAArG,C;;;AAAjBkC,gBAAAA,Q;AAEN,qBAAKmO,QAAL,CAAc,kBAAd,EAAkC;AAAErQ,kBAAAA,QAAQ,EAARA,QAAF;AAAYqT,kBAAAA,OAAO,EAAEnR;AAArB,iBAAlC;mDACOA,Q;;;;;;;;;;;;;;;;;;;oGAGUqS,S;;;;;;AACbE,gBAAAA,Q,GAAW,E,EAAIC,I,GAAO,C;;;;uBAEF,KAAK7S,OAAL,CAAa,KAAb,EAAoB,aAApB,EAAmC;AAAE2S,kBAAAA,GAAG,EAAED,SAAP;AAAkBI,kBAAAA,KAAK,EAAED;AAAzB,iBAAnC,C;;;AAAjBxS,gBAAAA,Q;;sBACFA,QAAQ,CAACU,GAAT,KAAiB,C;;;;;sBACd,IAAIjE,mBAAJ,E;;;sBACIuD,QAAQ,CAACU,GAAT,KAAiB,C;;;;;sBACrB,IAAInE,sBAAJ,CAA2B8V,SAA3B,C;;;AAGPE,gBAAAA,QAAQ,GAAGA,QAAQ,CAACpL,MAAT,CAAgBnH,QAAQ,CAAC0S,KAAzB,CAAX;AACAF,gBAAAA,IAAI,GAAGxS,QAAQ,CAACwS,IAAhB;;;oBACQA,IAAI,KAAK,C;;;;;;mDAEXD,QAAQ,CAAChO,GAAT,CAAa,UAAAoO,IAAI;AAAA,yBAAK;AAC5BC,oBAAAA,WAAW,EAAED,IAAI,CAACzP,IAAL,KAAc,GADC;AAE5BoE,oBAAAA,IAAI,EAAEqL,IAAI,CAACrL,IAFiB;AAG5BmJ,oBAAAA,IAAI,EAAGkC,IAAI,CAACzP,IAAL,KAAc,GAAf,GAAsB,IAAtB,GAA6ByP,IAAI,CAAClC,IAHZ;AAI5Ba,oBAAAA,YAAY,EAAEpU,SAAS,CAACyV,IAAI,CAACE,IAAN;AAJK,mBAAL;AAAA,iBAAjB,C;;;;;;;;;;;;;;;;;;;oGAQU/U,Q;;;;;;;uBACM,KAAK6B,OAAL,CAAa,KAAb,EAAoB,aAApB,EAAmC7B,QAAQ,GAAG;AAAEwJ,kBAAAA,IAAI,EAAExJ;AAAR,iBAAH,GAAwB,EAAnE,EAAuE,MAAvE,EAA+E,IAA/E,EAAqF,IAArF,EAA2F,KAAKkE,cAAhG,EAAgH,IAAhH,EAAsHlE,QAAtH,C;;;AAAjBkC,gBAAAA,Q;;qBACFA,QAAQ,CAACU,G;;;;;sBACN,IAAIpE,oBAAJ,eAAgC0D,QAAQ,CAACU,GAAzC,E;;;AAGP,uBAAOV,QAAQ,CAACU,GAAhB;mDACO,IAAIzE,cAAJ,CAAmB+D,QAAnB,C;;;;;;;;;;;;;;;;;;;EAhlCkCzE,a;;SAAtB6B,a","sourcesContent":["// Polling connector for RepRapFirmware\r\n'use strict'\r\n\r\nimport crc32 from 'turbo-crc32/crc32'\r\n\r\nimport BaseConnector, { defaultRequestTimeout } from './BaseConnector.js'\r\nimport { getBoardDefinition } from '../boards.js'\r\nimport { DefaultMachineModel } from '../model.js'\r\nimport { HeaterState, StatusType, isPaused, isPrinting } from '../modelEnums.js'\r\nimport { BeepRequest, MessageBox, ParsedFileInfo } from '../modelItems.js'\r\n\r\nimport {\r\n\tNetworkError, DisconnectedError, TimeoutError, OperationCancelledError, OperationFailedError,\r\n\tDirectoryNotFoundError, FileNotFoundError, DriveUnmountedError,\r\n\tLoginError, InvalidPasswordError, NoFreeSessionError,\r\n\tCodeResponseError, CodeBufferError\r\n} from '../../../utils/errors.js'\r\nimport { arraySizesDiffer, quickPatch } from '../../../utils/patch.js'\r\nimport { bitmapToArray } from '../../../utils/numbers.js'\r\nimport { strToTime, timeToStr } from '../../../utils/time.js'\r\n\r\nexport default class PollConnector extends BaseConnector {\r\n\tstatic async connect(hostname, username, password) {\r\n\t\tconst response = await BaseConnector.request('GET', `${location.protocol}//${hostname}/rr_connect`, {\r\n\t\t\tpassword,\r\n\t\t\ttime: timeToStr(new Date())\r\n\t\t});\r\n\r\n\t\tswitch (response.err) {\r\n\t\t\tcase 0:\r\n\t\t\t\tif (!window.forceLegacyConnect && response.apiLevel > 0) {\r\n\t\t\t\t\t// Don't hide the connection dialog while the full model is being loaded...\r\n\t\t\t\t\tBaseConnector.setConnectingProgress(0);\r\n\t\t\t\t}\r\n\t\t\t\treturn new PollConnector(hostname, password, response);\r\n\t\t\tcase 1: throw new InvalidPasswordError();\r\n\t\t\tcase 2: throw new NoFreeSessionError();\r\n\t\t\tdefault: throw new LoginError(`Unknown err value: ${response.err}`)\r\n\t\t}\r\n\t}\r\n\r\n\tsessionTimeout = 8000\t\t// ms\r\n\tjustConnected = true\r\n\tname = null\r\n\tpassword = null\r\n\tboardType = null\r\n\tapiLevel = 0\r\n\r\n\trequestBase = ''\r\n\trequestTimeout = defaultRequestTimeout\r\n\trequests = []\r\n\r\n\trequest(method, url, params = null, responseType = 'json', body = null, onProgress = null, timeout = this.requestTimeout, cancellationToken = null, filename = 'n/a', retry = 0) {\r\n\t\tlet internalURL = this.requestBase + url;\r\n\t\tif (params) {\r\n\t\t\tlet hadParam = false;\r\n\t\t\tfor (let key in params) {\r\n\t\t\t\tinternalURL += (hadParam ? '&' : '?') + key + '=' + encodeURIComponent(params[key]);\r\n\t\t\t\thadParam = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst xhr = new XMLHttpRequest();\r\n\t\txhr.open(method, internalURL);\r\n\t\tif (responseType === 'json') {\r\n\t\t\txhr.responseType = 'text';\r\n\t\t\txhr.setRequestHeader('Content-Type', 'application/json');\r\n\t\t} else {\r\n\t\t\txhr.responseType = responseType;\r\n\t\t}\r\n\t\tif (onProgress) {\r\n\t\t\txhr.onprogress = function(e) {\r\n\t\t\t\tif (e.loaded && e.total) {\r\n\t\t\t\t\tonProgress(e.loaded, e.total);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\txhr.upload.onprogress = xhr.onprogress;\r\n\t\t}\r\n\t\txhr.timeout = timeout;\r\n\t\tif (cancellationToken) {\r\n\t\t\tcancellationToken.cancel = () => xhr.abort();\r\n\t\t}\r\n\t\tthis.requests.push(xhr);\r\n\r\n\t\tconst maxRetries = this.settings.ajaxRetries, that = this;\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\txhr.onload = function() {\r\n\t\t\t\tthat.requests = that.requests.filter(request => request !== xhr);\r\n\t\t\t\tif (xhr.status >= 200 && xhr.status < 300) {\r\n\t\t\t\t\tif (responseType === 'json') {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tif (!xhr.responseText) {\r\n\t\t\t\t\t\t\t\tresolve(null);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tresolve(JSON.parse(xhr.responseText));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\treject(e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresolve(xhr.response);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (xhr.status === 401) {\r\n\t\t\t\t\t// User might have closed another tab or the firmware restarted, which can cause\r\n\t\t\t\t\t// the current session to be terminated. Try to send another rr_connect request\r\n\t\t\t\t\t// with the last-known password and retry the pending request if that succeeds\r\n\t\t\t\t\tBaseConnector.request('GET', `${location.protocol}//${that.hostname}/rr_connect`, {\r\n\t\t\t\t\t\t\tpassword: that.password,\r\n\t\t\t\t\t\t\ttime: timeToStr(new Date())\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.then(function(result) {\r\n\t\t\t\t\t\t\tif (result instanceof Object && result.err === 0) {\r\n\t\t\t\t\t\t\t\tthat.request(method, url, params, responseType, body, onProgress, timeout, cancellationToken, filename)\r\n\t\t\t\t\t\t\t\t\t.then(result => resolve(result))\r\n\t\t\t\t\t\t\t\t\t.catch(error => reject(error));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\treject(new InvalidPasswordError());\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.catch(error => reject(error));\r\n\t\t\t\t} else if (xhr.status === 404) {\r\n\t\t\t\t\treject(new FileNotFoundError(filename));\r\n\t\t\t\t} else if (xhr.status === 503) {\r\n\t\t\t\t\tif (retry < maxRetries) {\r\n\t\t\t\t\t\t// RRF may have run out of output buffers. We usually get here when a code reply is blocking\r\n\t\t\t\t\t\tif (retry === 0) {\r\n\t\t\t\t\t\t\tthat.lastSeq++;\r\n\t\t\t\t\t\t\tthat.getGCodeReply(that.lastSeq)\r\n\t\t\t\t\t\t\t\t.then(function() {\r\n\t\t\t\t\t\t\t\t\t// Retry the original request when the code reply has been received\r\n\t\t\t\t\t\t\t\t\tthat.request(method, url, params, responseType, body, onProgress, timeout, cancellationToken, filename, retry + 1)\r\n\t\t\t\t\t\t\t\t\t\t.then(result => resolve(result))\r\n\t\t\t\t\t\t\t\t\t\t.catch(error => reject(error));\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.catch(error => reject(error));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Retry the original request after a while\r\n\t\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\t\tthat.request(method, url, params, responseType, body, onProgress, timeout, cancellationToken, filename, retry + 1)\r\n\t\t\t\t\t\t\t\t\t.then(result => resolve(result))\r\n\t\t\t\t\t\t\t\t\t.catch(error => reject(error));\r\n\t\t\t\t\t\t\t}, 2000);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treject(new OperationFailedError(xhr.responseText || xhr.statusText));\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (xhr.status >= 500) {\r\n\t\t\t\t\treject(new OperationFailedError(xhr.responseText || xhr.statusText));\r\n\t\t\t\t} else if (xhr.status !== 0) {\r\n\t\t\t\t\treject(new OperationFailedError());\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\txhr.onabort = function() {\r\n\t\t\t\tthat.requests = that.requests.filter(request => request !== xhr);\r\n\t\t\t\treject(that.updateLoopTimer ? new OperationCancelledError() : new DisconnectedError());\r\n\t\t\t}\r\n\t\t\txhr.onerror = function() {\r\n\t\t\t\tthat.requests = that.requests.filter(request => request !== xhr);\r\n\t\t\t\tif (retry < maxRetries) {\r\n\t\t\t\t\t// Unreliable connection, retry if possible\r\n\t\t\t\t\tthat.request(method, url, params, responseType, body, onProgress, timeout, cancellationToken, filename, retry + 1)\r\n\t\t\t\t\t\t.then(result => resolve(result))\r\n\t\t\t\t\t\t.catch(error => reject(error));\r\n\t\t\t\t} else {\r\n\t\t\t\t\treject(new NetworkError());\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\txhr.ontimeout = function () {\r\n\t\t\t\tthat.requests = that.requests.filter(request => request !== xhr);\r\n\t\t\t\tif (retry < maxRetries) {\r\n\t\t\t\t\t// Request has timed out, retry if possible\r\n\t\t\t\t\tthat.request(method, url, params, responseType, body, onProgress, timeout, cancellationToken, filename, retry + 1)\r\n\t\t\t\t\t\t.then(result => resolve(result))\r\n\t\t\t\t\t\t.catch(error => reject(error));\r\n\t\t\t\t} else {\r\n\t\t\t\t\treject(new TimeoutError());\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\txhr.send(body);\r\n\t\t});\r\n\t}\r\n\r\n\tcancelRequests() {\r\n\t\tthis.pendingCodes.forEach(code => code.reject(new DisconnectedError()));\r\n\t\tthis.pendingCodes = [];\r\n\t\tthis.requests.forEach(request => request.abort());\r\n\t\tthis.requests = [];\r\n\t}\r\n\r\n\tconstructor(hostname, password, responseData) {\r\n\t\tsuper('poll', hostname);\r\n\t\tthis.password = password;\r\n\t\tthis.boardType = responseData.boardType;\r\n\t\tthis.requestBase = `${location.protocol}//${hostname}/`;\r\n\t\tthis.sessionTimeout = responseData.sessionTimeout;\r\n\t\tthis.apiLevel = responseData.apiLevel || 0;\r\n\t}\r\n\r\n\tregister(module) {\r\n\t\tsuper.register(module);\r\n\t\tthis.requestTimeout = this.sessionTimeout / (this.settings.ajaxRetries + 1)\r\n\r\n\t\t// Ideally we should be using a ServiceWorker here which would allow us to send push\r\n\t\t// notifications even while DWC2 is running in the background. However, we cannot do\r\n\t\t// this because ServiceWorkers require secured HTTP connections, which are no option\r\n\t\t// for standard end-users. That is also the reason why they are disabled in the build\r\n\t\t// script, which by default is used for improved caching\r\n\t\tthis.scheduleUpdate();\r\n\t}\r\n\r\n\tasync reconnect() {\r\n\t\t// Cancel pending requests and reset the last 'seq' field\r\n\t\t// so that the last G-code reply is queried again\r\n\t\tthis.cancelRequests();\r\n\t\tthis.lastStatusResponse = {};\r\n\t\tthis.lastSeq = 0;\r\n\t\tthis.lastSeqs = {}\r\n\t\tthis.lastUptime = 0\r\n\r\n\t\t// Attempt to reconnect\r\n\t\tconst response = await BaseConnector.request('GET', `${location.protocol}//${this.hostname}/rr_connect`, {\r\n\t\t\tpassword: this.password,\r\n\t\t\ttime: timeToStr(new Date())\r\n\t\t});\r\n\r\n\t\tswitch (response.err) {\r\n\t\t\tcase 0:\r\n\t\t\t\tthis.justConnected = true;\r\n\t\t\t\tthis.boardType = response.boardType;\r\n\t\t\t\tthis.sessionTimeout = response.sessionTimeout;\r\n\t\t\t\tthis.requestTimeout = response.sessionTimeout / (this.settings.ajaxRetries + 1);\r\n\t\t\t\tthis.apiLevel = response.apiLevel || 0;\r\n\t\t\t\tthis.scheduleUpdate();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\t// Bad password\r\n\t\t\t\tthrow new InvalidPasswordError();\r\n\t\t\tcase 2:\r\n\t\t\t\t// No free session available\r\n\t\t\t\tthrow new NoFreeSessionError();\r\n\t\t\tdefault:\r\n\t\t\t\t// Generic login error\r\n\t\t\t\tthrow new LoginError(`Unknown err value: ${response.err}`);\r\n\t\t}\r\n\t}\r\n\r\n\tasync disconnect() {\r\n\t\tawait this.request('GET', 'rr_disconnect');\r\n\t}\r\n\r\n\tunregister() {\r\n\t\tthis.cancelRequests();\r\n\t\tif (this.updateLoopTimer) {\r\n\t\t\tclearTimeout(this.updateLoopTimer);\r\n\t\t\tthis.updateLoopTimer = null;\r\n\t\t}\r\n\t\tsuper.unregister();\r\n\t}\r\n\r\n\tupdateLoopTimer = null\r\n\tupdateLoopCounter = 1\r\n\tlastStatusResponse = {}\r\n\tlastSeq = 0\r\n\r\n\tpendingCodes = []\r\n\tlayers = []\r\n\tcurrentFileInfo = new ParsedFileInfo()\r\n\tprintStats = {}\r\n\tprobeType = 0\r\n\tnumExtruders = 0\r\n\r\n\tasync updateLoopStatus(requestExtendedStatus = false) {\r\n\t\trequestExtendedStatus |= this.justConnected ||\r\n\t\t\t(this.updateLoopCounter % this.settings.extendedUpdateEvery) === 0 ||\r\n\t\t\t(this.verbose && (this.updateLoopCounter % 2) === 0);\r\n\r\n\t\t// Decide which type of status update to poll and request it\r\n\t\tconst wasPrinting = ['D', 'S', 'R', 'P', 'M'].indexOf(this.lastStatusResponse.status) !== -1;\r\n\t\tconst wasSimulating = this.lastStatusResponse.status === 'M', wasPaused = this.lastStatusResponse.status === 'P';\r\n\t\tconst statusType = requestExtendedStatus ? 2 : (wasPrinting ? 3 : 1);\r\n\t\tconst response = await this.request('GET', 'rr_status', { type: statusType });\r\n\t\tconst isPrinting = ['D', 'S', 'R', 'P', 'M'].indexOf(response.status) !== -1;\r\n\t\tconst newData = {};\r\n\r\n\t\t// Check if an extended status response needs to be polled in case machine parameters have changed\r\n\t\tif (!requestExtendedStatus && arraySizesDiffer(response, this.lastStatusResponse)) {\r\n\t\t\tawait this.updateLoopStatus(true);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Retrieve job file information if a print has started or set info about the last job if it has finished\r\n\t\tif (isPrinting) {\r\n\t\t\tif (this.justConnected || !wasPrinting) {\r\n\t\t\t\tthis.currentFileInfo = await this.getFileInfo();\r\n\t\t\t\tdelete this.currentFileInfo.printDuration;\r\n\r\n\t\t\t\tquickPatch(newData, {\r\n\t\t\t\t\tjob: {\r\n\t\t\t\t\t\tfile: this.currentFileInfo,\r\n\t\t\t\t\t\tlayers: []\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.layers = [];\r\n\t\t\t\tthis.printStats = {\r\n\t\t\t\t\tlayerHeight: this.currentFileInfo.layerHeight\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t} else if (wasPrinting) {\r\n\t\t\tquickPatch(newData, {\r\n\t\t\t\tjob: {\r\n\t\t\t\t\tlastFileName: this.currentFileInfo.fileName,\r\n\t\t\t\t\tlastFileCancelled: wasPaused,\r\n\t\t\t\t\tlastFileSimulated: wasSimulating\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Standard Status Response\r\n\t\tconst fanRPMs = (response.sensors.fanRPM instanceof Array) ? response.sensors.fanRPM : [response.sensors.fanRPM];\r\n\t\tquickPatch(newData, {\r\n\t\t\tfans: response.params.fanPercent.map((fanPercent, index) => ({\r\n\t\t\t\trpm: (index < fanRPMs.length) ? fanRPMs[index] : -1,\r\n\t\t\t\tvalue: fanPercent / 100\r\n\t\t\t})),\r\n\t\t\theat: {\r\n\t\t\t\theaters: response.temps.state.map((state, sensor) => ({ state: this.convertHeaterState(state), sensor }), this)\r\n\t\t\t},\r\n\t\t\tmove: {\r\n\t\t\t\taxes: response.coords.xyz.map((position, drive) => ({\r\n\t\t\t\t\tdrives: [drive],\r\n\t\t\t\t\thomed: Boolean(response.coords.axesHomed[drive]),\r\n\t\t\t\t\tmachinePosition: (position === 9999) ? null : position,\r\n\t\t\t\t\tuserPosition: (position === 9999) ? null : position\r\n\t\t\t\t})),\r\n\t\t\t\tcurrentMove: {\r\n\t\t\t\t\trequestedSpeed: (response.speeds !== undefined) ? response.speeds.requested : null,\r\n\t\t\t\t\ttopSpeed: (response.speeds !== undefined) ? response.speeds.top : null\r\n\t\t\t\t},\r\n\t\t\t\textruders: response.coords.extr.map((position, extruder) => ({\r\n\t\t\t\t\tdrives: [response.coords.xyz.length + extruder],\r\n\t\t\t\t\tfactor: response.params.extrFactors[extruder] / 100,\r\n\t\t\t\t\tposition: position\r\n\t\t\t\t})),\r\n\t\t\t\tspeedFactor: response.params.speedFactor / 100,\r\n\t\t\t\tworkspaceNumber: (response.wpl !== undefined) ? response.wpl : 1\r\n\t\t\t},\r\n\t\t\tscanner: (response.scanner) ? {\r\n\t\t\t\tprogress: response.scanner.progress,\r\n\t\t\t\tstatus: response.scanner.status\r\n\t\t\t} : {},\r\n\t\t\tsensors: {\r\n\t\t\t\tanalog: response.temps.current.map((lastReading, number) => ({ lastReading, number }))\r\n\t\t\t\t\t\t.concat(response.temps.extra.map(extra => ({\r\n\t\t\t\t\t\t\tlastReading: (extra.temp === 9999) ? null : extra.temp,\r\n\t\t\t\t\t\t\tname: extra.name\r\n\t\t\t\t\t\t}))),\r\n\t\t\t\tprobes: (this.probeType !== 0) ? [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvalue: [response.sensors.probeValue].concat(response.sensors.probeSecondary ? response.sensors.probeSecondary : [])\r\n\t\t\t\t\t}\r\n\t\t\t\t] : []\r\n\t\t\t},\r\n\t\t\tstate: {\r\n\t\t\t\tatxPower: (response.params.atxPower === -1) ? null : Boolean(response.params.atxPower),\r\n\t\t\t\tcurrentTool: response.currentTool,\r\n\t\t\t\tstatus: this.convertStatusLetter(response.status)\r\n\t\t\t},\r\n\t\t\ttools: response.temps.tools.active.map((active, index) => ({\r\n\t\t\t\tactive,\r\n\t\t\t\tstandby: response.temps.tools.standby[index]\r\n\t\t\t}))\r\n\t\t});\r\n\t\tif (newData.move.axes.length >= 3) {\r\n\t\t\tnewData.move.axes[2].babystep = (response.params.babystep !== undefined) ? response.params.babystep : 0;\r\n\t\t}\r\n\t\tif (response.coords.machine) {\r\n\t\t\tresponse.coords.machine.forEach(function(machinePosition, axis) {\r\n\t\t\t\tnewData.move.axes[axis].machinePosition = (machinePosition === 9999) ? null : machinePosition;\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (response.temps.bed && response.temps.bed.heater >= 0 && response.temps.bed.heater < newData.sensors.analog.length) {\r\n\t\t\tnewData.heat.heaters[response.temps.bed.heater].active = response.temps.bed.active;\r\n\t\t\tnewData.heat.heaters[response.temps.bed.heater].standby = response.temps.bed.standby;\r\n\t\t}\r\n\t\tif (response.temps.chamber && response.temps.chamber.heater >= 0 && response.temps.chamber.heater < newData.sensors.analog.length) {\r\n\t\t\tnewData.heat.heaters[response.temps.chamber.heater].active = response.temps.chamber.active;\r\n\t\t\tnewData.heat.heaters[response.temps.chamber.heater].standby = response.temps.chamber.standby;\r\n\t\t}\r\n\t\tif (response.temps.cabinet && response.temps.cabinet.heater >= 0 && response.temps.cabinet.heater < newData.sensors.analog.length) {\r\n\t\t\tnewData.heat.heaters[response.temps.cabinet.heater].active = response.temps.cabinet.active;\r\n\t\t\tnewData.heat.heaters[response.temps.cabinet.heater].standby = response.temps.cabinet.standby;\r\n\t\t}\r\n\t\tthis.numExtruders = response.coords.extr.length;\r\n\r\n\t\tif (statusType === 2) {\r\n\t\t\t// Extended Status Response\r\n\t\t\tconst axisNames = (response.axisNames !== undefined) ? response.axisNames.split('') : ['X', 'Y', 'Z', 'U', 'V', 'W', 'A', 'B', 'C'];\r\n\t\t\tconst boardDefinition = getBoardDefinition(this.boardType);\r\n\t\t\tthis.name = name;\r\n\t\t\tthis.probeType = response.probe ? response.probe.type : 0;\r\n\r\n\t\t\tquickPatch(newData, {\r\n\t\t\t\tboards: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfirmwareFileName: boardDefinition.firmwareFileName,\r\n\t\t\t\t\t\tfirmwareName: response.firmwareName,\r\n\t\t\t\t\t\tiapFileNameSD: boardDefinition.iapFileNameSD,\r\n\t\t\t\t\t\tmaxHeaters: boardDefinition.maxHeaters,\r\n\t\t\t\t\t\tmaxMotors: boardDefinition.maxMotors,\r\n\t\t\t\t\t\tmcuTemp: response.mcutemp ? {\r\n\t\t\t\t\t\t\tmin: response.mcutemp.min,\r\n\t\t\t\t\t\t\tcurrent: response.mcutemp.cur,\r\n\t\t\t\t\t\t\tmax: response.mcutemp.max\r\n\t\t\t\t\t\t} : {},\r\n\t\t\t\t\t\tshortName: this.boardType,\r\n\t\t\t\t\t\tsupports12864: boardDefinition.supports12864,\r\n\t\t\t\t\t\tv12: response.v12 ? {\r\n\t\t\t\t\t\t\tmin: response.v12.min,\r\n\t\t\t\t\t\t\tcurrent: response.v12.cur,\r\n\t\t\t\t\t\t\tmax: response.v12.max\r\n\t\t\t\t\t\t} : {},\r\n\t\t\t\t\t\tvIn: response.vin ? {\r\n\t\t\t\t\t\t\tmin: response.vin.min,\r\n\t\t\t\t\t\t\tcurrent: response.vin.cur,\r\n\t\t\t\t\t\t\tmax: response.vin.max\r\n\t\t\t\t\t\t} : {}\r\n\t\t\t\t\t}\r\n\t\t\t\t],\r\n\t\t\t\tfans: newData.fans.map((fanData, index) => ({\r\n\t\t\t\t\tname: !response.params.fanNames ? null : response.params.fanNames[index],\r\n\t\t\t\t\tthermostatic: {\r\n\t\t\t\t\t\theaters: ((response.controllableFans & (1 << index)) !== 0) ? [] : [-1]\r\n\t\t\t\t\t}\r\n\t\t\t\t})),\r\n\t\t\t\theat: {\r\n\t\t\t\t\tbedHeaters: response.temps.bed ? [response.temps.bed.heater] : [],\r\n\t\t\t\t\tchamberHeaters: (response.temps.chamber ? [response.temps.chamber.heater] : [])\r\n\t\t\t\t\t\t\t\t\t.concat(response.temps.cabinet ? [response.temps.cabinet.heater] : []),\r\n\t\t\t\t\tcoldExtrudeTemperature: response.coldExtrudeTemp,\r\n\t\t\t\t\tcoldRetractTemperature: response.coldRetractTemp\r\n\t\t\t\t},\r\n\t\t\t\tmove: {\r\n\t\t\t\t\taxes: response.coords.xyz.map((position, index) => ({\r\n\t\t\t\t\t\tletter: axisNames[index],\r\n\t\t\t\t\t\tvisible: (response.axes !== undefined) ? (index < response.axes) : true\r\n\t\t\t\t\t})),\r\n\t\t\t\t\tcompensation: {\r\n\t\t\t\t\t\ttype: response.compensation\r\n\t\t\t\t\t},\r\n\t\t\t\t\tkinematics: {\r\n\t\t\t\t\t\tname: response.geometry\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tnetwork: {\r\n\t\t\t\t\tname: response.name\r\n\t\t\t\t},\r\n\t\t\t\tsensors: {\r\n\t\t\t\t\tendstops: [...Array(response.coords.xyz.length + response.coords.extr.length)].map((dummy, drive) => ({\r\n\t\t\t\t\t\ttriggered: Boolean(response.endstops & (1 << drive))\r\n\t\t\t\t\t})),\r\n\t\t\t\t\tprobes: (response.probe && response.probe.type !== 0) ? [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tthreshold: response.probe.threshold,\r\n\t\t\t\t\t\t\ttriggerHeight: response.probe.height,\r\n\t\t\t\t\t\t\ttype: response.probe.type\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t] : []\r\n\t\t\t\t},\r\n\t\t\t\tstate: {\r\n\t\t\t\t\tmachineMode: response.mode ? response.mode : null,\r\n\t\t\t\t},\r\n\t\t\t\ttools: (response.tools !== undefined) ? response.tools.map(tool => ({\r\n\t\t\t\t\tnumber: tool.number,\r\n\t\t\t\t\tname: tool.name ? tool.name : '',\r\n\t\t\t\t\theaters: tool.heaters,\r\n\t\t\t\t\textruders: tool.drives,\r\n\t\t\t\t\taxes: tool.axisMap,\r\n\t\t\t\t\tfans: bitmapToArray(tool.fans),\r\n\t\t\t\t\tfilamentExtruder: (tool.drives.length > 0) ? tool.drives[0] : -1,\r\n\t\t\t\t\toffsets: tool.offsets\r\n\t\t\t\t})) : []\r\n\t\t\t});\r\n\r\n\t\t\tnewData.heat.heaters.forEach(heater => heater.max = response.tempLimit);\r\n\r\n\t\t\tresponse.tools.forEach(tool => {\r\n\t\t\t\tif (tool.drives.length > 0) {\r\n\t\t\t\t\tconst drive = tool.drives[0];\r\n\t\t\t\t\tif (drive >= 0 && drive < newData.move.extruders.length) {\r\n\t\t\t\t\t\tnewData.move.extruders[0].filament = tool.filament;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (response.temps.names !== undefined) {\r\n\t\t\t\tresponse.temps.names.forEach((name, index) => newData.sensors.analog[index].name = name);\r\n\t\t\t}\r\n\r\n\t\t\tnewData.volumes = [];\r\n\t\t\tfor (let i = 0; i < response.volumes; i++) {\r\n\t\t\t\tnewData.volumes.push({\r\n\t\t\t\t\tmounted: (response.mountedVolumes & (1 << i)) !== 0\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tresponse.tools.forEach(tool => {\r\n\t\t\t\tif (tool.drives.length > 0) {\r\n\t\t\t\t\tconst extruder = tool.drives[0];\r\n\t\t\t\t\tif (extruder >= 0 && extruder < newData.move.extruders.length && newData.move.extruders[extruder] !== null) {\r\n\t\t\t\t\t\tnewData.move.extruders[extruder].filament = tool.filament;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else if (statusType === 3) {\r\n\t\t\tif (!newData.job) {\r\n\t\t\t\tnewData.job = {};\r\n\t\t\t}\r\n\r\n\t\t\t// Print Status Response\r\n\t\t\tquickPatch(newData.job, {\r\n\t\t\t\tfile: {},\r\n\t\t\t\tfilePosition: response.filePosition\r\n\t\t\t});\r\n\t\t\tresponse.extrRaw.forEach((rawPosition, extruder) => newData.move.extruders[extruder].rawPosition = rawPosition);\r\n\r\n\t\t\t// Update some stats only if the print is still live\r\n\t\t\tif (isPrinting) {\r\n\t\t\t\tquickPatch(newData.job, {\r\n\t\t\t\t\tduration: response.printDuration,\r\n\t\t\t\t\tlayer: response.currentLayer,\r\n\t\t\t\t\tlayerTime: response.currentLayerTime,\r\n\t\t\t\t\twarmUpDuration: response.warmUpDuration,\r\n\t\t\t\t\ttimesLeft: {\r\n\t\t\t\t\t\tfile: response.timesLeft.file,\r\n\t\t\t\t\t\tfilament: response.timesLeft.filament,\r\n\t\t\t\t\t\tlayer: response.timesLeft.layer\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tquickPatch(newData.job, {\r\n\t\t\t\t\tlayerTime: null,\r\n\t\t\t\t\ttimesLeft: {\r\n\t\t\t\t\t\tfile: null,\r\n\t\t\t\t\t\tfilament: null,\r\n\t\t\t\t\t\tlayer: null\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// See if we need to record more layer stats\r\n\t\t\tif (response.currentLayer > this.layers.length) {\r\n\t\t\t\tlet addLayers = false;\r\n\t\t\t\tif (!this.layers.length) {\r\n\t\t\t\t\t// Is the first layer complete?\r\n\t\t\t\t\tif (response.currentLayer > 1) {\r\n\t\t\t\t\t\tthis.layers.push({\r\n\t\t\t\t\t\t\tduration: response.firstLayerDuration,\r\n\t\t\t\t\t\t\theight: this.currentFileInfo.firstLayerHeight,\r\n\t\t\t\t\t\t\tfilament: (response.currentLayer === 2) ? response.extrRaw.filter(amount => amount > 0) : null,\r\n\t\t\t\t\t\t\tfractionPrinted: (response.currentLayer === 2) ? response.fractionPrinted / 100 : null\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tnewData.job.layers = this.layers;\r\n\r\n\t\t\t\t\t\t// Keep track of the past layer\r\n\t\t\t\t\t\tif (response.currentLayer === 2) {\r\n\t\t\t\t\t\t\tthis.printStats.duration = response.warmUpDuration + response.firstLayerDuration;\r\n\t\t\t\t\t\t\tthis.printStats.extrRaw = response.extrRaw;\r\n\t\t\t\t\t\t\tthis.printStats.fractionPrinted = response.fractionPrinted;\r\n\t\t\t\t\t\t\tthis.printStats.measuredLayerHeight = response.coords.xyz[2] - this.currentFileInfo.firstLayerHeight;\r\n\t\t\t\t\t\t\tthis.printStats.zPosition = response.coords.xyz[2];\r\n\t\t\t\t\t\t} else if (response.currentLayer > this.layers.length + 1) {\r\n\t\t\t\t\t\t\taddLayers = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (response.currentLayer > this.layers.length + 1) {\r\n\t\t\t\t\t// Another layer is complete, add it\r\n\t\t\t\t\taddLayers = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (addLayers) {\r\n\t\t\t\t\tconst layerJustChanged = (response.status === 'M') || ((response.currentLayer - this.layers.length) === 2);\r\n\t\t\t\t\tif (this.printStats.duration) {\r\n\t\t\t\t\t\t// Got info about the past layer, add what we know\r\n\t\t\t\t\t\tthis.layers.push({\r\n\t\t\t\t\t\t\tduration: response.printDuration - this.printStats.duration,\r\n\t\t\t\t\t\t\theight: this.printStats.measuredLayerHeight ? this.printStats.measuredLayerHeight : this.printStats.layerHeight,\r\n\t\t\t\t\t\t\tfilament: response.extrRaw.map((amount, index) => amount - this.printStats.extrRaw[index]).filter((dummy, index) => response.extrRaw[index] > 0),\r\n\t\t\t\t\t\t\tfractionPrinted: (response.fractionPrinted - this.printStats.fractionPrinted) / 100\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Interpolate data...\r\n\t\t\t\t\t\tconst avgDuration = (response.printDuration - response.warmUpDuration - response.firstLayerDuration - response.currentLayerTime) / (response.currentLayer - 2);\r\n\t\t\t\t\t\tfor (let layer = this.layers.length; layer + 1 < response.currentLayer; layer++) {\r\n\t\t\t\t\t\t\tthis.layers.push({ duration: avgDuration });\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.printStats.zPosition = response.coords.xyz[2];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnewData.job.layers = this.layers;\r\n\r\n\t\t\t\t\t// Keep track of the past layer if the layer change just happened\r\n\t\t\t\t\tif (layerJustChanged) {\r\n\t\t\t\t\t\tthis.printStats.duration = response.printDuration;\r\n\t\t\t\t\t\tthis.printStats.extrRaw = response.extrRaw;\r\n\t\t\t\t\t\tthis.printStats.fractionPrinted = response.fractionPrinted;\r\n\t\t\t\t\t\tthis.printStats.measuredLayerHeight = response.coords.xyz[2] - this.printStats.zPosition;\r\n\t\t\t\t\t\tthis.printStats.zPosition = response.coords.xyz[2];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Output Utilities\r\n\t\tlet beepFrequency = 0, beepDuration = 0, displayMessage = '', messageBox = null;\r\n\t\tif (response.output) {\r\n\t\t\t// Beep\r\n\t\t\tif (response.output.beepFrequency !== undefined && response.output.beepDuration !== undefined) {\r\n\t\t\t\tbeepFrequency = response.output.beepFrequency;\r\n\t\t\t\tbeepDuration = response.output.beepDuration;\r\n\t\t\t}\r\n\r\n\t\t\t// Persistent Message\r\n\t\t\tif (response.output.message !== undefined) {\r\n\t\t\t\tdisplayMessage = response.output.message;\r\n\t\t\t}\r\n\r\n\t\t\t// Message Box\r\n\t\t\tif (response.output.msgBox) {\r\n\t\t\t\tmessageBox = new MessageBox({\r\n\t\t\t\t\tmode: response.output.msgBox.mode,\r\n\t\t\t\t\ttitle: response.output.msgBox.title,\r\n\t\t\t\t\tmessage: response.output.msgBox.msg,\r\n\t\t\t\t\ttimeout: response.output.msgBox.timeout,\r\n\t\t\t\t\taxisControls: response.output.msgBox.controls\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tquickPatch(newData, {\r\n\t\t\tstate: {\r\n\t\t\t\tbeep: (beepFrequency > 0 && beepDuration > 0) ? new BeepRequest({\r\n\t\t\t\t\tfrequency: beepFrequency,\r\n\t\t\t\t\tduration: beepDuration\r\n\t\t\t\t}) : null,\r\n\t\t\t\tdisplayMessage,\r\n\t\t\t\tmessageBox\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Spindles\r\n\t\tif (response.spindles) {\r\n\t\t\tquickPatch(newData, {\r\n\t\t\t\tspindles: response.spindles.map(spindle => ({\r\n\t\t\t\t\tactive: spindle.active,\r\n\t\t\t\t\tcurrent: spindle.current,\r\n\t\t\t\t\ttool: spindle.tool\r\n\t\t\t\t}))\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Remove invalid heaters\r\n\t\tfor (let i = 0; i < newData.heat.heaters.length; i++) {\r\n\t\t\tconst heater = newData.heat.heaters[i];\r\n\t\t\tif (heater && heater.state === HeaterState.off) {\r\n\t\t\t\tif (heater.sensor < 0 || heater.sensor >= newData.sensors.analog.length ||\r\n\t\t\t\t\tnewData.sensors.analog[heater.sensor].lastReading === 2000) {\r\n\t\t\t\t\tnewData.heat.heaters[i] = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Update the data model\r\n\t\tawait this.dispatch('update', newData);\r\n\r\n\t\t// Check if the G-code response needs to be polled\r\n\t\tif (response.seq !== this.lastSeq) {\r\n\t\t\tawait this.getGCodeReply(response.seq);\r\n\t\t\tthis.lastSeq = response.seq;\r\n\t\t}\r\n\r\n\t\t// Check if the firmware rebooted\r\n\t\tif (!this.justConnected && response.time < this.lastStatusResponse.time) {\r\n\t\t\tthis.pendingCodes.forEach(code => code.reject(new OperationCancelledError()));\r\n\t\t\tthis.pendingCodes = [];\r\n\t\t}\r\n\r\n\t\t// Sometimes we need to update the config as well\r\n\t\tif (requestExtendedStatus || this.justConnected || (this.verbose && this.updateLoopCounter % 2 === 0)) {\r\n\t\t\tawait this.getConfigResponse();\r\n\t\t}\r\n\r\n\t\t// Status update complete\r\n\t\tthis.lastStatusResponse = response;\r\n\t\tthis.justConnected = false;\r\n\t\tthis.updateLoopCounter++;\r\n\r\n\t\t// Schedule the next status update\r\n\t\tthis.scheduleUpdate();\r\n\t}\r\n\r\n\tconvertHeaterState(state) {\r\n\t\tconst keys = Object.keys(HeaterState);\r\n\t\tif (state >= 0 && state < keys.length) {\r\n\t\t\treturn keys[state];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconvertStatusLetter(letter) {\r\n\t\tswitch (letter) {\r\n\t\t\tcase 'F': return 'updating';\r\n\t\t\tcase 'O': return 'off';\r\n\t\t\tcase 'H': return 'halted';\r\n\t\t\tcase 'D': return 'pausing';\r\n\t\t\tcase 'S': return 'paused';\r\n\t\t\tcase 'R': return 'resuming';\r\n\t\t\tcase 'P': return 'processing';\r\n\t\t\tcase 'M': return 'simulating';\r\n\t\t\tcase 'B': return 'busy';\r\n\t\t\tcase 'T': return 'changingTool';\r\n\t\t\tcase 'I': return 'idle';\r\n\t\t}\r\n\t\treturn 'unknown';\r\n\t}\r\n\r\n\t// Call this only from updateLoopStatus()\r\n\tasync getConfigResponse() {\r\n\t\tconst response = await this.request('GET', 'rr_config');\r\n\t\tconst configData = {\r\n\t\t\tboards: [\r\n\t\t\t\t{\r\n\t\t\t\t\tname: response.firmwareElectronics,\r\n\t\t\t\t\tfirmwareDate: response.firmwareDate,\r\n\t\t\t\t\tfirmwareName: response.firmwareName,\r\n\t\t\t\t\tfirmwareVersion: response.firmwareVersion\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\tdirectories: (response.sysdir !== undefined) ? {\r\n\t\t\t\tsystem: response.sysdir\r\n\t\t\t} : {},\r\n\t\t\tmove: {\r\n\t\t\t\taxes: response.axisMins.map((min, index) => ({\r\n\t\t\t\t\tacceleration: response.accelerations[index],\r\n\t\t\t\t\tcurrent: response.currents[index],\r\n\t\t\t\t\tjerk: response.minFeedrates[index],\r\n\t\t\t\t\tmin,\r\n\t\t\t\t\tmax: response.axisMaxes[index],\r\n\t\t\t\t\tspeed: response.maxFeedrates[index]\r\n\t\t\t\t})),\r\n\t\t\t\textruders: [...Array(this.numExtruders)].map((dummy, index) => ({\r\n\t\t\t\t\tacceleration: response.accelerations[response.axisMins.length + index],\r\n\t\t\t\t\tcurrent: response.currents[response.axisMins.length + index],\r\n\t\t\t\t\tjerk: response.minFeedrates[response.axisMins.length + index],\r\n\t\t\t\t\tspeed: response.maxFeedrates[response.axisMins.length + index]\r\n\t\t\t\t})),\r\n\t\t\t\tidle: {\r\n\t\t\t\t\tfactor: response.idleCurrentFactor,\r\n\t\t\t\t\ttimeout: response.idleTimeout\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tnetwork: {\r\n\t\t\t\tinterfaces: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: (response.dwsVersion !== undefined) ? 'wifi' : 'lan',\r\n\t\t\t\t\t\tfirmwareVersion: response.dwsVersion\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tawait this.dispatch('update', configData);\r\n\t}\r\n\r\n\tlastSeqs = {}\r\n\tlastStatus = null\r\n\tlastUptime = 0\r\n\tasync updateLoopModel() {\r\n\t\tlet jobKey = null, extruders = [], status = null, zPosition = null;\r\n\t\tif (this.justConnected) {\r\n\t\t\tthis.justConnected = false;\r\n\r\n\t\t\t// Query the seqs field and the G-code reply\r\n\t\t\tthis.lastSeqs = (await this.request('GET', 'rr_model', { key: 'seqs' })).result;\r\n\t\t\tif (this.lastSeqs == null || this.lastSeqs.reply === undefined) {\r\n\t\t\t\tconsole.warn('Incompatible rr_model version detected, falling back to status responses');\r\n\t\t\t\twindow.forceLegacyConnect = true;\r\n\t\t\t\tBaseConnector.setConnectingProgress(-1);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (this.lastSeqs.reply > 0) {\r\n\t\t\t\tawait this.getGCodeReply(this.lastSeqs.reply);\r\n\t\t\t}\r\n\r\n\t\t\t// Query the full object model initially\r\n\t\t\ttry {\r\n\t\t\t\tlet keyIndex = 1, numKeys = Object.keys(DefaultMachineModel).length;\r\n\t\t\t\tfor (let key in DefaultMachineModel) {\r\n\t\t\t\t\tconst keyResponse = await this.request('GET', 'rr_model', { key, flags: 'd99vn' });\r\n\t\t\t\t\tawait this.dispatch('update', { [key]: keyResponse.result });\r\n\t\t\t\t\tBaseConnector.setConnectingProgress((keyIndex++ / numKeys) * 100);\r\n\r\n\t\t\t\t\tif (key === 'job') {\r\n\t\t\t\t\t\tjobKey = keyResponse.result;\r\n\t\t\t\t\t} else if (key === 'move') {\r\n\t\t\t\t\t\textruders = keyResponse.result.extruders;\r\n\t\t\t\t\t\tzPosition = (keyResponse.result.axes.length > 2) ? keyResponse.result.axes[2].userPosition : null;\r\n\t\t\t\t\t} else if (key === 'state') {\r\n\t\t\t\t\t\tstatus = keyResponse.result.status;\r\n\t\t\t\t\t\tthis.lastUptime = keyResponse.result.upTime;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} finally {\r\n\t\t\t\tBaseConnector.setConnectingProgress(-1);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Query live values\r\n\t\t\tconst response = await this.request('GET', 'rr_model', { flags: 'd99fn' }), seqs = response.result.seqs;\r\n\t\t\textruders = response.result.move.extruders;\r\n\t\t\tdelete response.result.seqs;\r\n\t\t\tstatus = response.result.state.status;\r\n\t\t\tzPosition = (response.result.move.axes.length > 2) ? response.result.move.axes[2].userPosition : null;\r\n\r\n\t\t\t// Apply new values\r\n\t\t\tif (!isPrinting(status) && isPrinting(this.lastStatus)) {\r\n\t\t\t\tresponse.result.job.lastFileCancelled = isPaused(this.lastStatus);\r\n\t\t\t\tresponse.result.job.lastFileSimulated = (this.lastStatus === StatusType.simulating);\r\n\t\t\t}\r\n\t\t\tawait this.dispatch('update', response.result);\r\n\r\n\t\t\t// Check if any of the non-live fields have changed and query them if so\r\n\t\t\tfor (let key in DefaultMachineModel) {\r\n\t\t\t\tif (this.lastSeqs[key] !== seqs[key]) {\r\n\t\t\t\t\tconst keyResponse = await this.request('GET', 'rr_model', { key, flags: 'd99vn' });\r\n\t\t\t\t\tawait this.dispatch('update', { [key]: keyResponse.result });\r\n\r\n\t\t\t\t\tif (key === 'job') {\r\n\t\t\t\t\t\tjobKey = keyResponse.result;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Check if the firmware has rebooted\r\n\t\t\tif (response.result.state.upTime < this.lastUptime) {\r\n\t\t\t\tthis.justConnected = true;\r\n\t\t\t\tthis.pendingCodes.forEach(code => code.reject(new OperationCancelledError()));\r\n\t\t\t\tthis.pendingCodes = [];\r\n\r\n\t\t\t\t// Send the rr_connect request and datetime again after a firmware reset\r\n\t\t\t\tawait this.request('GET', 'rr_connect', {\r\n\t\t\t\t\tpassword: this.password,\r\n\t\t\t\t\ttime: timeToStr(new Date())\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tthis.lastUptime = response.result.state.upTime;\r\n\r\n\t\t\t// Finally check if there is a new G-code reply available\r\n\t\t\tif (this.lastSeqs.reply !== seqs.reply) {\r\n\t\t\t\tawait this.getGCodeReply(seqs.reply);\r\n\t\t\t}\r\n\t\t\tthis.lastSeqs = seqs;\r\n\t\t}\r\n\r\n\t\t// See if we need to record more layer stats\r\n\t\tif (jobKey && isPrinting(status)) {\r\n\t\t\tlet layersChanged = false;\r\n\t\t\tif (!isPrinting(this.lastStatus)) {\r\n\t\t\t\tthis.layers = [];\r\n\t\t\t\tlayersChanged = true;\r\n\t\t\t}\r\n\r\n\t\t\tconst extrRaw = extruders.map(extruder => extruder.rawPosition);\r\n\t\t\tconst fractionPrinted = (jobKey.size > 0) ? (jobKey.filePosition / jobKey.file.size) : 0;\r\n\t\t\tlet addLayers = false;\r\n\t\t\tif (this.layers.length === 0) {\r\n\t\t\t\t// Is the first layer complete?\r\n\t\t\t\tif (jobKey.layer > 1) {\r\n\t\t\t\t\tthis.layers.push({\r\n\t\t\t\t\t\tduration: jobKey.firstLayerDuration,\r\n\t\t\t\t\t\theight: jobKey.file.firstLayerHeight,\r\n\t\t\t\t\t\tfilament: (jobKey.layer === 2) ? extrRaw : null,\r\n\t\t\t\t\t\tfractionPrinted: (jobKey.layer === 2) ? fractionPrinted : null\r\n\t\t\t\t\t});\r\n\t\t\t\t\tlayersChanged = true;\r\n\r\n\t\t\t\t\t// Keep track of the past layer\r\n\t\t\t\t\tif (jobKey.layer === 2) {\r\n\t\t\t\t\t\tthis.printStats.duration = jobKey.warmUpDuration + jobKey.firstLayerDuration;\r\n\t\t\t\t\t\tthis.printStats.extrRaw = extrRaw;\r\n\t\t\t\t\t\tthis.printStats.fractionPrinted = fractionPrinted;\r\n\t\t\t\t\t\tthis.printStats.measuredLayerHeight = zPosition - jobKey.file.firstLayerHeight;\r\n\t\t\t\t\t\tthis.printStats.zPosition = zPosition;\r\n\t\t\t\t\t} else if (jobKey.layer > this.layers.length + 1) {\r\n\t\t\t\t\t\taddLayers = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (jobKey.layer > this.layers.length + 1) {\r\n\t\t\t\t// Another layer is complete, add it\r\n\t\t\t\taddLayers = true;\r\n\t\t\t}\r\n\r\n\t\t\tif (addLayers) {\r\n\t\t\t\tif (this.printStats.duration) {\r\n\t\t\t\t\t// Got info about the past layer, add what we know\r\n\t\t\t\t\tthis.layers.push({\r\n\t\t\t\t\t\tduration: jobKey.duration - this.printStats.duration,\r\n\t\t\t\t\t\theight: this.printStats.measuredLayerHeight ? this.printStats.measuredLayerHeight : this.printStats.layerHeight,\r\n\t\t\t\t\t\tfilament: extrRaw\r\n\t\t\t\t\t\t.map((amount, index) => amount - this.printStats.extrRaw[index])\r\n\t\t\t\t\t\t.filter((dummy, index) => extrRaw[index] > 0),\r\n\t\t\t\t\t\tfractionPrinted: fractionPrinted - this.printStats.fractionPrinted\r\n\t\t\t\t\t});\r\n\t\t\t\t\tlayersChanged = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Interpolate data...\r\n\t\t\t\t\tconst avgDuration = (jobKey.duration - jobKey.warmUpDuration - jobKey.firstLayerDuration - jobKey.layerTime) / (jobKey.layer - 2);\r\n\t\t\t\t\tfor (let layer = this.layers.length; layer + 1 < jobKey.layer; layer++) {\r\n\t\t\t\t\t\tthis.layers.push({ duration: avgDuration });\r\n\t\t\t\t\t\tlayersChanged = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Keep track of the past layer if new layers have been added\r\n\t\t\t\tif (layersChanged) {\r\n\t\t\t\t\tthis.printStats.duration = jobKey.duration;\r\n\t\t\t\t\tthis.printStats.extrRaw = extrRaw;\r\n\t\t\t\t\tthis.printStats.fractionPrinted = fractionPrinted;\r\n\t\t\t\t\tthis.printStats.measuredLayerHeight = zPosition - this.printStats.zPosition;\r\n\t\t\t\t\tthis.printStats.zPosition = zPosition;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (layersChanged) {\r\n\t\t\t\tawait this.dispatch('update', {\r\n\t\t\t\t\tjob: {\r\n\t\t\t\t\t\tlayers: this.layers\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Schedule the next status update\r\n\t\tthis.lastStatus = status;\r\n\t\tthis.scheduleUpdate();\r\n\t}\r\n\r\n\tasync doUpdate() {\r\n\t\tthis.updateLoopTimer = null;\r\n\t\ttry {\r\n\t\t\tif (!window.forceLegacyConnect && this.apiLevel >= 1) {\r\n\t\t\t\t// Request object model updates\r\n\t\t\t\tawait this.updateLoopModel();\r\n\t\t\t} else {\r\n\t\t\t\t// Request updates using the legacy poll adapter\r\n\t\t\t\tawait this.updateLoopStatus();\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tconsole.warn(e);\r\n\t\t\tawait this.dispatch('onConnectionError', e);\r\n\t\t}\r\n\t}\r\n\r\n\tscheduleUpdate() {\r\n\t\tif (!this.updateLoopTimer) {\r\n\t\t\tthis.updateLoopTimer = setTimeout(this.doUpdate.bind(this), this.settings.updateInterval);\r\n\t\t}\r\n\t}\r\n\r\n\tasync sendCode(code) {\r\n\t\tconst response = await this.request('GET', 'rr_gcode', { gcode: code });\r\n\t\tif (!(response instanceof Object)) {\r\n\t\t\tconsole.warn(`Received bad response for rr_gcode: ${JSON.stringify(response)}`);\r\n\t\t\tthrow new CodeResponseError();\r\n\t\t}\r\n\t\tif (response.buff === 0) {\r\n\t\t\tthrow new CodeBufferError();\r\n\t\t}\r\n\r\n\t\tlet inBraces = false;\r\n\t\tfor (let i = 0; i < code.length; i++) {\r\n\t\t\tif (inBraces) {\r\n\t\t\t\tinBraces = (code[i] !== ')');\r\n\t\t\t} else if (code[i] === '(') {\r\n\t\t\t\tinBraces = true;\r\n\t\t\t} else {\r\n\t\t\t\tif (code[i] === ';') {\r\n\t\t\t\t\treturn '';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (code[i] !== ' ' && code[i] !== '\\t' && code[i] !== '\\r' && code !== '\\n') {\r\n\t\t\t\t\tconst pendingCodes = this.pendingCodes, seq = this.lastSeq;\r\n\t\t\t\t\treturn new Promise((resolve, reject) => pendingCodes.push({ seq, resolve, reject }));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tasync getGCodeReply(seq) {\r\n\t\tconst response = await this.request('GET', 'rr_reply', this.requestTimeout, 'text');\r\n\t\tconst reply = response.trim();\r\n\r\n\t\t// TODO? Check for special JSON responses generated by M119, see DWC1\r\n\t\t// Probably makes sense only as soon as the settings update notifications are working again\r\n\r\n\t\tif (!this.pendingCodes.length) {\r\n\t\t\t// Just log this response\r\n\t\t\tthis.dispatch('onCodeCompleted', { code: undefined, reply });\r\n\t\t} else {\r\n\t\t\t// Resolve pending code promises\r\n\t\t\tthis.pendingCodes.forEach(function(code) {\r\n\t\t\t\tif (code.seq < seq) {\r\n\t\t\t\t\tcode.resolve(reply);\r\n\t\t\t\t\tthis.dispatch('onCodeCompleted', { code, reply });\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.pendingCodes = this.pendingCodes.filter(code => code.seq >= seq);\r\n\t\t}\r\n\t}\r\n\r\n\tasync upload({ filename, content, cancellationToken = null, onProgress }) {\r\n\t\t// Create upload options\r\n\t\tconst payload = (content instanceof(Blob)) ? content : new Blob([content]);\r\n\t\tconst params = {\r\n\t\t\tname: filename,\r\n\t\t\ttime: timeToStr(content.lastModified ? new Date(content.lastModified) : new Date())\r\n\t\t};\r\n\r\n\t\t// Check if the CRC32 checksum is required\r\n\t\tif (this.settings.crcUploads) {\r\n\t\t\tconst checksum = await new Promise(function(resolve) {\r\n\t\t\t\tconst fileReader = new FileReader();\r\n\t\t\t\tfileReader.onload = function(e){\r\n\t\t\t\t\tconst result = crc32(e.target.result);\r\n\t\t\t\t\tresolve(result);\r\n\t\t\t\t}\r\n\t\t\t\tfileReader.readAsArrayBuffer(payload);\r\n\t\t\t});\r\n\r\n\t\t\tparams.crc32 = checksum.toString(16);\r\n\t\t}\r\n\r\n\t\t// Perform actual upload in the background\r\n\t\tconst response = await this.request('POST', 'rr_upload', params, 'json', payload, onProgress, 0, cancellationToken, filename);\r\n\t\tif (response.err !== 0) {\r\n\t\t\tthrow new OperationFailedError(`err ${response.err}`);\r\n\t\t}\r\n\r\n\t\t// Upload successful\r\n\t\tthis.dispatch('onFileUploaded', { filename, content });\r\n\t}\r\n\r\n\tasync delete(filename) {\r\n\t\tconst response = await this.request('GET', 'rr_delete', { name: filename }, 'json', null, null, this.requestTimeout, null, filename);\r\n\t\tif (response.err !== 0) {\r\n\t\t\tthrow new OperationFailedError(`err ${response.err}`);\r\n\t\t}\r\n\r\n\t\tawait this.dispatch('onFileOrDirectoryDeleted', filename);\r\n\t}\r\n\r\n\tasync move({ from, to, force = false, silent = false }) {\r\n\t\tconst response = await this.request('GET', 'rr_move', {\r\n\t\t\told: from,\r\n\t\t\tnew: to,\r\n\t\t\tdeleteexisting: force ? 'yes' : 'no'\r\n\t\t}, 'json', null, null, this.requestTimeout, null, from);\r\n\r\n\t\tif (!silent) {\r\n\t\t\tif (response.err !== 0) {\r\n\t\t\t\tthrow new OperationFailedError(`err ${response.err}`);\r\n\t\t\t}\r\n\r\n\t\t\tawait this.dispatch('onFileOrDirectoryMoved', { from, to, force });\r\n\t\t}\r\n\t}\r\n\r\n\tasync makeDirectory(directory) {\r\n\t\tconst response = await this.request('GET', 'rr_mkdir', { dir: directory });\r\n\t\tif (response.err !== 0) {\r\n\t\t\tthrow new OperationFailedError(`err ${response.err}`);\r\n\t\t}\r\n\r\n\t\tawait this.dispatch('onDirectoryCreated', directory);\r\n\t}\r\n\r\n\tasync download(payload) {\r\n\t\tconst filename = (payload instanceof Object) ? payload.filename : payload;\r\n\t\tconst type = (payload instanceof Object && payload.type !== undefined) ? payload.type : 'json';\r\n\t\tconst onProgress = (payload instanceof Object) ? payload.onProgress : undefined;\r\n\t\tconst cancellationToken = (payload instanceof Object && payload.cancellationToken) ? payload.cancellationToken : null;\r\n\r\n\t\tconst response = await this.request('GET', 'rr_download', { name: filename }, type, null, onProgress, 0, cancellationToken, filename);\r\n\r\n\t\tthis.dispatch('onFileDownloaded', { filename, content: response });\r\n\t\treturn response;\r\n\t}\r\n\r\n\tasync getFileList(directory) {\r\n\t\tlet fileList = [], next = 0;\r\n\t\tdo {\r\n\t\t\tconst response = await this.request('GET', 'rr_filelist', { dir: directory, first: next });\r\n\t\t\tif (response.err === 1) {\r\n\t\t\t\tthrow new DriveUnmountedError();\r\n\t\t\t} else if (response.err === 2) {\r\n\t\t\t\tthrow new DirectoryNotFoundError(directory);\r\n\t\t\t}\r\n\r\n\t\t\tfileList = fileList.concat(response.files);\r\n\t\t\tnext = response.next;\r\n\t\t} while (next !== 0);\r\n\r\n\t\treturn fileList.map(item => ({\r\n\t\t\tisDirectory: item.type === 'd',\r\n\t\t\tname: item.name,\r\n\t\t\tsize: (item.type === 'd') ? null : item.size,\r\n\t\t\tlastModified: strToTime(item.date)\r\n\t\t}));\r\n\t}\r\n\r\n\tasync getFileInfo(filename) {\r\n\t\tconst response = await this.request('GET', 'rr_fileinfo', filename ? { name: filename } : {}, 'json', null, null, this.sessionTimeout, null, filename);\r\n\t\tif (response.err) {\r\n\t\t\tthrow new OperationFailedError(`err ${response.err}`);\r\n\t\t}\r\n\r\n\t\tdelete response.err;\r\n\t\treturn new ParsedFileInfo(response);\r\n\t}\r\n}\r\n"]}]}