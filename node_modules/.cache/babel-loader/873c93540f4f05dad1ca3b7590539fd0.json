{"remainingRequest":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\thread-loader\\dist\\cjs.js!C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\src\\utils\\3d.js","dependencies":[{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\src\\utils\\3d.js","mtime":1592248188736},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\jpatrick\\Documents\\GitHub\\DuetWebControl_Fork\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:J3VzZSBzdHJpY3QnOwoKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsbCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluZGV4LW9mIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc29tZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwbGljZSI7CmltcG9ydCB7IENvbG9yLCBWZWN0b3IzLCBGYWNlMywgU3BoZXJlR2VvbWV0cnksIE1hdHJpeDQsIE1lc2gsIE1lc2hCYXNpY01hdGVyaWFsLCBHZW9tZXRyeSwgUGxhbmVHZW9tZXRyeSB9IGZyb20gJ3RocmVlJzsKaW1wb3J0IGkxOG4gZnJvbSAnLi4vaTE4bic7CmltcG9ydCB7IEludmFsaWRIZWlnaHRtYXBFcnJvciB9IGZyb20gJy4vZXJyb3JzLmpzJzsKdmFyIHBvaW50VG9sZXJhbmNlID0gMi4wOwp2YXIgc21hbGxJbmRpY2F0b3JSYWRpdXMgPSAwLjAxLAogICAgbWVkaXVtSW5kaWNhdG9yUmFkaXVzID0gMC4wMiwKICAgIGJpZ0luZGljYXRvclJhZGl1cyA9IDAuMDU7IC8vIERyYXcgc2NhbGUrbGVnZW5kIG5leHQgdG8gdGhlIDNEIGNvbnRyb2wKCmV4cG9ydCBmdW5jdGlvbiBkcmF3TGVnZW5kKGNhbnZhcywgbWF4VmlzdWFsaXphdGlvblosIGNvbG9yU2NoZW1lKSB7CiAgLy8gQ2xlYXIgYmFja2dyb3VuZAogIHZhciBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgY29udGV4dC5yZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CiAgY29udGV4dC5maWxsU3R5bGUgPSAnYmxhY2snOwogIGNvbnRleHQuZmlsbCgpOyAvLyBQdXQgYW5ub3RhdGlvbnMgYWJvdmUgZ3JhZGllbnQKCiAgY29udGV4dC5mb250ID0gJzE0cHggUm9ib3RvLHNhbnMtc2VyaWYnOwogIGNvbnRleHQudGV4dEFsaWduID0gJ2NlbnRlcic7CiAgY29udGV4dC5maWxsU3R5bGUgPSAnd2hpdGUnOwogIGNvbnRleHQuZmlsbFRleHQoaTE4bi50KCdwYW5lbC5oZWlnaHRtYXAuc2NhbGUnKSwgY2FudmFzLndpZHRoIC8gMiwgMjEpOwogIGNvbnRleHQuZmlsbFRleHQoIiIuY29uY2F0KG1heFZpc3VhbGl6YXRpb25aLCAiIG1tIiksIGNhbnZhcy53aWR0aCAvIDIsIDQ0KTsKICBjb250ZXh0LmZpbGxUZXh0KGkxOG4udCgncGFuZWwuaGVpZ2h0bWFwLm9yTW9yZScpLCBjYW52YXMud2lkdGggLyAyLCA2MCk7IC8vIE1ha2Ugc2NhbGUgZ3JhZGllbnQKCiAgdmFyIHNob3dBeGVzID0gY2FudmFzLmhlaWdodCA+IDE4MDsKICB2YXIgc2NhbGVIZWlnaHQgPSBzaG93QXhlcyA/IGNhbnZhcy5oZWlnaHQgLSAxMzkgOiBjYW52YXMuaGVpZ2h0IC0gOTY7CgogIGlmIChjb2xvclNjaGVtZSA9PT0gJ3RlcnJhaW4nKSB7CiAgICBzY2FsZUhlaWdodCAtPSAxNjsKICB9CgogIHZhciBncmFkaWVudCA9IGNvbnRleHQuY3JlYXRlTGluZWFyR3JhZGllbnQoMCwgNjYsIDAsIDY2ICsgc2NhbGVIZWlnaHQpOwoKICBpZiAoY29sb3JTY2hlbWUgPT09ICd0ZXJyYWluJykgewogICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDAuMCwgJ2hzbCgwLDEwMCUsNDUlKScpOwogICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDAuMjUsICdoc2woNjAsMTAwJSw0NSUpJyk7CiAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMC41LCAnaHNsKDEyMCwxMDAlLDQ1JSknKTsKICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgwLjc1LCAnaHNsKDE4MCwxMDAlLDQ1JSknKTsKICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgxLjAsICdoc2woMjQwLDEwMCUsNDUlKScpOwogIH0gZWxzZSB7CiAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMC4wLCAnaHNsKDAsMTAwJSw0NSUpJyk7CiAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMC41LCAnaHNsKDYwLDEwMCUsNDUlKScpOwogICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDEuMCwgJ2hzbCgxMjAsMTAwJSw0NSUpJyk7CiAgfQoKICBjb250ZXh0LmZpbGxTdHlsZSA9IGdyYWRpZW50OwogIGNvbnRleHQuZmlsbFJlY3QoY2FudmFzLndpZHRoIC8gMiAtIDEyLCA2NiwgMjQsIHNjYWxlSGVpZ2h0KTsgLy8gUHV0IGFubm90YXRpb24gYmVsb3cgZ3JhZGllbnQKCiAgY29udGV4dC5maWxsU3R5bGUgPSAnd2hpdGUnOwoKICBpZiAoY29sb3JTY2hlbWUgPT09ICd0ZXJyYWluJykgewogICAgY29udGV4dC5maWxsVGV4dCgiIi5jb25jYXQoLW1heFZpc3VhbGl6YXRpb25aLCAiIG1tIiksIGNhbnZhcy53aWR0aCAvIDIsIHNjYWxlSGVpZ2h0ICsgODIpOwogICAgY29udGV4dC5maWxsVGV4dChpMThuLnQoJ3BhbmVsLmhlaWdodG1hcC5vckxlc3MnKSwgY2FudmFzLndpZHRoIC8gMiwgc2NhbGVIZWlnaHQgKyA5OCk7CiAgICBzY2FsZUhlaWdodCArPSAxNjsKICB9IGVsc2UgewogICAgY29udGV4dC5maWxsVGV4dCgnMC4wMCBtbScsIGNhbnZhcy53aWR0aCAvIDIsIHNjYWxlSGVpZ2h0ICsgODIpOwogIH0gLy8gQWRkIGF4ZXMKCgogIGlmIChzaG93QXhlcykgewogICAgY29udGV4dC5maWxsVGV4dChpMThuLnQoJ3BhbmVsLmhlaWdodG1hcC5heGVzJyksIGNhbnZhcy53aWR0aCAvIDIsIHNjYWxlSGVpZ2h0ICsgMTA5KTsKICAgIGNvbnRleHQuZm9udCA9ICdib2xkICcgKyBjb250ZXh0LmZvbnQ7CiAgICBjb250ZXh0LmZpbGxTdHlsZSA9ICdyZ2IoMjU1LDAsMCknOwogICAgY29udGV4dC5maWxsVGV4dCgnWCcsIGNhbnZhcy53aWR0aCAvIDMsIHNjYWxlSGVpZ2h0ICsgMTI5KTsKICAgIGNvbnRleHQuZmlsbFN0eWxlID0gJ3JnYigwLDI1NSwwKSc7CiAgICBjb250ZXh0LmZpbGxUZXh0KCdZJywgY2FudmFzLndpZHRoIC8gMiwgc2NhbGVIZWlnaHQgKyAxMjkpOwogICAgY29udGV4dC5maWxsU3R5bGUgPSAncmdiKDAsMCwyNTUpJzsKICAgIGNvbnRleHQuZmlsbFRleHQoJ1onLCAyICogY2FudmFzLndpZHRoIC8gMywgc2NhbGVIZWlnaHQgKyAxMjkpOwogIH0KfQoKZnVuY3Rpb24gZ2V0Q29sb3JCeVooeiwgY29sb3JTY2hlbWUsIG1heFZpc3VhbGl6YXRpb25aKSB7CiAgLy8gVGVycmFpbiBjb2xvciBzY2hlbWUgKGkuZS4gZnJvbSBibHVlIHRvIHJlZCwgYXN5bW1ldHJpYykKICBpZiAoY29sb3JTY2hlbWUgPT09ICd0ZXJyYWluJykgewogICAgeiA9IE1hdGgubWF4KE1hdGgubWluKHosIG1heFZpc3VhbGl6YXRpb25aKSwgLW1heFZpc3VhbGl6YXRpb25aKTsKCiAgICB2YXIgX2h1ZSA9IDI0MCAtICh6ICsgbWF4VmlzdWFsaXphdGlvblopIC8gbWF4VmlzdWFsaXphdGlvblogKiAxMjA7CgogICAgcmV0dXJuIG5ldyBDb2xvcignaHNsKCcgKyBfaHVlICsgJywxMDAlLDQ1JSknKTsKICB9IC8vIERlZmF1bHQgY29sb3Igc2NoZW1lIChpLmUuIHRoZSB3b3JzZSB0aGUgcmVkZGVyLCBzeW1tZXRyaWMpCgoKICB2YXIgaHVlID0gMTIwIC0gTWF0aC5taW4oTWF0aC5hYnMoeiksIG1heFZpc3VhbGl6YXRpb25aKSAvIG1heFZpc3VhbGl6YXRpb25aICogMTIwOwogIHJldHVybiBuZXcgQ29sb3IoJ2hzbCgnICsgaHVlICsgJywxMDAlLDQ1JSknKTsKfSAvLyBBcHBseSBjb2xvcnMgdG8gdGhlIGZhY2VzCgoKZXhwb3J0IGZ1bmN0aW9uIHNldEZhY2VDb2xvcnMoZ2VvbWV0cnksIHNjYWxlWiwgY29sb3JTY2hlbWUsIG1heFZpc3VhbGl6YXRpb25aKSB7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBnZW9tZXRyeS5mYWNlcy5sZW5ndGg7IGkrKykgewogICAgdmFyIGZhY2UgPSBnZW9tZXRyeS5mYWNlc1tpXTsKICAgIHZhciBhID0gZ2V0Q29sb3JCeVooZ2VvbWV0cnkudmVydGljZXNbZmFjZS5hXS56IC8gc2NhbGVaLCBjb2xvclNjaGVtZSwgbWF4VmlzdWFsaXphdGlvblopOwogICAgdmFyIGIgPSBnZXRDb2xvckJ5WihnZW9tZXRyeS52ZXJ0aWNlc1tmYWNlLmJdLnogLyBzY2FsZVosIGNvbG9yU2NoZW1lLCBtYXhWaXN1YWxpemF0aW9uWik7CiAgICB2YXIgYyA9IGdldENvbG9yQnlaKGdlb21ldHJ5LnZlcnRpY2VzW2ZhY2UuY10ueiAvIHNjYWxlWiwgY29sb3JTY2hlbWUsIG1heFZpc3VhbGl6YXRpb25aKTsKCiAgICBpZiAoZmFjZS52ZXJ0ZXhDb2xvcnMubGVuZ3RoIDwgMykgewogICAgICBmYWNlLnZlcnRleENvbG9ycyA9IFthLCBiLCBjXTsKICAgIH0gZWxzZSB7CiAgICAgIGZhY2UudmVydGV4Q29sb3JzWzBdLmNvcHkoYSk7CiAgICAgIGZhY2UudmVydGV4Q29sb3JzWzFdLmNvcHkoYik7CiAgICAgIGZhY2UudmVydGV4Q29sb3JzWzJdLmNvcHkoYyk7CiAgICB9CiAgfQoKICBnZW9tZXRyeS5jb2xvcnNOZWVkVXBkYXRlID0gdHJ1ZTsKfQoKZnVuY3Rpb24gdHJhbnNsYXRlR3JpZFBvaW50KG1lc2hHZW9tZXRyeSwgdmVjdG9yLCBzY2FsZVopIHsKICB2YXIgeCwgeTsKCiAgaWYgKG1lc2hHZW9tZXRyeS50eXBlID09PSAnUGxhbmVHZW9tZXRyeScpIHsKICAgIHggPSAodmVjdG9yLnggLyBtZXNoR2VvbWV0cnkucGFyYW1ldGVycy53aWR0aCArIDAuNSkgKiAobWVzaEdlb21ldHJ5LnhNYXggLSBtZXNoR2VvbWV0cnkueE1pbikgKyBtZXNoR2VvbWV0cnkueE1pbjsKICAgIHkgPSAodmVjdG9yLnkgLyBtZXNoR2VvbWV0cnkucGFyYW1ldGVycy5oZWlnaHQgKyAwLjUpICogKG1lc2hHZW9tZXRyeS55TWF4IC0gbWVzaEdlb21ldHJ5LnlNaW4pICsgbWVzaEdlb21ldHJ5LnlNaW47CiAgfSBlbHNlIGlmIChtZXNoR2VvbWV0cnkudHlwZSA9PT0gJ0dlb21ldHJ5JykgewogICAgeCA9ICh2ZWN0b3IueCArIDAuNSkgKiAobWVzaEdlb21ldHJ5LnhNYXggLSBtZXNoR2VvbWV0cnkueE1pbikgKyBtZXNoR2VvbWV0cnkueE1pbjsKICAgIHkgPSAodmVjdG9yLnkgKyAwLjUpICogKG1lc2hHZW9tZXRyeS55TWF4IC0gbWVzaEdlb21ldHJ5LnlNaW4pICsgbWVzaEdlb21ldHJ5LnlNaW47CiAgfSBlbHNlIHsKICAgIHRocm93IG5ldyBFcnJvcigiVW5zdXBwb3J0ZWQgZ2VvbWV0cnk6ICIuY29uY2F0KG1lc2hHZW9tZXRyeS50eXBlKSk7CiAgfQoKICB2YXIgeiA9IHZlY3Rvci56IC8gc2NhbGVaOwogIHJldHVybiBuZXcgVmVjdG9yMyh4LCB5LCB6KTsKfSAvLyBHZW5lcmF0ZSBiYWxsLXN0eWxlIGluZGljYXRvcnMKCgpleHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVJbmRpY2F0b3JzKG1lc2hHZW9tZXRyeSwgbnVtUG9pbnRzLCBzY2FsZVosIGNvbG9yLCBvcGFjaXR5KSB7CiAgdmFyIGluZGljYXRvcnMgPSBbXSwKICAgICAgY2VudGVyUG9pbnRHZW5lcmF0ZWQgPSBmYWxzZTsKCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXNoR2VvbWV0cnkudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgIC8vIENvbnZlcnQgd29ybGQgY29vcmRpbmF0ZSB0byAncmVhbCcgcHJvYmUgY29vcmRpbmF0ZXMKICAgIHZhciB4ID0gbWVzaEdlb21ldHJ5LnZlcnRpY2VzW2ldLng7CiAgICB2YXIgeSA9IG1lc2hHZW9tZXRyeS52ZXJ0aWNlc1tpXS55OwogICAgdmFyIHogPSBtZXNoR2VvbWV0cnkudmVydGljZXNbaV0uejsKICAgIHZhciB0cnVlUHJvYmVQb2ludCA9IHRyYW5zbGF0ZUdyaWRQb2ludChtZXNoR2VvbWV0cnksIG5ldyBWZWN0b3IzKHgsIHksIHopLCBzY2FsZVopOyAvLyBTa2lwIGNlbnRlciBwb2ludCBpZiBpdCBhbHJlYWR5IGV4aXN0cwoKICAgIGlmIChNYXRoLnNxcnQodHJ1ZVByb2JlUG9pbnQueCAqIHRydWVQcm9iZVBvaW50LnggKyB0cnVlUHJvYmVQb2ludC55ICogdHJ1ZVByb2JlUG9pbnQueSkgPCBwb2ludFRvbGVyYW5jZSkgewogICAgICBpZiAoY2VudGVyUG9pbnRHZW5lcmF0ZWQpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQoKICAgICAgY2VudGVyUG9pbnRHZW5lcmF0ZWQgPSB0cnVlOwogICAgfSAvLyBJZiB3ZSBoYXZlIGEgY2xvc2UgcG9pbnQsIGNyZWF0ZSBhIG5ldyBpbmRpY2F0b3IKCgogICAgaWYgKCFpc05hTih0cnVlUHJvYmVQb2ludC56KSkgewogICAgICB2YXIgcmFkaXVzID0gbnVtUG9pbnRzID4gNjQgPyBzbWFsbEluZGljYXRvclJhZGl1cyA6IG51bVBvaW50cyA+IDkgPyBtZWRpdW1JbmRpY2F0b3JSYWRpdXMgOiBiaWdJbmRpY2F0b3JSYWRpdXM7CiAgICAgIHZhciBzcGhlcmVHZW9tZXRyeSA9IG5ldyBTcGhlcmVHZW9tZXRyeShyYWRpdXMpOwogICAgICBzcGhlcmVHZW9tZXRyeS5hcHBseU1hdHJpeDQobmV3IE1hdHJpeDQoKS5tYWtlVHJhbnNsYXRpb24oeCwgeSwgeikpOwogICAgICB2YXIgbWF0ZXJpYWwgPSBuZXcgTWVzaEJhc2ljTWF0ZXJpYWwoewogICAgICAgIGNvbG9yOiBjb2xvciwKICAgICAgICBvcGFjaXR5OiBvcGFjaXR5LAogICAgICAgIHRyYW5zcGFyZW50OiB0cnVlCiAgICAgIH0pOwogICAgICB2YXIgc3BoZXJlID0gbmV3IE1lc2goc3BoZXJlR2VvbWV0cnksIG1hdGVyaWFsKTsKICAgICAgc3BoZXJlLmNvb3JkcyA9IHRydWVQcm9iZVBvaW50OwogICAgICBpbmRpY2F0b3JzLnB1c2goc3BoZXJlKTsKICAgIH0KICB9CgogIHJldHVybiBpbmRpY2F0b3JzOwp9CgpmdW5jdGlvbiBnZXROZWFyZXN0Wihwb2ludHMsIHgsIHksIG1heERlbHRhKSB7CiAgLy8gR2V0IHRoZSBwb2ludCB0aGF0IGlzIGNsb3Nlc3QgdG8gWCtZCiAgdmFyIHBvaW50LCBkZWx0YTsKCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwb2ludHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBkZWx0YU5ldyA9IE1hdGguc3FydChNYXRoLnBvdyh4IC0gcG9pbnRzW2ldWzBdLCAyKSArIE1hdGgucG93KHkgLSBwb2ludHNbaV1bMV0sIDIpKTsKCiAgICBpZiAoZGVsdGEgPT09IHVuZGVmaW5lZCB8fCBkZWx0YU5ldyA8IGRlbHRhKSB7CiAgICAgIHBvaW50ID0gcG9pbnRzW2ldOwogICAgICBkZWx0YSA9IGRlbHRhTmV3OwogICAgfQogIH0gLy8gQ2hlY2sgaWYgd2UgZXhjZWVkIHRoZSBtYXhpbXVtIGFsbG93ZWQgZGVsdGEKCgogIGlmIChkZWx0YSA9PT0gdW5kZWZpbmVkIHx8IG1heERlbHRhICE9PSB1bmRlZmluZWQgJiYgZGVsdGEgPiBtYXhEZWx0YSkgewogICAgcmV0dXJuIE5hTjsKICB9IC8vIE90aGVyd2lzZSByZXR1cm4gdGhlIGNsb3Nlc3QgWiBjb29yZGluYXRlIG9mIHRoaXMgcG9pbnQKCgogIHJldHVybiBwb2ludFsyXTsKfSAvLyBHZW5lcmF0ZSBhIG1lc2ggZ2VvbWV0cnkKCgpleHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVNZXNoR2VvbWV0cnkocHJvYmVQb2ludHMsIHhNaW4sIHhNYXgsIHlNaW4sIHlNYXgsIHNjYWxlWikgewogIC8qKiBDYXJ0ZXNpYW4gMy1wb2ludCBhbmQgNS1wb2ludCBiZWQgY29tcGVuc2F0aW9uIChkZXByZWNhdGVkKSAqKi8KICBpZiAocHJvYmVQb2ludHMubGVuZ3RoID09PSAzIHx8IHByb2JlUG9pbnRzLmxlbmd0aCA9PT0gNSkgewogICAgdmFyIGdlb21ldHJ5ID0gbmV3IEdlb21ldHJ5KCk7CiAgICBnZW9tZXRyeS54TWluID0geE1pbjsKICAgIGdlb21ldHJ5LnhNYXggPSB4TWF4OwogICAgZ2VvbWV0cnkueU1pbiA9IHlNaW47CiAgICBnZW9tZXRyeS55TWF4ID0geU1heDsgLy8gR2VuZXJhdGUgdmVydGljZXMKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByb2JlUG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciB4ID0gKHByb2JlUG9pbnRzW2ldWzBdIC0geE1pbikgLyAoeE1heCAtIHhNaW4pIC0gMC41OwogICAgICB2YXIgeSA9IChwcm9iZVBvaW50c1tpXVsxXSAtIHlNaW4pIC8gKHlNYXggLSB5TWluKSAtIDAuNTsKICAgICAgdmFyIHogPSBwcm9iZVBvaW50c1tpXVsyXSAqIHNjYWxlWjsKICAgICAgZ2VvbWV0cnkudmVydGljZXMucHVzaChuZXcgVmVjdG9yMyh4LCB5LCB6KSk7CiAgICB9IC8vIEdlbmVyYXRlIGZhY2VzCgoKICAgIGlmIChwcm9iZVBvaW50cy5sZW5ndGggPT09IDMpIHsKICAgICAgZ2VvbWV0cnkuZmFjZXMucHVzaChuZXcgRmFjZTMoMCwgMSwgMikpOwogICAgfSBlbHNlIHsKICAgICAgZ2VvbWV0cnkuZmFjZXMucHVzaChuZXcgRmFjZTMoMCwgMSwgNCkpOwogICAgICBnZW9tZXRyeS5mYWNlcy5wdXNoKG5ldyBGYWNlMygxLCAyLCA0KSk7CiAgICAgIGdlb21ldHJ5LmZhY2VzLnB1c2gobmV3IEZhY2UzKDIsIDMsIDQpKTsKICAgICAgZ2VvbWV0cnkuZmFjZXMucHVzaChuZXcgRmFjZTMoMywgMCwgNCkpOwogICAgfQoKICAgIHJldHVybiBnZW9tZXRyeTsKICB9CiAgLyoqIE5ldyBncmlkLWJhc2VkIGNvbXBlbnNhdGlvbiAqKi8KICAvLyBGaW5kIG91dCBob3cgbWFueSBkaWZmZXJlbnQgWCtZIGNvb3JkaW5hdGVzIGFyZSB1c2VkCgoKICB2YXIgeFBvaW50cyA9IFtdLAogICAgICB5UG9pbnRzID0gW107CgogIGZvciAodmFyIF9pID0gMDsgX2kgPCBwcm9iZVBvaW50cy5sZW5ndGg7IF9pKyspIHsKICAgIHZhciBfeiA9IHByb2JlUG9pbnRzW19pXVsyXTsKCiAgICBpZiAoIWlzTmFOKF96KSkgewogICAgICB2YXIgX3ggPSBwcm9iZVBvaW50c1tfaV1bMF0sCiAgICAgICAgICBfeSA9IHByb2JlUG9pbnRzW19pXVsxXTsKCiAgICAgIGlmICh4UG9pbnRzLmluZGV4T2YoX3gpID09PSAtMSkgewogICAgICAgIHhQb2ludHMucHVzaChfeCk7CiAgICAgIH0KCiAgICAgIGlmICh5UG9pbnRzLmluZGV4T2YoX3kpID09PSAtMSkgewogICAgICAgIHlQb2ludHMucHVzaChfeSk7CiAgICAgIH0KICAgIH0KICB9IC8vIENoZWNrIGlmIHRoZSBjb29yZGluYXRlcyBhcmUgdmFsaWQKCgogIGlmICgheFBvaW50cy5zb21lKGZ1bmN0aW9uIChwb2ludCkgewogICAgcmV0dXJuICFpc05hTihwb2ludCk7CiAgfSkgfHwgIXlQb2ludHMuc29tZShmdW5jdGlvbiAocG9pbnQpIHsKICAgIHJldHVybiAhaXNOYU4ocG9pbnQpOwogIH0pKSB7CiAgICB0aHJvdyBuZXcgSW52YWxpZEhlaWdodG1hcEVycm9yKCk7CiAgfSAvLyBHZW5lcmF0ZSBwbGFuZSBnZW9tZXRyeSBmb3IgZ3JpZAoKCiAgdmFyIHdpZHRoID0geE1heCAtIHhNaW4sCiAgICAgIGhlaWdodCA9IHlNYXggLSB5TWluOwogIHZhciBwbGFuZVdpZHRoID0gd2lkdGggPCBoZWlnaHQgPyBNYXRoLmFicyh3aWR0aCAvIGhlaWdodCkgOiAxLjA7CiAgdmFyIHBsYW5lSGVpZ2h0ID0gaGVpZ2h0IDwgd2lkdGggPyBNYXRoLmFicyhoZWlnaHQgLyB3aWR0aCkgOiAxLjA7CiAgdmFyIHBsYW5lR2VvbWV0cnkgPSBuZXcgUGxhbmVHZW9tZXRyeShwbGFuZVdpZHRoLCBwbGFuZUhlaWdodCwgeFBvaW50cy5sZW5ndGggLSAxLCB5UG9pbnRzLmxlbmd0aCAtIDEpOwogIHBsYW5lR2VvbWV0cnkueE1pbiA9IHhNaW47CiAgcGxhbmVHZW9tZXRyeS54TWF4ID0geE1heDsKICBwbGFuZUdlb21ldHJ5LnlNaW4gPSB5TWluOwogIHBsYW5lR2VvbWV0cnkueU1heCA9IHlNYXg7CgogIGZvciAodmFyIF9pMiA9IHBsYW5lR2VvbWV0cnkudmVydGljZXMubGVuZ3RoIC0gMTsgX2kyID49IDA7IF9pMi0tKSB7CiAgICB2YXIgX3gyID0gKHBsYW5lR2VvbWV0cnkudmVydGljZXNbX2kyXS54IC8gcGxhbmVXaWR0aCArIDAuNSkgKiB3aWR0aCArIHhNaW47CgogICAgdmFyIF95MiA9IChwbGFuZUdlb21ldHJ5LnZlcnRpY2VzW19pMl0ueSAvIHBsYW5lSGVpZ2h0ICsgMC41KSAqIGhlaWdodCArIHlNaW47CgogICAgdmFyIF96MiA9IGdldE5lYXJlc3RaKHByb2JlUG9pbnRzLCBfeDIsIF95MikgKiBzY2FsZVo7CgogICAgcGxhbmVHZW9tZXRyeS52ZXJ0aWNlc1tfaTJdLnogPSBfejI7CiAgfSAvLyBBZGQgZXh0cmEgZmFjZXMgdG8gZWFjaCB0b3Agcm93IHRvIGF2b2lkIHppZy16YWcgbGluZXMgKGZvciByb3VuZCBncmlkcykKCgogIHZhciB5Q3VycmVudDsKCiAgZm9yICh2YXIgX2kzID0gMTsgX2kzIDwgcGxhbmVHZW9tZXRyeS52ZXJ0aWNlcy5sZW5ndGggLyAyOyBfaTMrKykgewogICAgdmFyIHZlcnRleCA9IHBsYW5lR2VvbWV0cnkudmVydGljZXNbX2kzXSwKICAgICAgICBfcHJldlZlcnRleCA9IHBsYW5lR2VvbWV0cnkudmVydGljZXNbX2kzIC0gMV07CgogICAgaWYgKCFpc05hTihfcHJldlZlcnRleC56KSAmJiBpc05hTih2ZXJ0ZXgueikpIHsKICAgICAgdmFyIHlQb2ludCA9IHZlcnRleC55OwoKICAgICAgaWYgKHlDdXJyZW50ID09PSB1bmRlZmluZWQgfHwgeUN1cnJlbnQgPiB5UG9pbnQpIHsKICAgICAgICAvLyBXZSBhcmUgYXQgdGhlIGxhc3QgZGVmaW5lZCBwb2ludCBpbiB0aGlzIHJvdwogICAgICAgIHlDdXJyZW50ID0geVBvaW50OyAvLyBGaW5kIHRoZSBuZXh0IHR3byBwb2ludHMgYmVsb3cgYW5kIGJlbG93K3JpZ2h0IHRvIHRoaXMgb25lCgogICAgICAgIHZhciBhID0gdm9pZCAwLAogICAgICAgICAgICBiID0gdm9pZCAwOwoKICAgICAgICBmb3IgKHZhciBrID0gX2kzICsgMTsgayA8IHBsYW5lR2VvbWV0cnkudmVydGljZXMubGVuZ3RoIC0gMTsgaysrKSB7CiAgICAgICAgICB2YXIgbmV4dFZlcnRleCA9IHBsYW5lR2VvbWV0cnkudmVydGljZXNba107CgogICAgICAgICAgaWYgKG5leHRWZXJ0ZXgueCA9PT0gX3ByZXZWZXJ0ZXgueCAmJiBuZXh0VmVydGV4LnkgPT09IHBsYW5lR2VvbWV0cnkudmVydGljZXNbayArIDFdLnkpIHsKICAgICAgICAgICAgYSA9IGs7CiAgICAgICAgICAgIGIgPSBrICsgMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBJZiB0aGF0IHN1Y2NlZWRzIGFkZCBhIG5ldyBmYWNlCgoKICAgICAgICBpZiAoYSAhPT0gdW5kZWZpbmVkICYmICFpc05hTihwbGFuZUdlb21ldHJ5LnZlcnRpY2VzW2FdLnopICYmICFpc05hTihwbGFuZUdlb21ldHJ5LnZlcnRpY2VzW2JdLnopKSB7CiAgICAgICAgICB2YXIgZmFjZSA9IG5ldyBGYWNlMyhhLCBiLCBfaTMgLSAxKTsKICAgICAgICAgIHBsYW5lR2VvbWV0cnkuZmFjZXMucHVzaChmYWNlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9IC8vIEFkZCBleHRyYSBmYWNlcyB0byBlYWNoIGJvdHRvbSByb3cgdG8gYXZvaWQgemlnLXphZyBsaW5lcyAoZm9yIHJvdW5kIGdyaWRzKQoKCiAgdmFyIHByZXZWZXJ0ZXg7CgogIGZvciAodmFyIF9pNCA9IE1hdGguZmxvb3IocGxhbmVHZW9tZXRyeS52ZXJ0aWNlcy5sZW5ndGggLyAyKTsgX2k0IDwgcGxhbmVHZW9tZXRyeS52ZXJ0aWNlcy5sZW5ndGg7IF9pNCsrKSB7CiAgICB2YXIgX3ZlcnRleCA9IHBsYW5lR2VvbWV0cnkudmVydGljZXNbX2k0XTsgLy8gQ2hlY2sgaWYgdGhpcyBpcyB0aGUgZmlyc3QgZGVmaW5lZCBwb2ludCBpbiB0aGlzIHJvdwoKICAgIGlmIChwcmV2VmVydGV4ICE9PSB1bmRlZmluZWQgJiYgcHJldlZlcnRleC55ID09PSBfdmVydGV4LnkgJiYgaXNOYU4ocHJldlZlcnRleC56KSAmJiAhaXNOYU4oX3ZlcnRleC56KSkgewogICAgICAvLyBGaW5kIHRoZSB0d28gcG9pbnRzIGFib3ZlIGFuZCBhYm92ZStsZWZ0IHRvIHRoaXMgb25lCiAgICAgIHZhciBfYSA9IHZvaWQgMCwKICAgICAgICAgIF9iID0gdm9pZCAwOwoKICAgICAgZm9yICh2YXIgX2sgPSBfaTQgLSAxOyBfayA+IDA7IF9rLS0pIHsKICAgICAgICB2YXIgX3ByZXZWZXJ0ZXgyID0gcGxhbmVHZW9tZXRyeS52ZXJ0aWNlc1tfa107CgogICAgICAgIGlmIChfcHJldlZlcnRleDIueCA9PT0gX3ZlcnRleC54ICYmIF9wcmV2VmVydGV4Mi55ID09PSBwbGFuZUdlb21ldHJ5LnZlcnRpY2VzW19rIC0gMV0ueSkgewogICAgICAgICAgX2EgPSBfayAtIDE7CiAgICAgICAgICBfYiA9IF9rOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9IC8vIElmIHRoYXQgc3VjY2VlZHMgYWRkIGEgbmV3IGZhY2UKCgogICAgICBpZiAoX2EgIT09IHVuZGVmaW5lZCAmJiAhaXNOYU4ocGxhbmVHZW9tZXRyeS52ZXJ0aWNlc1tfYV0ueikgJiYgIWlzTmFOKHBsYW5lR2VvbWV0cnkudmVydGljZXNbX2JdLnopKSB7CiAgICAgICAgdmFyIF9mYWNlID0gbmV3IEZhY2UzKF9hLCBfYiwgX2k0KTsKCiAgICAgICAgcGxhbmVHZW9tZXRyeS5mYWNlcy5wdXNoKF9mYWNlKTsKICAgICAgfQogICAgfQoKICAgIHByZXZWZXJ0ZXggPSBfdmVydGV4OwogIH0gLy8gUmVtb3ZlIGFsbCB0aGUgcG9pbnRzIGFuZCBmYWNlcyB0aGF0IGhhdmUgaW52YWxpZCB2YWx1ZXMKCgogIGZvciAodmFyIF9pNSA9IHBsYW5lR2VvbWV0cnkudmVydGljZXMubGVuZ3RoIC0gMTsgX2k1ID49IDA7IF9pNS0tKSB7CiAgICBpZiAoaXNOYU4ocGxhbmVHZW9tZXRyeS52ZXJ0aWNlc1tfaTVdLnopKSB7CiAgICAgIC8vIFJlbW92ZSBhbmQgcmVhcnJhbmdlIHRoZSBhc3NvY2lhdGVkIGZhY2UocykKICAgICAgZm9yICh2YXIgX2syID0gcGxhbmVHZW9tZXRyeS5mYWNlcy5sZW5ndGggLSAxOyBfazIgPj0gMDsgX2syLS0pIHsKICAgICAgICB2YXIgX2ZhY2UyID0gcGxhbmVHZW9tZXRyeS5mYWNlc1tfazJdOwoKICAgICAgICBpZiAoX2ZhY2UyLmEgPT09IF9pNSB8fCBfZmFjZTIuYiA9PT0gX2k1IHx8IF9mYWNlMi5jID09PSBfaTUpIHsKICAgICAgICAgIHBsYW5lR2VvbWV0cnkuZmFjZXMuc3BsaWNlKF9rMiwgMSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChfZmFjZTIuYSA+IF9pNSkgewogICAgICAgICAgICBfZmFjZTIuYS0tOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChfZmFjZTIuYiA+IF9pNSkgewogICAgICAgICAgICBfZmFjZTIuYi0tOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChfZmFjZTIuYyA+IF9pNSkgewogICAgICAgICAgICBfZmFjZTIuYy0tOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBSZW1vdmUgdGhpcyB2ZXJ0ZXgKCgogICAgICBwbGFuZUdlb21ldHJ5LnZlcnRpY2VzLnNwbGljZShfaTUsIDEpOwogICAgfQogIH0KCiAgcmV0dXJuIHBsYW5lR2VvbWV0cnk7Cn0="},{"version":3,"sources":["C:/Users/jpatrick/Documents/GitHub/DuetWebControl_Fork/src/utils/3d.js"],"names":["Color","Vector3","Face3","SphereGeometry","Matrix4","Mesh","MeshBasicMaterial","Geometry","PlaneGeometry","i18n","InvalidHeightmapError","pointTolerance","smallIndicatorRadius","mediumIndicatorRadius","bigIndicatorRadius","drawLegend","canvas","maxVisualizationZ","colorScheme","context","getContext","rect","width","height","fillStyle","fill","font","textAlign","fillText","t","showAxes","scaleHeight","gradient","createLinearGradient","addColorStop","fillRect","getColorByZ","z","Math","max","min","hue","abs","setFaceColors","geometry","scaleZ","i","faces","length","face","a","vertices","b","c","vertexColors","copy","colorsNeedUpdate","translateGridPoint","meshGeometry","vector","x","y","type","parameters","xMax","xMin","yMax","yMin","Error","generateIndicators","numPoints","color","opacity","indicators","centerPointGenerated","trueProbePoint","sqrt","isNaN","radius","sphereGeometry","applyMatrix4","makeTranslation","material","transparent","sphere","coords","push","getNearestZ","points","maxDelta","point","delta","deltaNew","pow","undefined","NaN","generateMeshGeometry","probePoints","xPoints","yPoints","indexOf","some","planeWidth","planeHeight","planeGeometry","yCurrent","vertex","prevVertex","yPoint","k","nextVertex","floor","splice"],"mappings":"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","sourcesContent":["'use strict'\r\n\r\nimport { Color, Vector3, Face3, SphereGeometry, Matrix4, Mesh, MeshBasicMaterial, Geometry, PlaneGeometry } from 'three'\r\n\r\nimport i18n from '../i18n'\r\nimport { InvalidHeightmapError } from './errors.js'\r\n\r\nconst pointTolerance = 2.0\r\nconst smallIndicatorRadius = 0.01, mediumIndicatorRadius = 0.02, bigIndicatorRadius = 0.05\r\n\r\n// Draw scale+legend next to the 3D control\r\nexport function drawLegend(canvas, maxVisualizationZ, colorScheme) {\r\n\t// Clear background\r\n\tconst context = canvas.getContext('2d');\r\n\tcontext.rect(0, 0, canvas.width, canvas.height);\r\n\tcontext.fillStyle = 'black';\r\n\tcontext.fill();\r\n\r\n\t// Put annotations above gradient\r\n\tcontext.font = '14px Roboto,sans-serif';\r\n\tcontext.textAlign = 'center';\r\n\tcontext.fillStyle = 'white';\r\n\tcontext.fillText(i18n.t('panel.heightmap.scale'), canvas.width / 2, 21);\r\n\tcontext.fillText(`${maxVisualizationZ} mm`, canvas.width / 2, 44);\r\n\tcontext.fillText(i18n.t('panel.heightmap.orMore'), canvas.width / 2, 60);\r\n\r\n\t// Make scale gradient\r\n\tconst showAxes = canvas.height > 180;\r\n\tlet scaleHeight = showAxes ? (canvas.height - 139) : (canvas.height - 96);\r\n\tif (colorScheme === 'terrain') {\r\n\t\tscaleHeight -= 16;\r\n\t}\r\n\r\n\tconst gradient = context.createLinearGradient(0, 66, 0, 66 + scaleHeight);\r\n\tif (colorScheme === 'terrain') {\r\n\t\tgradient.addColorStop(0.0, 'hsl(0,100%,45%)');\r\n\t\tgradient.addColorStop(0.25, 'hsl(60,100%,45%)');\r\n\t\tgradient.addColorStop(0.5, 'hsl(120,100%,45%)');\r\n\t\tgradient.addColorStop(0.75, 'hsl(180,100%,45%)');\r\n\t\tgradient.addColorStop(1.0, 'hsl(240,100%,45%)');\r\n\t} else {\r\n\t\tgradient.addColorStop(0.0, 'hsl(0,100%,45%)');\r\n\t\tgradient.addColorStop(0.5, 'hsl(60,100%,45%)');\r\n\t\tgradient.addColorStop(1.0, 'hsl(120,100%,45%)');\r\n\t}\r\n\tcontext.fillStyle = gradient;\r\n\tcontext.fillRect(canvas.width / 2 - 12, 66, 24, scaleHeight);\r\n\r\n\t// Put annotation below gradient\r\n\tcontext.fillStyle = 'white';\r\n\tif (colorScheme === 'terrain') {\r\n\t\tcontext.fillText(`${-maxVisualizationZ} mm`, canvas.width / 2, scaleHeight + 82);\r\n\t\tcontext.fillText(i18n.t('panel.heightmap.orLess'), canvas.width / 2, scaleHeight + 98);\r\n\t\tscaleHeight += 16;\r\n\t} else {\r\n\t\tcontext.fillText('0.00 mm', canvas.width / 2, scaleHeight + 82);\r\n\t}\r\n\r\n\t// Add axes\r\n\tif (showAxes) {\r\n\t\tcontext.fillText(i18n.t('panel.heightmap.axes'), canvas.width / 2, scaleHeight + 109);\r\n\t\tcontext.font = 'bold ' + context.font;\r\n\t\tcontext.fillStyle = 'rgb(255,0,0)';\r\n\t\tcontext.fillText('X', canvas.width / 3, scaleHeight + 129);\r\n\t\tcontext.fillStyle = 'rgb(0,255,0)';\r\n\t\tcontext.fillText('Y', canvas.width / 2, scaleHeight + 129);\r\n\t\tcontext.fillStyle = 'rgb(0,0,255)';\r\n\t\tcontext.fillText('Z', 2 * canvas.width / 3, scaleHeight + 129);\r\n\t}\r\n}\r\n\r\nfunction getColorByZ(z, colorScheme, maxVisualizationZ) {\r\n\t// Terrain color scheme (i.e. from blue to red, asymmetric)\r\n\tif (colorScheme === 'terrain') {\r\n\t\tz = Math.max(Math.min(z, maxVisualizationZ), -maxVisualizationZ);\r\n\t\tconst hue = 240 - ((z + maxVisualizationZ) / maxVisualizationZ) * 120;\r\n\t\treturn new Color('hsl(' + hue + ',100%,45%)');\r\n\t}\r\n\r\n\t// Default color scheme (i.e. the worse the redder, symmetric)\r\n\tconst hue = 120 - Math.min(Math.abs(z), maxVisualizationZ) / maxVisualizationZ * 120;\r\n\treturn new Color('hsl(' + hue + ',100%,45%)');\r\n}\r\n\r\n// Apply colors to the faces\r\nexport function setFaceColors(geometry, scaleZ, colorScheme, maxVisualizationZ) {\r\n\tfor (let i = 0; i < geometry.faces.length; i++) {\r\n\t\tconst face = geometry.faces[i];\r\n\t\tconst a = getColorByZ(geometry.vertices[face.a].z / scaleZ, colorScheme, maxVisualizationZ);\r\n\t\tconst b = getColorByZ(geometry.vertices[face.b].z / scaleZ, colorScheme, maxVisualizationZ);\r\n\t\tconst c = getColorByZ(geometry.vertices[face.c].z / scaleZ, colorScheme, maxVisualizationZ);\r\n\r\n\t\tif (face.vertexColors.length < 3) {\r\n\t\t\tface.vertexColors = [a, b, c];\r\n\t\t} else {\r\n\t\t\tface.vertexColors[0].copy(a);\r\n\t\t\tface.vertexColors[1].copy(b);\r\n\t\t\tface.vertexColors[2].copy(c);\r\n\t\t}\r\n\t}\r\n\tgeometry.colorsNeedUpdate = true;\r\n}\r\n\r\nfunction translateGridPoint(meshGeometry, vector, scaleZ) {\r\n\tlet x, y;\r\n\tif (meshGeometry.type === 'PlaneGeometry') {\r\n\t\tx = (vector.x / meshGeometry.parameters.width + 0.5) * (meshGeometry.xMax - meshGeometry.xMin) + meshGeometry.xMin;\r\n\t\ty = (vector.y / meshGeometry.parameters.height + 0.5) * (meshGeometry.yMax - meshGeometry.yMin) + meshGeometry.yMin;\r\n\t} else if (meshGeometry.type === 'Geometry') {\r\n\t\tx = (vector.x + 0.5) * (meshGeometry.xMax - meshGeometry.xMin) + meshGeometry.xMin;\r\n\t\ty = (vector.y + 0.5) * (meshGeometry.yMax - meshGeometry.yMin) + meshGeometry.yMin;\r\n\t} else {\r\n\t\tthrow new Error(`Unsupported geometry: ${meshGeometry.type}`);\r\n\t}\r\n\tconst z = vector.z / scaleZ;\r\n\treturn new Vector3(x, y, z);\r\n}\r\n\r\n// Generate ball-style indicators\r\nexport function generateIndicators(meshGeometry, numPoints, scaleZ, color, opacity) {\r\n\tlet indicators = [], centerPointGenerated = false;\r\n\r\n\tfor (let i = 0; i < meshGeometry.vertices.length; i++) {\r\n\t\t// Convert world coordinate to 'real' probe coordinates\r\n\t\tconst x = meshGeometry.vertices[i].x;\r\n\t\tconst y = meshGeometry.vertices[i].y;\r\n\t\tconst z = meshGeometry.vertices[i].z;\r\n\t\tconst trueProbePoint = translateGridPoint(meshGeometry, new Vector3(x, y, z), scaleZ);\r\n\r\n\t\t// Skip center point if it already exists\r\n\t\tif (Math.sqrt(trueProbePoint.x * trueProbePoint.x + trueProbePoint.y * trueProbePoint.y) < pointTolerance) {\r\n\t\t\tif (centerPointGenerated) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tcenterPointGenerated = true;\r\n\t\t}\r\n\r\n\t\t// If we have a close point, create a new indicator\r\n\t\tif (!isNaN(trueProbePoint.z)) {\r\n\t\t\tconst radius = (numPoints > 64) ? smallIndicatorRadius\r\n\t\t\t\t: (numPoints > 9) ? mediumIndicatorRadius\r\n\t\t\t\t\t: bigIndicatorRadius;\r\n\t\t\tconst sphereGeometry = new SphereGeometry(radius);\r\n\t\t\tsphereGeometry.applyMatrix4(new Matrix4().makeTranslation(x, y, z));\r\n\r\n\t\t\tconst material = new MeshBasicMaterial({ color, opacity, transparent: true });\r\n\t\t\tconst sphere = new Mesh(sphereGeometry, material);\r\n\t\t\tsphere.coords = trueProbePoint;\r\n\r\n\t\t\tindicators.push(sphere);\r\n\t\t}\r\n\t}\r\n\r\n\treturn indicators;\r\n}\r\n\r\nfunction getNearestZ(points, x, y, maxDelta) {\r\n\t// Get the point that is closest to X+Y\r\n\tlet point, delta;\r\n\tfor (let i = 0; i < points.length; i++) {\r\n\t\tconst deltaNew = Math.sqrt(Math.pow(x - points[i][0], 2) + Math.pow(y - points[i][1], 2));\r\n\t\tif (delta === undefined || deltaNew < delta) {\r\n\t\t\tpoint = points[i];\r\n\t\t\tdelta = deltaNew;\r\n\t\t}\r\n\t}\r\n\r\n\t// Check if we exceed the maximum allowed delta\r\n\tif (delta === undefined || (maxDelta !== undefined && delta > maxDelta)) {\r\n\t\treturn NaN;\r\n\t}\r\n\r\n\t// Otherwise return the closest Z coordinate of this point\r\n\treturn point[2];\r\n}\r\n\r\n// Generate a mesh geometry\r\nexport function generateMeshGeometry(probePoints, xMin, xMax, yMin, yMax, scaleZ) {\r\n\t/** Cartesian 3-point and 5-point bed compensation (deprecated) **/\r\n\r\n\tif (probePoints.length === 3 || probePoints.length === 5) {\r\n\t\tconst geometry = new Geometry();\r\n\t\tgeometry.xMin = xMin;\r\n\t\tgeometry.xMax = xMax;\r\n\t\tgeometry.yMin = yMin;\r\n\t\tgeometry.yMax = yMax;\r\n\r\n\t\t// Generate vertices\r\n\t\tfor (let i = 0; i < probePoints.length; i++) {\r\n\t\t\tconst x = (probePoints[i][0] - xMin) / (xMax - xMin) - 0.5;\r\n\t\t\tconst y = (probePoints[i][1] - yMin) / (yMax - yMin) - 0.5;\r\n\t\t\tconst z = probePoints[i][2] * scaleZ;\r\n\r\n\t\t\tgeometry.vertices.push(new Vector3(x, y, z));\r\n\t\t}\r\n\r\n\t\t// Generate faces\r\n\t\tif (probePoints.length === 3) {\r\n\t\t\tgeometry.faces.push(new Face3(0, 1, 2));\r\n\t\t} else {\r\n\t\t\tgeometry.faces.push(new Face3(0, 1, 4));\r\n\t\t\tgeometry.faces.push(new Face3(1, 2, 4));\r\n\t\t\tgeometry.faces.push(new Face3(2, 3, 4));\r\n\t\t\tgeometry.faces.push(new Face3(3, 0, 4));\r\n\t\t}\r\n\r\n\t\treturn geometry;\r\n\t}\r\n\r\n\t/** New grid-based compensation **/\r\n\r\n\t// Find out how many different X+Y coordinates are used\r\n\tconst xPoints = [], yPoints = [];\r\n\tfor (let i = 0; i < probePoints.length; i++) {\r\n\t\tconst z = probePoints[i][2];\r\n\t\tif (!isNaN(z)) {\r\n\t\t\tconst x = probePoints[i][0], y = probePoints[i][1];\r\n\t\t\tif (xPoints.indexOf(x) === -1) {\r\n\t\t\t\txPoints.push(x);\r\n\t\t\t}\r\n\t\t\tif (yPoints.indexOf(y) === -1) {\r\n\t\t\t\tyPoints.push(y);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Check if the coordinates are valid\r\n\tif (!xPoints.some(point => !isNaN(point)) || !yPoints.some(point => !isNaN(point))) {\r\n\t\tthrow new InvalidHeightmapError();\r\n\t}\r\n\r\n\t// Generate plane geometry for grid\r\n\tconst width = xMax - xMin, height = yMax - yMin;\r\n\tconst planeWidth = (width < height) ? Math.abs(width / height) : 1.0;\r\n\tconst planeHeight = (height < width) ? Math.abs(height / width) : 1.0;\r\n\r\n\tconst planeGeometry = new PlaneGeometry(planeWidth, planeHeight, xPoints.length - 1, yPoints.length - 1);\r\n\tplaneGeometry.xMin = xMin;\r\n\tplaneGeometry.xMax = xMax;\r\n\tplaneGeometry.yMin = yMin;\r\n\tplaneGeometry.yMax = yMax;\r\n\r\n\tfor (let i = planeGeometry.vertices.length - 1; i >= 0; i--) {\r\n\t\tconst x = ((planeGeometry.vertices[i].x / planeWidth) + 0.5) * width + xMin;\r\n\t\tconst y = ((planeGeometry.vertices[i].y / planeHeight) + 0.5) * height + yMin;\r\n\t\tconst z = getNearestZ(probePoints, x, y) * scaleZ;\r\n\r\n\t\tplaneGeometry.vertices[i].z = z;\r\n\t}\r\n\r\n\t// Add extra faces to each top row to avoid zig-zag lines (for round grids)\r\n\tlet yCurrent;\r\n\tfor (let i = 1; i < planeGeometry.vertices.length / 2; i++) {\r\n\t\tconst vertex = planeGeometry.vertices[i], prevVertex = planeGeometry.vertices[i - 1];\r\n\r\n\t\tif (!isNaN(prevVertex.z) && isNaN(vertex.z)) {\r\n\t\t\tvar yPoint = vertex.y;\r\n\t\t\tif (yCurrent === undefined || yCurrent > yPoint) {\r\n\t\t\t\t// We are at the last defined point in this row\r\n\t\t\t\tyCurrent = yPoint;\r\n\r\n\t\t\t\t// Find the next two points below and below+right to this one\r\n\t\t\t\tlet a, b;\r\n\t\t\t\tfor (let k = i + 1; k < planeGeometry.vertices.length - 1; k++) {\r\n\t\t\t\t\tconst nextVertex = planeGeometry.vertices[k];\r\n\t\t\t\t\tif (nextVertex.x === prevVertex.x && nextVertex.y === planeGeometry.vertices[k + 1].y) {\r\n\t\t\t\t\t\ta = k;\r\n\t\t\t\t\t\tb = k + 1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// If that succeeds add a new face\r\n\t\t\t\tif (a !== undefined && !isNaN(planeGeometry.vertices[a].z) && !isNaN(planeGeometry.vertices[b].z)) {\r\n\t\t\t\t\tconst face = new Face3(a, b, i - 1);\r\n\t\t\t\t\tplaneGeometry.faces.push(face);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Add extra faces to each bottom row to avoid zig-zag lines (for round grids)\r\n\tlet prevVertex;\r\n\tfor (let i = Math.floor(planeGeometry.vertices.length / 2); i < planeGeometry.vertices.length; i++) {\r\n\t\tconst vertex = planeGeometry.vertices[i];\r\n\r\n\t\t// Check if this is the first defined point in this row\r\n\t\tif (prevVertex !== undefined && prevVertex.y === vertex.y && isNaN(prevVertex.z) && !isNaN(vertex.z)) {\r\n\t\t\t// Find the two points above and above+left to this one\r\n\t\t\tlet a, b;\r\n\t\t\tfor (let k = i - 1; k > 0; k--) {\r\n\t\t\t\tconst prevVertex = planeGeometry.vertices[k];\r\n\t\t\t\tif (prevVertex.x === vertex.x && prevVertex.y === planeGeometry.vertices[k - 1].y) {\r\n\t\t\t\t\ta = k - 1;\r\n\t\t\t\t\tb = k;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// If that succeeds add a new face\r\n\t\t\tif (a !== undefined && !isNaN(planeGeometry.vertices[a].z) && !isNaN(planeGeometry.vertices[b].z)) {\r\n\t\t\t\tconst face = new Face3(a, b, i);\r\n\t\t\t\tplaneGeometry.faces.push(face);\r\n\t\t\t}\r\n\t\t}\r\n\t\tprevVertex = vertex;\r\n\t}\r\n\r\n\t// Remove all the points and faces that have invalid values\r\n\tfor (let i = planeGeometry.vertices.length - 1; i >= 0; i--) {\r\n\t\tif (isNaN(planeGeometry.vertices[i].z)) {\r\n\t\t\t// Remove and rearrange the associated face(s)\r\n\t\t\tfor (let k = planeGeometry.faces.length - 1; k >= 0; k--) {\r\n\t\t\t\tconst face = planeGeometry.faces[k];\r\n\t\t\t\tif (face.a === i || face.b === i || face.c === i) {\r\n\t\t\t\t\tplaneGeometry.faces.splice(k, 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (face.a > i) { face.a--; }\r\n\t\t\t\t\tif (face.b > i) { face.b--; }\r\n\t\t\t\t\tif (face.c > i) { face.c--; }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Remove this vertex\r\n\t\t\tplaneGeometry.vertices.splice(i, 1);\r\n\t\t}\r\n\t}\r\n\r\n\treturn planeGeometry;\r\n}\r\n"]}]}